<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/blog-web/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css"><title>选择页面内容范围 | Blog</title><meta name="description" content="A blog and knowledge management system about web.">
    <link rel="modulepreload" href="/blog-web/assets/app.43fe0c63.js"><link rel="modulepreload" href="/blog-web/assets/选择页面内容范围.html.94e76c3d.js"><link rel="modulepreload" href="/blog-web/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/blog-web/assets/选择页面内容范围.html.cf0fb883.js">
    <link rel="stylesheet" href="/blog-web/assets/style.b42fd117.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="min-h-screen flex flex-col"><nav class="px-4 sm:px-8 py-2 flex justify-between items-center sticky top-0 z-30 bg-white"><div class="left flex items-center space-x-0.5"><!--[--><button class="text-gray-400 hover:bg-gray-100 catelog-btn p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--><a class="avatar p-2 hover:bg-gray-100 rounded-md" href="/blog-web/#"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="right hidden sm:flex items-center space-x-0.5"><!--[--><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">All</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Network</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Frontend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Backend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Project</button><!--]--><!--[--><button class="text-gray-900 bg-gray-100 hover:bg-gray-200 p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md hidden lg:block"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--></div><div class="more-container sm:hidden relative"><button style="" class="p-2 select-none hover:bg-gray-100 rounded-md text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"></path></svg></button><button style="display:none;" class="p-2 select-none hover:bg-gray-100 rounded-md text-red-400 hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path></svg></button><div style="display:none;" class="more-modal p-2 absolute top-10 right-0 z-10 flex flex-col space-y-2 bg-gray-100 rounded-md opacity-90"><!--[--><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">All</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Network</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Frontend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Backend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Project</button><!--]--></div></div></nav><div class="relative flex-grow"><div class="theme-container no-navbar no-sidebar"><!--[--><!----><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="选择页面内容范围" tabindex="-1"><a class="header-anchor" href="#选择页面内容范围" aria-hidden="true">#</a> 选择页面内容范围</h1><h2 id="范围" tabindex="-1"><a class="header-anchor" href="#范围" aria-hidden="true">#</a> 范围</h2><p>如果我们在进行页面内容选择时需要理解一个基本概念，即范围 Range。范围本质上是一对「边界点」，范围起点和范围终点。</p><p>可以使用构造器 <code>Range()</code> 创建的一个范围（构造器没有参数）</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>let range = new Range();
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>范围对象有多种方法和属性，用以创建范围或对范围内的（被选中）内容进行操作，如使用方法 <code>range.setStart(node, offset)</code> 和 <code>range.setEnd(node, offset)</code> 来设置选择边界，其中 <strong><code>node</code> 既可以是文本节点，也可以是元素节点，对于文本节点，偏移量 <code>offset</code> 表示字符数，而对于元素节点则是子节点数</strong>。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Example: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">&gt;</span></span>italic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> and <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>bold<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Range</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 基于元素节点设定范围</span>
  range<span class="token punctuation">.</span><span class="token function">setStart</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  range<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 范围的 toString 以文本形式返回其内容（不带标签）</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Example: italic</span>

  <span class="token comment">// 将此范围应用于文档选择（视觉上）</span>
  document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><img src="/blog-web/assets/20200511202309522_1941.c6c3910f.png" alt="DOM 结构"></p><p><img src="/blog-web/assets/20200511202328187_23168.a7a194f7.png" alt="节点顺序"></p><p><img src="data:image/png;base64,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" alt="output"></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>p<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Example: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span><span class="token punctuation">&gt;</span></span>italic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> and <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>bold<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">let</span> range <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Range</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 基于文本节点设定范围</span>
  range<span class="token punctuation">.</span><span class="token function">setStart</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>firstChild<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  range<span class="token punctuation">.</span><span class="token function">setEnd</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;b&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>firstChild<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">alert</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ample: italic and bol</span>

  <span class="token comment">// 使用此范围进行选择（后文有解释）</span>
  window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="/blog-web/assets/20200511202504754_8493.389938fe.png" alt="output illustration"></p><h3 id="范围对象的属性" tabindex="-1"><a class="header-anchor" href="#范围对象的属性" aria-hidden="true">#</a> 范围对象的属性</h3><p><img src="/blog-web/assets/20200511202836643_10650.7266dda5.png" alt="range properties"></p><ul><li><code>startContainer</code>，<code>startOffset</code> 起始节点和偏移量</li><li><code>endContainer</code>，<code>endOffset</code> 结束节点和偏移量</li><li><code>collapsed</code> 布尔值，如果范围在同一点上开始和结束（所以范围内没有内容）则为 <code>true</code></li><li><code>commonAncestorContainer</code> 在范围内的所有节点中最近的共同祖先节点</li></ul><h3 id="范围对象的方法" tabindex="-1"><a class="header-anchor" href="#范围对象的方法" aria-hidden="true">#</a> 范围对象的方法</h3><p>有许多便利的方法可以操纵范围，使用这些方法基本上可以对选定的内容/节点执行任何操作。</p><p><strong>设置范围的起点</strong></p><ul><li><code>setStart(node, offset)</code> 将起点设置在：<code>node</code> 中的位置 <code>offset</code></li><li><code>setStartBefore(node)</code> 将起点设置在：<code>node</code> 前面</li><li><code>setStartAfter(node)</code> 将起点设置在：<code>node</code> 后面</li></ul><p><strong>设置范围的终点</strong></p><ul><li><code>setEnd(node, offset)</code> 将终点设置为：<code>node</code> 中的位置 <code>offset</code></li><li><code>setEndBefore(node)</code> 将终点设置为：<code>node</code> 前面</li><li><code>setEndAfter(node)</code> 将终点设置为：<code>node</code> 后面</li></ul><p><strong>操纵范围内的内容</strong></p><ul><li><code>deleteContents()</code> 从文档中删除范围内容</li><li><code>extractContents()</code> 从文档中删除范围内容，并将删除的内容作为 <a href="https://zh.javascript.info/modifying-document#document-fragment" target="_blank" rel="noopener noreferrer">DocumentFragment</a> 返回</li><li><code>cloneContents()</code> 复制范围内容，并将删除的内容作为 <a href="https://zh.javascript.info/modifying-document#document-fragment" target="_blank" rel="noopener noreferrer">DocumentFragment</a> 返回</li><li><code>insertNode(node)</code> 在范围的起始处将 <code>node</code> 插入文档</li><li><code>surroundContents(node)</code> 使用 <code>node</code> 将所选范围内容包裹起来。要使此操作有效，则该范围必须包含其中所有元素的开始和结束标签：不能像 <code>&lt;i&gt;abc</code> 这样的部分范围。</li></ul><p><strong>其他</strong></p><ul><li><code>selectNode(node)</code> 设置范围以选择整个 <code>node</code></li><li><code>selectNodeContents(node)</code> 设置范围以选择整个 <code>node</code> 的内容</li><li><code>collapse(toStart)</code> 如果 <code>toStart=true</code> 则设置 end=start，否则设置 start=end，从而折叠范围</li><li><code>cloneRange()</code> 创建一个具有相同起点/终点的新范围</li></ul><p>💡 <code>node</code> 既可以是文本节点，也可以是元素节点：对于文本节点，<code>offset</code> 偏移的是字符数，而对于元素节点则是子节点数</p><h2 id="选择" tabindex="-1"><a class="header-anchor" href="#选择" aria-hidden="true">#</a> 选择</h2><p>范围对象 <code>range</code> 用于管理选择的范围，但选中的内容在页面视觉上不会显示，需要由选择对象 <code>Selection</code> 依据范围进行设置，即范围是「更底层」的对象。</p><p>文档选择是由 <code>Selection</code> 对象表示的，可通过方法 <code>window.getSelection()</code> 或 <code>document.getSelection()</code> 来获取/设置。</p><p>💡 根据 <a href="https://www.w3.org/TR/selection-api/" target="_blank" rel="noopener noreferrer">Selection API 规范</a> 描述，一个页面的选择对象可以包括零个或多个范围，不过实际上，一般浏览器最多支持 1 个范围，只有 Firefox 允许使用 Ctrl+click (Mac 上用 Cmd+click) 在文档中选择多个范围。</p><p><img src="/blog-web/assets/20200511203729395_10632.3cb1b4ee.png" alt="在 Firefox 中可同时选中 3 个范围"></p><p>💡 需要厘清两个重要的概念，选择的起点称为 <strong>锚点 anchor</strong>，而选择的终点称为 <strong>焦点 focus</strong>，一般选择的锚点在焦点之前，但是有些操作方式，如鼠标，允许从两个方向创建相同的选择，即「从左到右」和「从右到左」，就会造成选择的终点可能在起点之前。而这始终指向前方（范围的起点不能在终点之后）的 <code>Range</code> 对象不同。</p><ul><li>如果在文档中，选择的锚点（anchor）在焦点（focus）之前，则称此选择具有 forward 方向。 <img src="/blog-web/assets/20200511204354363_19856.38e74548.png" alt="forward"></li><li>如果在文档中，选择的焦点（focus）在锚点（anchor）之前，则称此选择具有 backward 方向。 <img src="/blog-web/assets/20200511204410285_26549.56e627c7.png" alt="backward"></li></ul><h3 id="选择对象的方法" tabindex="-1"><a class="header-anchor" href="#选择对象的方法" aria-hidden="true">#</a> 选择对象的方法</h3><p><strong>添加/移除范围的选择方法</strong></p><ul><li><code>getRangeAt(i)</code> 将选择范围设置为从 <code>0</code> 开始的第 i 个范围。在除 Firefox 之外的所有浏览器中，仅使用 <code>0</code>。</li><li><code>addRange(range)</code> 将 <code>range</code> 添加到选择范围中。⚠️ 如果选择已有关联的范围，则除 Firefox 外的所有浏览器都将忽略该调用，因此如果选择已存在应该先使用 <code>removeAllRanges()</code> 将其清空，然后添加范围。否则，除 Firefox 外的所有浏览器都将忽略新范围。</li><li><code>removeRange(range)</code> 从选择范围中删除 <code>range</code>。</li><li><code>removeAllRanges()</code> 删除所有选择范围。</li><li><code>empty()</code> 方法 <code>removeAllRanges</code> 的别名。</li></ul><p><strong>更方便的方法</strong>（可以直接操作选择范围，而无需使用 <code>Range</code> 关键字）</p><ul><li><code>collapse(node, offset)</code> 用一个新的范围替换选定的范围，该新范围从给定的 <code>node</code> 处开始，到偏移 <code>offset</code> 处结束。</li><li><code>setPosition(node, offset)</code> 方法 <code>collapse</code> 的别名。</li><li><code>collapseToStart()</code> 折叠（替换为空范围）到选择起点，即取消选中并移动光标至原来范围的起点</li><li><code>collapseToEnd()</code> 折叠到选择终点，即取消选中并移动光标至原来范围的终点</li><li><code>extend(node, offset)</code> 将选择的焦点（focus）移到给定的 <code>node</code>，位置偏移 <code>oofset</code>，</li><li><code>setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset)</code> 用给定的起点 <code>anchorNode/anchorOffset</code> 和终点 <code>focusNode/focusOffset</code> 来替换选择范围。选中它们之间的所有内容。</li><li><code>selectAllChildren(node)</code> 选择 <code>node</code> 的所有子节点。</li><li><code>deleteFromDocument()</code> 从文档中删除所选择的内容。</li><li><code>containsNode(node, allowPartialContainment = false)</code> 检查选择中是否包含 <code>node</code>（特别是如果第二个参数是 <code>true</code> 的话）</li></ul><h3 id="选择事件" tabindex="-1"><a class="header-anchor" href="#选择事件" aria-hidden="true">#</a> 选择事件</h3><p>当页面内容被选中时会触发相应的事件，监听这些事件可以进行相应的处理。</p><ul><li><strong>监听开始选择事件 <code>elem.onselectstart</code></strong> 当选择从 <code>elem</code> 上开始时触发该事件，如用户按下鼠标键并开始移动鼠标。处理程序可以阻止默认行为，让选择无法开始。</li><li><strong>监听选择内容改变事件 <code>document.onselectionchange</code></strong> 当选择变动时触发该事件。⚠️ 监听器只能设置在 <code>document</code> 上。</li></ul><h3 id="常用的方案" tabindex="-1"><a class="header-anchor" href="#常用的方案" aria-hidden="true">#</a> 常用的方案</h3><p><strong>获取选择</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> selection <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> cloned <span class="token operator">=</span> <span class="token comment">/* 要将所选的节点克隆到的元素 */</span><span class="token punctuation">;</span>

<span class="token comment">// 然后将 Range 方法应用于 selection.getRangeAt(0)</span>
<span class="token comment">// 或者，像这样，用于所有范围，以支持多选</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> selection<span class="token punctuation">.</span>rangeCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cloned<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>selection<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cloneContents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>设置选择</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> selection <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 直接：</span>
selection<span class="token punctuation">.</span><span class="token function">setBaseAndExtent</span><span class="token punctuation">(</span><span class="token operator">...</span>from<span class="token operator">...</span>to<span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 或者我们可以创建一个范围并：</span>
selection<span class="token punctuation">.</span><span class="token function">removeAllRanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
selection<span class="token punctuation">.</span><span class="token function">addRange</span><span class="token punctuation">(</span>range<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="表单控件中的选中" tabindex="-1"><a class="header-anchor" href="#表单控件中的选中" aria-hidden="true">#</a> 表单控件中的选中</h2><p>选择在表单控件中行为不一样，诸如 <code>input</code> 和 <code>textarea</code> 等表单元素使用的是 <a href="https://html.spec.whatwg.org/#textFieldSelection" target="_blank" rel="noopener noreferrer">专用的选择 API</a>，没有 <code>Selection</code> 或 <code>Range</code> 对象，由于输入值是纯文本而不是 HTML，因此操作更简单。</p><h3 id="表单控件的选择属性" tabindex="-1"><a class="header-anchor" href="#表单控件的选择属性" aria-hidden="true">#</a> 表单控件的选择属性</h3><ul><li><code>input.selectionStart</code> 选择的起始位置（可写），</li><li><code>input.selectionEnd</code> 选择的结束位置（可写），</li><li><code>input.selectionDirection</code> 选择方向，<code>forward</code>、<code>backward</code> 或 <code>none</code>（例如使用鼠标双击进行的选择）其中之一</li></ul><p>💡 将 <code>selectionStart</code> 和 <code>selectionEnd</code> 设置为相同的值可以移动光标</p><h3 id="表单控件的选择事件" tabindex="-1"><a class="header-anchor" href="#表单控件的选择事件" aria-hidden="true">#</a> 表单控件的选择事件</h3><p><code>input.onselect</code> 监听当某段文本被选择时触发的事件。</p><h3 id="表单控件的选择方法" tabindex="-1"><a class="header-anchor" href="#表单控件的选择方法" aria-hidden="true">#</a> 表单控件的选择方法</h3><ul><li><code>input.select()</code> 选择文本控件中的所有内容（可以是 <code>textarea</code> 而不是 <code>input</code>），</li><li><code>input.setSelectionRange(start, end, [direction])</code> 在给定方向上（可选），从 <code>start</code> 一直选择到 <code>end</code>。</li><li><code>input.setRangeText(replacement, [start], [end], [selectionMode])</code> 用新文本替换范围中的文本。可选参数 <code>start</code> 和 <code>end</code>，如果提供的话，则设置范围的起点和终点，否则使用用户的选择。最后一个参数 <code>selectionMode</code> 决定替换文本后如何设置选择，可能的值为： <ul><li><code>&quot;select&quot;</code> 将选择新插入的文本。</li><li><code>&quot;start&quot;</code> 选择范围将在插入的文本之前折叠（光标将在其之前）。</li><li><code>&quot;end&quot;</code> 选择范围将在插入的文本之后折叠（光标将紧随其后）。</li><li><code>&quot;preserve&quot;</code> 尝试保留选择。这是默认值。</li></ul></li></ul><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">更新时间: </span><span class="meta-item-info">2021/7/6 上午2:38:22</span></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><div style="width:0px;" class="catalog-container absolute top-0 right-0 h-full hidden lg:block"><div class="headings-container sticky top-36" data-v-c28348e0><ul class="max-w-max m-2 pl-7 xl:pl-16 2xl:pl-20 py-4 opacity-50 hover:opacity-100 transition-all duration-300" data-v-c28348e0><!--[--><!--]--></ul></div></div><div style="display:none;" tabindex="0" class="sidebar-container fixed inset-y-0 left-0 z-20 lg:hidden opacity-10 hover:opacity-95"><div class="headings-container px-2 space-y-2 transition-all duration-300 py-20" data-v-6eed9461><!--[--><!--]--></div></div></div><footer class="bg-gray-200 p-8 grid grid-cols-1 md:grid-cols-3 gap-4 items-center"><div class="flex justify-center md:justify-start items-center"><a class="p-2 hover:bg-gray-300 rounded-md" href="https://benbinbin.github.io/" target="_blank"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="text-center space-y-0.5"><p class="text-sm text-gray-600"> ©2021 <span class="author">Benbinbin</span>. All Right Reserved. </p><p class="text-xs text-center text-gray-400"> 除特殊说明外，本站的文章遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" target="_blank" class="text-blue-400">CC-BY-SA-4.0</a> 协议 </p><p class="text-xs text-center text-gray-400"> 网站主题采用 <a href="https://github.com/Benbinbin/two-dishes-one-fish" target="_blank" class="text-blue-400">Two Dishes One Fish</a></p></div><div class="btn-container flex justify-center md:justify-end items-center space-x-0.5"><!--[--><a class="p-2 hover:bg-gray-300 rounded-md" href="mailto:benthomsonbin@gmail.com" target=""><img src="/blog-web/images/icons/email.svg" alt="email" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://github.com/Benbinbin" target="_blank"><img src="/blog-web/images/icons/github.svg" alt="github" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://juejin.cn/user/3175045314389278/posts" target="_blank"><img src="/blog-web/images/icons/juejin.svg" alt="juejin" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://dribbble.com/BinBinDesign" target="_blank"><img src="/blog-web/images/icons/dribbble.svg" alt="dribbble" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://twitter.com/Benbinbin_fun" target="_blank"><img src="/blog-web/images/icons/twitter.svg" alt="twitter" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://weibo.com/binbindesign" target="_blank"><img src="/blog-web/images/icons/weibo.svg" alt="weibo" class="w-auto h-6"></a><!--]--></div></footer></div><!--]--></div>
    <script type="module" src="/blog-web/assets/app.43fe0c63.js" defer></script>
  </body>
</html>
