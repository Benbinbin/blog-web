<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/blog-web/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css"><title>事件 | Blog</title><meta name="description" content="A blog and knowledge management system about web.">
    <link rel="modulepreload" href="/blog-web/assets/app.43fe0c63.js"><link rel="modulepreload" href="/blog-web/assets/事件.html.0baf04df.js"><link rel="modulepreload" href="/blog-web/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/blog-web/assets/事件.html.022bbd98.js">
    <link rel="stylesheet" href="/blog-web/assets/style.b42fd117.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="min-h-screen flex flex-col"><nav class="px-4 sm:px-8 py-2 flex justify-between items-center sticky top-0 z-30 bg-white"><div class="left flex items-center space-x-0.5"><!--[--><button class="text-gray-400 hover:bg-gray-100 catelog-btn p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--><a class="avatar p-2 hover:bg-gray-100 rounded-md" href="/blog-web/#"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="right hidden sm:flex items-center space-x-0.5"><!--[--><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">All</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Network</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Frontend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Backend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Project</button><!--]--><!--[--><button class="text-gray-900 bg-gray-100 hover:bg-gray-200 p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md hidden lg:block"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--></div><div class="more-container sm:hidden relative"><button style="" class="p-2 select-none hover:bg-gray-100 rounded-md text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"></path></svg></button><button style="display:none;" class="p-2 select-none hover:bg-gray-100 rounded-md text-red-400 hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path></svg></button><div style="display:none;" class="more-modal p-2 absolute top-10 right-0 z-10 flex flex-col space-y-2 bg-gray-100 rounded-md opacity-90"><!--[--><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">All</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Network</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Frontend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Backend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Project</button><!--]--></div></div></nav><div class="relative flex-grow"><div class="theme-container no-navbar no-sidebar"><!--[--><!----><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="事件" tabindex="-1"><a class="header-anchor" href="#事件" aria-hidden="true">#</a> 事件</h1><p><strong>事件</strong> 是某事发生的信号，所有的 DOM 节点都生成这样的信号（但事件不仅限于 DOM），JavaScript 就是通过事件与 HTML（DOM 节点）进行交互的。</p><p>最有用的 DOM 事件的列表如下：</p><p><strong>鼠标事件：</strong></p><ul><li><code>click</code> 当鼠标点击一个元素时（触摸屏设备会在点击时生成）。</li><li><code>contextmenu</code> 当鼠标右键点击一个元素时。</li><li><code>mouseover</code>/<code>mouseout</code> 当鼠标指针移入/离开一个元素时。</li><li><code>mousedown</code> / <code>mouseup</code> 当在元素上按下/释放鼠标按钮时。</li><li><code>mousemove</code> 当鼠标移动时。</li></ul><p><strong>表单（form）元素事件</strong>：</p><ul><li><code>submit</code> 当访问者提交了一个 <code>&lt;form&gt;</code> 时。</li><li><code>focus</code> 当访问者聚焦于一个元素时，如聚焦于一个 <code>&lt;input&gt;</code>。</li></ul><p><strong>键盘事件</strong>：</p><ul><li><code>keydown</code>/<code>keyup</code> 当访问者按下然后松开按键时。</li></ul><p><strong>Document 事件</strong>：</p><ul><li><code>DOMContentLoaded</code> 当 HTML 的加载和处理均完成，DOM 被完全构建完成时。</li></ul><p><strong>CSS 事件</strong>：</p><ul><li><code>transitionend</code> 当一个 CSS 动画完成时。</li></ul><h2 id="事件处理程序" tabindex="-1"><a class="header-anchor" href="#事件处理程序" aria-hidden="true">#</a> 事件处理程序</h2><p>为了对事件作出响应，我们可以为元素节点分配一个 <strong>处理程序（handler）</strong>，即一个在事件发生时被调用/运行的函数。</p><p>💡 处理程序中的 <code>this</code> 的值是对应的元素，就是处理程序所在的那个元素。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
// 点击按钮，弹出提示框内容为 Click me
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>有 3 种分配事件处理程序的方式：</p><ul><li>HTML 特性（attribute） <code>onclick=&quot;...&quot;</code>。</li><li>DOM 属性（property） <code>elem.onclick = function</code>。</li><li>方法（method） <code>elem.addEventListener(event, handler, [phase])</code> 用于添加，<code>removeEventListener()</code> 用于移除。</li></ul><h3 id="html-特性" tabindex="-1"><a class="header-anchor" href="#html-特性" aria-hidden="true">#</a> HTML 特性</h3><p>处理程序可以设置在 HTML 中名为 <code>on&lt;event&gt;</code> 的特性 attribute 中。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>// 为一个 input 元素分配一个 click 鼠标点击事件的处理程序
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Click me<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Click!&#39;</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>⚠️ HTML 特性的值需要是<strong>字符串</strong>，因此如果在 <code>onclick</code> 特性值本身使用的是双引号，那么其内部如果需要使用字符串，就只能使用单引号 <code>&#39;&#39;</code></p><p>💡 HTML 特性不是编写大量代码的好位置，可以创建一个 JavaScript 函数然后在 HTML 特性中调用这个函数（函数作为特性值也是以字符串形式，<strong>函数需要有括号</strong>）。当浏览器解析该 HTML 特性时，会创建一个处理程序，并将 <strong>特性中的内容</strong> 作为处理程序的内容（即事件触发后调用处理程序，并运行里面的函数），并将这个处理程序写入元素节点 DOM 属性（property）。<strong>实际上处理程序总是在 DOM 属性中，HTML 特性只是初始化它的方法之一</strong>。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">sayThanks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Thanks!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">sayThanks</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>click<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>浏览器解析 HTML 元素的特性时会根据内容创建一个新的处理程序</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code>button.onclick = function() {
  sayThanks(); // 特性中的内容
};
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>⚠️ <strong>不要使用方法 <code>setAttribute</code></strong> 为 HTML 元素添加处理程序，因为这种方式会将函数变成字符串</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 点击 &lt;body&gt; 将产生 error，</span>
<span class="token comment">// 因为特性总是字符串的，函数变成了一个字符串</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&#39;onclick&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="dom-属性" tabindex="-1"><a class="header-anchor" href="#dom-属性" aria-hidden="true">#</a> DOM 属性</h3><p>可以使用 DOM 属性（property）<code>on&lt;event&gt;</code> 来分配处理程序。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>elem<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Click me<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  elem<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Thank you&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>⚠️ 因为 DOM 只有一个 <code>onclick</code> 属性，所以我们无法为 DOM 元素针对点击事件分配更多事件处理程序，其他事件也是一样的。而且 DOM 属性 <code>on&lt;event&gt;</code> 和 HTML 特性 <code>on&lt;event&gt;</code> 实际上是一样的，因此用这两种方式为同一个元素针对同一类型事件分配事件处理程序时，其中之一（HTML 特性）会被覆盖。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>elem<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Before&#39;</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Click me<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  elem<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 覆盖了现有的处理程序</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;After&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 只会显示此内容</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>⚠️ 使用 DOM 属性 <code>on&lt;event&gt;</code> 为元素分配事件处理程序时，如果处理程序的函数事先定义，<strong>则函数应该以函数体（而非调用函数的方式，不应该带括号）进行传递</strong>。因为如果我们添加了括号，如 <code>sayThanks()</code> 这是一个函数调用，下述实例的后一行代码，实际上获得的是函数执行的 <strong>结果</strong>，即 <code>undefined</code>（假设这个函数没有返回值），此代码不会工作。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 正确</span>
button<span class="token punctuation">.</span>onclick <span class="token operator">=</span> sayThanks<span class="token punctuation">;</span>

<span class="token comment">// 错误</span>
button<span class="token punctuation">.</span>onclick <span class="token operator">=</span> <span class="token function">sayThanks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="addeventlistener" tabindex="-1"><a class="header-anchor" href="#addeventlistener" aria-hidden="true">#</a> addEventListener</h3><p>使用方法 <code>elem.addEventListener()</code> 针对事件 <code>event</code> 为元素 <code>elem</code> 分配处理程序 <code>handler</code>，通过这种方式<strong>可以分配多个处理程序</strong>。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>参数说明</p><ul><li><code>event</code> 事件名，如 <code>&quot;click&quot;</code>。</li><li><code>handler</code> 处理程序</li><li><code>options</code>可选对象，具有以下属性用于对事件处理程序进行更多设置 <ul><li><code>once</code> 如果为 <code>true</code>，那么会在被触发后自动删除监听器</li><li><code>capture</code> 设置处理程序在事件第几阶段被调用，如果为 <code>false</code>（默认值）则在<strong>冒泡阶段</strong>设置处理程序；如果为 <code>true</code>，则在<strong>捕获阶段</strong>设置处理程序</li><li><code>passive</code> 如果为 <code>true</code>，那么处理程序将不会调用 <code>preventDefault()</code>，即浏览器会执行默认行为</li></ul></li></ul><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>elem<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Click me<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">handler1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Thanks!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handler2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Thanks again!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 针对 click 事件为元素 elem 添加三个事件处理程序</span>
  elem<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handler1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Thanks!</span>
  elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handler2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Thanks again!</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>⚠️ 方法 <code>addEventListener</code> 是设置事件处理程序的另一种备选方法，但是对于默写事件，如 <code>transtionend</code>、<code>DOMContentLoaded</code> 等，必须使用方法 <code>addEventListener</code> 设置事件处理程序，因此 <strong><code>addEventListener</code> 更通用</strong></p><p>除了分配函数作为事件处理程序， 还可以接收一个<strong>对象作为处理程序</strong>，该对象有方法 <code>handleEvent</code>，当事件发生时就会调用该对象的 <code>handleEvent</code> 方法。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>elem<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">handleEvent</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">&quot; at &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>currentTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="removeeventlistener" tabindex="-1"><a class="header-anchor" href="#removeeventlistener" aria-hidden="true">#</a> removeEventListener</h3><p>要<strong>移除处理程序</strong>，可以使用方法 <code>removeEventListener()</code> 需要传入与分配的函数完全相同的函数</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>element<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>⚠️ 由于在移除事件处理程序需要传入与分配的函数<strong>完全相同的函数</strong>，因此通过匿名函数设置的事件处理程序无法移除</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span> <span class="token string">&quot;click&quot;</span> <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Thanks!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
elem<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;Thanks!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 处理程序代码相同，但没有名称，因此获取了另一个函数</span>

<span class="token comment">/*---------- 分割线 ----------*/</span>

<span class="token comment">// 正确方法</span>
<span class="token comment">// 将匿名函数存储在一个变量中</span>
<span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span> <span class="token string">&#39;Thanks!&#39;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 通过变量名（函数名）获取事件处理程序</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="事件对象" tabindex="-1"><a class="header-anchor" href="#事件对象" aria-hidden="true">#</a> 事件对象</h2><p>当事件发生时，浏览器会创建一个 <strong><code>event</code> 对象</strong>，将详细信息放入其中，并将其作为参数传递给处理程序。</p><p>不同的事件产生的事件对象拥有不同属性，如鼠标点击事件 <code>click</code> 创建的 <code>event</code> 对象常用属性</p><ul><li><code>event.type</code> 事件类型，这里是 <code>&quot;click&quot;</code>。</li><li><code>event.currentTarget</code> 处理事件的元素（即设置了事件监听器的元素），它与 <code>this</code> 相同（除非处理程序是一个箭头函数，或者它的 <code>this</code> 被绑定到了其他东西上），可以从 <code>event.currentTarget</code> 获取元素</li><li><code>event.clientX / event.clientY</code> 鼠标事件的指针的窗口相对坐标</li><li><code>event.pageX</code> 和 <code>event.pageY</code> 鼠标事件的指针的页面相对坐标</li><li><code>event.screenX</code> 和 <code>event.screenY</code> 鼠标事件的指针的屏幕相对坐标</li></ul><p>💡 如果在 HTML 中分配了一个处理程序，也可以使用 <code>event</code> 对象，因为<code>event</code> 会作为默认参数传递给处理程序。当浏览器读取特性（attribute）时，它会创建处理程序 <code>function(event) { alert(event.type) }</code> 其中第一个参数是 <code>&quot;event&quot;</code></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>type<span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Event type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="事件阶段" tabindex="-1"><a class="header-anchor" href="#事件阶段" aria-hidden="true">#</a> 事件阶段</h2><p><a href="http://www.w3.org/TR/DOM-Level-3-Events/" target="_blank" rel="noopener noreferrer">DOM 事件</a>标准描述了事件传播的 3 个阶段：</p><ol><li>捕获阶段（Capturing phase）—— 事件（从 Window）向下走近元素。</li><li>目标阶段（Target phase）—— 事件到达目标元素。</li><li>冒泡阶段（Bubbling phase）—— 事件从元素上开始冒泡。</li></ol><p>💡 冒泡和捕获为「事件委托」奠定了基础，基于该行为可以实现非常强大的事件处理模式。</p><p>当一个事件发生时，发生该事件的嵌套最深的元素被标记为「目标元素」<code>event.target</code></p><ul><li>首先就会发生<strong>捕获阶段</strong>，事件从文档根节点向下移动到 <code>event.target</code>，并在途中调用分配了 <code>addEventListener(..., true)</code> 的处理程序（<code>true</code> 是 <code>{capture: true}</code> 的一个简写形式）。</li><li>然后事件会在目标元素自身上的触发</li><li>接着就会发生<strong>冒泡阶段</strong>，事件从 <code>event.target</code> 向上移动到根，调用使用 <code>on&lt;event&gt;</code> 和没有第三个参数的，或者第三个参数为 <code>false/{capture:false}</code> 的 <code>addEventListener</code> 分配的处理程序。</li></ul><p>💡 所有事件对象 <code>event</code> 具有的通用属性，每个处理程序都可以访问</p><ul><li><code>event.target</code> 引发事件的层级最深的元素</li><li><code>event.currentTarget</code>（=<code>this</code>） 处理事件的当前元素，即设置了并当前正执行的处理程序的元素</li><li><code>event.eventPhase</code> 当前阶段，以数值表示（capturing=1，target=2，bubbling=3）</li></ul><p><img src="/blog-web/assets/20200508153528291_21782.0086dd89.png" alt="event phase"></p><p>上图实例演示了点击事件的 3 个阶段。点击 <code>&lt;td&gt;</code> 事件首先通过祖先链向下到达元素（捕获阶段），然后到达目标（目标阶段），最后上升（冒泡阶段），在途中调用处理程序。</p><h3 id="冒泡" tabindex="-1"><a class="header-anchor" href="#冒泡" aria-hidden="true">#</a> 冒泡</h3><p>事件冒泡 bubbling 是指当一个事件发生在一个元素上，它会首先运行在该元素上的处理程序（如果该元素针对该事件设置了处理程序），然后运行其父元素上的处理程序（假如设置了处理程序），然后一直向上到其他祖先上的处理程序。</p><p>这个过程被称为冒泡（bubbling），因为事件就像在水里的气泡一样从内部元素「冒泡」到所有父级，一路触发相应的事件处理程序。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">body *</span> <span class="token punctuation">{</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid blue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;form&#39;</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>FORM
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;div&#39;</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>DIV
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;p&#39;</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>P<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上述实例代码演示了冒泡的过程，点击内部的 <code>&lt;p&gt;</code> 会运行 <code>onclick</code> 事件处理程序</p><ol><li>在该 <code>&lt;p&gt;</code> 上的。</li><li>然后是外部 <code>&lt;div&gt;</code> 上的。</li><li>然后是外部 <code>&lt;form&gt;</code> 上的。</li><li>以此类推，直到最后的 <code>document</code> 对象。</li></ol><p><img src="/blog-web/assets/20200508154631915_22112.7ba0e341.png" alt="bubbling"></p><p>⚠️ <strong>几乎</strong> 所有事件都会冒泡，除了个别事件，如 <code>focus</code> 事件不会冒泡。</p><p>💡 事件从目标元素开始向上冒泡，通常它会一直上升到 <code>&lt;html&gt;</code>，然后再到 <code>document</code> 对象，有些事件甚至会到达 <code>window</code>，它们会调用路径上所有的处理程序。</p><p>但是可以在冒泡「路径」上的元素设置相应的事件处理方法为 <code>event.stopPropagation()</code> ，表示事件已经被完全处理并停止冒泡，该事件就会在「冒泡」到该元素时停止再向上冒泡，因此该元素外的祖先元素设置的相应事件的处理程序都无法被触发，但该元素上设置的其他相应事件处理程序依然可以运行。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>first<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;first&#39;</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>first
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>second<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>second
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>third<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;third&#39;</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>third<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// 在元素 div 上针对点击事件 click 设置 event.stopPropagation() 阻止事件冒泡</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;second&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      event<span class="token punctuation">.</span><span class="token function">stopPropagation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 该元素还设置了点击事件 click 的另一个处理程序，它会运行</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;second&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;second&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>💡 如果希望<strong>当前的元素上的相应事件的处理程序都被阻止</strong>可以使用方法 <code>event.stopImmediatePropagation()</code> 。</p><p>⚠️ <strong>不要在没有需要的情况下停止冒泡！</strong> 因为停止冒泡会产生隐形的陷阱，如我们创建了一个嵌套菜单，每个子菜单各自处理对自己的元素的点击事件，并调用 <code>stopPropagation</code> 以便不会触发外部菜单。之后我们决定捕获在整个窗口上的点击，以追踪用户的行为（有些分析系统会获取用户点击的位置），因此使用 <code>document.addEventListener(&#39;click&#39;…)</code> 来捕获所有的点击。但是存在有一个「死区」，由于之前设置的停止冒泡 <code>stopPropagation</code> 会阻止点击菜单区域的事件不能在窗口上「侦测」到。</p><h3 id="event-target" tabindex="-1"><a class="header-anchor" href="#event-target" aria-hidden="true">#</a> event.target</h3><p>引发事件的那个<strong>嵌套层级最深的元素</strong>被称为目标元素，即事件发生的「第一个」元素，可以通过 <code>event.target</code> 访问。</p><p>💡 <code>event.target</code> 与 <code>event.currentTarget</code> 之间的区别</p><ul><li><code>event.target</code> 是引发事件的「目标」元素，它在冒泡过程中不会发生变化</li><li><code>event.currentTarget</code>（一般都是与 <code>this</code> 等价，即表示「当前」正在运行的处理程序所在/所绑定的元素</li></ul><p>上述实例中，如果我们点击了元素 <code>&lt;p&gt;</code> 那么该元素就是 <code>event.target</code> 同时该元素也是 <code>event.currentTarget</code>，点击事件会触发 <code>&lt;p&gt;</code> 元素上设置的事件处理程序，然后事件会冒泡到元素 <code>&lt;div&gt;</code>，该元素的事件处理程序会被触发，此时 <code>event.currentTarget</code> 就变成元素 <code>&lt;div&gt;</code>，但 <code>event.target</code> 不变，依然是元素 <code>&lt;p&gt;</code>。</p><h3 id="捕获" tabindex="-1"><a class="header-anchor" href="#捕获" aria-hidden="true">#</a> 捕获</h3><p>捕获阶段 Capturing phase 是指事件（从 Window）通过祖先链向下走近目标元素。</p><p>为了在捕获阶段捕获事件，我们需要将处理程序 <code>addEventListener(event, handler)</code> 的 <code>capture</code> 可选参数设置为 <code>true</code>(<code>false</code> 是默认值，表示在冒泡阶段设置处理程序）</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>capture<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 或者，用 {capture: true} 的别名 &quot;true&quot;</span>
elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>💡 捕获阶段很少被使用，DOM 属性 <code>on&lt;even&gt;</code> 、HTML 特性（attribute）或使方法 <code>addEventListener(event, handler)</code> 添加的处理程序，默认都是在事件冒泡阶段（在第二阶段和第三阶段）被触发执行的，对捕获一无所知。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  <span class="token selector">body *</span> <span class="token punctuation">{</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid blue<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span><span class="token punctuation">&gt;</span></span>FORM
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>DIV
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>P<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> elem <span class="token keyword">of</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#39;*&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Capturing: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>elem<span class="token punctuation">.</span>tagName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bubbling: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>elem<span class="token punctuation">.</span>tagName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>上述实例代码为文档中的 <strong>每个</strong> 元素两个阶段（捕获阶段和冒泡阶段）都设置了点击处理程序，以演示了事件在捕获阶段和冒泡阶段触发处理程序的过程。当点击了 <code>&lt;p&gt;</code> 那么处理程序依次被触发并输出相应的信息：</p><ol><li><code>HTML</code> → <code>BODY</code> → <code>FORM</code> → <code>DIV</code>（捕获阶段第一个监听器）：</li><li><code>P</code>（目标阶段，触发两次，因为我们设置了两个监听器：捕获和冒泡）</li><li><code>DIV</code> → <code>FORM</code> → <code>BODY</code> → <code>HTML</code>（冒泡阶段，第二个监听器）。</li></ol><p>💡 如果我们在<strong>同一阶段</strong>设置了多个事件处理程序，并通过 <code>addEventListener</code> 分配给了相同的元素，则它们的运行顺序与创建顺序相同</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 会先被触发</span>
elem<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="事件委托" tabindex="-1"><a class="header-anchor" href="#事件委托" aria-hidden="true">#</a> 事件委托</h2><p>捕获和冒泡允许我们在「外层」祖先元素上对事件作出反应，这种事件处理模式称为 <strong>事件委托</strong>，它通常用于为许多相似的元素添加相同的处理。</p><p>基本过程：</p><ol><li>在容器 container/共同祖先元素上放一个事件处理程序（就不必为每个元素分配一个处理程序）</li><li>在处理程序中通过事件对象属性<code>event.target</code> 获取触发事件的「真实」元素</li><li>执行相应的处理</li></ol><p>该模式有显著的优点：</p><ul><li>简化初始化并节省内存：无需添加许多处理程序。</li><li>更少的代码：添加或移除元素时，无需添加/移除处理程序。</li><li>DOM 修改 ：我们可以使用 <code>innerHTML</code> 等，来批量添加/移除元素。</li></ul><p>但是事件委托也有其局限性：</p><ul><li>事件必须冒泡，低级别的处理程序不应该使用 <code>event.stopPropagation()</code> 阻止事件冒泡</li><li>委托可能会增加 CPU 负载，因为容器级别的处理程序会对容器中任意位置的事件做出反应，而不管我们是否对该事件感兴趣（但是通常负载可以忽略不计）。</li></ul><p>使用事件委托将处理程序设置在文档级 <code>document</code>，适用于（监控）整个页面的元素，这样就可以在 HTML 元素设置自定义特性或类属性来添加相应的功能。这种以<strong>声明</strong>的方式将 JavaScript 操作添加/绑定到 HTML 元素方式称为 行为模式 behavior pattern。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 点击一个具有 data-toggle-id 特性的元素将显示/隐藏具有给定 id 的元素 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">data-toggle-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>subscribe-mail<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  Show the subscription form
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- 只需要向元素添加特性 data-toggle-id 即可使元素具有显示/隐藏的功能 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>subscribe-mail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">hidden</span><span class="token punctuation">&gt;</span></span>
  Your mail: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 在文档级设置事件监听器</span>
  document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>toggleId<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>id<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 切换元素显示/隐藏状态</span>
    elem<span class="token punctuation">.</span>hidden <span class="token operator">=</span> <span class="token operator">!</span>elem<span class="token punctuation">.</span>hidden<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>行为模式十分方便，无需为每个这样的元素编写 JavaScript，只需要创建一个方法并将相应的特性/类属性放入 HMTL 标签中即可，而且可以设置多个特性实现多种行为。</p><p>⚠️ 在文档级设置处理程序始终使用方法 <code>addEventListener</code> 而不是 <code>document.on&lt;event&gt;</code>，因为后者会引起冲突，新的处理程序会覆盖旧的处理程序，而在实际项目中， 一般会在不同部分为 <code>document</code> 设置了许多处理程序。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">更新时间: </span><span class="meta-item-info">2021/7/6 上午2:38:22</span></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><div style="width:0px;" class="catalog-container absolute top-0 right-0 h-full hidden lg:block"><div class="headings-container sticky top-36" data-v-c28348e0><ul class="max-w-max m-2 pl-7 xl:pl-16 2xl:pl-20 py-4 opacity-50 hover:opacity-100 transition-all duration-300" data-v-c28348e0><!--[--><!--]--></ul></div></div><div style="display:none;" tabindex="0" class="sidebar-container fixed inset-y-0 left-0 z-20 lg:hidden opacity-10 hover:opacity-95"><div class="headings-container px-2 space-y-2 transition-all duration-300 py-20" data-v-6eed9461><!--[--><!--]--></div></div></div><footer class="bg-gray-200 p-8 grid grid-cols-1 md:grid-cols-3 gap-4 items-center"><div class="flex justify-center md:justify-start items-center"><a class="p-2 hover:bg-gray-300 rounded-md" href="https://benbinbin.github.io/" target="_blank"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="text-center space-y-0.5"><p class="text-sm text-gray-600"> ©2021 <span class="author">Benbinbin</span>. All Right Reserved. </p><p class="text-xs text-center text-gray-400"> 除特殊说明外，本站的文章遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" target="_blank" class="text-blue-400">CC-BY-SA-4.0</a> 协议 </p><p class="text-xs text-center text-gray-400"> 网站主题采用 <a href="https://github.com/Benbinbin/two-dishes-one-fish" target="_blank" class="text-blue-400">Two Dishes One Fish</a></p></div><div class="btn-container flex justify-center md:justify-end items-center space-x-0.5"><!--[--><a class="p-2 hover:bg-gray-300 rounded-md" href="mailto:benthomsonbin@gmail.com" target=""><img src="/blog-web/images/icons/email.svg" alt="email" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://github.com/Benbinbin" target="_blank"><img src="/blog-web/images/icons/github.svg" alt="github" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://juejin.cn/user/3175045314389278/posts" target="_blank"><img src="/blog-web/images/icons/juejin.svg" alt="juejin" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://dribbble.com/BinBinDesign" target="_blank"><img src="/blog-web/images/icons/dribbble.svg" alt="dribbble" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://twitter.com/Benbinbin_fun" target="_blank"><img src="/blog-web/images/icons/twitter.svg" alt="twitter" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://weibo.com/binbindesign" target="_blank"><img src="/blog-web/images/icons/weibo.svg" alt="weibo" class="w-auto h-6"></a><!--]--></div></footer></div><!--]--></div>
    <script type="module" src="/blog-web/assets/app.43fe0c63.js" defer></script>
  </body>
</html>
