<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/blog-web/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css"><title>promise | Blog</title><meta name="description" content="A blog and knowledge management system about web.">
    <link rel="modulepreload" href="/blog-web/assets/app.43fe0c63.js"><link rel="modulepreload" href="/blog-web/assets/promise.html.c8beabbe.js"><link rel="modulepreload" href="/blog-web/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/blog-web/assets/promise.html.5c12db2a.js">
    <link rel="stylesheet" href="/blog-web/assets/style.b42fd117.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="min-h-screen flex flex-col"><nav class="px-4 sm:px-8 py-2 flex justify-between items-center sticky top-0 z-30 bg-white"><div class="left flex items-center space-x-0.5"><!--[--><button class="text-gray-400 hover:bg-gray-100 catelog-btn p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--><a class="avatar p-2 hover:bg-gray-100 rounded-md" href="/blog-web/#"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="right hidden sm:flex items-center space-x-0.5"><!--[--><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">All</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Network</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Frontend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Backend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Project</button><!--]--><!--[--><button class="text-gray-900 bg-gray-100 hover:bg-gray-200 p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md hidden lg:block"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--></div><div class="more-container sm:hidden relative"><button style="" class="p-2 select-none hover:bg-gray-100 rounded-md text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"></path></svg></button><button style="display:none;" class="p-2 select-none hover:bg-gray-100 rounded-md text-red-400 hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path></svg></button><div style="display:none;" class="more-modal p-2 absolute top-10 right-0 z-10 flex flex-col space-y-2 bg-gray-100 rounded-md opacity-90"><!--[--><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">All</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Network</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Frontend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Backend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Project</button><!--]--></div></div></nav><div class="relative flex-grow"><div class="theme-container no-navbar no-sidebar"><!--[--><!----><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="promise" tabindex="-1"><a class="header-anchor" href="#promise" aria-hidden="true">#</a> promise</h1><p>å‚è€ƒï¼š</p><ul><li><a href="https://zh.javascript.info/promise-basics" target="_blank" rel="noopener noreferrer">Promise</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener noreferrer">Promise - JavaScript | MDN</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises" target="_blank" rel="noopener noreferrer">ä½¿ç”¨ Promise - JavaScript | MDN</a></li><li><a href="https://developers.google.cn/web/fundamentals/primers/promises" target="_blank" rel="noopener noreferrer">JavaScript Promiseï¼šç®€ä»‹ | Web Fundamentals | Google Developers</a></li></ul><p><code>promise</code> å¯¹è±¡ä»£è¡¨å¼‚æ­¥æ‰§è¡Œç»“æœï¼Œé€šå¸¸ç”¨äºç½‘ç»œè¯·æ±‚ï¼Œé€šè¿‡æ„é€ å‡½æ•° <code>new Promise</code> åˆ›å»ºï¼Œè€Œä¸”åœ¨æ‰§è¡Œæ—¶ç«‹å³è¿”å› <code>promise</code> å¯¹è±¡ï¼Œâš ï¸ ä½†è¯¥è¿”å›å€¼å¹¶ä¸æ˜¯æœ€ç»ˆçš„æ‰§è¡Œç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½ä»£è¡¨æœªæ¥å‡ºç°çš„ç»“æœçš„å¯¹è±¡ï¼Œå³ <code>promise</code> å¯¹è±¡æ˜¯ä¸€ä¸ª<strong>ä»£ç†å¯¹è±¡</strong>ï¼ˆä»£ç†ä¸€ä¸ªåˆ›å»ºæ—¶ä»æœªçŸ¥çš„å€¼ï¼Œéœ€è¦ç­‰å¾…å¼‚æ­¥è¡Œä¸ºæ‰§è¡Œå®Œæˆåæ‰å¯ä»¥ç¡®å®šï¼‰,<strong>è¿™å¯è®©ä¸»çº¿ç¨‹ä¸­çš„å¼‚æ­¥è¡Œä¸ºåƒåŒæ­¥è¡Œä¸ºé‚£æ ·ç«‹å³æ‹¥æœ‰è¿”å›å€¼ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…è€Œå¼•èµ·å¡é¡¿</strong>ã€‚</p><h2 id="promise-åŸç†" tabindex="-1"><a class="header-anchor" href="#promise-åŸç†" aria-hidden="true">#</a> promise åŸç†</h2><ol><li><p>é€šè¿‡æ„é€ å‡½æ•°åˆ›å»º <code>promise</code> å¯¹è±¡ï¼Œæ„é€ å‡½æ•°çš„å‚æ•°æ˜¯<strong>å¤„ç†å™¨å‡½æ•° executor function</strong> ï¼Œå®ƒä¼šåœ¨æ„é€ å‡½æ•°æ‰§è¡Œæ—¶è¢«ç«‹å³è°ƒç”¨ï¼Œå¼‚æ­¥æ“ä½œï¼ˆå¦‚åŒ…å« <code>setTimeout()</code> çš„ä»£ç ï¼‰å°±æ˜¯åœ¨å…¶ä¸­è¿›è¡Œã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å½“ promise è¢«æ„é€ å®Œæˆæ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œæ­¤å‡½æ•°</span>
  <span class="token comment">// executor</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ğŸ’¡ <code>promise</code> å¯¹è±¡æœ‰ä¸åŒçŠ¶æ€ï¼Œä¸€å¼€å§‹åˆ›å»ºçš„ <code>promise</code> å¯¹è±¡çŠ¶æ€æ˜¯ <code>pending</code>ï¼ˆè¡¨ç¤ºåˆå§‹çŠ¶æ€ï¼‰ï¼Œç„¶ååœ¨ executor ä¸­ä¼šåŸºäºå¼‚æ­¥è¡Œä¸ºçš„ç»“æœæ‰§è¡Œ <code>resolve</code> æˆ– <code>reject</code> ä¹‹ä¸€ï¼Œè¿™æ ·å°±ä¼šæ”¹å˜ <code>promise</code> å¯¹è±¡çš„çŠ¶æ€ä¸º <code>settled</code>ï¼ˆè¡¨ç¤ºçŠ¶æ€ç¡®å®šï¼Œæ›´å‡†ç¡®çš„æ˜¯ <code>resolved</code> æˆ– <code>rejected</code> çŠ¶æ€ä¹‹ä¸€ï¼‰</p><ul><li><code>pending</code> è¡¨ç¤ºåˆå§‹çŠ¶æ€ï¼Œæ—¢å¼‚æ­¥è¡Œä¸ºä¸æ˜¯æˆåŠŸï¼Œä¹Ÿä¸æ˜¯å¤±è´¥çš„çŠ¶æ€</li><li><code>settled</code> è¡¨ç¤ºç¡®å®šçŠ¶æ€ï¼Œæ„å‘³ç€å·²ç»æˆåŠŸæˆ–å¤±è´¥</li><li><code>fulfilled</code> æˆ– <code>resolved</code> æ„å‘³ç€æ“ä½œæˆåŠŸå®Œæˆ</li><li><code>rejected</code> æ„å‘³ç€æ“ä½œå¤±è´¥</li></ul><p>ğŸ’¡ <code>promise</code> å¯¹è±¡æœ‰ä¸¤ä¸ªå†…éƒ¨çš„çš„å±æ€§çŠ¶æ€ <code>state</code>ï¼ˆé»˜è®¤ä¸º <code>pending</code>ï¼‰å’Œç»“æœ <code>result</code>ï¼ˆé»˜è®¤ä¸º <code>undefined</code>ï¼‰ï¼Œå®ƒä»¬æ— æ³•ç›´æ¥è®¿é—®ä½†å¯ä»¥åœ¨ executor function ä¸­è°ƒç”¨ <code>resolve</code> æˆ– <code>reject</code> æ›´æ”¹å…¶çŠ¶æ€å’Œè®¾ç½®ç»“æœã€‚</p></li><li><p>åŸºäºå¼‚æ­¥è¡Œä¸ºå½¢æˆçš„ç‰¹å®šæ¡ä»¶ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•° <code>resolve</code> æˆ– <code>reject</code> ä¹‹ä¸€ï¼Œç¡®å®š <code>promise</code> å¯¹è±¡çš„çŠ¶æ€ï¼Œè¿˜å¯èƒ½ä¿®æ”¹å¯¹è±¡çš„ç»“æœå±æ€§ <code>result</code>ï¼ˆç»“æœçš„å€¼å°±æ˜¯å›è°ƒå‡½æ•° <code>resolve(value)</code> æˆ– <code>reject(error)</code> çš„å‚æ•° <code>value</code> æˆ– <code>error</code>ï¼‰</p><p>executor å‚æ•° <code>resolve</code> å’Œ <code>reject</code> æ˜¯ç”± JavaScript è‡ªèº«æä¾›çš„é»˜è®¤å‚æ•°ï¼ˆå®ƒä»¬æ˜¯å‡½æ•°ï¼Œæ¥å—çš„å®å‚è®¾ç½®ä¸º <code>promise</code> å¯¹è±¡çš„ç»“æœå±æ€§ï¼‰ï¼Œåº”è¯¥éµå¾ªè§„åˆ™åŸºäºå¼‚æ­¥ä»£ç æ‰§è¡Œçš„ç»“æœè°ƒç”¨å®ƒä»¬å…¶ä¸€ï¼Œä»¥ä¿®æ”¹ <code>promise</code> å¯¹è±¡çš„çŠ¶æ€å’Œç»“æœ</p><ul><li>è°ƒç”¨ <code>resolve(value)</code> è¡¨ç¤ºä»»åŠ¡æˆåŠŸå®Œæˆï¼Œè€Œä¸”å°† <code>promise</code> å¯¹è±¡çš„ç»“æœå±æ€§è®¾ç½®ä¸º <code>value</code></li><li>è°ƒç”¨ <code>reject(error)</code> è¡¨ç¤ºå‡ºç°äº† exector function ä¸­å‡ºç° <code>error</code>ï¼Œè€Œä¸”å°† <code>promise</code> å¯¹è±¡çš„ç»“æœå±æ€§è®¾ç½®ä¸ºä¸º <code>error</code> å¯¹è±¡ï¼ˆå…¶å®å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å€¼ä½œä¸ºå‚æ•°ï¼Œä½†æ˜¯ä¸ºäº†å¯ä»¥è·å–é”™è¯¯ä¿¡æ¯ï¼Œæ¨èä½¿ç”¨ <code>error</code> å¯¹è±¡æˆ–ç»§æ‰¿è‡ª <code>error</code> çš„å¯¹è±¡ï¼‰</li></ul><p><img src="/blog-web/assets/20200501171746434_26167.4ef0a38c.png" alt="settled promise"></p><p>âš ï¸ executor åªèƒ½è°ƒç”¨ä¸€ä¸ª <code>resolve</code> æˆ–ä¸€ä¸ª <code>reject</code>ï¼Œä»»ä½•çŠ¶æ€çš„æ›´æ”¹éƒ½æ˜¯æœ€ç»ˆçš„ï¼Œæ­¤åæ‰€æœ‰å…¶ä»–çš„å†å¯¹ <code>resolve</code> å’Œ <code>reject</code> çš„è°ƒç”¨éƒ½ä¼šè¢«å¿½ç•¥ï¼Œå¹¶ä¸”ï¼Œ<code>resolve/reject</code> åªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼ˆæˆ–ä¸åŒ…å«ä»»ä½•å‚æ•°ï¼‰ï¼Œå¹¶ä¸”å°†å¿½ç•¥é¢å¤–çš„å‚æ•°ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;â€¦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¢«å¿½ç•¥</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;â€¦&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¢«å¿½ç•¥</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li><li><p><code>promise</code> å¯¹è±¡çš„åŸå‹æœ‰æ–¹æ³• <code>.then(handler)</code>ã€<code>.catch(handler)</code>ã€<code>.finally(handler)</code>ï¼Œå®ƒä»¬ä¹‹ä¸€ä¼šåœ¨ <code>promise</code> å¯¹è±¡çŠ¶æ€ç¡®å®šåè¢«è°ƒç”¨ï¼Œä»¥æ‰§è¡Œç›¸åº”çš„è¡Œä¸ºã€‚</p><p>è¿™äº›æ–¹æ³•å’Œå›è°ƒç»“æ„ä¸­çš„å›è°ƒå‡½æ•°ä½œç”¨ç±»ä¼¼ï¼Œä½†å­˜åœ¨åŒºåˆ«ï¼Œåœ¨å›è°ƒç»“æ„ä¸­<a href="/blog-web/frontend/JavaScript/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%9B%9E%E8%B0%83.html" class="">å›è°ƒå‡½æ•°éœ€è¦åœ¨å£°æ˜ä¸»ä½“å‡½æ•°æ—¶å°±ç»™å‡º</a>ï¼›Promise åˆ™æ›´åŠ çµæ´»ï¼Œè¿™äº›æ–¹æ³•å¹¶ä¸ä¸€å®šéœ€è¦åœ¨åˆ›å»ºå¯¹è±¡æ—¶å°±è®¾å®šï¼Œå¯ä»¥éšæ—¶ä¸ºå¯¹è±¡è®¾ç½®æ–¹æ³•ä»¥æ·»åŠ å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰ï¼Œå¦‚æœç»“æœå·²ç»åœ¨ï¼ˆå³ <code>promise</code> å¯¹è±¡çŠ¶æ€å·²ç» <code>settled</code>ï¼‰è¿™äº›åæ¥æ·»åŠ çš„å¤„ç†ç¨‹åºä¾¿ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œä¸”å¯ä»¥æ·»åŠ å¤šæ¬¡ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åœ¨åŒä¸€ä¸ª promise å¯¹è±¡ä¸Šå¤šæ¬¡æ·»åŠ æ–¹æ³• thenï¼Œåˆ›å»ºå‡ºå¤šä¸ªç‹¬ç«‹çš„å¤„ç†ç¨‹åº</span>
<span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
  <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
  <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
  <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><img src="/blog-web/assets/20200501201018739_24298.c297b5af.png" alt="multiple then"></p><p>ğŸ’¡ å®é™…ä¸Šå®Œæ•´æ–¹æ³• <code>then(resolveFunc, rejectFunc)</code> å¯ä»¥æ¥å—ä¸¤ä¸ªå‚æ•°ï¼ˆè€Œä¸”æ¯æ¬¡åªèƒ½è°ƒç”¨å…¶ä¸€ï¼‰ï¼Œå½“ <code>promise</code> å¯¹è±¡ä¸­çš„å¼‚æ­¥ä»£ç æ‰§è¡ŒæˆåŠŸï¼ˆå³ <code>promise</code> çŠ¶æ€ä¸º<code>fulfilled</code> æˆ– <code>resolved</code> æ—¶ï¼‰ï¼Œæ–¹æ³• <code>then()</code> ä¼šæ‰§è¡Œå›è°ƒå‡½æ•° <code>resolvFunc</code>ï¼Œå¼‚æ­¥ä»£ç æ‰§è¡Œå¤±è´¥å°±ä¼šæ‰§è¡Œå›è°ƒå‡½æ•° <code>rejectFunc</code>ã€‚è€Œæ–¹æ³• <code>catch()</code> å®é™…ä¸Šæ˜¯ <code>then(null, rejectFunc)</code> çš„ç¼©å†™ï¼Œå³å®ƒåªé€‚ç”¨äºå¼‚å¸¸æƒ…å†µä¸‹æ‰æ‰§è¡Œ handler å¤„ç†ç¨‹åºï¼Œæ¨èä½¿ç”¨ <code>catch</code> æ•æ‰å¼‚æ­¥ä»£ç æ‰§è¡Œå¤±è´¥çš„æƒ…å†µå› ä¸ºå®ƒä¾¿äºé˜…è¯»ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;done!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// resolve è¿è¡Œ .then ä¸­çš„ç¬¬ä¸€ä¸ªå‡½æ•°</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 1 ç§’åæ˜¾ç¤º &quot;done!&quot;</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// ä¸è¿è¡Œ</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*---------- åˆ†å‰²çº¿ ----------*/</span>

<span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Whoops!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// reject è¿è¡Œ .then ä¸­çš„ç¬¬äºŒä¸ªå‡½æ•°</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ä¸è¿è¡Œ</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token comment">// 1 ç§’åæ˜¾ç¤º &quot;Error: Whoops!&quot;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><code>promise</code> å¯¹è±¡çš„æ–¹æ³• <code>finally</code>ï¼Œç±»ä¼¼äº <code>try {...} catch {...}</code> ä¸­çš„ <code>finally</code> å­å¥ä¸€æ ·ï¼Œæ–¹æ³• <code>.finally(f)</code> ä¸­çš„å¤„ç†ç¨‹åº¦ <code>f</code> åœ¨ <code>promise</code> å¯¹è±¡è¢« <code>settled</code> æ—¶è¿è¡Œï¼ˆå³ <code>promise</code> å¯¹è±¡è¢« <code>resolve</code> æˆ– <code>reject</code>ï¼‰è¯¥æ–¹æ³•æ˜¯è®¾ç½®æ¸…ç† cleanup çš„å¾ˆå¥½åœ°æ–¹ï¼Œå®ƒçš„å¤„ç†ç¨‹åºæ— è®ºå¼‚æ­¥æ“ä½œç»“æœå¦‚ä½•éƒ½ä¼šè¢«æ‰§è¡Œ</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* åšä¸€äº›éœ€è¦æ—¶é—´çš„äº‹å„¿ï¼Œç„¶åè°ƒç”¨ resolve/reject */</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// åœ¨ promise è¢« settled æ—¶è¿è¡Œï¼Œæ— è®ºæˆåŠŸä¸å¦</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> stop loading indicator<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> show result<span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> show error<span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ–¹æ³• <code>.finally(f)</code> ä¸æ–¹æ³• <code>then(f,f)</code> ç±»ä¼¼ï¼Œä½†æ˜¯æœ‰ä¸»è¦çš„åŒºåˆ«</p><ul><li>æ–¹æ³• <code>finally</code> çš„å¤„ç†ç¨‹åº handler æ²¡æœ‰å‚æ•°ï¼Œå› ä¸ºåœ¨ <code>finally</code> ä¸­ä¸éœ€è¦çŸ¥é“ <code>promise</code> æ˜¯å¦æˆåŠŸï¼Œä»»åŠ¡éƒ½ä¼šè¢«æ‰§è¡Œï¼Œè¢«ç§°ä½œå®šç¨¿ç¨‹åº finalizing procedures</li><li>æ–¹æ³• <code>finally</code> çš„å¤„ç†ç¨‹åºå°†ç»“æœå’Œ <code>error</code> ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åºï¼ˆä¸€èˆ¬åœ¨é“¾å¼è°ƒç”¨ï¼‰ï¼Œè¿™éå¸¸æ–¹ä¾¿ï¼Œå› ä¸º <code>finally</code> å¹¶ä¸æ˜¯ä¸ºäº†å¤„ç† <code>promise</code> çš„ç»“æœï¼Œæ‰€ä»¥å®ƒå°†ç»“æœä¼ é€’äº†ä¸‹å»ã€‚</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;result&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Promise ready&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &lt;-- .then å¯¹ç»“æœè¿›è¡Œå¤„ç†ï¼Œç»“æœ result æ˜¯ä»æ–¹æ³• finally ä¸­è·å–çš„</span>

<span class="token comment">/*---------- åˆ†å‰²çº¿ ----------*/</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Promise ready&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &lt;-- .catch å¯¹ error å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œé”™è¯¯å¯¹è±¡ error æ˜¯ä»æ–¹æ³• finally ä¸­è·å–çš„</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ğŸ’¡ æœ‰ä¸€ä¸ªæµè§ˆå™¨æŠ€å·§ï¼Œ<a href="https://zh.javascript.info/promise-error-handling#qi-ta" target="_blank" rel="noopener noreferrer">åœ¨æ–¹æ³• <code>finally</code> å¤„ç†ç¨‹åºä¸­è¿”å›é›¶å»¶æ—¶ zero-timeout çš„ <code>promise</code> å¯¹è±¡</a>ï¼ˆå¦‚æ„å»ºå‡½æ•°çš„ executor ä¸­å«æœ‰ <code>setTimeout(callback, 0)</code>ï¼‰ï¼Œè¿™æ˜¯å› ä¸ºä¸€äº›æµè§ˆå™¨ï¼Œå¦‚ Chromeï¼Œéœ€è¦ã€Œä¸€ç‚¹æ—¶é—´ã€å¤–çš„ <code>promise</code> å¤„ç†ç¨‹åºæ¥ç»˜åˆ¶æ–‡æ¡£çš„æ›´æ”¹ï¼Œå› æ­¤å®ƒç¡®ä¿åœ¨è¿›å…¥é“¾ä¸‹ä¸€æ­¥ä¹‹å‰ï¼ŒæŒ‡ç¤ºï¼ˆå¦‚ modal å¼¹å‡ºæ¡†å‡ºç°æˆ–æ¶ˆå¤±æ—¶é¡µé¢èƒŒæ™¯è‰²çš„å˜åŒ–ï¼‰åœ¨è§†è§‰ä¸Šæ˜¯åœæ­¢çš„ã€‚</p></li></ol><p>ğŸ’¡ <code>promise</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ä»£è¡¨äº†ä¸€ä¸ª <strong><a href="/blog-web/frontend/JavaScript/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/D:/Front_end/JavaScript/%E5%BC%82%E6%AD%A5%E6%93%8D%E4%BD%9C.html" class="">å¼‚æ­¥æ“ä½œ</a></strong> çš„ç»“æœï¼ˆå®Œæˆæˆ–å¤±è´¥ï¼‰ï¼Œé€šè¿‡å®ƒå¯ä»¥å°†å¼‚æ­¥æ“ä½œçš„ï¼ˆæˆåŠŸå’Œå¤±è´¥ï¼‰ç»“æœä¸ç›¸åº”çš„å¤„ç† handlerï¼ˆæ–¹æ³• <code>.then</code>ã€<code>.catch</code>ã€<code>.finally</code>ï¼Œç›¸å½“äº<a href="/blog-web/frontend/JavaScript/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%9B%9E%E8%B0%83.html" class="">å›è°ƒç»“æ„</a>ä¸­çš„å›è°ƒå‡½æ•°ï¼‰ç»‘å®šï¼Œè¿™ç§åˆ†ç¦»ç»“æ„å¯ä»¥é¿å…åµŒå¥—å›è°ƒè€Œå½¢æˆã€Œå›è°ƒåœ°ç‹±ã€ç»“æ„ï¼ˆè¿™äº›æ–¹æ³•è¿”å›çš„æ˜¯ <code>promise</code> å¯¹è±¡ï¼Œå› æ­¤å¯ä»¥æ„å»º<a href="#%E9%93%BE%E5%BC%8F%E8%B0%83%E7%94%A8">é“¾å¼è°ƒç”¨</a>ï¼‰ã€‚</p><p>promise ç›¸è¾ƒäºåŸºäºå›è°ƒçš„æ¨¡å¼çš„ä¸€äº›å¥½å¤„</p><table><thead><tr><th style="text-align:center;">Promises</th><th style="text-align:center;">Callbacks</th></tr></thead><tbody><tr><td style="text-align:center;">Promises å…è®¸æˆ‘ä»¬æŒ‰ç…§è‡ªç„¶é¡ºåºè¿›è¡Œç¼–ç ï¼Œå¯ä»¥å…ˆè¿è¡Œ <code>executor</code> ç„¶åå†æ·»åŠ æ–¹æ³• <code>.then</code> æ¥å¤„ç†ç»“æœ</td><td style="text-align:center;">åœ¨å£°æ˜ä¸»ä½“å‡½æ•°æ—¶ï¼Œå¿…é¡»æœ‰ä¸€ä¸ª <code>callback</code> å‡½æ•°ï¼Œå³åœ¨è°ƒç”¨ä¹‹å‰å¿…é¡»çŸ¥é“å¦‚ä½•å¤„ç†ç»“æœ</td></tr><tr><td style="text-align:center;">å¯ä»¥æ ¹æ®éœ€è¦åœ¨ promise ä¸Šå¤šæ¬¡è°ƒç”¨ <code>.then</code>ã€‚æ¯æ¬¡è°ƒç”¨éƒ½æ˜¯å½¢æˆä¸€ä¸ªç‹¬ç«‹çš„å¤„ç†ç¨‹åºï¼ˆä¹Ÿå¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨æ¥å¯¹ç»Ÿä¸€ç»“æœè¿›è¡Œå¤„ç†ï¼‰</td><td style="text-align:center;">åªèƒ½æœ‰ä¸€ä¸ªå›è°ƒ</td></tr></tbody></table><p>âš ï¸ <code>Promise</code> ä¸ <code>event</code> ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å¼‚æ­¥æ“ä½œçš„ä¸€ç§ï¼Œä½†äº‹ä»¶ <code>event</code> å¯ä»¥å¤šæ¬¡è§¦å‘ï¼Œè€Œ <strong><code>promise</code> å¯¹è±¡çŠ¶æ€</strong>åªèƒ½ç¡®å®šä¸€æ¬¡ï¼ˆä½†æ˜¯å¯ä»¥åŸºäº <code>promise</code> å¯¹è±¡çŠ¶æ€å¯ä»¥è®¾ç½®å¤šæ¬¡ <code>.then</code> æ–¹æ³•ï¼‰ã€‚</p><p>âš ï¸ <code>Promise</code> å¹¶ä¸æ˜¯å®‰å…¨æ‰§è¡Œè´¹æ—¶æ“ä½œçš„é€šè¡Œè¯ï¼Œå®ƒåªæ˜¯åœ¨å¼‚æ­¥ä»»åŠ¡çŠ¶æ€ç¡®å®šæ—¶å†³å®šä¸‹ä¸€æ­¥æ“ä½œçš„ä¸€ç§æ–¹å¼ã€‚å¦‚æœ <code>Promise</code> åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¸”åœ¨ <code>Promise</code> ä¸­çš„æ“ä½œéœ€æ—¶è¿‡é•¿ä¹Ÿå¯èƒ½ä¼šé€ æˆé˜»å¡å¹¶å¼•èµ·é¡µé¢å¡é¡¿ã€‚</p><h2 id="é”™è¯¯å¤„ç†" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯å¤„ç†" aria-hidden="true">#</a> é”™è¯¯å¤„ç†</h2><p>Promise é“¾åœ¨é”™è¯¯å¤„ç†ä¸­ååˆ†å¼ºå¤§ï¼Œå½“ä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼ˆç”±äº executor æŠ›å‡ºå¼‚å¸¸ï¼‰çŠ¶æ€å˜æˆ <code>rejected</code> æ—¶ï¼Œ<strong>æ§åˆ¶æƒå°†ç§»äº¤è‡³æœ€è¿‘çš„ rejection å¤„ç†ç¨‹åº handlerï¼ˆä¸€èˆ¬æ˜¯æ–¹æ³• <code>.catch(handler)</code></strong>ï¼Œè¿™åœ¨å®é™…å¼€å‘ä¸­éå¸¸æ–¹ä¾¿ã€‚</p><p>å®é™…ä¸Šåœ¨ <code>promise</code> æ„é€ å‡½æ•°ä¸­çš„æ‰§è¡Œè€… executor å’Œ <code>promise</code> å¯¹è±¡æ–¹æ³•çš„å¤„ç†ç¨‹åº handler å‘¨å›´æœ‰ä¸€ä¸ªã€Œéšå¼çš„ã€ <code>try...catch</code> ç»“æ„ï¼Œå¦‚æœä»£ç å‘ç”Ÿå¼‚å¸¸å°±ä¼šè¢«æ•è·ï¼Œå¹¶è§†ä¸º rejection è¿›è¡Œå¤„ç†ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Whoops!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Whoops!</span>

<span class="token comment">// ç›¸å½“äºä»¥ä¸‹æƒ…å†µ</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Whoops!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Whoops!</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ğŸ’¡ é™¤äº†å¼‚æ­¥ä»»åŠ¡å¤±è´¥ä¹‹å¤–ï¼Œå¦‚æœæ˜¯åœ¨æ–¹æ³• <code>.then()</code> ä¸­å¼•å‘çš„é”™è¯¯ï¼ˆå¦‚ <code>throw</code> ã€Œæ‰‹åŠ¨ã€æŠ›å‡ºé”™è¯¯ï¼‰ï¼Œä¹Ÿä¼šéšå¼è‡ªåŠ¨è°ƒç”¨å…¶åæœ€è¿‘çš„æ–¹æ³• <code>catch()</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Whoops!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// reject è¿™ä¸ª promise</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Whoops!</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ğŸ’¡ ä¸€èˆ¬éƒ½åœ¨ promise é“¾å°¾ç«¯ä½¿ç”¨ä¸€ä¸ª <code>.catch</code> å¤„ç†å…¶ä¸Šçš„æ‰€æœ‰å¯èƒ½æŠ›å‡ºçš„ <code>error</code>ï¼Œä»¥é¿å…ç¨‹åºå› å¼‚å¸¸å¡ä½è€Œå¯¼è‡´è„šæœ¬æ­»æ‰ã€‚å¦‚æœå¯¹äº promise é“¾å¯èƒ½ä¼šäº§ç”Ÿæœªå¤„ç†çš„ rejectionï¼Œå¯ä»¥ä½¿ç”¨ <code>unhandledrejection</code> äº‹ä»¶æ¥æ•è·è¿™ç±» <code>error</code>ï¼Œè¿™ä¸ªäº‹ä»¶æ˜¯ <a href="https://html.spec.whatwg.org/multipage/webappapis.html#unhandled-promise-rejections" target="_blank" rel="noopener noreferrer">HTML æ ‡å‡†</a> çš„ä¸€éƒ¨åˆ†ã€‚å¦‚æœå‡ºç°äº†ä¸€ä¸ª errorï¼Œå¹¶ä¸”åœ¨å…¶åæ²¡æœ‰ <code>.catch</code> å¯¹å®ƒè¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆ <code>unhandledrejection</code> å¤„ç†ç¨‹åº handler ä¼šè¢«è§¦å‘ï¼Œå¹¶è·å–å…·æœ‰ <code>error</code> ç›¸å…³ä¿¡æ¯çš„ <code>event</code> å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±èƒ½åšä¸€äº›åç»­å¤„ç†äº†ã€‚é€šå¸¸æ­¤ç±» error æ˜¯æ— æ³•æ¢å¤çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†é—®é¢˜å‘ŠçŸ¥ç”¨æˆ·ï¼Œå¹¶ä¸”å¯ä»¥å°†äº‹ä»¶æŠ¥å‘Šç»™æœåŠ¡å™¨ã€‚åœ¨ Node.js ç­‰éæµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œæœ‰å…¶ä»–ç”¨äºè·Ÿè¸ªæœªå¤„ç†çš„ error çš„æ–¹æ³•ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;unhandledrejection&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿™ä¸ªäº‹ä»¶å¯¹è±¡æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å±æ€§ï¼š</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Promise] - ç”Ÿæˆè¯¥å…¨å±€ error çš„ promise</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error: Whoops! - æœªå¤„ç†çš„ error å¯¹è±¡</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Whoops!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ²¡æœ‰ç”¨æ¥å¤„ç† error çš„ catch</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="é“¾å¼è°ƒç”¨" tabindex="-1"><a class="header-anchor" href="#é“¾å¼è°ƒç”¨" aria-hidden="true">#</a> é“¾å¼è°ƒç”¨</h2><p>ä¾æ¬¡è¿ç»­æ‰§è¡Œå¤šä¸ªæ“ä½œæ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œå³åœ¨ä¸Šä¸€ä¸ªæ“ä½œæ‰§è¡ŒæˆåŠŸä¹‹åï¼Œæ‰å¼€å§‹ä¸‹ä¸€ä¸ªæ“ä½œï¼ˆå¹¶ä¸€èˆ¬å¸¦ç€ä¸Šä¸€æ­¥è¿”å›çš„ç»“æœï¼‰ã€‚ä½¿ç”¨ <code>promise</code> å¯¹è±¡çš„æ–¹æ³• <code>then</code> å¯ä»¥å®ç°è¿™ç§åŠŸèƒ½ï¼Œä»è€Œé¿å…å½¢æˆ<a href="/blog-web/frontend/JavaScript/%E8%AF%AD%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%9B%9E%E8%B0%83.html#%E5%B5%8C%E5%A5%97%E5%9B%9E%E8%B0%83" class="">ã€Œå›è°ƒåœ°ç‹±ã€ç»“æ„</a>ã€‚è¿™æ˜¯ç”±äºæ–¹æ³• <code>.then</code> è¿”å›çš„æ˜¯ <a href="https://zh.javascript.info/promise-chaining#shi-li-loadscript" target="_blank" rel="noopener noreferrer">thenable å¯¹è±¡</a>ï¼Œå³ä¸€ä¸ªå…·æœ‰æ–¹æ³• <code>.then</code> çš„ä»»æ„å¯¹è±¡ï¼ˆå¯ä»¥ä½œä¸º <code>promise</code> æ¥å¯¹å¾…ï¼‰ï¼Œ<strong>å› æ­¤å¯ä»¥åœ¨æ–¹æ³•åå†æ·»åŠ æ–¹æ³• <code>.then</code></strong> ï¼Œä¸æ–­æ·»åŠ æ–¹æ³• <code>.then</code> å¯ä»¥æ„æˆä¸€ä¸ªé•¿åºåˆ—çš„é“¾å¼è°ƒç”¨ã€‚</p><p>ğŸ’¡ ç¡®åˆ‡åœ°è¯´å¤„ç†ç¨‹åº handler è¿”å›çš„ä¸å®Œå…¨æ˜¯ä¸€ä¸ª promiseï¼Œè€Œæ˜¯è¿”å›çš„è¢«ç§°ä¸º thenable å¯¹è±¡ï¼ˆä¸€ä¸ªå…·æœ‰æ–¹æ³• <code>.then</code> çš„ä»»æ„å¯¹è±¡ï¼‰ï¼Œå®ƒä¼šè¢«å½“åšä¸€ä¸ª promise æ¥å¯¹å¾…ï¼Œè¿™ä¸ªæƒ³æ³•æ˜¯è®©ç¬¬ä¸‰æ–¹åº“å¯ä»¥å®ç°è‡ªå·±çš„ promise å…¼å®¹ï¼ˆpromise-compatibleï¼‰å¯¹è±¡ï¼Œä½†ä¾ç„¶å¯ä»¥ä¸åŸç”Ÿçš„ promise å…¼å®¹ï¼ˆå› ä¸ºå®ƒä»¬å®ç°äº† <code>.then</code> æ–¹æ³•ï¼‰ï¼Œå³å…è®¸æˆ‘ä»¬å°†è‡ªå®šä¹‰çš„å¯¹è±¡ä¸ <code>promise</code> é“¾é›†æˆåœ¨ä¸€èµ·ï¼Œè€Œä¸å¿…ç»§æ‰¿è‡ª <code>Promise</code>ç±»ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è‡ªå®šä¹‰ thenable ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">Thenable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function() { native code }</span>
    <span class="token comment">// 1 ç§’åä½¿ç”¨ this.num*2 è¿›è¡Œ resolve</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (**)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Thenable</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1000ms åæ˜¾ç¤º 2</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>é“¾å¼è°ƒç”¨çš„ç†å¿µæ˜¯åˆ©ç”¨æ–¹æ³• <code>.then</code> ä¼šè¿”å›ç±»ä¼¼äº <code>promise</code> å¯¹è±¡ï¼Œåœ¨ä¸‹ä¸€æ­¥ä¸­å†æ¬¡è°ƒç”¨è¯¥è¿”å›å¯¹è±¡çš„æ–¹æ³• <code>.then</code>ï¼Œå¹¶å¯¹å¯¹è±¡çš„ç»“æœå±æ€§ <code>result</code> åœ¨ä¼ é€’é“¾ä¸Šè¿›è¡Œä¾æ¬¡å¤„ç†ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (*)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// (**)</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
  <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// (***)</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
  <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
  <span class="token keyword">return</span> result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ä¸Šè¿°å®ä¾‹è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åˆå§‹ <code>promise</code> åœ¨ 1 ç§’åè¿›è¡Œ <code>resolve</code></li><li>ç„¶å <code>.then</code> å¤„ç†ç¨‹åº handler è¢«è°ƒç”¨</li><li>å®ƒè¿”å›çš„å€¼æ˜¯ä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼Œå…¶ç»“æœï¼ˆä¸Šä¸€æ­¥çš„ <code>result</code>ï¼‰å°±å¯ä»¥è¢«ä¼ å…¥ä¸‹ä¸€ä¸ª <code>.then</code> å¤„ç†ç¨‹åº handler</li><li>â€¦â€¦ä¾æ­¤ç±»æ¨</li></ol><p>éšç€ result åœ¨å¤„ç†ç¨‹åºï¼ˆhandlerï¼‰é“¾ä¸­ä¼ é€’ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ç³»åˆ—çš„ <code>alert</code> è°ƒç”¨ï¼š<code>1</code> â†’ <code>2</code> â†’ <code>4</code></p><p><img src="/blog-web/assets/20200501212737000_24563.a3e75bf7.png" alt="promise chain"></p><p>ğŸ’¡ å¦‚æœæ–¹æ³• <code>.then(handler)</code> çš„å¤„ç†ç¨‹åºä¸­åŒ…å«å¼‚æ­¥ä»£ç ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ <code>new Promise</code> æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ª <code>promise</code> å¯¹è±¡å°†å…¶åŒ…è£¹ï¼Œå¹¶è¿”å›è¿™ä¸ªæ–°å»ºçš„ <code>promise</code> å¯¹è±¡ï¼Œè¿™æ ·è°ƒç”¨é“¾çš„ä¸‹ä¸€æ­¥çš„æ–¹æ³• <code>.then</code> å°±ä¼šç­‰å¾…æ–°å»º <code>promise</code> å¯¹è±¡çš„çŠ¶æ€ç¡®å®šåå†æ‰§è¡Œï¼Œå³å¯å®ç°å¼‚æ­¥é“¾å¼è°ƒç”¨ã€‚</p><p>é“¾å¼è°ƒç”¨ä¸åŒæƒ…å†µçš„ç¤ºæ„å›¾ <img src="/blog-web/assets/20200501213514130_4159.597eed41.png" alt="asynchronous  promise chain"></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// (*)</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// (**)</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ä¸Šè¿°å®ä¾‹è¾“å‡ºä¸å‰é¢çš„ç¤ºä¾‹ç›¸åŒï¼š<code>1</code> â†’ <code>2</code> â†’ <code>4</code>ï¼Œä½†æ˜¯ç°åœ¨åœ¨æ¯æ¬¡ <code>alert</code> è°ƒç”¨ä¹‹é—´ä¼šæœ‰ 1 ç§’é’Ÿçš„å»¶è¿Ÿã€‚</p><p>ğŸ’¡ è¿”å› <code>promise</code>ï¼ˆä¸”å…¶ä¸­çš„ executor åŒ…å«å¼‚æ­¥ä»£ç ï¼‰ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ„å»ºå¼‚æ­¥è¡Œä¸ºé“¾ã€‚</p><h2 id="async-å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#async-å‡½æ•°" aria-hidden="true">#</a> async å‡½æ•°</h2><p>Async/await æ˜¯ä»¥æ›´èˆ’é€‚çš„æ–¹å¼ä½¿ç”¨ promise çš„ä¸€ç§ç‰¹æ®Šè¯­æ³•ï¼ŒåŒæ—¶å®ƒä¹Ÿéå¸¸æ˜“äºç†è§£å’Œä½¿ç”¨ã€‚</p><p>å½“å‡½æ•°ä»¥å…³é”®å­— <code>async</code> å¼€å§‹å°±è¡¨ç¤ºè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼Œè€Œä¸”ä¼šå°†å‡½æ•°çš„è¿”å›å€¼ä½œä¸º <code>promise</code> å¯¹è±¡çš„ç»“æœ <code>result</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªç»“æœä¸º 1 çš„ resolved promise</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä¸€èˆ¬åœ¨ <code>async</code> å‡½æ•°ä¼šä½¿ç”¨å…³é”®å­— <code>await</code> è·å–ç¡®å®šæš‚åœçš„å¯¹è±¡çš„ç»“æœã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åªåœ¨ async å‡½æ•°å†…å·¥ä½œ</span>
<span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">await</span> promise<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>å…³é”®å­— <code>await</code> çš„ä½œç”¨å°±æ˜¯è®© JavaScript å¼•æ“ã€Œæš‚åœã€å¹¶ç­‰å¾…ç›´åˆ° <code>promise</code> å¯¹è±¡ settleï¼Œç„¶åä»¥ <code>promise</code> å¯¹è±¡çš„ç»“æœç»§ç»­æ‰§è¡Œã€‚è¿™ä¸ªè¡Œä¸ºä¸ä¼šè€—è´¹ä»»ä½• CPU èµ„æºï¼Œå› ä¸ºå¼•æ“å¯ä»¥åŒæ—¶å¤„ç†å…¶ä»–ä»»åŠ¡ï¼šæ‰§è¡Œå…¶ä»–è„šæœ¬ï¼Œå¤„ç†äº‹ä»¶ç­‰ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// async å‡½æ•°</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">&quot;done!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> promise<span class="token punctuation">;</span>   <span class="token comment">// ç­‰å¾…ï¼Œç›´åˆ° promise resolve</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// &quot;done!&quot;</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>âš ï¸ å…³é”®å­— <code>await</code> åªåœ¨ <code>async</code> å‡½æ•°ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šå¾—åˆ°ä¸€ä¸ªè¯­æ³•é”™è¯¯</p><p>å¦‚æœä¸€ä¸ª <code>promise</code> å¯¹è±¡æ­£å¸¸ resolveï¼Œ<code>await promise</code> è¿”å›çš„å°±æ˜¯å…¶ç»“æœï¼›å¦‚æœ <code>promise</code> å¯¹è±¡è¢« rejectï¼Œå®ƒå°† <code>throw</code> è¿™ä¸ª <code>error</code>ï¼Œå¯ä»¥åœ¨å¤–éƒ¨æ·»åŠ  <code>try...catch</code> ç»“æ„æ¥æ•è·ä¸Šé¢æåˆ°çš„é‚£ä¸ª <code>error</code>ï¼›æˆ–è€…åœ¨ <code>async</code> å‡½æ•°åé¢æ·»åŠ æ–¹æ³• <code>.catch</code> æ•è·å¼‚å¸¸ï¼›æˆ–è€…ä½¿ç”¨å…¨å±€äº‹ä»¶å¤„ç†ç¨‹åº <code>unhandledrejection</code> æ¥æ•è·ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ä½¿ç”¨ try...catch ç»“æ„æ•è·å¼‚å¸¸</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;http://no-such-url&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: failed to fetch</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*---------- åˆ†å‰²çº¿ ----------*/</span>
<span class="token comment">// æ‰‹æ§ç«ç‘°æ–¹æ³• .catch æ•è·å¼‚å¸¸</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;http://no-such-url&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// f() å˜æˆäº†ä¸€ä¸ª rejected çš„ promise</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: failed to fetch // (*)</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>å®é™…ä¸Š <code>await</code> æ˜¯æ¥å—ä¸€ä¸ª thenable å¯¹è±¡ï¼ˆé‚£äº›å…·æœ‰å¯è°ƒç”¨çš„ <code>then</code> æ–¹æ³•çš„å¯¹è±¡ï¼‰ï¼Œå°±åƒæ–¹æ³• <code>.then</code> è¿”å›ä¸€ä¸ª thenable å¯¹è±¡ä¸€æ ·ï¼Œè¿™æ ·è§„å®šæ˜¯ä¸ºäº†å…¼å®¹é <code>promise</code> çš„ç¬¬ä¸‰æ–¹å¯¹è±¡ã€‚</p><p>å¦‚æœ <code>await</code> æ¥æ”¶äº†ä¸€ä¸ªé <code>promise</code>ä½†æ˜¯æä¾›äº† <code>.then</code> æ–¹æ³•çš„å¯¹è±¡æ—¶ï¼Œå®ƒå°±ä¼šè°ƒç”¨è¿™ä¸ª <code>.then</code> æ–¹æ³•å¹¶å°†å†…å»ºçš„å‡½æ•° <code>resolve</code> å’Œ <code>reject</code> ä½œä¸ºå‚æ•°ä¼ å…¥ï¼ˆå°±åƒ <code>Promise</code> å¯¹è±¡çš„ executor æ‰§è¡Œæ­¥éª¤ä¸€æ ·ï¼‰ï¼Œç„¶å <code>await</code> ç­‰å¾…ï¼Œç›´åˆ°è¿™ä¸¤ä¸ªå‡½æ•°ä¹‹ä¸€è¢«è°ƒç”¨ï¼Œå°±å¯ä»¥è·å–ç›¸åº”çš„ç»“æœç»§ç»­æ‰§è¡Œåç»­ä»»åŠ¡ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// thenable å¯¹è±¡</span>
<span class="token keyword">class</span> <span class="token class-name">Thenable</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">=</span> num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// å…·æœ‰æ–¹æ³• then</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ç­‰å¾… 1 ç§’ï¼Œä¹‹å result å˜ä¸º 2</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Thenable</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// æ¥å— thenable å¯¹è±¡ï¼Œç±»ä¼¼äº promise å¯¹è±¡</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>ğŸ’¡ ç›¸æ¯”äº <code>promise.then</code>ï¼Œå‡½æ•° <code>async</code> ç»“åˆå…³é”®å­— <code>await</code> æ˜¯è·å– promise çš„ç»“æœçš„ä¸€ä¸ªæ›´ä¼˜é›…çš„è¯­æ³•ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>async/await</code> æ—¶å‡ ä¹å°±ä¸ä¼šç”¨åˆ° <code>.then</code> äº†ï¼Œå› ä¸º <code>await</code> ä¸ºæˆ‘ä»¬å¤„ç†äº†ç­‰å¾…ï¼Œè€Œä¸”ä¸€èˆ¬ç»“åˆ <code>try..catch</code> ç»“æ„ï¼ˆè€Œä¸æ˜¯ <code>.catch</code> ï¼‰æ•æŠ“å¼‚å¸¸ã€‚âš ï¸ ä½†æ˜¯å½“æˆ‘ä»¬åœ¨ä»£ç çš„é¡¶å±‚ï¼ˆå³åœ¨ <code>async</code> å‡½æ•°ä¹‹å¤–ï¼‰ï¼Œå°±ä¸èƒ½ä½¿ç”¨ <code>await</code> äº†ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨ <code>async</code> å‡½æ•°åæ·»åŠ  <code>.then/catch</code> æ¥å¤„ç†æœ€ç»ˆçš„ç»“æœ <code>result</code> æˆ–æŠ›å‡ºçš„ <code>error</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// then é“¾å¼è°ƒç”¨</span>
<span class="token keyword">function</span> <span class="token function">loadJson</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">loadJson</span><span class="token punctuation">(</span><span class="token string">&#39;no-such-user.json&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*---------- åˆ†å‰²çº¿ ----------*/</span>
<span class="token comment">// ä½¿ç”¨ await å…³é”®å­—</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadJson</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> json<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">loadJson</span><span class="token punctuation">(</span><span class="token string">&#39;no-such-user.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>alert<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="promise-api" tabindex="-1"><a class="header-anchor" href="#promise-api" aria-hidden="true">#</a> promise API</h2><p><code>Promise</code> ç±»æœ‰ 5 ç§é™æ€æ–¹æ³•ï¼Œç”¨äºã€Œæ‰¹é‡ã€å¤„ç† <code>promise</code> å¯¹è±¡</p><ul><li><p><code>Promise.all(promises)</code> ç­‰å¾…æ‰€æœ‰ <code>promise</code> å¯¹è±¡çŠ¶æ€éƒ½ä¸º <code>resolved</code> æ—¶è¿”å›ä»¥å­˜æ”¾å®ƒä»¬ç»“æœçš„æ•°ç»„ä¸ºç»“æœçš„ <code>promise</code> å¯¹è±¡ã€‚å¦‚æœç»™å®šçš„ä»»æ„ä¸€ä¸ª <code>promise</code> å¯¹è±¡ä¸º <code>rejected</code>ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå˜æˆ <code>Promise.all</code> çš„ <code>error</code>ï¼Œæ‰€æœ‰å…¶ä»– <code>promise</code> å¯¹è±¡çš„çŠ¶æ€ç»“æœéƒ½ä¼šè¢«å¿½ç•¥ã€‚</p></li><li><p><code>Promise.allSettled(promises)</code>ï¼ˆES2020 æ–°å¢æ–¹æ³•ï¼‰ç­‰å¾…æ‰€æœ‰ <code>promise</code> å¯¹è±¡éƒ½ <code>settled</code> æ—¶ï¼Œå¹¶ä»¥åŒ…å«<strong>ä»¥ä¸‹å†…å®¹çš„å¯¹è±¡</strong>æ•°ç»„çš„å½¢å¼è¿”å›å®ƒä»¬çš„ç»“æœ</p><ul><li><code>state</code>: <code>&quot;fulfilled&quot;</code> æˆ– <code>&quot;rejected&quot;</code></li><li><code>value</code>ï¼ˆå¦‚æœ fulfilledï¼‰æˆ– <code>reason</code>ï¼ˆå¦‚æœ rejectedï¼‰</li></ul></li><li><p><code>Promise.race(promises)</code> ç­‰å¾…<strong>ç¬¬ä¸€ä¸ª <code>settled</code> çš„ <code>promise</code> å¯¹è±¡</strong>ï¼Œå¹¶å°†å…¶ <code>result/error</code> ä½œä¸ºç»“æœ</p></li><li><p><code>Promise.resolve(value)</code> ä½¿ç”¨ç»™å®š <code>value</code> ä½œä¸ºç»“æœ <code>result</code>ï¼Œåˆ›å»ºä¸€ä¸ª <code>resolved</code> çš„ <code>promise</code> å¯¹è±¡</p></li><li><p><code>Promise.reject(error)</code> ä½¿ç”¨ç»™å®š <code>error</code> ä½œä¸ºåŸå›  <code>reason</code>ï¼Œåˆ›å»ºä¸€ä¸ª <code>rejected</code> çš„ <code>promise</code> å¯¹è±¡</p></li></ul><p>ğŸ’¡ è¿™äº”ä¸ªæ–¹æ³•ä¸­ <code>Promise.all</code> å¯èƒ½æ˜¯åœ¨å®æˆ˜ä¸­ä½¿ç”¨æœ€å¤šçš„</p><h2 id="promisification" tabindex="-1"><a class="header-anchor" href="#promisification" aria-hidden="true">#</a> Promisification</h2><p>Promisification è¿™ä¸ªé•¿å•è¯è¡¨ç¤ºä¸€ç§ç‰¹å®šçš„å‡½æ•°ç»“æ„è½¬æ¢è¡Œä¸ºï¼Œè¡¨ç¤ºå°†å›è°ƒç»“æ„è½¬æ¢ä¸º promise ç»“æ„ï¼Œå³æŒ‡ promise åŒ–ã€‚</p><p>å› ä¸ºä½¿ç”¨ promise æ›´åŠ æ–¹ä¾¿ï¼Œè®¸å¤šå‡½æ•°å’Œåº“éƒ½æ˜¯åŸºäºå›è°ƒçš„ï¼Œå› æ­¤åœ¨å®é™…å¼€å‘ä¸­ç»å¸¸ä¼šéœ€è¦è¿›è¡Œè¿™ç§è½¬æ¢ï¼Œå¯ä»¥è®¾è®¡ä¸€ä¸ªé€šç”¨çš„è½¬æ¢å‡½æ•° <code>promisify(f)</code> ååŠ©æˆ‘ä»¬è¿›è¡Œè½¬æ¢ã€‚</p><p>è¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªéœ€è¦è¢« promisify çš„å‡½æ•° <code>f</code>ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…è£… wrapper å‡½æ•°ï¼ˆä»¥ä¾¿æˆ‘ä»¬æŒ‰ç…§åŸæ¥çš„æ–¹å¼è°ƒç”¨è½¬æ¢åçš„å‡½æ•°ï¼‰ã€‚è€Œè¯¥åŒ…è£…å‡½æ•°çš„åŠŸèƒ½å°±æ˜¯æœ€åè¿”å›ä¸€ä¸ª <code>promise</code> å¯¹è±¡ï¼Œå¹¶å°†è°ƒç”¨ï¼ˆå‚æ•°ï¼‰ä¼ é€’ç»™åŸå§‹çš„å‡½æ•° <code>f</code>ï¼Œå¹¶åœ¨è‡ªå®šä¹‰çš„å›è°ƒä¸­è·Ÿè¸ªç»“æœ</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è¿”å›ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼ˆwrapper-functionï¼‰</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// æˆ‘ä»¬å¯¹ f çš„è‡ªå®šä¹‰çš„å›è°ƒ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å°†æˆ‘ä»¬çš„è‡ªå®šä¹‰çš„å›è°ƒé™„åŠ åˆ° f å‚æ•°ï¼ˆargumentsï¼‰çš„æœ«å°¾</span>

      <span class="token function">f</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è°ƒç”¨åŸå§‹çš„å‡½æ•°</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç”¨æ³•ï¼š</span>
<span class="token keyword">let</span> loadScriptPromise <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>loadScript<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">loadScriptPromise</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åŸæ¥çš„å›è°ƒå‡½æ•°å˜æˆæ–¹æ³• then çš„å¤„ç†ç¨‹åº</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>ğŸ’¡ ä¸Šè¿°çš„ä»£ç å‡è®¾<strong>åŸå§‹çš„å‡½æ•°æœŸæœ›ä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªå‚æ•° <code>(err, result)</code> çš„å›è°ƒ</strong>ã€‚è¿™å°±æ˜¯æˆ‘ä»¬æœ€å¸¸é‡åˆ°çš„å½¢å¼ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„è‡ªå®šä¹‰å›è°ƒçš„æ ¼å¼å®Œå…¨æ­£ç¡®ï¼Œå¹¶ä¸” <code>promisify</code> åœ¨è¿™ç§æƒ…å†µä¸‹éå¸¸æœ‰ç”¨ã€‚</p><p>å¦‚æœåŸå§‹çš„ <code>f</code> æœŸæœ›ä¸€ä¸ªå¸¦æœ‰æ›´å¤šå‚æ•°çš„å›è°ƒå‡½æ•°ï¼Œå¦‚ <code>callback(err, res1, res2, ...)</code> åˆ™å¯ä»¥ä½¿ç”¨ã€Œæ›´é«˜çº§ã€çš„ç‰ˆæœ¬</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// promisify(f, true) æ¥è·å–ç»“æœæ•°ç»„</span>
<span class="token keyword">function</span> <span class="token function">promisify</span><span class="token punctuation">(</span><span class="token parameter">f<span class="token punctuation">,</span> manyArgs <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">function</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> <span class="token operator">...</span>results</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// æˆ‘ä»¬è‡ªå®šä¹‰çš„ f çš„å›è°ƒï¼Œä»¥å‰©ä½™å‚æ•°æ¥æ¥å—ä¸å®šæ•°é‡çš„è¾“å…¥</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">// å¦‚æœ manyArgs è¢«æŒ‡å®šï¼Œåˆ™ä½¿ç”¨æ‰€æœ‰å›è°ƒçš„ç»“æœ resolve</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span>manyArgs <span class="token operator">?</span> results <span class="token operator">:</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">f</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç”¨æ³•</span>
<span class="token comment">// è°ƒç”¨ promisify(f, true) è¡¨ç¤º promise çš„ç»“æœå°†æ˜¯ç”¨æˆ·è¾“å…¥å¤šä¸ªå‚æ•°ç»„æˆçš„æ•°ç»„ [res1, res2, ...]</span>
f <span class="token operator">=</span> <span class="token function">promisify</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">arrayOfResults</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span><span class="token punctuation">)</span>   <span class="token comment">// ä½¿ç”¨ç”¨æˆ·æ‰€æœ‰è¾“å…¥è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>ğŸ’¡ å¯¹äºä¸€äº›æ›´å¥‡ç‰¹çš„å›è°ƒæ ¼å¼ï¼Œå¦‚æ ¹æœ¬æ²¡æœ‰ <code>err</code> çš„æ ¼å¼ <code>callback(result)</code> å¯ä»¥æ‰‹åŠ¨ promisify è¿™æ ·çš„å‡½æ•°ã€‚ä¹Ÿæœ‰ä¸€äº›å…·æœ‰æ›´çµæ´»ä¸€ç‚¹çš„ promisification å‡½æ•°çš„æ¨¡å—ï¼Œä¾‹å¦‚ <a href="https://github.com/digitaldesignlabs/es6-promisify" target="_blank" rel="noopener noreferrer">es6-promisify</a>ã€‚åœ¨ Node.js ä¸­ï¼Œæœ‰ä¸€ä¸ªå†…å»ºçš„ promisify å‡½æ•° <code>util.promisify</code>ã€‚</p><h2 id="å¾®ä»»åŠ¡" tabindex="-1"><a class="header-anchor" href="#å¾®ä»»åŠ¡" aria-hidden="true">#</a> å¾®ä»»åŠ¡</h2><p>Promise çš„å¤„ç†ç¨‹åºï¼ˆhandlersï¼‰<code>.then</code>ã€<code>.catch</code> å’Œ <code>.finally</code> éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå³ä¸€ä¸ª <code>promise</code> å¯¹è±¡ç«‹å³è¢« resolveï¼Œä½†å®ƒçš„æ–¹æ³• <code>.then</code>ã€<code>.catch</code> å’Œ <code>.finally</code> ä¹Ÿä¼šç­‰å¾…å…¶ä¸‹é¢ï¼ˆé“¾å¼è°ƒç”¨ä»¥å¤–ï¼‰ çš„ä»£ç æ‰§è¡Œå®Œæˆåå†æ‰§è¡Œè¿™äº›å¤„ç†ç¨‹åº handlerã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;promise done!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;code finished&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿™ä¸ª alert å…ˆæ˜¾ç¤º</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¿™æ˜¯ç”±äº ECMA æ ‡å‡†è§„å®šäº†ä¸€ä¸ªå†…éƒ¨é˜Ÿåˆ— <code>PromiseJobs</code>ï¼Œé€šå¸¸è¢«ç§°ä¸ºå¾®ä»»åŠ¡é˜Ÿåˆ— microtask queueï¼ˆES8 æœ¯è¯­ï¼‰æ¥ç®¡ç†å¼‚æ­¥ä»»åŠ¡ã€‚å½“ä¸€ä¸ª <code>promise</code> å¯¹è±¡å‡†å¤‡å°±ç»ªæ—¶ï¼Œå®ƒçš„æ–¹æ³• <code>.then/catch/finally</code> ä¸­çš„å¤„ç†ç¨‹åº handler å°±ä¼šè¢«æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œä½†æ˜¯å®ƒä»¬ä¸ä¼šç«‹å³è¢«æ‰§è¡Œã€‚æ ¹æ®<a href="https://tc39.github.io/ecma262/#sec-jobs-and-job-queues" target="_blank" rel="noopener noreferrer">è§„èŒƒ</a>ä¸­æ‰€è¿°ï¼š</p><ul><li>åªæœ‰åœ¨ JavaScript å¼•æ“ä¸­æ²¡æœ‰å…¶å®ƒä»»åŠ¡åœ¨è¿è¡Œæ—¶ï¼Œæ‰å¼€å§‹æ‰§è¡Œä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</li><li>é˜Ÿåˆ— queue æ˜¯å…ˆè¿›å…ˆå‡ºçš„ï¼Œå³åœ¨ promise é“¾ä¸­é¦–å…ˆè¿›å…¥é˜Ÿåˆ—çš„å¤„ç†ç¨‹åºä»»åŠ¡ä¼šé¦–å…ˆè¿è¡Œã€‚</li></ul><p><img src="/blog-web/assets/20200502102151557_23180.2d849bd8.png" alt="microtask queue"></p><p>å¦‚æœæ‰§è¡Œé¡ºåºå¯¹æˆ‘ä»¬å¾ˆé‡è¦ï¼Œå¯ä»¥å°†ä»£ç æ·»åŠ åˆ°é“¾å¼è°ƒç”¨çš„ <code>.then</code> ä¸­ï¼Œç¡®ä¿ç¨‹åºä¾æ¬¡æ‰§è¡Œ</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;promise done!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;code finished&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ğŸ’¡ å¯¹äº promise é“¾æœªå¤„ç†çš„ rjection å¯ä»¥ä½¿ç”¨ <code>unhandledrejection</code> äº‹ä»¶æ¥æ•è·ï¼Œä½†å®ƒæ˜¯åœ¨å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½å®Œæˆæ—¶æ‰ä¼šç”Ÿæˆçš„ã€‚</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">æ›´æ–°æ—¶é—´: </span><span class="meta-item-info">2021/7/6 ä¸Šåˆ2:38:22</span></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><div style="width:0px;" class="catalog-container absolute top-0 right-0 h-full hidden lg:block"><div class="headings-container sticky top-36" data-v-c28348e0><ul class="max-w-max m-2 pl-7 xl:pl-16 2xl:pl-20 py-4 opacity-50 hover:opacity-100 transition-all duration-300" data-v-c28348e0><!--[--><!--]--></ul></div></div><div style="display:none;" tabindex="0" class="sidebar-container fixed inset-y-0 left-0 z-20 lg:hidden opacity-10 hover:opacity-95"><div class="headings-container px-2 space-y-2 transition-all duration-300 py-20" data-v-6eed9461><!--[--><!--]--></div></div></div><footer class="bg-gray-200 p-8 grid grid-cols-1 md:grid-cols-3 gap-4 items-center"><div class="flex justify-center md:justify-start items-center"><a class="p-2 hover:bg-gray-300 rounded-md" href="https://benbinbin.github.io/" target="_blank"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="text-center space-y-0.5"><p class="text-sm text-gray-600"> Â©2021 <span class="author">Benbinbin</span>. All Right Reserved. </p><p class="text-xs text-center text-gray-400"> é™¤ç‰¹æ®Šè¯´æ˜å¤–ï¼Œæœ¬ç«™çš„æ–‡ç« éµå¾ª <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" target="_blank" class="text-blue-400">CC-BY-SA-4.0</a> åè®® </p><p class="text-xs text-center text-gray-400"> ç½‘ç«™ä¸»é¢˜é‡‡ç”¨ <a href="https://github.com/Benbinbin/two-dishes-one-fish" target="_blank" class="text-blue-400">Two Dishes One Fish</a></p></div><div class="btn-container flex justify-center md:justify-end items-center space-x-0.5"><!--[--><a class="p-2 hover:bg-gray-300 rounded-md" href="mailto:benthomsonbin@gmail.com" target=""><img src="/blog-web/images/icons/email.svg" alt="email" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://github.com/Benbinbin" target="_blank"><img src="/blog-web/images/icons/github.svg" alt="github" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://juejin.cn/user/3175045314389278/posts" target="_blank"><img src="/blog-web/images/icons/juejin.svg" alt="juejin" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://dribbble.com/BinBinDesign" target="_blank"><img src="/blog-web/images/icons/dribbble.svg" alt="dribbble" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://twitter.com/Benbinbin_fun" target="_blank"><img src="/blog-web/images/icons/twitter.svg" alt="twitter" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://weibo.com/binbindesign" target="_blank"><img src="/blog-web/images/icons/weibo.svg" alt="weibo" class="w-auto h-6"></a><!--]--></div></footer></div><!--]--></div>
    <script type="module" src="/blog-web/assets/app.43fe0c63.js" defer></script>
  </body>
</html>
