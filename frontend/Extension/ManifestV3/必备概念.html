<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/blog-web/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css"><title>å¿…å¤‡æ¦‚å¿µ | Blog</title><meta name="description" content="A blog and knowledge management system about web.">
    <link rel="modulepreload" href="/blog-web/assets/app.43fe0c63.js"><link rel="modulepreload" href="/blog-web/assets/å¿…å¤‡æ¦‚å¿µ.html.d5475543.js"><link rel="modulepreload" href="/blog-web/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/blog-web/assets/å¿…å¤‡æ¦‚å¿µ.html.82bc0dc3.js">
    <link rel="stylesheet" href="/blog-web/assets/style.b42fd117.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="min-h-screen flex flex-col"><nav class="px-4 sm:px-8 py-2 flex justify-between items-center sticky top-0 z-30 bg-white"><div class="left flex items-center space-x-0.5"><!--[--><button class="text-gray-400 hover:bg-gray-100 catelog-btn p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--><a class="avatar p-2 hover:bg-gray-100 rounded-md" href="/blog-web/#"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="right hidden sm:flex items-center space-x-0.5"><!--[--><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">All</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Network</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Frontend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Backend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Project</button><!--]--><!--[--><button class="text-gray-900 bg-gray-100 hover:bg-gray-200 p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md hidden lg:block"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--></div><div class="more-container sm:hidden relative"><button style="" class="p-2 select-none hover:bg-gray-100 rounded-md text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"></path></svg></button><button style="display:none;" class="p-2 select-none hover:bg-gray-100 rounded-md text-red-400 hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path></svg></button><div style="display:none;" class="more-modal p-2 absolute top-10 right-0 z-10 flex flex-col space-y-2 bg-gray-100 rounded-md opacity-90"><!--[--><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">All</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Network</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Frontend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Backend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Project</button><!--]--></div></div></nav><div class="relative flex-grow"><div class="theme-container no-navbar no-sidebar"><!--[--><!----><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="å¿…å¤‡æ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#å¿…å¤‡æ¦‚å¿µ" aria-hidden="true">#</a> å¿…å¤‡æ¦‚å¿µ</h1><p>æ‰©å±•ç¨‹åºç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼Œä»¥ä¸‹åˆ—å‡ºäº†<a href="https://developer.chrome.com/docs/extensions/mv3/devguide/" target="_blank" rel="noopener noreferrer">å¼€å‘ç›¸å…³çš„å¿…å¤‡æ¦‚å¿µ</a>ã€‚</p><h2 id="é€šç”¨æŠ€æœ¯" tabindex="-1"><a class="header-anchor" href="#é€šç”¨æŠ€æœ¯" aria-hidden="true">#</a> é€šç”¨æŠ€æœ¯</h2><h3 id="service-workers" tabindex="-1"><a class="header-anchor" href="#service-workers" aria-hidden="true">#</a> Service Workers</h3><p>åœ¨ Manifest V2 ç‰ˆæœ¬ä¸­ï¼Œåå°é¡µé¢ background pages æ˜¯æ‰©å±•ç¨‹åºä¸­çš„ä¸€ä¸ªç‹¬ç«‹é¡µé¢ï¼Œä¸€èˆ¬è®¾ç½®äº‹ä»¶ç›‘å¬ï¼Œä»¥å“åº”ç”¨æˆ·çš„æ“ä½œï¼Œä½†æ˜¯å®ƒä¼šé•¿æœŸé©»ç•™åå°å½±å“æ€§èƒ½ã€‚åœ¨ Manifest V3 ç‰ˆæœ¬ä¸­ï¼Œåå°è„šæœ¬è¿ç§»åˆ° Service Workers ä¸­è¿è¡Œä»¥æä¾›æ€§èƒ½ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p><ul><li>Service Workers åœ¨æ‰§è¡Œäº‹ä»¶å¤„ç†å‡½æ•°åç»ˆæ­¢ï¼Œå¹¶åœ¨æ–°çš„äº‹ä»¶è§¦å‘ä¸‹é‡æ–°è¿è¡Œ</li><li>å®ƒæ˜¯ä¸€ç§ <a href="https://www.html5rocks.com/en/tutorials/workers/basics/" target="_blank" rel="noopener noreferrer">JavaScript Worker</a>ï¼Œ<strong>æ— æ³•ç›´æ¥è®¿é—® DOM</strong>ã€‚</li></ul><p>ğŸ’¡ <a href="https://developers.google.com/web/fundamentals/primers/service-workers/" target="_blank" rel="noopener noreferrer">Service Worker</a> æ˜¯æµè§ˆå™¨<strong>å®Œå…¨ç‹¬ç«‹äºç½‘é¡µè¿è¡Œ</strong>çš„è„šæœ¬ã€‚é™¤äº†ä»¥ä¸Šçš„ç‰¹ç‚¹ï¼Œè¿˜è¦æ³¨æ„ä»¥ä¸‹çš„ç›¸å…³äº‹é¡¹ï¼š</p><ul><li>å®ƒæ˜¯ä¸€ç§å¯ç¼–ç¨‹ç½‘ç»œä»£ç†ï¼Œè®©æ‚¨èƒ½å¤Ÿæ§åˆ¶é¡µé¢æ‰€å‘é€ç½‘ç»œè¯·æ±‚çš„å¤„ç†æ–¹å¼ã€‚</li><li>å®ƒå¹¿æ³›åœ°åˆ©ç”¨äº† promise è¿›è¡Œå¼‚æ­¥æ“ä½œã€‚</li></ul><p>å¦‚æœéœ€è¦ä½¿ç”¨ service workers æ—¶éœ€è¦åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>background.service_worker</code> ä¸­å£°æ˜æ³¨å†Œï¼Œå±æ€§å€¼æŒ‡å®šéœ€è¦æ‰§è¡Œçš„ä¸€ä¸ª JavaScript æ–‡æ¡£çš„è·¯å¾„ï¼ˆå®ƒå¿…é¡»åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼‰ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;service_worker&quot;</span><span class="token operator">:</span> <span class="token string">&quot;background.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åå°è„šæœ¬åœ¨ Service Workers ä¸­è¿è¡ŒåŸºäºç›‘å¬äº‹ä»¶-å“åº”æ¨¡å‹æ¥æ‰§è¡Œæ“ä½œï¼Œå› æ­¤é€»è¾‘ä»£ç çš„ç¼–å†™ä¹Ÿåº”è¯¥éµå¾ªè¯¥æ¨¡å‹ä»¥ä¼˜åŒ–æ€§èƒ½ï¼š</p><ul><li><p>åœ¨äº‹ä»¶å¾ªç¯çš„ç¬¬ä¸€è½®ä¸­å®Œæˆäº‹ä»¶ç›‘å¬çš„æ³¨å†Œï¼Œå³å°†äº‹ä»¶ç›‘å¬ç¨‹åºå†™åœ¨åå°è„šæœ¬æœ€é¡¶å±‚çš„ä½œç”¨åŸŸä¸­ï¼Œè€Œä¸åº”è¯¥å†…åµŒåœ¨å…¶ä»–çš„é€»è¾‘ä»£ç ä¸­ï¼ˆå› ä¸º Service Workers æ‰§è¡Œå®Œä»£ç ä¼šç»ˆæ­¢è€Œä¸ä¼šé•¿æœŸé©»ç•™ï¼Œå½“æœ‰äº‹ä»¶éœ€è¦åˆ†æ´¾æ—¶å®ƒæ‰å†æ¬¡è¿è¡Œï¼Œå¦‚æœæœªèƒ½åœ¨ç¬¬ä¸€æ¬¡äº‹ä»¶è½®è¯¢ä¸­æ³¨å†Œç›‘å¬å™¨ï¼Œè¿™å°±æ— æ³•å“åº”äº‹ä»¶ï¼‰ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;badgeText&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> badgeText <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setBadgeText</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> badgeText <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Listener is registered on startup</span>
chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span>onClicked<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>handleActionClick<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleActionClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li><li><p>ç”±äº Service Workers ç”Ÿå‘½å‘¨æœŸæ˜¯<strong>çŸ­æœŸçš„</strong>ï¼Œå¦‚æœéœ€è¦æŒä¹…åŒ–çš„æ•°æ®ï¼ˆä¾‹å¦‚éœ€è¦å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹ä½œä¸ºå˜é‡ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ Chrome ä¸ºæ‰©å±•ç¨‹åºæä¾›çš„ <a href="https://developer.chrome.com/docs/extensions/reference/storage/" target="_blank" rel="noopener noreferrer">Storage API</a></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> type<span class="token punctuation">,</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">&quot;set-name&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span>onClicked<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tab</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>tab<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li><li><p>åœ¨ Manifest V2 ç‰ˆæœ¬ä¸­ä½¿ç”¨ <code>setTimeout</code> æˆ– <code>setInterval</code> å®ç°å»¶è¿Ÿæˆ–å®šæœŸæ“ä½œï¼Œåœ¨ Manifest V3 ç‰ˆæœ¬çš„ Service Workers ä¸­å¹¶<strong>ä¸</strong>å¯è¡Œï¼Œå› ä¸º Service Worker å¹¶ä¸ä¼šé•¿æœŸé©»ç•™åå°ï¼Œå½“å®ƒç»ˆæ­¢æ—¶è°ƒåº¦ç¨‹åºä¼šæ³¨é”€è®¡æ—¶å™¨ã€‚æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <a href="https://developer.chrome.com/docs/extensions/reference/alarms/" target="_blank" rel="noopener noreferrer">Alarms API</a> æ¥æ›¿ä»£ï¼Œå®ƒç”¨ä»¥å®‰æ’ä»£ç å®šæœŸè¿è¡Œæˆ–åœ¨æœªæ¥çš„æŒ‡å®šæ—¶é—´è¿è¡Œã€‚å®ƒä¹Ÿéœ€è¦åœ¨åå°è„šæœ¬æœ€é¡¶å±‚çš„ä½œç”¨åŸŸä¸­æ³¨å†Œã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
chrome<span class="token punctuation">.</span>alarms<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> delayInMinutes<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// set an alarm, which will dispatch onAlarm event after 3 mins</span>

<span class="token comment">// listen the onAlarm event and react to it</span>
chrome<span class="token punctuation">.</span>alarms<span class="token punctuation">.</span>onAlarm<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setIcon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token function">getRandomIconPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul><p>Service Worker å®é™…ä¸Šæ˜¯ä¸€ä¸ª <a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker" target="_blank" rel="noopener noreferrer">web worker</a>ï¼Œåœ¨æµè§ˆå™¨ä¸­å¯ä»¥ç‹¬ç«‹äºç½‘é¡µè¿è¡Œï¼Œä¸€èˆ¬ç½‘é¡µçš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­éƒ½æœ‰<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window" target="_blank" rel="noopener noreferrer">å…¨å±€å˜é‡ <code>window</code></a>ï¼Œå¯ä»¥é€šè¿‡å®ƒè®¿é—®ä¸€äº›æµè§ˆå™¨æä¾›çš„ APIï¼Œä¾‹å¦‚ IndexedDBã€cookieã€localStorage ç­‰ï¼Œä½†åœ¨ Service Worker ä¸­æ²¡æœ‰è¯¥å¯¹è±¡ï¼Œå› æ­¤æœ‰è¯¸å¤šé™åˆ¶ï¼Œä¾‹å¦‚åœ¨è¯¥ç¯å¢ƒä¸­æ— æ³•è®¿é—® DOMï¼Œæ— æ³•å‘èµ· XMLHttpRequestï¼ˆä½†æ”¯æŒ fetch åŠŸèƒ½ï¼‰ï¼Œä»¥ä¸‹æ˜¯åº”å¯¹é™åˆ¶çš„ä¸€äº›è§£å†³æ–¹æ³•ï¼š</p><ul><li><p>ç”±äº Service Workers æ— æ³•è®¿é—® <a href="https://developer.mozilla.org/en-US/docs/Web/API/DOMParser" target="_blank" rel="noopener noreferrer">DOMParser API</a> ä»¥è§£æ HTMLï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>chrome.windows.create()</code> å’Œ <code>crhome.tabs.create()</code> API åˆ›å»ºä¸€ä¸ªæ ‡ç­¾é¡µï¼Œä»¥æä¾›ä¸€ä¸ªå…·æœ‰ window å¯¹è±¡çš„ç¯å¢ƒï¼Œæˆ–å€ŸåŠ©ä¸€äº›åº“ï¼ˆå¦‚ <a href="https://github.com/jsdom/jsdom" target="_blank" rel="noopener noreferrer">jsdom</a> æˆ– <a href="https://github.com/developit/undom" target="_blank" rel="noopener noreferrer">undom</a>ï¼‰å¼¥è¡¥è¿™ä¸ªç¼ºå¤±ã€‚</p></li><li><p>åœ¨ Service Workers ä¸­æ— æ³•æ’­æ”¾æˆ–æ•è·å¤šåª’ä½“èµ„æºï¼Œå¯ä»¥é€šè¿‡ <code>chrome.windows.create()</code> å’Œ <code>crhome.tabs.create()</code> API åˆ›å»ºä¸€ä¸ªæ ‡ç­¾é¡µï¼Œä»¥æä¾›ä¸€ä¸ªå…·æœ‰ window å¯¹è±¡çš„ç¯å¢ƒï¼Œç„¶åå¯ä»¥é€šè¿‡<a href="https://developer.chrome.com/docs/extensions/mv3/messaging/" target="_blank" rel="noopener noreferrer">æ¶ˆæ¯ä¼ é€’ message passing</a> åœ¨ service worker ä¸­æ§åˆ¶é¡µé¢çš„å¤šåª’ä½“æ’­æ”¾ã€‚</p></li><li><p>è™½ç„¶åœ¨ Service Worker ä¸­æ— æ³•è®¿é—® DOMï¼Œä½†å¯ä»¥é€šè¿‡ <a href="https://html.spec.whatwg.org/multipage/canvas.html#the-offscreencanvas-interface" target="_blank" rel="noopener noreferrer"><code>OffscreenCanvas</code> API</a> åˆ›å»ºä¸€ä¸ª canvasã€‚å…³äº OffscreenCanvas ç›¸å…³ä¿¡æ¯å¯ä»¥å‚è€ƒ<a href="https://developers.google.com/web/updates/2018/08/offscreen-canvas" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
<span class="token comment">// for MV3 service workers</span>
<span class="token keyword">function</span> <span class="token function">buildCanvas</span><span class="token punctuation">(</span><span class="token parameter">width<span class="token punctuation">,</span> height</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OffscreenCanvas</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> canvas<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul><h3 id="message-passing" tabindex="-1"><a class="header-anchor" href="#message-passing" aria-hidden="true">#</a> Message Passing</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/mv3/messaging/#external" target="_blank" rel="noopener noreferrer">Message passing</a></li><li>å…³äº Message Passing <a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/messaging" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a></li></ul><p>æ³¨å…¥åˆ°é¡µé¢çš„è„šæœ¬ content scripts æ˜¯åœ¨ç½‘é¡µè¿è¡Œçš„ï¼Œå®ƒã€Œè„±ç¦»ã€äº†æ‰©å±•ç¨‹åºï¼Œä½†å¯ä»¥ä½¿ç”¨ä¿¡æ¯ä¼ é€’ message passing è¿›è¡Œæ²Ÿé€šï¼ˆåœ¨ web page çš„é¡µé¢è„šæœ¬ content script å’Œæ‰©å±•ç¨‹åºä¹‹é—´ï¼‰ï¼ŒChrome é™¤äº†æä¾›ç®€å•çš„ API è¿›è¡Œä¸€æ¬¡æ€§çš„è¯·æ±‚-å“åº”é€šè®¯ï¼Œä¹Ÿæä¾›å¤æ‚çš„ API è¿›è¡Œé•¿è¿æ¥é€šè®¯ï¼Œè¿˜å¯ä»¥åŸºäº ID è¿›è¡Œè·¨æ‰©å±•ç¨‹åºçš„é€šè®¯ã€‚</p><p>ğŸ’¡ ä»»ä½•åˆæ³•çš„ JSON æ ¼å¼çš„æ•°æ®éƒ½å¯ä»¥ä¼ é€’ã€‚</p><p>ğŸ’¡ ç”šè‡³å¯ä»¥<a href="https://developer.chrome.com/docs/apps/nativeMessaging/" target="_blank" rel="noopener noreferrer">ä¸æœ¬æœºç³»ç»Ÿè¿›è¡Œé€šè®¯</a>ã€‚</p><p>âš ï¸ ä¿¡æ¯ä¼ é€’è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘å®‰å…¨é—®é¢˜ï¼š</p><ul><li><p>å†…å®¹è„šæœ¬ content scripts æ›´å®¹æ˜“é­å—æ¶æ„ç½‘é¡µæ”»å‡»ï¼Œåº”è¯¥é™åˆ¶é€šè¿‡ content script ä¼ é€’è¿‡æ¥çš„ä¿¡æ¯ï¼Œå¯ä»¥è§¦å‘çš„æ“ä½œèŒƒå›´</p></li><li><p>å½“æ‰©å±•ç¨‹åºä¸å¤–éƒ¨èµ„æºè¿›è¡Œé€šè®¯æ—¶ï¼Œåº”è¯¥é‡‡å–å¿…è¦çš„è¡Œä¸ºé¿å…å‘ç”Ÿè·¨ç«™è„šæœ¬æ”»å‡»</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>tab<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>greeting<span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// WARNING! Might be injecting a malicious script!</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;resp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> response<span class="token punctuation">.</span>farewell<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>tab<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>greeting<span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// innerText does not let the attacker inject HTML elements.</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;resp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText <span class="token operator">=</span> response<span class="token punctuation">.</span>farewell<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>tab<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>greeting<span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// JSON.parse does not evaluate the attacker&#39;s scripts.</span>
  <span class="token keyword">var</span> resp <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>farewell<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul><h4 id="ä¸€æ¬¡æ€§è¯·æ±‚" tabindex="-1"><a class="header-anchor" href="#ä¸€æ¬¡æ€§è¯·æ±‚" aria-hidden="true">#</a> ä¸€æ¬¡æ€§è¯·æ±‚</h4><p>ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/reference/runtime/#method-sendMessage" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.runtime.sendMessage()</code></a> æˆ–<a href="https://developer.chrome.com/docs/extensions/reference/tabs/#method-sendMessage" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chome.tabs.sendMessage()</code></a> è¿›è¡Œ<strong>å•æ¬¡è¯·æ±‚</strong>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥è®¾ç½®å›è°ƒå‡½æ•°ï¼Œé»˜è®¤æ¥æ”¶è¿”å›çš„å“åº”æ•°æ®ä½œä¸ºå‚æ•°ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åœ¨é¡µé¢è„šæœ¬ content script å‘é€ä¿¡æ¯</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>greeting<span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>farewell<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åœ¨æ‰©å±•ç¨‹åºå‘é€ä¿¡æ¯</span>
<span class="token comment">// éœ€è¦å…ˆä½¿ç”¨ query è·å– tabIdï¼Œä»¥æŒ‡å®šè¯¥è¯·æ±‚å‘é€ç»™å“ªä¸ªç‰¹å®šçš„ tab æ ‡ç­¾é¡µé¢</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> currentWindow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tabs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å‘é€åˆ°å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µé¢</span>
  chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>tabs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>greeting<span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>farewell<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>åœ¨æ¥æ”¶ç«¯ï¼Œæ¤å…¥é¡µé¢çš„ä»£ç  content script å’Œæ‰©å±•ç¨‹åºçš„åå°ä»£ç  background script éƒ½ä¸€æ ·ï¼Œéœ€è¦ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/reference/runtime/#event-onMessage" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.runtime.onMessage.addListener()</code></a> <strong>ç›‘å¬ç›¸åº”çš„äº‹ä»¶ä»¥æ•è·è¯·æ±‚</strong>ã€‚äº‹ä»¶å¤„ç†å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€å‚æ•°æ˜¯æ¥æ”¶åˆ°çš„ä¿¡æ¯ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒåŒ…å«è¿™æ¬¡ message çš„å‘é€æ–¹çš„ç›¸å…³ä¿¡æ¯ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå‘é€å“åº”å†…å®¹ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sender<span class="token punctuation">.</span>tab <span class="token operator">?</span>
    <span class="token string">&quot;from a content script:&quot;</span> <span class="token operator">+</span> sender<span class="token punctuation">.</span>tab<span class="token punctuation">.</span>url <span class="token operator">:</span>
    <span class="token string">&quot;from the extension&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>greeting <span class="token operator">===</span> <span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
    <span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>farewell<span class="token operator">:</span> <span class="token string">&quot;goodbye&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ğŸ’¡ ä»¥ä¸Šäº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œå‘é€å“åº”æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œå³æ¥æ”¶åˆ° message è§¦å‘äº‹ä»¶å¤„ç†å‡½æ•°åï¼Œæ‰§è¡Œåˆ° <code>sendResponse</code> å‡½æ•°æ—¶å°±ä¼šç«‹å³å‘é€å“åº”ï¼›å¦‚æœå¸Œæœ›å¼‚æ­¥å‘é€å“åº”ï¼ˆä¾‹å¦‚éœ€è¦æ•´åˆå…¶ä»–å¼‚æ­¥è¯·æ±‚çš„æ•°æ®ï¼‰ï¼Œå¯ä»¥åœ¨ <code>onMessage</code> äº‹ä»¶å¤„ç†å‡½æ•°çš„æœ€åï¼Œæ˜¾æ€§è¿”å› <code>return true</code>ï¼Œå‘ŠçŸ¥æ‰©å±•ç¨‹åºå“åº”ä¼šå¼‚æ­¥æ‰§è¡Œï¼Œè¿™æ ·ä¿¡æ¯é€šé“ message channel è¿˜ä¼šä¿æŒæ‰“å¼€ï¼Œç›´åˆ° <code>sendResponse</code> è¢«è°ƒç”¨ã€‚</p><p>ğŸ’¡ å¦‚æœåœ¨ä¸åŒé¡µé¢è®¾ç½®äº†å¤šä¸ª <code>onMessage</code> äº‹ä»¶ç›‘å¬å™¨ï¼Œ<strong>ä¸ºäº†ä¿è¯åªæœ‰ä¸€æ¬¡å“åº”ï¼Œå¯¹äºæ¯æ¬¡ message è¯·æ±‚æ‰©å±•ç¨‹åºæ•´ä½“éƒ½åªä¼šæœ€å¤šæ‰§è¡Œä¸€æ¬¡ <code>sendResponse()</code> æ–¹æ³•</strong>ï¼Œå…¶ä»–äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„å“åº”å‡½æ•°éƒ½ä¼šè¢«å¿½ç•¥ã€‚</p><h4 id="é•¿è¿æ¥" tabindex="-1"><a class="header-anchor" href="#é•¿è¿æ¥" aria-hidden="true">#</a> é•¿è¿æ¥</h4><p>å¯ä»¥ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/reference/runtime/#method-connect" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.runtime.connect()</code></a> æˆ–<a href="https://developer.chrome.com/docs/extensions/reference/tabs/#method-connect" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.tabs.connect()</code></a> ä¸ºå†…å®¹è„šæœ¬ content script å’Œæ‰©å±•ç¨‹åºä¹‹é—´<strong>å»ºç«‹ä¸€ä¸ªé•¿è¿æ¥</strong>ï¼ˆå¯ä»¥ä¸ºä¿¡æ¯é€šé“ channel è®¾ç½®åç§°ï¼Œä»¥åŒºåˆ«å¤šä¸ªé€šé“ï¼‰ã€‚</p><p>ä½¿ç”¨ä»¥ä¸Šæ–¹æ³•åˆ›å»ºé€šé“åï¼Œä¼šè¿”å›ä¸€ä¸ª <a href="https://developer.chrome.com/docs/extensions/reference/runtime/#type-Port" target="_blank" rel="noopener noreferrer"><code>runtime.Port</code> ç«¯å£å¯¹è±¡</a>ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å…³äºä¿¡æ¯é€šé“çš„ç›¸å…³æ–¹æ³•å’Œå±æ€§ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡è¯¥é€šé“å‘é€ <code>portObj.postMessage()</code> å’Œæ¥æ”¶ <code>portObj.onMessage.addListener()</code> ä¿¡æ¯ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åœ¨é¡µé¢è„šæœ¬ content script å»ºç«‹é•¿è¿æ¥çš„ä¿¡æ¯é€šé“</span>
<span class="token keyword">var</span> port <span class="token operator">=</span> chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">&quot;knockknock&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// é€šè¿‡è¯¥ç«¯å£å‘é€ä¿¡æ¯</span>
port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>joke<span class="token operator">:</span> <span class="token string">&quot;Knock knock&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è®¾ç½®äº‹ä»¶ç›‘å¬å™¨ï¼Œé€šè¿‡è¯¥ç«¯å£æ¥æ”¶ä¿¡æ¯ï¼Œå°†æ¥æ”¶åˆ°çš„ä¿¡æ¯ä½œä¸ºå…¥å‚</span>
port<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>question <span class="token operator">===</span> <span class="token string">&quot;Who&#39;s there?&quot;</span><span class="token punctuation">)</span>
    port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>answer<span class="token operator">:</span> <span class="token string">&quot;Madame&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>question <span class="token operator">===</span> <span class="token string">&quot;Madame who?&quot;</span><span class="token punctuation">)</span>
    port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>answer<span class="token operator">:</span> <span class="token string">&quot;Madame... Bovary&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ç±»ä¼¼åœ°ï¼Œå¦‚æœåœ¨æ‰©å±•ç¨‹åºä¸­å»ºç«‹é•¿è¿æ¥å‘é€æ¶ˆæ¯æ—¶ï¼Œä½¿ç”¨æ–¹æ³• <code>chrome.tabs.connect()</code>ï¼Œéœ€è¦æŒ‡å®šè¯·æ±‚æ˜¯å‘é€ç»™å“ªä¸ªç‰¹å®šçš„ tab æ ‡ç­¾é¡µã€‚</p><p>ä¿¡æ¯é€šé“æ˜¯åŒå‘çš„ï¼Œå› æ­¤é™¤äº†å‘èµ·ç«¯åˆ›å»ºç«¯å£ï¼Œè¿˜éœ€è¦åœ¨æ¥æ”¶ç«¯ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/reference/runtime#event-onConnect" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.runtime.onConnect()</code></a> <strong>å“åº”é€šé“è¿æ¥è¯·æ±‚</strong>ï¼ˆåœ¨å†…å®¹è„šæœ¬ content script å’Œæ‰©å±•ç¨‹åºä¸­ä¸€æ ·ï¼‰ã€‚å½“é€šé“å‘èµ·ç«¯å£è°ƒç”¨ connect æ–¹æ³•æ—¶ï¼Œæ¥æ”¶ç«¯çš„ç›‘å¬å™¨å°±ä¼šè°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå®ƒå°†ç›¸åº”çš„ <code>runtime.Port</code> ç«¯å£å¯¹è±¡ä½œä¸ºå…¥å‚ï¼Œç„¶åå¯ä»¥ä½¿ç”¨è¯¥ç«¯å£åœ¨é€šé“ä¸­å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œè¿™æ ·é€šé“ä¸¤ç«¯çš„æ¥å£å°±å¯ä»¥<strong>ç›¸äº’æ¥æ”¶å’Œå‘é€ä¿¡æ¯</strong>äº†ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onConnect<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">port</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">assert</span><span class="token punctuation">(</span>port<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;knockknock&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  port<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>joke <span class="token operator">===</span> <span class="token string">&quot;Knock knock&quot;</span><span class="token punctuation">)</span>
      port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>question<span class="token operator">:</span> <span class="token string">&quot;Who&#39;s there?&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>answer <span class="token operator">===</span> <span class="token string">&quot;Madame&quot;</span><span class="token punctuation">)</span>
      port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>question<span class="token operator">:</span> <span class="token string">&quot;Madame who?&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>answer <span class="token operator">===</span> <span class="token string">&quot;Madame... Bovary&quot;</span><span class="token punctuation">)</span>
      port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>question<span class="token operator">:</span> <span class="token string">&quot;I don&#39;t get it.&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="ç«¯å£ç”Ÿå‘½å‘¨æœŸ" tabindex="-1"><a class="header-anchor" href="#ç«¯å£ç”Ÿå‘½å‘¨æœŸ" aria-hidden="true">#</a> ç«¯å£ç”Ÿå‘½å‘¨æœŸ</h4><p>ä¿¡æ¯é€šé“è¿æ¥æ˜¯é•¿æœŸçš„ï¼Œä½†ä¹Ÿå¯èƒ½å› ä¸ºä»¥ä¸‹åŸå› æ–­å¼€ï¼š</p><ul><li><p>åœ¨æ¥æ”¶ç«¯æ²¡æœ‰è®¾ç½®ç›‘å¬å™¨ <code>chrome.runtime.onConnect()</code> æ— æ³•æˆåŠŸå»ºç«‹é€šé“</p></li><li><p>ä½¿ç”¨ <code>chrome.tabs.connect()</code> åˆ›å»ºé€šé“æ—¶ï¼ŒæœŸæœ›è¿æ¥çš„ç«¯å£æ‰€åœ¨çš„é¡µé¢ä¸å­˜åœ¨</p></li><li><p>All frames that received the port (via <a href="https://developer.chrome.com/docs/extensions/reference/runtime#event-onConnect" target="_blank" rel="noopener noreferrer">runtime.onConnect</a>) have unloaded.</p></li><li><p>ç«¯å£å¯¹è±¡è°ƒç”¨äº†æ–¹æ³• <code>chrome.runtime.Port.disconnect()</code> ç»“æŸè¿æ¥</p><p>ğŸ’¡ å¦‚æœå‘èµ·ç«¯å£è°ƒç”¨ connect åï¼Œå»ºç«‹å¤šä¸ªæ¥æ”¶ç«¯å£ï¼ˆåˆ›å»ºå¤šä¸ªä¿¡æ¯é€šé“ï¼‰ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªæ¥æ”¶ç«¯å£è°ƒç”¨ disconnect æ—¶ï¼Œåˆ™ <strong><code>onDisconnect</code> äº‹ä»¶</strong>åªä¼šåœ¨å‘èµ·ç«¯å£è§¦å‘ï¼Œå…¶ä»–ç«¯å£å¹¶ä¸ä¼šè§¦å‘ã€‚</p></li></ul><p>å¯ä»¥ä½¿ç”¨æ–¹æ³• <code>port.onDisconnect()</code> ç›‘å¬è¯¥ç«¯å£çš„æ–­è¿äº‹ä»¶ï¼ˆå…¶ä¸­ <code>port</code> æ˜¯ç«¯å£å¯¹è±¡ï¼‰ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°çš„å…¥å‚æ˜¯è¯¥ç«¯å£å¯¹è±¡ã€‚</p><h4 id="è·¨æ‰©å±•ç¨‹åºçš„é€šè®¯" tabindex="-1"><a class="header-anchor" href="#è·¨æ‰©å±•ç¨‹åºçš„é€šè®¯" aria-hidden="true">#</a> è·¨æ‰©å±•ç¨‹åºçš„é€šè®¯</h4><p>é™¤äº†åœ¨æ‰©å±•ç¨‹åºå†…è¿›è¡Œä¿¡æ¯ä¼ é€’ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„ messaging API åœ¨ä¸åŒæ‰©å±•ç¨‹åºé—´è¿›è¡Œé€šè®¯ã€‚</p><p>å‘é€è¯·æ±‚ä¿¡æ¯æ—¶ï¼Œå¿…é¡»æä¾›æ‰©å±•ç¨‹åºçš„ IDï¼Œä»¥ä¾¿å…¶ä»–æ‰©å±•ç¨‹åºåˆ¤æ–­æ˜¯å¦ä½œå‡ºå“åº”ã€‚ä½¿ç”¨æ–¹æ³• <code>chrome.runtime.sendMessage(id, message)</code> å‘é€ä¸€æ¬¡æ€§çš„è¯·æ±‚ï¼›ä½¿ç”¨æ–¹æ³• <code>chrome.runtime.connect(id)</code> å‘èµ·é€šé“è¿æ¥è¯·æ±‚ï¼Œå¹¶è¿”å›ç«¯å£å¯¹è±¡ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// The ID of the extension we want to talk to.</span>
<span class="token keyword">var</span> laserExtensionId <span class="token operator">=</span> <span class="token string">&quot;abcdefghijklmnoabcdefhijklmnoabc&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Make a simple request:</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>laserExtensionId<span class="token punctuation">,</span> <span class="token punctuation">{</span>getTargetData<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">targetInRange</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>targetData<span class="token punctuation">)</span><span class="token punctuation">)</span>
      chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>laserExtensionId<span class="token punctuation">,</span> <span class="token punctuation">{</span>activateLasers<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Start a long-running conversation:</span>
<span class="token keyword">var</span> port <span class="token operator">=</span> chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>laserExtensionId<span class="token punctuation">)</span><span class="token punctuation">;</span>
port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>å¯¹äºä¸€æ¬¡æ€§çš„è¯·æ±‚ï¼Œä½¿ç”¨æ–¹æ³• <code>chrome.runtime.onMessageExternal()</code> è¿›è¡Œç›‘å¬å¹¶ä½œå‡ºå“åº”ï¼›å¯¹äºé•¿è¿æ¥ï¼Œä½¿ç”¨æ–¹æ³• <code>chrome.runtime.onConnectExternal()</code> å“åº”è¿æ¥ï¼Œå¹¶ä½¿ç”¨ç«¯å£å¯¹è±¡æ¥æ”¶å’Œå‘é€ä¿¡æ¯ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// For simple requests:</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessageExternal<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>id <span class="token operator">===</span> blocklistedExtension<span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token comment">// don&#39;t allow this extension access</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>getTargetData<span class="token punctuation">)</span>
      <span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>targetData<span class="token operator">:</span> targetData<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>activateLasers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> success <span class="token operator">=</span> <span class="token function">activateLasers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">sendResponse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>activateLasers<span class="token operator">:</span> success<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// For long-lived connections:</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onConnectExternal<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">port</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  port<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// See other examples for sample onMessage handlers.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="ç½‘é¡µé€šè®¯" tabindex="-1"><a class="header-anchor" href="#ç½‘é¡µé€šè®¯" aria-hidden="true">#</a> ç½‘é¡µé€šè®¯</h4><p>ç±»ä¼¼äºè·¨æ‰©å±•ç¨‹åºé—´é€šè®¯ï¼Œä¸€èˆ¬çš„ç½‘é¡µå¯ä»¥å‘é€ä¿¡æ¯ç»™æ‰©å±•ç¨‹åºã€‚è€Œæ‰©å±•ç¨‹åºéœ€è¦åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>externally_connectable.matches</code> ä¸­å£°æ˜æ³¨å†Œï¼Œå¸Œæœ›ä¸å“ªäº›å¤–éƒ¨ç½‘é¡µè¿›è¡Œè¿æ¥ï¼ˆå¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œä»¥æ”¯æŒä¸€ç³»åˆ—ç¬¦åˆä¸€å®šè§„åˆ™çš„ç½‘é¡µï¼Œä½†<strong>è‡³å°‘åŒ…å«äºŒçº§åŸŸ</strong>ï¼‰</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;externally_connectable&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;matches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://*.example.com/*&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åœ¨ç½‘é¡µä½¿ç”¨æ–¹æ³• <code>chrome.runtime.sendMessage()</code> æˆ–æ–¹æ³• <code>chrome.runtime.connect()</code> å‘é€ä¿¡æ¯ï¼ˆé€šè¿‡ ID æ¥æŒ‡å®šä¸å“ªä¸€ä¸ªæ‰©å±•ç¨‹åºè¿›è¡Œé€šè®¯ï¼‰</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// The ID of the extension we want to talk to.</span>
<span class="token keyword">var</span> editorExtensionId <span class="token operator">=</span> <span class="token string">&quot;abcdefghijklmnoabcdefhijklmnoabc&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Make a simple request:</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>editorExtensionId<span class="token punctuation">,</span> <span class="token punctuation">{</span>openUrlInEditor<span class="token operator">:</span> url<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token function">handleError</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>åœ¨æ‰©å±•ç¨‹åºä½¿ç”¨æ–¹æ³• <code>chrome.runtime.onMessageExternal()</code> æˆ–æ–¹æ³• <code>chrome.runtime.onConnectExternal()</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessageExternal<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>url <span class="token operator">===</span> blocklistedWebsite<span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>  <span class="token comment">// don&#39;t allow this web page access</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>openUrlInEditor<span class="token punctuation">)</span> <span class="token function">openUrl</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>openUrlInEditor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ğŸ’¡ å½“æ‰©å±•ç¨‹åºä¸ä¸€èˆ¬çš„ç½‘é¡µé€šè®¯æ—¶ï¼Œé•¿è¿æ¥åªèƒ½é€šè¿‡ç½‘é¡µç«¯å‘èµ·ã€‚</p><h3 id="options-pages" tabindex="-1"><a class="header-anchor" href="#options-pages" aria-hidden="true">#</a> Options Pages</h3><p>è®¾ç½®é¡µé¢å…è®¸ç”¨æˆ·å®šåˆ¶æ‰©å±•ç¨‹åºï¼Œä»¥æ›´ç¬¦åˆè‡ªå·±çš„ä½¿ç”¨ä¹ æƒ¯ã€‚</p><p>å¦‚æœè¦ä¸ºæ‰©å±•ç¨‹åºæ·»åŠ è®¾ç½®é¡µé¢ï¼Œéœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„ä¸­è¿›è¡Œå£°æ˜æ³¨å†Œï¼Œæœ‰ä¸¤ç§ç±»å‹çš„è®¾ç½®é¡µé¢ï¼š</p><ul><li><p>Full page options æ•´é¡µçš„è®¾ç½®é¡µé¢ï¼Œéœ€è¦æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚</p><p>åœ¨é…ç½®æ¸…å•çš„é€‰é¡¹ <code>options_page</code> ä¸­å£°æ˜æ³¨å†Œä½œä¸ºè®¾ç½®é¡µé¢çš„ HTML æ–‡æ¡£çš„è·¯å¾„</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;options_page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;options.html&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç„¶åç”¨æˆ·å¯ä»¥åœ¨æµè§ˆå™¨å·¥å…·æ çš„æ‰©å±•ç¨‹åºå›¾æ ‡å³é”®ç‚¹å‡»é€‰æ‹©ã€Œ<strong>é€‰é¡¹</strong>ã€æ‰“å¼€è®¾ç½®é¡µé¢</p><p><img src="/blog-web/assets/open-options-page-1.e7479be3.png" alt="æ‰“å¼€è®¾ç½®é¡µé¢-1"></p><p>æˆ–è€…åœ¨æ‰©å±•ç¨‹åºçš„ã€Œ<strong>è¯¦æƒ…</strong>ã€é¡µé¢ä¸­é€‰æ‹©ã€Œ<strong>æ‰©å±•ç¨‹åºé€‰é¡¹</strong>ã€æ‰“å¼€è®¾ç½®é¡µé¢</p><p><img src="/blog-web/assets/open-options-page-2.3d6a4197.png" alt="æ‰“å¼€è®¾ç½®é¡µé¢-2"></p></li><li><p>Embedded Options å†…åµŒçš„è®¾ç½®é¡µé¢ï¼Œä»¥æ¨¡æ€æ¡†çš„å½¢å¼å±•ç¤ºè®¾ç½®é¡µé¢ã€‚</p><p>ğŸ’¡ æ¨¡æ€æ¡†çš„å¤§å°ä¼šæ ¹æ®é¡µé¢å†…å®¹è‡ªåŠ¨è°ƒæ•´ï¼Œä½†æœ‰æ—¶å€™å¯èƒ½å¹¶ä¸å¥æ•ˆï¼Œæ­¤æ—¶å¯ä»¥ä¸ºè®¾ç½®é¡µé¢å…ˆæä¾›ä¸€ä¸ª<strong>æœ€å°çš„å°ºå¯¸</strong>ï¼Œä»¥ä¿è¯å¸ƒå±€æ­£å¸¸æ˜¾ç¤ºã€‚</p><p>åœ¨é…ç½®æ¸…å•çš„é€‰é¡¹ <code>options_ui.page</code> ä¸­æŒ‡å‘ç›¸åº”çš„ HTML æ–‡æ¡£è·¯å¾„ï¼Œå¹¶è®¾ç½®å±æ€§ <code>option_ui.open_in_tab</code> ä¸º <code>false</code>ï¼Œè¡¨ç¤ºé‡‡ç”¨å†…åµŒè®¾ç½®é¡µï¼ˆå¦‚æœè®¾ç½®ä¸º <code>true</code> å°±ä¼šæ‰“å¼€æ–°çš„æ ‡ç­¾é¡µæ¥å±•ç¤ºè®¾ç½®é¡µé¢ï¼‰ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;options_ui&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;options.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;open_in_tab&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ç„¶åç”¨æˆ·å°±å¯ä»¥åœ¨åœ¨æµè§ˆå™¨å·¥å…·æ çš„æ‰©å±•ç¨‹åºå›¾æ ‡å³é”®ç‚¹å‡»é€‰æ‹©ã€Œ<strong>é€‰é¡¹</strong>ã€ï¼Œä¼šè·³è½¬åˆ°ç›¸åº”æ‰©å±•ç¨‹åºçš„è¯¦æƒ…é¡µï¼ŒåŒæ—¶æ‰“å¼€æ¨¡æ€æ¡†å±•ç¤ºè®¾ç½®é¡µé¢ï¼›æˆ–è€…åœ¨æ‰©å±•ç¨‹åºçš„ã€Œ<strong>è¯¦æƒ…</strong>ã€é¡µé¢ä¸­é€‰æ‹©ã€Œ<strong>æ‰©å±•ç¨‹åºé€‰é¡¹</strong>ã€ï¼Œæ‰“å¼€æ¨¡æ€æ¡†å±•ç¤ºè®¾ç½®é¡µé¢ã€‚</p><p><img src="/blog-web/assets/open-options-page-3.13aaf8b4.png" alt="æ‰“å¼€è®¾ç½®é¡µ"></p></li></ul><p>ğŸ’¡ åœ¨æ‰©å±•ç¨‹åºçš„é¡µé¢ä¸­å¯ä»¥é€šè¿‡æ–¹æ³• <code>chrome.runtime.openOptionsPage()</code> æ‰“å¼€è®¾ç½®é¡µé¢</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>go-to-options<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Go to options<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#go-to-options&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// å…ˆåˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒè¯¥æ–¹æ³•</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>openOptionsPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">openOptionsPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœä¸æ”¯æŒå°±æ‰‹åŠ¨åŸºäºé¡µé¢è·¯å¾„æ‰“å¼€è®¾ç½®é¡µé¢</span>
    window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span><span class="token string">&#39;options.html&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>è™½ç„¶ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥ä¾›ç”¨æˆ·è®¾ç½®å‚æ•°ï¼Œä½†æ˜¯æœ‰ä¸€äº›ä¸åŒï¼š</p><ul><li><p>å¯¹äºå†…åµŒå‹çš„è®¾ç½®é¡µé¢ï¼Œä¸æ”¯æŒéƒ¨åˆ† Tabs ç›¸å…³çš„ API</p><ul><li>æ— æ³•ä½¿ç”¨ <a href="https://developer.chrome.com/docs/extensions/reference/tabs#method-query" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.tabs.query()</code></a> é€šè¿‡è®¾ç½®é¡µé¢çš„ URL æ‰¾åˆ°å¯¹åº”çš„ tab</li><li>æ‰“å¼€è®¾ç½®é¡µé¢æ—¶ï¼Œ<a href="https://developer.chrome.com/docs/extensions/reference/tabs/#event-onCreated" target="_blank" rel="noopener noreferrer">äº‹ä»¶ <code>chrome.tabs.onCreated.addListener()</code></a> æ— æ³•è¢«ç›‘å¬åˆ°</li><li>å½“è®¾ç½®é¡µé¢é‡è½½æ—¶ï¼Œ<a href="https://developer.chrome.com/docs/extensions/reference/tabs/#event-onUpdated" target="_blank" rel="noopener noreferrer">äº‹ä»¶ <code>chrome.tabs.onUpdated.addListener()</code></a> æ— æ³•è¢«ç›‘å¬åˆ°</li></ul></li><li><p>æ— æ³•ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/reference/tabs/#method-connect" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.tabs.connect()</code></a> å’Œ<a href="https://developer.chrome.com/docs/extensions/reference/tabs/#method-sendMessage" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.tabs.sendMessage()</code></a> å‘é€ä¿¡æ¯ï¼Œä½†<a href="https://developer.chrome.com/docs/extensions/runtime#method-connect" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.runtime.connect()</code></a> å’Œ<a href="https://developer.chrome.com/docs/extensions/runtime#method-sendMessage" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.runtime.sendMessage()</code></a> å¹¶ä¸å—é™åˆ¶ã€‚</p><p>ğŸ’¡ å¦‚æœè®¾ç½®é¡µé¢ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/runtime#method-connect" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.runtime.connect()</code></a> å’Œ<a href="https://developer.chrome.com/docs/extensions/runtime#method-sendMessage" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.runtime.sendMessage()</code></a> ä¼ é€’ä¿¡æ¯ï¼Œæ¥æ”¶è€…å¹¶ä¸èƒ½è¯»å–å‘é€è€… sender çš„ tab ä¿¡æ¯ï¼Œåªèƒ½è¯»å–åˆ°å‘é€è€…çš„ url ä¿¡æ¯ï¼ˆè®¾ç½®é¡µé¢æ–‡æ¡£çš„è·¯å¾„ï¼‰</p></li></ul><p>ğŸ’¡ ä¸ºäº†å¯ä»¥è®©ç”¨æˆ·çš„è®¾ç½®æ•°æ®æŒä¹…åŒ–åŠè·¨è®¾å¤‡åŒæ­¥ï¼Œå¯ä»¥ä½¿ç”¨ Chrome æä¾›çš„ <a href="https://developer.chrome.com/docs/extensions/reference/storage#property-sync" target="_blank" rel="noopener noreferrer"><code>storage.sync</code> API</a>ï¼Œè®°å¾—å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> ä¸­å£°æ˜æ³¨å†Œ <code>strage</code> æƒé™</p><h3 id="permissions" tabindex="-1"><a class="header-anchor" href="#permissions" aria-hidden="true">#</a> Permissions</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/permissions/" target="_blank" rel="noopener noreferrer"><code>chrome.permissions</code> API</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/declare_permissions/" target="_blank" rel="noopener noreferrer">Declare permissions</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/permission_warnings/" target="_blank" rel="noopener noreferrer">Declare permissions and warn users</a></li></ul><p>é™åˆ¶æ‰©å±•ç¨‹åºçš„æƒé™ï¼Œä¸ä»…å¯ä»¥é™ä½æ‰©å±•ç¨‹åºè¢«æ¶æ„ç¨‹åºåˆ©ç”¨çš„å¯èƒ½æ€§ï¼›è¿˜å¯ä»¥è®©ç”¨æˆ·æœ‰ä¸»åŠ¨é€‰æ‹©æƒï¼Œå†³å®šåº”è¯¥ç»™æ‰©å±•ç¨‹åºæˆäºˆå“ªäº›æƒé™å¯é€‰ã€‚</p><p>æ‰©å±•ç¨‹åºä¸ºäº†å¯ä»¥ä½¿ç”¨éƒ¨åˆ† Chrome APIs å’Œè®¿é—®å¤–éƒ¨ç½‘é¡µï¼Œéœ€è¦åœ¨é…ç½®æ¸…å• <code>manifest.json</code> ä¸­ä»¥<strong>æ˜¾å¼å£°æ˜</strong>æ‰€éœ€çš„æƒé™ï¼Œæœ‰ä¸‰ç§é€‰é¡¹ä»¥å£°æ˜ä¸åŒçš„æƒé™ï¼š</p><ul><li><code>permissions</code> ç”¨äºè®¾ç½®å¿…è¦æƒé™è®¸å¯ required permissionsï¼Œæ‰€æœ‰å¯ä»¥ä½¿ç”¨çš„ permissions å­—æ®µå¯ä»¥åœ¨<a href="https://developer.chrome.com/docs/extensions/mv3/declare_permissions/" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>æŸ¥çœ‹ï¼Œä»¥æ•°ç»„çš„å½¢å¼åŒ…å«å¤šä¸ªå­—æ®µã€‚ä¸ºäº†å®ç°æ‰©å±•ç¨‹åºçš„åŸºæœ¬åŠŸèƒ½ï¼Œåœ¨å®‰è£…æ—¶è¯¢é—®ç”¨æˆ·</li><li><code>optional_permissions</code> ç”¨äºè®¾ç½®å¯é€‰æƒé™è®¸å¯ optional permissionsï¼Œä¹Ÿæ˜¯ä»¥ä»¥æ•°ç»„çš„å½¢å¼åŒ…å«å¤šä¸ªå­—æ®µã€‚ä¸ºäº†å®ç°æŸäº›å¯é€‰çš„åŠŸèƒ½ï¼ˆä¸€èˆ¬æ˜¯è®¿é—®ç‰¹å®šçš„æ•°æ®æˆ–èµ„æºï¼‰ï¼Œåœ¨æ‰©å±•ç¨‹åºè¿è¡Œæ—¶æ‰è¯¢é—®ç”¨æˆ·ï¼Œä»¥è·å–æƒé™è®¸å¯ã€‚</li><li><code>host_permissions</code> ä¸“é—¨ç”¨äºè®¾ç½®æ‰©å±•ç¨‹åºå¯ä»¥å»è®¿é—®å“ªäº›ä¸»æœºçš„æƒé™ï¼ŒåŒ…å«ä¸€ç³»åˆ—<a href="https://developer.chrome.com/docs/extensions/mv3/match_patterns/" target="_blank" rel="noopener noreferrer">ç”¨äºåŒ¹é… url çš„æ­£åˆ™è¡¨è¾¾å¼</a></li></ul><p>ç„¶åæµè§ˆå™¨ä¼šåœ¨æ‰©å±•ç¨‹åºå®‰è£…æ—¶æˆ–åœ¨è¿è¡Œæ—¶ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦å…è®¸å®ƒè·å–ç›¸åº”çš„æƒé™ã€è®¿é—®ç‰¹å®šçš„èµ„æºï¼Œè®©ç”¨æˆ·å¯ä»¥æœ‰ä¸»åŠ¨æƒå»ä¿æŠ¤è‡ªå·±çš„æ•°æ®ï¼Œå…·ä½“å“ªäº›æƒé™ä¼šé€šçŸ¥ç”¨æˆ·æˆ–æ˜¯è¯¢é—®è®©ç”¨æˆ·ä¸»åŠ¨é€‰æ‹©ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://developer.chrome.com/docs/extensions/mv3/permission_warnings/" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;tabs&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;bookmarks&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;unlimitedStorage&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;optional_permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;unlimitedStorage&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;host_permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;http://www.blogger.com/&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;http://*.google.com/&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ğŸ’¡ åœ¨é…ç½®æ¸…å• <code>manifest.json</code> é‡Œæ‰€æœ‰å¯ä»¥å£°æ˜çš„ permissions å­—æ®µå¯ä»¥åœ¨<a href="https://developer.chrome.com/docs/extensions/mv3/declare_permissions/" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>æŸ¥çœ‹ï¼Œä½†æ˜¯éƒ¨åˆ†å­—æ®µå¹¶<strong>ä¸</strong>èƒ½åœ¨å¯é€‰æƒé™ <code>optional_permissions</code> é€‰é¡¹ä¸­å£°æ˜ï¼š</p><ul><li><code>debugger</code></li><li><code>declarativeNetRequest</code></li><li><code>devtools</code></li><li><code>experimental</code></li><li><code>geolocation</code></li><li><code>mdns</code></li><li><code>proxy</code></li><li><code>tts</code></li><li><code>ttsEngine</code></li><li><code>wallpaper</code></li></ul><p>é™¤äº†å¯ä»¥åœ¨é…ç½®æ¸…å•ä¸­è®¾ç½®å¯é€‰æƒé™è®¸å¯ï¼Œè¿˜å¯ä»¥åœ¨æ‰©å±•ç¨‹åºçš„é€»è¾‘ä»£ç ä¸­ï¼ŒåŸºäºç”¨æˆ·ä¸»åŠ¨äº¤äº’ï¼ˆä¾‹å¦‚åœ¨æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶çš„å¤„ç†å‡½æ•°ä¸­ï¼‰ä¸­ä½¿ç”¨æ–¹æ³• <code>chrome.permissions.request()</code> åŠ¨æ€ç”³è¯·ã€‚å¦‚æœç”³è¯·çš„æƒé™ä¼šè§¦å‘è­¦å‘Šæç¤ºï¼Œåˆ™ä¼šå¼¹å‡ºä¸€ä¸ªæƒé™æç¤ºæ¡†è¯¢é—®ç”¨æˆ·è®¸å¯ï¼Œå¹¶ç­‰å¾…ç»“æœè¿”å›å†æ‰§è¡Œåç»­çš„ä»£ç </p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#my-button&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Permissions must be requested from inside a user gesture, like a button&#39;s</span>
  <span class="token comment">// click handler.</span>
  chrome<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    permissions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;tabs&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    origins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;https://www.google.com/&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">granted</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// The callback argument will be true if the user granted the permissions.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>granted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">doSomethingElse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>å¦‚æœä¸å†éœ€è¦æŸé¡¹æƒé™æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³• <code>chrome.permissions.remove()</code> åˆ é™¤è¯¥æƒé™ï¼Œå¦‚æœä¹‹åå†ä½¿ç”¨æ–¹æ³• <code>chrome.permissions.request()</code> åŠ¨æ€æ·»åŠ ç›¸åº”çš„æƒé™ï¼Œåˆ™ä¸å¿…å†å‘ŠçŸ¥ç”¨æˆ·</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  permissions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;tabs&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  origins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;https://www.google.com/&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">removed</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>removed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The permissions have been removed.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// The permissions have not been removed (e.g., you tried to remove</span>
    <span class="token comment">// required permissions).</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ğŸ’¡ å¯ä»¥ä½¿ç”¨æ–¹æ³• <code>chrome.permissions.contains()</code> æŸ¥çœ‹æ‰©å±•ç¨‹åºå½“å‰æ˜¯å¦æ‹¥æœ‰æŸé¡¹æƒé™ï¼Œä½¿ç”¨æ–¹æ³• <code>chrome.permissions.getAll()</code> è·å–æ‰©å±•ç¨‹åºå½“å‰å…·æœ‰çš„æ‰€æœ‰æƒé™</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>permissions<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  permissions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;tabs&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  origins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;https://www.google.com/&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// The extension has the permissions.</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// The extension doesn&#39;t have the permissions.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ğŸ’¡ æœ‰ä¸€äº›æƒé™è·å–æ—¶ï¼Œä¼š<strong>å¼¹å‡ºè­¦å‘Šæç¤º</strong>ï¼Œä½ å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹<a href="https://developer.chrome.com/docs/extensions/mv3/permission_warnings/#permissions_with_warnings" target="_blank" rel="noopener noreferrer">ç›¸å…³çš„æƒé™</a>ã€‚</p><p><img src="/blog-web/assets/permission-warning.3a5fe231.png" alt="æƒé™è­¦å‘Š"></p><p>ä¸ºäº†é¿å…åœ¨å®‰è£…æ‰©å±•ç¨‹åºæ—¶ï¼Œ<strong>ç”±äºå¼¹å‡ºçš„è¿‡å¤šçš„è­¦å‘Šè€Œé™ä½äº†å®‰è£…é‡ï¼Œåº”è¯¥åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>permissions</code> ä¸­åªå£°æ˜æ ¸å¿ƒåŠŸèƒ½æ‰€å¿…éœ€çš„æƒé™ï¼Œè€Œå°½é‡åŒ…å«éœ€è¦å¼¹å‡ºè­¦å‘Šçš„æƒé™ï¼Œè€Œåº”è¯¥å°†è¿™äº›æƒé™åœ¨é€‰é¡¹ <code>optional_permissions</code> ä¸­å£°æ˜</strong>ï¼Œç„¶åä½¿ç”¨äº¤äº’æ§ä»¶ï¼Œå¦‚æŒ‰é’®æˆ– checkboxï¼Œè®©ç”¨æˆ·ä¸»åŠ¨æ¿€æ´»å¯é€‰åŠŸèƒ½ï¼Œæ­¤æ—¶æ‰å¼¹å‡ºæƒé™è­¦å‘Šæ¡†ï¼Œè®©ç”¨æˆ·ä¸»åŠ¨é€‰æ‹©æ˜¯å¦æˆæƒï¼Œè¿™æ ·çš„äº¤äº’ä½“éªŒä¼šæ›´ä½³ã€‚</p><p>ğŸ’¡ å¦‚æœæ›´æ–°æ‰©å±•ç¨‹åºæ—¶ï¼Œæ–°å¢äº† permissions ä¼šå¯¼è‡´æ‰©å±•ç¨‹åºä¸´æ—¶æ— æ³•æ¿€æ´»ï¼Œéœ€è¦ç”¨æˆ·å†èµ·å…è®¸æˆæƒæ‰å¯ä»¥ï¼Œå¦‚æœå°†è¿™äº›æ–°å¢çš„ permissions æ”¾åœ¨é€‰é¡¹ <code>optional_permissions</code> åˆ™å¯ä»¥é¿å…è¿™ä¸ªä¸å¥½çš„ä½“éªŒã€‚</p><p>ğŸ’¡ å£°æ˜ <code>activeTab</code> æƒé™å¯ä»¥<strong>ä¸´æ—¶è·å–è®¸å¯è®¿é—®å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µ</strong>ï¼Œå¹¶åœ¨å½“å‰é¡µé¢ä½¿ç”¨ <a href="https://developer.chrome.com/docs/extensions/reference/tabs/" target="_blank" rel="noopener noreferrer">tabs ç›¸å…³çš„ API</a>ï¼ˆå½“å¯¼èˆªåˆ°å…¶ä»– url æˆ–å…³é—­å½“å‰é¡µé¢åï¼Œè¯¥è·¯å¾„çš„å¯è®¿é—®æ€§å°±å¤±æ•ˆï¼‰ï¼Œä¸€èˆ¬ç”¨ä»¥æ›¿ä»£ <code>&lt;all_urls&gt;</code> æƒé™ï¼Œè¾¾åˆ°è®¿é—®ä»»æ„ url çš„å½“å‰é¡µé¢ï¼Œè€Œä¸”ä¸ä¼šåœ¨å®‰è£…æ‰©å±•ç¨‹åºæ—¶å¼¹å‡ºè­¦å‘Šã€‚</p><p>ğŸ’¡ å¯¹äºåœ¨ã€Œå¼€å‘è€…æ¨¡å¼ã€ä¸‹ã€ŒåŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åºã€ï¼Œå¹¶<strong>ä¸</strong>ä¼šå±•ç¤ºæƒé™è­¦å‘Šæç¤ºã€‚å¦‚æœå¸Œæœ›æŸ¥çœ‹è­¦å‘Šæç¤ºçš„æ•ˆæœï¼Œå¯ä»¥ç›¸å¯¹å¼€å‘çš„æ‰©å±•ç¨‹åºè¿›è¡Œ<strong>æ‰“åŒ…</strong>ï¼Œå…·ä½“æ­¥éª¤è¯·å‚è€ƒ<a href="https://developer.chrome.com/docs/extensions/mv3/permission_warnings/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æŒ‡å—</a>ã€‚</p><h3 id="storage" tabindex="-1"><a class="header-anchor" href="#storage" aria-hidden="true">#</a> Storage</h3><p>æ‰©å±•ç¨‹åºå¯ä»¥åœ¨æµè§ˆå™¨ä¸­å­˜å‚¨å’Œæ£€ç´¢æ•°æ®ã€‚</p><p>Chrome æµè§ˆå™¨ä¸ºæ‹“å±•å‡ºç°æä¾›æ•°æ®å­˜å‚¨ API <code>chrome.storeage</code> ï¼Œè¯¥ API æä¾›ç±»ä¼¼ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" target="_blank" rel="noopener noreferrer">localStorage </a> çš„åŠŸèƒ½ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ä¸åŒï¼š</p><ul><li>ä½¿ç”¨ <code>chrome.storage.sync</code> ç›¸å…³æ–¹æ³•ï¼Œå°±å¯ä»¥åˆ©ç”¨ Chrome çš„<strong>åŒæ­¥</strong>åŠŸèƒ½ï¼Œå®ç°åŒä¸€è´¦æˆ·ä¸‹çš„æ‰©å±•ç¨‹åºæ•°æ®åœ¨å¤šä¸ªè®¾å¤‡ä¹‹é—´åŒæ­¥ã€‚ğŸ’¡ å¦‚æœå·²ç™»å½•è´¦æˆ·çš„ Chrome ç¦»çº¿æ—¶ï¼Œå¸Œæœ›åŒæ­¥å­˜å‚¨çš„æ•°æ®ä¼šå…ˆè¿›è¡Œæœ¬åœ°å­˜å‚¨ï¼Œç­‰å¾…æµè§ˆå™¨ä¸Šçº¿åå†è¿›è¡ŒåŒæ­¥ã€‚å¦‚æœç”¨æˆ·åœ¨ Chrome è®¾ç½®ä¸­å–æ¶ˆäº†æ•°æ®åŒæ­¥åŠŸèƒ½ï¼Œé‚£ä¹ˆ <code>chrome.storage.sync</code> ç›¸å…³æ–¹æ³•çš„ä½œç”¨å’Œ <code>chrome.storage.local</code> ä¸€æ ·</li><li>æ‰¹é‡çš„è¯»å–å’Œå†™å…¥æ•°æ®æ“ä½œæ˜¯<strong>å¼‚æ­¥æ‰§è¡Œ</strong>çš„ï¼Œå› æ­¤ä¸ localStorage å¼•èµ·çš„é˜»å¡å’Œä¸²è¡Œç›¸æ¯”æ“ä½œæ›´å¿«</li><li>å­˜å‚¨çš„<strong>æ•°æ®ç±»å‹å¯ä»¥æ˜¯å¯¹è±¡</strong>ï¼Œè€Œ localStorage åªå…è®¸å­˜å‚¨å­—ç¬¦ä¸²</li><li>Enterprise policies configured by the administrator for the extension can be read (using <code>storage.managed</code> with a <a href="https://developer.chrome.com/docs/extensions/mv2/manifest/storage/" target="_blank" rel="noopener noreferrer">schema</a>). The <code>storage.managed</code> storage is read-only.</li></ul><p>ğŸ’¡ æœ‰ä¸‰ç§ä¸åŒçš„å­˜å‚¨åŸŸ StorageArea</p><ul><li><code>sync</code> åŒæ­¥å­˜å‚¨çš„æ•°æ®</li><li><code>local</code> æœ¬åœ°å­˜å‚¨çš„æ•°æ®</li><li><code>managed</code> ç®¡ç†å‘˜è®¾ç½®çš„æ•°æ®ï¼Œåªè¯»</li></ul><p>å¦‚æœè¦ä½¿ç”¨è¯¥ API éœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>permissions</code> ä¸­å£°æ˜æ³¨å†Œæƒé™</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;storage&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>å­˜å‚¨æ‰©å±•ç¨‹åºçš„æ•°æ®æ—¶ï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼ï¼ˆæ•°æ®æ ¼å¼æ˜¯å¯¹è±¡ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³• <code>chrome.storage.local.set({key: value}, callback())</code> å­˜å‚¨åœ¨æœ¬åœ°ï¼Œæˆ–ä½¿ç”¨æ–¹æ³• <code>chrome.storage.sync.set({key: value}, callback())</code> è¿›è¡ŒåŒæ­¥å­˜å‚¨ï¼Œç›¸åº”åœ°åˆ†åˆ«ä½¿ç”¨æ–¹æ³• <code>chrome.storage.local.get()</code> æˆ– <code>chrome.storage.sync.get()</code> è·å–å¯¹åº” key çš„æ•°æ®</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// sync</span>
chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token operator">:</span> value<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Value is set to &#39;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>sync<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;key&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Value currently is &#39;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// local</span>
chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token operator">:</span> value<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Value is set to &#39;</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;key&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Value currently is &#39;</span> <span class="token operator">+</span> result<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ğŸ’¡ è·å– get æ•°æ®æ—¶ï¼Œä¸ä»…å¯ä»¥ä¼ å…¥ key å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ keys æ•°ç»„ï¼Œä»¥è¿”å›å¯¹åº”çš„ä¸€ç³»åˆ—æ•°æ®ã€‚å¦‚æœè·å– get æ•°æ®æ—¶ï¼Œä¼ å…¥çš„ key ä¸º <code>null</code> åˆ™ä¼šè¿”å›<strong>æ‰€æœ‰</strong>å­˜å‚¨çš„æ•°æ®ã€‚</p><p>ğŸ’¡ å¦‚æœæƒ³åˆ é™¤æŸä¸ª key çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³• <code>chrome.storage.remove(key, callback())</code>ã€‚å¦‚æœè¦æ¸…ç©ºæ‰€æœ‰å­˜å‚¨çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³• <code>chrome.storage.clear(callback())</code></p><p>âš ï¸ ä¸ç”¨æˆ·ç›¸å…³æœºå¯†æ•°æ®è¯·ä¸è¦è¿›è¡Œå­˜å‚¨ï¼Œå› ä¸ºä½¿ç”¨è¯¥ API æ‰€å­˜å‚¨çš„æ•°æ®<strong>å¹¶ä¸ä¼š</strong>åŠ å¯†ã€‚</p><p>è¯¥ API <strong>å…è®¸å­˜å‚¨çš„æ•°æ®å¹¶ä¸å¤§</strong>ï¼Œå¯¹äº <a href="https://developer.chrome.com/docs/extensions/reference/storage/#property-sync" target="_blank" rel="noopener noreferrer">sync åŒæ­¥å­˜å‚¨</a>çš„æ•°æ®ï¼Œå…è®¸æ€»å¤§å°ä¸º 100KBï¼Œæœ€å¤šå­˜å‚¨ 512 ä¸ªæ•°æ®é¡¹ï¼Œæ¯é¡¹å¤§å°ä¸º 8KBï¼›å¯¹äº <a href="https://developer.chrome.com/docs/extensions/reference/storage/#property-local" target="_blank" rel="noopener noreferrer">local æœ¬åœ°å­˜å‚¨</a>çš„æ•°æ®ï¼Œå…è®¸æ€»å¤§å°ä¸º 5MBï¼ˆç±»ä¼¼äº localstorage çš„å­˜å‚¨é™åˆ¶ï¼‰ï¼Œå› æ­¤å®ƒä»¬ä¸€èˆ¬ç”¨ä½œå­˜å‚¨ã€åŒæ­¥æ‰©å±•ç¨‹åºçš„è®¾ç½®ã€‚</p><p>å½“æ‰©å±•ç¨‹åºå­˜å‚¨çš„æ•°æ®å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šè§¦å‘ <code>onChange</code> äº‹ä»¶ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œç›‘å¬ä»¥ä½œå‡ºå“åº”</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>onChanged<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">changes<span class="token punctuation">,</span> namespace</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> <span class="token punctuation">{</span> oldValue<span class="token punctuation">,</span> newValue <span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>changes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Storage key &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; in namespace &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>namespace<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; changed.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Old value was &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>oldValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;, new value is &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;.</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="accessibility" tabindex="-1"><a class="header-anchor" href="#accessibility" aria-hidden="true">#</a> Accessibility</h3><p>å¯åŠæ€§ï¼Œåˆç§°ä¸º a11yï¼Œæ˜¯æŒ‡ä¸€ç³»åˆ—çš„è®¾è®¡æŒ‡å—ï¼Œä»¥ä¾¿æ®‹éšœäººå£«æ›´æ˜“äºä½¿ç”¨æ‰©å±•ç¨‹åºï¼Œä¾‹å¦‚å¿«æ·é”®å‘½ä»¤å¯ä»¥è®©è§†è§‰éšœç¢äººå£«æ›´æ–¹ä¾¿åœ°ä½¿ç”¨æ‰©å±•ç¨‹åºï¼Œå­—å¹•å’Œç¿»è¯‘åŠŸèƒ½å¯¹è§†è§‰éšœç¢äººå£«å’Œå¤–è¯­è€…æœ‰å¸®åŠ©ã€‚</p><p>å¼€å‘è€…å¯ä»¥éµå¾ªä»¥ä¸‹å»ºè®®ï¼Œä»¥æé«˜æ‰©å±•ç¨‹åºçš„å¯åŠæ€§ accessibleï¼š</p><ul><li><p>ä½¿ç”¨æ­£ç¡®çš„<a href="https://developer.mozilla.org/zh-CN/docs/Learn/Accessibility/HTML" target="_blank" rel="noopener noreferrer">è¯­ä¹‰åŒ– HTML å…ƒç´ </a>æ­å»º UI æ§ä»¶ï¼Œä»¥ä¾¿ä¿éšœå¯åŠæ€§ã€‚è¿™äº›æ§ä»¶ä¿è¯äº†å¯ä»¥é€šè¿‡é”®ç›˜ï¼ˆTab é”®ï¼‰è®¿é—®æ“ä½œï¼Œä¸”å®ƒä»¬çš„è¯­ä¹‰æ€§è®©å±å¹•é˜…è¯»å™¨æ›´å®¹æ˜“ç†è§£ã€‚</p><p><img src="/blog-web/assets/semantic-HTML.efe1c236.png" alt="è¯­ä¹‰åŒ– HTML å…ƒç´ "></p></li><li><p>å¦‚æœéœ€è¦ä½¿ç”¨éè¯­ä¹‰åŒ–çš„ HTML å…ƒç´ æˆ– JavaScript æ„å»º UI æ§ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡ <a href="https://www.w3.org/WAI/standards-guidelines/aria/" target="_blank" rel="noopener noreferrer">WAI-ARIA</a>ï¼ŒWeb Accessibility Initiative - Accessible Rich Internet Applicationsï¼Œä¸€ä¸ªç”± W3C åˆ¶å®šçš„è§„èŒƒï¼Œå®ƒé€šè¿‡ç»™ DOM å…ƒç´ æ·»åŠ ä¸€äº›è§„å®šçš„å±æ€§ï¼Œè®©æˆ‘ä»¬çš„å¼€å‘çš„ç½‘é¡µåº”ç”¨æ›´å…·è¯­ä¹‰åŒ–ã€‚</p><p>ğŸ’¡ WAI-ARIA å±æ€§<strong>ä¸ä¼š</strong>å¯¹ web é¡µé¢æœ‰ä»»ä½•å½±å“ï¼Œåªæ˜¯è®©æµè§ˆå™¨æš´éœ²æ›´å¤šçš„ä¿¡æ¯ç»™æ— éšœç¢ APIï¼Œä¾‹å¦‚å±å¹•é˜…è¯»å™¨ã€‚</p><p>è¯¥è§„èŒƒä¸­ä¸‰ä¸ªä¸»è¦çš„ç‰¹æ€§ï¼š</p><ul><li>å£°æ˜å…ƒç´ çš„è§’è‰²å’ŒåŠŸèƒ½ï¼Œä¾‹å¦‚ <code>role=&quot;navigation&quot;</code> è¡¨ç¤ºè¯¥å…ƒç´ çš„ä½œç”¨æ˜¯å¯¼èˆª</li><li>ä¸ºå…ƒç´ å®šä¹‰é¢å¤–çš„å±æ€§ï¼Œä¾‹å¦‚ <code>aria-require=true</code> å‘ŠçŸ¥ç”¨æˆ·è¯¥è¡¨å•æ˜¯å¿…æ·»çš„</li><li>è®¾å®šå…ƒç´ çš„çŠ¶æ€ï¼Œä¾‹å¦‚ <code>aria-disable=&quot;true&quot;</code> è¡¨ç¤ºè¯¥è¡¨å•ç¦æ­¢è¾“å…¥</li></ul><p>ğŸ’¡ çŠ¶æ€å’Œå±æ€§çš„å·®å¼‚ä¹‹å¤„å°±æ˜¯ï¼šå±æ€§åœ¨åº”ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸­ä¸ä¼šæ”¹å˜ï¼Œ<strong>è€ŒçŠ¶æ€å¯ä»¥</strong>ï¼Œç”¨ç¼–ç¨‹çš„æ–¹æ³•æ”¹å˜ã€‚</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>toolbar<span class="token punctuation">&quot;</span></span> <span class="token attr-name">tabindex</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">aria-activedescendant</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>buttoncut.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cut<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>buttoncopy.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>copy<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>buttonpaste.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paste<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/tabindex" target="_blank" rel="noopener noreferrer">å±æ€§ <code>tabindex=&quot;0&quot;</code></a> è®©è¯¥å…ƒç´ å¯ä»¥èšç„¦ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡é”®ç›˜æ¥å¯¼èˆªï¼Œå…¶èšç„¦é¡ºåºç”± DOM ç»“æ„å†³å®šï¼›å±æ€§ <code>aria-activedescendant</code> æŒ‡å®šè¯¥å…ƒç´ èšç„¦æ—¶ï¼Œå…¶å­ä»£å“ªä¸€ä¸ªå…ƒç´ å…ˆè¿›è¡Œèšç„¦ã€‚</p></li><li><p>å…ƒç´ å¯èšç„¦è®©ç”¨æˆ·ä»…é€šè¿‡é”®ç›˜ä¹Ÿèƒ½æ“ä½œæ‰©å±•ç¨‹åºé¡µé¢ï¼Œåº”è¯¥ä¿è¯æŒ‰é’®ã€èœå•æ ç­‰å…ƒç´ å¯ä»¥èšç„¦ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰é”šæ ‡ç­¾ã€æŒ‰é’®ã€è¡¨å•æ§ä»¶å¯ä»¥é€šè¿‡é”®ç›˜èšç„¦ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ºå…ƒç´ æ·»åŠ å±æ€§ <code>tabIndex=&quot;0&quot;</code> è®©ä»»æ„å…ƒç´ å¯ä»¥èšç„¦ï¼›ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ å±æ€§ <code>tabIndex=&quot;-1&quot;</code> è®©è¯¥å…ƒç´ æ— æ³•é€šè¿‡é”®ç›˜èšç„¦ï¼ˆä½†ä»å¯ä»¥é€šè¿‡ JavaScript ç¼–ç¨‹èšç„¦ <code>elem.focus()</code>ï¼‰ã€‚</p></li><li><p>ä¸é€šè¿‡ Tab é”®èšç„¦å…ƒç´ ç›¸æ¯”ï¼Œå¿«æ·é”®å¯ä»¥è®©ç”¨æˆ·æ›´æ–¹ä¾¿åœ°æ“ä½œæ‰©å±•ç¨‹åºé¡µé¢çš„å…ƒç´ ï¼Œå¯ä»¥å‚è€ƒ<a href="https://developer.chrome.com/docs/extensions/mv3/a11y/#shortcuts" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a>å¦‚ä½•ç”¨å¿«æ·é”®è¿›è¡Œå¯¼èˆªã€‚å¦‚æœåœ¨æ‰©å±•ç¨‹åºçš„é¡µé¢å†…æä¾›äº†å¿«æ·é”®ï¼Œåº”è¯¥åœ¨<a href="https://developer.chrome.com/docs/extensions/mv3/options/" target="_blank" rel="noopener noreferrer">è®¾ç½®é¡µé¢ options page</a> ä¸­å‘ŠçŸ¥ç”¨æˆ·ã€‚</p></li><li><p>ä»¥ä¸‹è®¾ç½®å¯ä»¥å®Œå–„å†…å®¹çš„å¯è®¿é—®æ€§</p><ul><li><p>æ–‡æœ¬ï¼šé€‰æ‹©åˆé€‚çš„å­—ä½“å’Œå­—å·å¤§å°ä»¥ç¡®ä¿æ–‡æœ¬å†…å®¹çš„å¯è¯»æ€§ï¼Œè€Œä¸”åº”è¯¥è€ƒè™‘è§†è§‰éšœç¢è€…çš„ä½¿ç”¨ä½“éªŒï¼Œä»–ä»¬å¯èƒ½éœ€è¦è®¾ç½®æ›´å¤§çš„å­—ä½“ï¼Œé¿å…å°†è‡ªå®šä¹‰çš„å¿«æ·é”®ä¸é¡µé¢ç¼©æ”¾çš„å¿«æ·é”®ç›¸å†²çªã€‚ä¸ºäº†ç¡®ä¿ç‰ˆå‹çš„ç¨³å®šï¼Œåº”è¯¥æµ‹è¯•ç¼©æ”¾è‡³ 200%ï¼ŒæŸ¥çœ‹é¡µé¢æ˜¯å¦è¿˜æ˜¾ç¤ºæ­£å¸¸ã€‚åº”è¯¥é¿å…å°†æ–‡å­—åµŒå…¥åˆ°å›¾ç‰‡ä¸­ï¼Œè¿™æ ·ä¸ä»…æ— æ³•è°ƒæ•´å­—ä½“ï¼Œè¿˜æ— æ³•è®©å±å¹•é˜…è¯»å™¨è¯†åˆ«ï¼›å¦‚æœå¿…é¡»å°†æ–‡å­—åµŒå…¥å›¾ç‰‡ä¸­ï¼Œåº”è¯¥åœ¨å›¾ç‰‡çš„å¯æ›¿ä»£æ–‡å­—ï¼ˆå±æ€§ <code>alt</code>ï¼‰ä¸­åŒ…å«è¿™äº›æ–‡å­—å†…å®¹ï¼Œç›¸å…³æŒ‡å—å¯ä»¥å‚è€ƒ<a href="https://webaim.org/techniques/alttext/" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ã€‚</p></li><li><p>é¢œè‰²ï¼šèƒŒæ™¯å’Œå†…å®¹çš„é¢œè‰²åº”è¯¥æœ‰è¶³å¤Ÿçš„<strong>å¯¹æ¯”åº¦</strong>ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://snook.ca/technical/colour_contrast/colour.html" target="_blank" rel="noopener noreferrer">Colour Contrast Check</a> å·¥å…·æ£€æŸ¥ã€‚å¯¹äºé¢œè‰²ä¸°å¯Œçš„å›¾è¡¨ï¼Œå¯ä»¥ä½¿ç”¨è‰²å¼±æ¨¡æ‹Ÿå™¨ <a href="http://www.color-blindness.com/coblis-color-blindness-simulator/" target="_blank" rel="noopener noreferrer">Coblis</a> æ¥æŸ¥çœ‹å®ƒåœ¨ä¸åŒç¨‹åº¦çš„è‰²å¼±ç—‡äººå£«çœ¼é‡Œçš„æ•ˆæœï¼Œè°ƒæ•´å›¾è¡¨çš„é…è‰²ï¼Œä»¥ä½¿æ‰©å±•ç¨‹åºå¯¹äºè¿™äº›ç”¨æˆ·æ›´å‹å¥½ã€‚å¯ä»¥è€ƒè™‘ä¸ºæä¾›ä¸åŒçš„è‰²å½©ä¸»é¢˜ï¼Œæˆ–å…è®¸è‡ªå®šä¹‰é…è‰²æ–¹æ¡ˆï¼Œä»¥ä¾¿ç”¨æˆ·æœ‰æ›´å¥½çš„ä½“éªŒã€‚</p></li><li><p>å£°éŸ³ï¼šå¦‚æœæ‰©å±•ç¨‹åºéœ€è¦å£°éŸ³å’Œè§†é¢‘ä¼ è¾¾ä¿¡æ¯ï¼Œåº”è¯¥æä¾›å­—å¹•å’Œç¿»è¯‘åŠŸèƒ½ï¼Œå…³äºå¤šåª’ä½“å­—å¹•çš„ç›¸å…³æŒ‡å—å‚è€ƒ<a href="https://dcmp.org/learn/213" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ã€‚</p></li><li><p>å›¾ç‰‡ï¼šä¸ºå›¾ç‰‡æä¾›å¯æ›¿ä»£æ–‡å­—ï¼Œå³å±æ€§ <code>alt</code>ï¼ˆæ–‡å­—å†…å®¹åº”è¯¥ç”¨äºé˜æ˜å›¾åƒçš„ç›®çš„ï¼Œè€Œä¸æ˜¯æè¿°å›¾ç‰‡çš„ç»†èŠ‚ï¼‰ï¼Œè€Œå¯¹äºå ä½å›¾å’Œçº¯è£…é¥°ä½œç”¨çš„å›¾ç‰‡ï¼Œåº”è¯¥å°†è¯¥å±æ€§å€¼ç•™ç©º <code>&quot;&quot;</code>ï¼Œæˆ–ä½¿ç”¨ CSS æ¥å®ç°ï¼ˆè€Œä¸æ˜¯ç”¨ DOMï¼‰</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>img.jpg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>The logo for the extension<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li></ul></li><li><p>æ›´å¤šç›¸å…³èµ„æºï¼š</p><ul><li><a href="https://www.chromium.org/developers/design-documents/accessibility" target="_blank" rel="noopener noreferrer">Accessibility Technical Documentation</a></li><li><a href="https://youtube.com/playlist?list=PLNYkxOF6rcICWx0C9LVWWVqvHlYJyqw7g" target="_blank" rel="noopener noreferrer">A11ycasts with Rob Dodson</a></li></ul></li></ul><h3 id="internationalization" tabindex="-1"><a class="header-anchor" href="#internationalization" aria-hidden="true">#</a> Internationalization</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/i18n/" target="_blank" rel="noopener noreferrer"><code>chrome.i18n</code> API</a></li><li>å…³äº Internationalization å®˜æ–¹ç¤ºä¾‹ï¼š <ul><li><a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/i18n" target="_blank" rel="noopener noreferrer">i18n</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li><li><a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/extensions/news" target="_blank" rel="noopener noreferrer">news</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li><li><a href="https://developer.chrome.com/docs/extensions/reference/i18n/#examples" target="_blank" rel="noopener noreferrer">Examples</a></li></ul></li></ul><p>å›½é™…åŒ– I18N æ˜¯æŒ‡åœ¨å¼€å‘æ‰©å±•ç¨‹åºæ—¶ï¼Œå¯ä»¥è®©ç”¨æˆ·æŒ‰éœ€åˆ‡æ¢è¯­è¨€ã€‚</p><p>ğŸ’¡ å…³äºè½¯ä»¶<a href="https://zhuanlan.zhihu.com/p/112277526" target="_blank" rel="noopener noreferrer">å¤šè¯­è¨€ç‰ˆæœ¬çš„å¼€å‘</a>ï¼š</p><ul><li>å›½é™…åŒ– Internationalizationï¼ŒL18Nï¼šè½¯ä»¶å›½é™…åŒ–æ˜¯åœ¨è½¯ä»¶è®¾è®¡å’Œæ–‡æ¡£å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½¿å¾—åŠŸèƒ½å’Œä»£ç è®¾è®¡èƒ½å¤„ç†å¤šç§è¯­è¨€å’Œæ–‡åŒ–ä¼ ç»Ÿï¼Œä½¿åˆ›å»ºä¸åŒè¯­è¨€ç‰ˆæœ¬æ—¶ï¼Œä¸éœ€è¦é‡æ–°è®¾è®¡æºç¨‹åºä»£ç çš„è½¯ä»¶å·¥ç¨‹æ–¹æ³•ã€‚</li><li>æœ¬åœ°åŒ– localization ï¼ŒL10Nï¼šèƒ½å¤Ÿä½¿ç½‘ç«™ã€Web åº”ç”¨æˆ–ä»»ä½•å…¶ä»–å½¢å¼çš„å†…å®¹é€‚ç”¨äºç‰¹å®šè¯­è¨€çš„èŒƒå›´å’Œæ–‡åŒ–åœˆã€‚</li></ul><p>ä¸ºäº†è®©æ‰©å±•ç¨‹åºæ›´æ–¹ä¾¿åœ°å®ç°å›½é™…åŒ–ï¼Œéœ€è¦éµå¾ªä»¥ä¸‹å»ºè®®ï¼š</p><ul><li><p>å°†æ‰€æœ‰ç”¨æˆ·å¯è§çš„å†…å®¹ï¼ˆæ–‡æœ¬ï¼‰æ”¾åœ¨ä¸€ä¸ª <code>messages.json</code> æ–‡æ¡£ä¸­ï¼Œå¹¶å°†è¯¥æ–‡æ¡£æ”¾åœ¨ <code>_locales/_localeCode_</code> ç›¸åº”çš„ç›®å½•ä¸‹ï¼ˆå…¶ä¸­ <code>_localeCode_</code> æ˜¯ä¸€ä¸ªè¯­è¨€ç¼–ç ï¼Œä¾‹å¦‚è‹±è¯­å°±åº”è¯¥ä½¿ç”¨ <code>en</code> è¡¨ç¤ºï¼‰ã€‚</p><p>ğŸ’¡ å¦‚æœé¡¹ç›®ä¸­æœ‰ <code>_locales</code> ç›®å½•ï¼Œéœ€è¦åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>default_locale</code> ä¸­å£°æ˜é»˜è®¤è¯­è¨€ï¼Œå¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹å…·ä½“çš„<a href="https://developer.chrome.com/docs/webstore/i18n/#choosing-locales-to-support" target="_blank" rel="noopener noreferrer">è¯­è¨€ä»£ç </a>ã€‚</p><p>åœ¨ <a href="https://developer.chrome.com/docs/extensions/mv2/i18n-messages/" target="_blank" rel="noopener noreferrer"><code>messages.json</code> æ–‡æ¡£</a>ä¸­ï¼Œå®ƒä»¥é”®å€¼å¯¹çš„å½¢å¼æ¥å®šä¹‰å†…å®¹ï¼Œæ¯ä¸€ä¸ªé”®éƒ½åŒ…å«ä¸€ä¸ªéœ€è¦å›½é™…åŒ–çš„é¡¹ï¼ˆå¤§å°å†™æ•æ„Ÿï¼‰ï¼Œå€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­å¸¸ç”¨çš„å±æ€§å¦‚ä¸‹ï¼š</p><ul><li>å±æ€§ <code>message</code> æ˜¯éœ€è¦æ˜¾ç¤ºçš„å†…å®¹</li><li>ï¼ˆå¯é€‰ï¼‰å±æ€§ <code>description</code> æ˜¯å¯¹è¯¥é¡¹çš„æè¿°ï¼Œä¾¿äºå‘ŠçŸ¥ç¿»è¯‘è€…è¯¥é¡¹çš„æ„ä¹‰ã€‚</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token comment">// messages.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;search_string&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;hello%20world&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;The string we search for. Put %20 between words that go together.&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//  ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ğŸ’¡ é”®åä¸èƒ½ä»¥ <code>@@</code> å¼€å¤´ï¼Œè¿™ä¸€ç±»çš„é”®åæ˜¯<a href="https://developer.chrome.com/docs/extensions/reference/i18n/#overview-predefined" target="_blank" rel="noopener noreferrer">ä¿ç•™é¢„å®šä¹‰çš„é¡¹</a>ï¼Œå¸¸ç”¨çš„é¢„å®šä¹‰ message é¡¹å¦‚ä¸‹ï¼š</p><table><thead><tr><th style="text-align:center;">Message é”®å</th><th style="text-align:center;">è§£é‡Š</th></tr></thead><tbody><tr><td style="text-align:center;"><code>@@extension_id</code></td><td style="text-align:center;">æ‰©å±•ç¨‹åºçš„ IDï¼Œå¯¹äºéå›½é™…åŒ–çš„æ‰©å±•ç¨‹åºè¯¥ message é¡¹ä¹Ÿå¯ç”¨ï¼ŒğŸ’¡ ä½†ä¸èƒ½ç”¨äº <code>manifest.json</code> ä¸­</td></tr><tr><td style="text-align:center;"><code>@@ui_locale</code></td><td style="text-align:center;">å½“å‰ä½¿ç”¨çš„è¯­è¨€</td></tr><tr><td style="text-align:center;"><code>@@bidi_dir</code></td><td style="text-align:center;">å½“å‰çš„æ–‡å­—æ–¹å‘ï¼Œ<code>ltr</code> è¡¨ç¤ºä»å·¦å¾€å³ä¹¦å†™çš„æ–‡å­—ï¼Œ<code>rtl</code> è¡¨ç¤ºä»å³å¾€å·¦ä¹¦å†™çš„æ–‡å­—</td></tr></tbody></table><p>ä¾‹å¦‚åœ¨ CSS ä¸­ä½¿ç”¨æ‰©å±•ç¨‹åºä¸­çš„é™æ€å›¾ç‰‡ä½œä¸ºèƒŒæ™¯</p><div class="language-css ext-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">background-image</span><span class="token punctuation">:</span><span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">&#39;chrome-extension://__MSG_@@extension_id__/background.png&#39;</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>ç„¶åå°±å¯ä»¥åœ¨é¡¹ç›®çš„å…¶ä»–æ–‡æ¡£ä¸­ï¼Œé€šè¿‡ message é¡¹æ¥ä½¿ç”¨ç›¸åº”çš„æ•°æ®ï¼š</p><ul><li>åœ¨ <code>manifest.json</code> æˆ– CSS æ–‡æ¡£ä¸­ï¼Œé€šè¿‡ <code>__MEG_messagename__</code> æ¥ä½¿ç”¨ message ç›¸åº”çš„é¡¹ <code>messagename</code></li><li>åœ¨æ‰©å±•ç¨‹åºé¡µé¢æˆ– JavaScript è„šæœ¬ä¸­ï¼Œé€šè¿‡æ–¹æ³• <code>chrome.i18n.getMessage(&quot;messagename&quot;)</code> è·å–ç›¸åº”çš„é¡¹ <code>messagename</code></li></ul><p><img src="/blog-web/assets/i18n-1.f593f5db.png" alt="i18n-1"></p><p>ğŸ’¡ æ¯æ¬¡æ–°å¢ä¸€ç§è¯­è¨€ï¼Œå°±éœ€è¦æ–°å¢ä¸€ä¸ª message æ–‡ä»¶åˆ° <code>_locales/_localeCode_</code> ç›®å½•é‡Œã€‚æ¯ä¸€ç§è¯­è¨€ä¸­ï¼Œ<strong>ä¸å¿…</strong>åŒ…å«ä¸é»˜è®¤è¯­è¨€ä¸­å®šä¹‰çš„å…¨éƒ¨ message é¡¹ã€‚</p><p><img src="/blog-web/assets/i18n-files-structure.e842fd97.png" alt="i18n file structure"></p><p><em>ä»¥ä¸Šç¤ºä¾‹æ˜¯æ”¯æŒè‹±è¯­ã€è¥¿ç­ç‰™è¯­ã€éŸ©è¯­çš„æ‰©å±•ç¨‹åºé¡¹ç›®æ–‡ä»¶ç»“æ„</em></p><p>ğŸ’¡ æµè§ˆå™¨ä¼šåŸºäºç”¨æˆ·çš„è¯­è¨€è®¾ç½®å’Œæ‰©å±•ç¨‹åºçš„ <code>default_locale</code> è®¾ç½®æ¥<a href="https://developer.chrome.com/docs/extensions/reference/i18n/#searching-for-messages" target="_blank" rel="noopener noreferrer">è‡ªåŠ¨é€‰æ‹©</a>é‡‡ç”¨å“ªä¸€ä¸ª <code>messages.json</code> æ–‡æ¡£</p></li></ul><h3 id="identity" tabindex="-1"><a class="header-anchor" href="#identity" aria-hidden="true">#</a> Identity</h3><p>æ‰©å±•ç¨‹åºå¯ä»¥åŸºäº <a href="https://oauth.net/2/" target="_blank" rel="noopener noreferrer">OAuth 2.0</a> è·å–æˆæƒï¼Œè®¿é—® Chrome ç”¨æˆ·ä¿¡æ¯ï¼Œå…·ä½“å‚è€ƒ <a href="https://developer.chrome.com/docs/extensions/reference/identity/" target="_blank" rel="noopener noreferrer"><code>chrome.identity</code> API</a>ã€‚</p><p>ğŸ’¡ å…³äºè¯¥æˆæƒæœºåˆ¶çš„ä»‹ç»å¯ä»¥å‚è€ƒ<a href="https://www.ruanyifeng.com/blog/2019/04/oauth_design.html" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ã€‚</p><h3 id="management" tabindex="-1"><a class="header-anchor" href="#management" aria-hidden="true">#</a> Management</h3><p>ç®¡ç†å·²å®‰è£…å’Œæ­£åœ¨è¿è¡Œçš„æ‰©å±•ç¨‹åºï¼Œå…·ä½“å‚è€ƒ <a href="https://developer.chrome.com/docs/extensions/reference/management/" target="_blank" rel="noopener noreferrer"><code>chrome.management</code> API</a>ã€‚</p><h2 id="ç”¨æˆ·äº¤äº’" tabindex="-1"><a class="header-anchor" href="#ç”¨æˆ·äº¤äº’" aria-hidden="true">#</a> ç”¨æˆ·äº¤äº’</h2><h3 id="action" tabindex="-1"><a class="header-anchor" href="#action" aria-hidden="true">#</a> Action</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/action/" target="_blank" rel="noopener noreferrer"><code>chrome.action</code> API</a></li><li>å…³äº Action çš„<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/api/action" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a></li></ul><p><img src="/blog-web/assets/UI-Action.70914301.png" alt="å›¾æ ‡"></p><p>è¯¥äº¤äº’æ§ä»¶æ˜¯æŒ‡åœ¨æµè§ˆå™¨å·¥å…·æ çš„æ‰©å±•ç¨‹åº<strong>å›¾æ ‡</strong>ï¼Œä¾›ç”¨æˆ·ç‚¹å‡»ï¼Œå¯ä»¥æ‰§è¡Œé¢„å®šçš„æ“ä½œã€‚å®ƒä¹Ÿå¯ä»¥ä½œä¸ºå”¤èµ·å…¶ä»–äº¤äº’æ§ä»¶çš„å…¥å£ï¼Œä¾‹å¦‚é€šè¿‡é€‚å½“çš„é…ç½®ï¼Œåœ¨æ‚¬åœæ—¶å¯ä»¥æ˜¾ç¤º<strong>æç¤ºæ¡† tooltip</strong>ï¼Œåœ¨ç‚¹å‡»æ—¶å¯ä»¥å¼¹å‡º<strong>å¼¹å‡ºæ¡† popup</strong>ã€‚</p><p>ğŸ’¡ å®‰è£…æ‰©å±•ç¨‹åºåï¼ŒAction å›¾æ ‡é»˜è®¤ã€Œéšè—ã€åœ¨æµè§ˆå™¨å·¥å…·æ çš„æ‰©å±•ç¨‹åºï¼ˆæ‹¼å›¾ï¼‰å›¾æ ‡ä¸‹ï¼Œå¯ä»¥å°†å®ƒ pin åˆ°å·¥å…·æ ä¸Šã€‚</p><p>ğŸ’¡ åœ¨ MV2 ç‰ˆæœ¬ä¸­æœ‰ <a href="https://developer.chrome.com/docs/extensions/reference/browserAction/" target="_blank" rel="noopener noreferrer">API <code>chrome.browserAction</code></a>ï¼ˆæµè§ˆå™¨çº§åˆ«çš„æŒ‰é’®ï¼Œå¯¹æ‰€æœ‰é¡µé¢éƒ½å¯ä»¥å“åº”ï¼‰å’Œ <a href="https://developer.chrome.com/docs/extensions/reference/pageAction/" target="_blank" rel="noopener noreferrer">API <code>chrome.pageAction</code></a>ï¼ˆé’ˆå¯¹ç‰¹å®šåŒ¹é…æ¡ä»¶çš„é¡µé¢æ‰ä¼šå“åº”ï¼‰ï¼›è€Œåœ¨ <strong>MV3 ç‰ˆæœ¬</strong>ä¸­æ–°å¢äº† <a href="https://developer.chrome.com/docs/extensions/reference/action/" target="_blank" rel="noopener noreferrer"><code>chorme.action</code> API</a>ï¼Œå®ƒçš„åŠŸèƒ½æœ‰ç‚¹åƒæ˜¯ MV2 çš„ Browser Actionï¼Œå¯ä»¥åœ¨å¤§éƒ¨åˆ†çš„é¡µé¢å“åº”ç”¨æˆ·ç‚¹å‡»ï¼Œå¦‚æœå¸Œæœ›å®ç°ç±»ä¼¼äº Page Action çš„åŠŸèƒ½<strong>åªåœ¨ç‰¹å®šçš„é¡µé¢å“åº”ç‚¹å‡»</strong>ï¼Œå¯ä»¥å‚è€ƒ<a href="https://developer.chrome.com/docs/extensions/reference/action/#emulating-pageactions-with-declarativecontent" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a>ï¼Œå…ˆä½¿ç”¨ <code>chrome.action.disable()</code> å°† Action å›¾æ ‡è®¾ç½®ä¸ºé»˜è®¤ä¸å“åº”ç‚¹å‡»ï¼Œå†ä½¿ç”¨æ–¹æ³• <code>new chrome.declarativeContent.PageStateMatcher()</code> è®¾ç½®å½“ Page URL åŒ¹é…æ—¶æ‰è®© Action å›¾æ ‡å“åº”ç‚¹å‡»ã€‚</p><ul><li><p>å¦‚æœè¦ä½¿ç”¨è¯¥æ§ä»¶ï¼Œéœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>action</code> ä¸­è¿›è¡Œå£°æ˜æ³¨å†Œï¼Œä¾‹å¦‚æŒ‡å®šå›¾æ ‡æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œå¦‚æœä½¿ç”¨äº† popup è¦æŒ‡å®šå¼¹å‡ºæ¡†çš„ HTML æ–‡ä»¶ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;action&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// å›¾æ ‡æ–‡ä»¶</span>
    <span class="token property">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>              <span class="token comment">// optional</span>
      <span class="token property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon16.png&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// optional</span>
      <span class="token property">&quot;24&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon24.png&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// optional</span>
      <span class="token property">&quot;32&quot;</span><span class="token operator">:</span> <span class="token string">&quot;images/icon32.png&quot;</span>    <span class="token comment">// optional</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// æç¤ºæ¡†</span>
    <span class="token property">&quot;default_title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Click Me&quot;</span><span class="token punctuation">,</span>   <span class="token comment">// optional, shown in tooltip</span>
    <span class="token comment">// å¼¹å‡ºæ¡†</span>
    <span class="token property">&quot;default_popup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;popup.html&quot;</span>  <span class="token comment">// optional</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>ğŸ’¡ å³ä½¿æ‰©å±•ç¨‹åºçš„é…ç½®æ¸…å•ä¸­æ²¡æœ‰è®¾ç½® <code>action</code> é€‰é¡¹ï¼Œå®ƒä¹Ÿå¯ä»¥æ˜¾ç¤ºåœ¨æµè§ˆå™¨å·¥å…·æ ä¸Šï¼Œä¼šä½¿ç”¨ä¸€ä¸ªé»˜è®¤å›¾æ ‡ï¼Œä¸€èˆ¬ä»¥èƒŒæ™¯è‰²ä¸ºç°åº•ä¸”åŒ…å«æ‰©å±•ç¨‹åºçš„é¦–å­—æ¯çš„å›¾æ ‡æŒ‡ä»£ã€‚</p></li><li><p>å›¾æ ‡</p><p>icon å›¾æ ‡çš„é»˜è®¤é«˜å’Œå®½éƒ½æ˜¯ 16 DIPsï¼ˆdevice-independent pixelsï¼‰ï¼Œæ¨èé¢„è®¾å¤šä¸ªå°ºå¯¸çš„å›¾æ ‡ï¼Œæµè§ˆå™¨ä¼šä½¿ç”¨æ°å½“çš„æ–‡ä»¶ã€‚å›¾æ ‡æ–‡ä»¶çš„æ ¼å¼éœ€è¦æ˜¯ <a href="https://en.wikipedia.org/wiki/Blink_(browser_engine)" target="_blank" rel="noopener noreferrer">Blink æ¸²æŸ“å¼•æ“</a>æ‰€æ”¯æŒçš„ï¼Œä¾‹å¦‚ PNGã€JPEGã€BMPã€ICO ç­‰ï¼Œ<mark>è€Œ SVG æ˜¯<strong>ä¸</strong>æ”¯æŒçš„</mark>ã€‚å¦‚æœæ˜¯è§£å‹çš„æ‰©å±•ç¨‹åºï¼Œåˆ™åªæ”¯æŒ PNG æ ¼å¼ã€‚</p><table><thead><tr><th style="text-align:center;">å›¾æ ‡å°ºå¯¸</th><th style="text-align:center;">ç”¨é€”</th></tr></thead><tbody><tr><td style="text-align:center;">16x16</td><td style="text-align:center;">ä½œä¸ºæ‰©å±•ç¨‹åºçš„ç›¸å…³é¡µé¢çš„ favicon</td></tr><tr><td style="text-align:center;">32x32</td><td style="text-align:center;">ä¸€èˆ¬ Windows ç³»ç»Ÿä½¿ç”¨è¯¥å°ºå¯¸</td></tr><tr><td style="text-align:center;">48x48</td><td style="text-align:center;">åœ¨æ‰©å±•ç¨‹åºç®¡ç†é¡µé¢ä¸­æ˜¾ç¤º</td></tr><tr><td style="text-align:center;">128x128</td><td style="text-align:center;">åœ¨ Chrome ç½‘ä¸Šåº”ç”¨åº—æ˜¾ç¤º</td></tr></tbody></table><p>é™¤äº†åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>action.default_icon</code> ä¸­æä¾›å›ºå®šçš„æ–‡ä»¶ï¼Œè¿˜æœ‰é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼ï¼Œä½¿ç”¨æ–¹æ³• <code>chrome.action.setIcon()</code> è®¾ç½®å›¾æ ‡ï¼Œå¯ä»¥æ ¹æ®æ¡ä»¶è®¾ç½®ä¸åŒçš„å›¾ç‰‡è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ canvas åˆ›å»ºå›¾ç‰‡ã€‚âš ï¸ è¯¥æ–¹æ³•æ˜¯ç”¨äºè®¾ç½®é™æ€å›¾ç‰‡ï¼Œè€Œä¸åº”è¯¥ç”¨äºè®¾ç½®åŠ¨å›¾ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OffscreenCanvas</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&#39;2d&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&#39;#00FF00&#39;</span><span class="token punctuation">;</span>  <span class="token comment">// Green</span>
context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> imageData <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setIcon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>imageData<span class="token operator">:</span> imageData<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li><li><p>æç¤ºæ¡†</p><p>tooltip æ˜¯åœ¨ç”¨æˆ·æ‚¬åœåœ¨å›¾æ ‡æ—¶æ˜¾ç¤ºçš„æç¤ºæ¡†ï¼Œå¯ä»¥è®¾ç½®ä¸€æ®µç®€çŸ­çš„æ–‡å­—ï¼Œç”¨ä»¥æç¤ºè¯¥æ‰©å±•ç¨‹åºçš„åç§°ã€‚</p><p>é™¤äº†åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>action.default_title</code> ä¸­è®¾ç½®æ–‡å­—ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ–¹æ³• <code>chrome.action.setTitle()</code> è¿›è¡Œè®¾ç½®ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token operator">:</span> <span class="token string">&#39;this is tooltip content&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>ğŸ’¡ å½“å›¾æ ‡æŒ‰é’®è¢«èšç„¦æ—¶ï¼Œå®ƒå¯ä»¥è¢«<strong>å±å¹•é˜…è¯»è½¯ä»¶</strong>è¯†åˆ«ï¼Œå¯ä»¥å¢å¼ºæ‰©å±•ç¨‹åºçš„å¯åŠæ€§ã€‚</p></li><li><p>å¼¹å‡ºæ¡†</p><p>popup æ˜¯åœ¨ç”¨æˆ·ç‚¹å‡» Action å›¾æ ‡æ—¶æ˜¾ç¤ºçš„å¼¹å‡ºæ¡†ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ª<a href="https://developer.chrome.com/docs/extensions/reference/action/#popup" target="_blank" rel="noopener noreferrer">å¤§å°</a>å—åˆ°<a href="https://stackoverflow.com/questions/8983165/how-can-i-expand-the-popup-window-of-my-chrome-extension" target="_blank" rel="noopener noreferrer">é™åˆ¶</a>ï¼ˆé«˜å’Œå®½çš„æœ€å°å€¼æ˜¯ 25pxï¼Œé«˜çš„æœ€å¤§å€¼æ˜¯ 600pxï¼Œå®½çš„æœ€å¤§å€¼æ˜¯ 800pxï¼‰çš„ HTML é¡µé¢ï¼Œé»˜è®¤å¤§å°æ˜¯åŸºäºå†…å®¹çš„ã€‚</p><p>é™¤äº†åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>action.default_popup</code> ä¸­è®¾ç½® popup é¡µé¢ï¼Œè¿˜å¯ä»¥<strong>ä½¿ç”¨æ–¹æ³• <code>chrome.action.setPopup()</code> åŠ¨æ€æ›´æ–°å¼¹å‡ºæ¡†æ‰€æŒ‡å‘çš„ HTML æ–‡ä»¶çš„è·¯å¾„</strong>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>storage<span class="token punctuation">.</span>local<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;signed_in&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>signed_in<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setPopup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>popup<span class="token operator">:</span> <span class="token string">&#39;popup.html&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setPopup</span><span class="token punctuation">(</span><span class="token punctuation">{</span>popup<span class="token operator">:</span> <span class="token string">&#39;popup_sign_in.html&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ğŸ’¡ å®ƒå’Œæ™®é€šçš„ HTML æ–‡æ¡£ä¸€æ ·ï¼Œå¯ä»¥å¼•å…¥æ ·å¼æ–‡ä»¶å’Œè„šæœ¬æ–‡ä»¶ï¼Œä½†<strong>ä¸</strong>æ”¯æŒä½¿ç”¨è¡Œå†…è„šæœ¬ inline JavaScript</p></li><li><p>æ ‡è®°</p><p>badge æ˜¯ä¸€ä¸ªæ·»åŠ åˆ°å›¾æ ‡ä¸Šçš„æ–‡å­—ï¼Œå¹¶å…è®¸è®¾ç½®èƒŒæ™¯è‰²ï¼Œä¸€èˆ¬ç”¨ä»¥æ˜¾ç¤ºæ‰©å±•ç¨‹åºçš„çŠ¶æ€ï¼Œä¾‹å¦‚æ›´æ–°äº†æ–°ç‰ˆæœ¬å¯ä»¥æ˜¾ç¤º <code>new</code>ï¼Œå¦‚æœæ‰©å±•ç¨‹åºå¸¦ç»Ÿè®¡åŠŸèƒ½åˆ™å¯ä»¥å½¢å¼æ•°å€¼ç­‰ã€‚</p><p>ğŸ’¡ ç”±äº badge éœ€è¦æ·»åŠ åˆ°å›¾æ ‡ä¸Šï¼Œæ‰€ä»¥åœ¨è®¾ç½® badge å‰ï¼Œæ‰©å±•ç¨‹åºéœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>action</code> ä¸­è®¾ç½®å›¾æ ‡</p><p>âš ï¸ ç”±äºæ ‡è®°çš„ç©ºé—´æœ‰é™ï¼Œæ‰€ä»¥ä¸€èˆ¬<strong>åªèƒ½æ˜¾ç¤º 4 ä¸ªæˆ–ä»¥ä¸‹çš„å­—ç¬¦</strong></p><p>é€šè¿‡æ–¹æ³• <code>chrome.action.setBadgeText()</code> è®¾ç½®æ ‡è®°æ–‡å­—ï¼›é€šè¿‡<code>chrome.action.setBadgeBackgroundColor()</code> è®¾ç½®æ ‡è®°çš„èƒŒæ™¯è‰²</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// è®¾ç½® badge æ–‡å­—å†…å®¹</span>
chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setBadgeText</span><span class="token punctuation">(</span><span class="token punctuation">{</span>text<span class="token operator">:</span> <span class="token string">&#39;NEW&#39;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// é€šè¿‡å¤šç§æ–¹å¼è®¾ç½® badge èƒŒæ™¯é¢œè‰²</span>
chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setBadgeBackgroundColor</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>color<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// Green</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setBadgeBackgroundColor</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>color<span class="token operator">:</span> <span class="token string">&#39;#00FF00&#39;</span><span class="token punctuation">,</span>  <span class="token comment">// Also green</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setBadgeBackgroundColor</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>color<span class="token operator">:</span> <span class="token string">&#39;green&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// Also, also green</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li><li><p><strong>action åœ¨æ¯ä¸€ä¸ªæ ‡ç­¾é¡µéƒ½å¯ä»¥æœ‰ä¸åŒçš„çŠ¶æ€</strong>ï¼Œä¾‹å¦‚å¯ä»¥é’ˆå¯¹ä¸åŒçš„æ ‡ç­¾é¡µï¼Œè®¾ç½®ä¸åŒ badge å†…å®¹</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getTabId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span><span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getTabBadge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span><span class="token punctuation">}</span>

chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setBadgeText</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token function">getTabBadge</span><span class="token punctuation">(</span>tabId<span class="token punctuation">)</span><span class="token punctuation">,</span>
    tabId<span class="token operator">:</span> <span class="token function">getTabId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ğŸ’¡ å¦‚æœæ–¹æ³• <code>setBadgeText</code> ç¬¬ä¸€ä¸ªå‚æ•°çš„é€‰é¡¹ <code>tabId</code> çœç•¥äº†ï¼Œåˆ™è¯¥æ ‡è®°ä¼šä½œä¸ºå…¨å±€è®¾ç½®ï¼Œè€Œæä¾›äº† <code>tabId</code> åˆ™é’ˆå¯¹ç‰¹å®šçš„æ ‡ç­¾é¡µï¼Œä¼˜å…ˆçº§æ›´é«˜ï¼Œä¼šè¦†ç›–å…¨å±€è®¾ç½®çš„æ ‡è®°æ–‡å­—ã€‚</p></li><li><p>é»˜è®¤æ‰€æœ‰æ ‡ç­¾é¡µä¸‹ï¼Œaction å›¾æ ‡éƒ½æ˜¯<strong>å¯ä»¥å“åº”ç‚¹å‡»çš„ clickable</strong>ï¼Œå¯ä»¥é€šè¿‡æ–¹æ³• <code>chrome.action.enable()</code> æˆ– <code>chrome.action.disable()</code> æ¥æ‰‹åŠ¨æ§åˆ¶ action çš„å“åº”çŠ¶æ€ï¼Œè¿™ä¼šå½±å“ popup çš„æ˜¾ç¤ºæˆ– <code>chrome.action.onClicked</code> æ‰€ç›‘å¬çš„ç›¸åº”äº‹ä»¶çš„åˆ†å‘ã€‚</p></li></ul><h3 id="context-menu" tabindex="-1"><a class="header-anchor" href="#context-menu" aria-hidden="true">#</a> Context Menu</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/contextMenus/" target="_blank" rel="noopener noreferrer"><code>chrome.contextMenus</code> API</a></li><li>å…³äº Context Menu <a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/apps/samples/context-menu" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a></li></ul><p><img src="/blog-web/assets/UI-Context-Menu.aaaf12f0.png" alt="èœå•é€‰é¡¹"></p><p>è¯¥äº¤äº’æ§ä»¶æ˜¯æŒ‡æµè§ˆå™¨çš„<strong>å³é”®èœå•</strong>ï¼Œå¯ä»¥é€šè¿‡æ‰©å±•ç¨‹åºå¾€å…¶ä¸­æ·»åŠ é€‰é¡¹ï¼Œé™¤äº†å¯ä»¥é’ˆå¯¹æ•´ä¸ªé¡µé¢ï¼Œè¿˜å¯ä»¥é’ˆå¯¹ç‰¹å®šçš„ DOM å…ƒç´ ï¼Œæˆ– action å›¾æ ‡ï¼Œæ·»åŠ å³é”®èœå•é¡¹ã€‚</p><ul><li><p>å¦‚æœè¦ä½¿ç”¨è¯¥æ§ä»¶ï¼Œéœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>permissions</code> ä¸­è¿›è¡Œå£°æ˜æ³¨å†Œã€‚ä¸ºäº†ä¾¿äºå°†èœå•é€‰é¡¹ä¸æ‰©å±•ç¨‹åºç›¸åŒ¹é…ï¼Œéœ€è¦åœ¨é…ç½®æ¸…å•çš„é€‰é¡¹ <code>icons</code> ä¸­æŒ‡å®šå›¾æ ‡æ–‡ä»¶ï¼Œæœ€å¥½æä¾›å¤šç§å°ºå¯¸çš„å›¾ç‰‡æ–‡ä»¶ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;contextMenus&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon-bitty.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon-small.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon-large.png&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li><li><p>ä½¿ç”¨æ–¹æ³• <code>chrome.contextMenus.create({}, callback())</code> ä¸ºæ‰©å±•ç¨‹åºåˆ›å»ºä¸“å±çš„èœå•é¡¹ï¼Œå®ƒå¯ä»¥æ¥æ”¶ä¸¤ä¸ªå…¥å‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é…ç½®å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ã€‚è¿”å›å€¼è¯¥èœå•é€‰é¡¹çš„å”¯ä¸€ ID å€¼ã€‚</p><p>é…ç½®å¯¹è±¡æœ‰å¤šä¸ªé€‰é¡¹ï¼Œå¸¸ç”¨å¦‚ä¸‹ï¼š</p><ul><li><p><code>id</code> ä¸ºå½“å‰èœå•é€‰é¡¹åˆ†é…ä¸€ä¸ªå”¯ä¸€ ID</p></li><li><p><code>title</code>ï¼ˆ<strong>å¿…é¡»</strong>ï¼Œé™¤éè¯¥èœå•é€‰é¡¹çš„ç±»å‹æ˜¯åˆ†å‰²çº¿ <code>type: &quot;separator&quot;</code>ï¼‰èœå•é€‰é¡¹çš„å†…å®¹</p></li><li><p><code>type</code> èœå•é€‰é¡¹çš„ç±»å‹ï¼Œé»˜è®¤å€¼æ˜¯ <code>normal</code>ï¼Œå°±æ˜¯æ­£å¸¸çš„èœå•é€‰é¡¹ï¼Œè¿˜å¯ä»¥æ˜¯ <code>checkbox</code>ã€<code>radio</code>ã€<code>separator</code></p></li><li><p><code>contexts</code> æ•°ç»„ï¼Œé™åˆ¶èœå•é€‰é¡¹å‡ºç°åœ¨<a href="https://developer.chrome.com/docs/extensions/reference/contextMenus/#type-ContextType" target="_blank" rel="noopener noreferrer">å¯¹é¡µé¢çš„å“ªä¸ªå…ƒç´ </a>è¿›è¡Œå³é”®ç‚¹å‡»æ—¶ï¼Œé»˜è®¤å€¼æ˜¯ <code>[&#39;page&#39;]</code>ï¼Œå³åœ¨æ•´ä¸ªç½‘é¡µä»»ä½•åœ°æ–¹å³é”®ç‚¹å‡»æ—¶ï¼Œè¯¥èœå•é€‰é¡¹éƒ½æ˜¾ç¤ºåœ¨èœå•ä¸­</p></li><li><p><code>parentId</code> å½“å‰èœå•é€‰é¡¹çš„çˆ¶çº§èœå•çš„ ID</p></li><li><p><code>onclick</code> ç›‘å¬èœå•é€‰é¡¹çš„ç‚¹å‡»äº‹ä»¶å’Œäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå½“èœå•é€‰é¡¹è¢«ç‚¹å‡»æ—¶æ‰§è¡Œè¯¥äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œä¼šæœ‰ä¸¤ä¸ªå…¥å‚ <code>info</code>ï¼ˆè¯¥èœå•é€‰é¡¹çš„ä¿¡æ¯ï¼‰å’Œ <code>tab</code>ï¼ˆå½“å‰æ ‡ç­¾é¡µçš„ä¿¡æ¯ï¼‰ä¼ å…¥</p></li></ul><p>ï¼ˆå¯é€‰ï¼‰å›åˆ°å‡½æ•°æ˜¯åœ¨ç”¨æˆ·å³é”®ç‚¹å‡»ï¼Œè¯¥èœå•é€‰é¡¹è¢«åˆ›å»ºæ—¶æ‰€æ‰§è¡Œçš„</p><p>è¯¥æ–¹æ³•åº”è¯¥åœ¨<strong>åå°è„šæœ¬</strong>ä¸­è®¾ç½®ï¼Œå¹¶åœ¨å®‰è£…æ‰©å±•ç¨‹åºå®Œæˆæ—¶çš„é’©å­å‡½æ•° <code>chroe.runtime.onInstalled.addListener()</code> ä¸­è°ƒç”¨ï¼Œä»¥ä¾¿å®‰è£…å®Œæˆæ—¶ï¼Œå³é”®èœå•é€‰é¡¹å³å¯ç”¨</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onInstalled<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>contextMenus<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token operator">:</span> key<span class="token punctuation">,</span>
    title<span class="token operator">:</span> <span class="token string">&#39;context menu demo&#39;</span><span class="token punctuation">,</span>
    type<span class="token operator">:</span> <span class="token string">&#39;normal&#39;</span><span class="token punctuation">,</span>
    contexts<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;selection&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li><li><p>ä½¿ç”¨æ–¹æ³• <code>chrome.contextMenus.update(menuItemId, {}, callback())</code> æ›´æ–°ç»™å®šèœå•é€‰é¡¹ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯èœå•é€‰é¡¹çš„å”¯ä¸€ ID å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯é…ç½®å¯¹è±¡ï¼ˆå’Œæ–¹æ³• <code>chrome.contextMenus.create()</code> çš„é…ç½®å¯¹è±¡å¯ä½¿ç”¨çš„é€‰é¡¹ä¸€æ ·ï¼‰ï¼Œç¬¬ä¸‰ä¸ªï¼ˆå¯é€‰ï¼‰å‚æ•°æ˜¯å›è°ƒå‡½æ•°ï¼Œåœ¨æ›´æ–°å®Œèœå•é€‰é¡¹åæ‰§è¡Œã€‚</p></li></ul><p>ğŸ’¡ æµè§ˆå™¨çš„å³é”®èœå•æ˜¯å…¨å±€çš„ï¼Œå¯ä»¥å‡ºç°åœ¨ä»»ä½•é¡µé¢ä¸­ï¼Œç”šè‡³æ˜¯ <code>file://</code> æˆ– <code>chrome://URLs</code> çš„é¡µé¢ï¼Œå¦‚æœå¸Œæœ›æ§åˆ¶èœå•é€‰é¡¹å‡ºç°åœ¨æŒ‡å®šçš„é¡µé¢ï¼Œä½ å¯ä»¥åœ¨åˆ›å»º <code>create()</code> æˆ–æ›´æ–° <code>update()</code> èœå•é€‰é¡¹æ—¶ï¼Œé€šè¿‡é…ç½®å¯¹è±¡çš„é€‰é¡¹ <code>documentUrlPatterns</code> æ¥é™åˆ¶åªèƒ½åœ¨<a href="https://developer.chrome.com/docs/extensions/mv3/match_patterns/" target="_blank" rel="noopener noreferrer">ç‰¹å®šçš„ URL</a> é¡µé¢æˆ– <code>&lt;iframe&gt;</code> ä¸­ï¼Œå³é”®ç‚¹å‡»æ‰æ˜¾ç¤ºç›¸åº”çš„èœå•é¡¹ã€‚</p><ul><li><p>ä½¿ç”¨æ–¹æ³• <code>chrome.contextMenus.remove(menuItemId, callback())</code> åŠ¨æ€åˆ é™¤å·²åˆ›å»ºçš„èœå•é€‰é¡¹ã€‚ï¼ˆå¯é€‰ï¼‰å›è°ƒå‡½æ•°åœ¨åˆ é™¤æŒ‡å®šçš„èœå•é€‰é¡¹åæ‰§è¡Œã€‚å¦‚æœæƒ³åˆ é™¤æ‰€æœ‰è¯¥æ‰©å±•ç¨‹åºåˆ›å»ºçš„èœå•é€‰é¡¹ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³• <code>chrome.contextMenus.removeAll(callback())</code> å…¶ï¼ˆå¯é€‰ï¼‰å›è°ƒå‡½æ•°ä¼šåœ¨åˆ é™¤èœå•é€‰é¡¹åæ‰§è¡Œã€‚</p></li><li><p>å¯ä»¥åˆ›å»ºå¤šä¸ªèœå•é€‰é¡¹ï¼Œä½†æ˜¯å¦‚æœé€‰é¡¹å¤šäºä¸€ä¸ªï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†å®ƒä»¬æ”¶çº³åˆ°ä¸€ä¸ª<strong>æ¬¡çº§èœå•</strong>ä¸­</p></li><li><p>ä½¿ç”¨æ–¹æ³• <code>chrome.contextMenus.onClicked(callback())</code> ç›‘å¬è¯¥æ‰©å±•ç¨‹åºèœå•é€‰é¡¹çš„ç‚¹å‡»äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå…¥å‚ <code>info</code> è¢«ç‚¹å‡»çš„èœå•é€‰é¡¹çš„ç›¸å…³ä¿¡æ¯ï¼Œ<code>tab</code> æ ‡ç­¾é¡µç›¸å…³ä¿¡æ¯ã€‚</p></li></ul><h3 id="omnibox" tabindex="-1"><a class="header-anchor" href="#omnibox" aria-hidden="true">#</a> Omnibox</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/omnibox/" target="_blank" rel="noopener noreferrer"><code>chrome.omnibox</code> API</a></li><li>å…³äº Omnibox çš„<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/api/omnibox/new-tab-search" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a></li></ul><p><img src="/blog-web/assets/UI-Omnibox.09dd1984.png" alt="Omnibox"></p><p>è¯¥äº¤äº’æ§ä»¶æ˜¯æŒ‡åœ°å€æ ä¸Šçš„<strong>æœç´¢å…³é”®è¯</strong>ï¼Œå½“ç”¨æˆ·åœ¨åœ°å€æ è¾“å…¥ç›¸åº”çš„å…³é”®è¯ï¼Œå°±ä¼šè§¦å‘ Omniboxï¼ˆå”¤èµ·ç›¸åº”çš„æ‰©å±•ç¨‹åºï¼‰ï¼Œæ¥ä¸‹æ¥ç”¨æˆ·åœ¨åœ°å€æ ä¸­è¾“å…¥å†…å®¹æ˜¯ç›´æ¥ä¸è¯¥æ‰©å±•ç¨‹åºè¿›è¡Œäº¤äº’ã€‚ä¸€èˆ¬ä¼šåœ¨æ‰©å±•ç¨‹åºä¸­é¢„å…ˆè®¾ç½®ä¸€ç³»åˆ—çš„æœç´¢å»ºè®®ï¼Œå½“ç”¨æˆ·è¾“å…¥çš„å†…å®¹æ¨¡ç³ŠåŒ¹é…æˆåŠŸæ—¶ï¼Œå°±ä¼šåœ¨ä¸€ä¸ª dropdown ä¸­æ˜¾ç¤ºç›¸åº”çš„æœç´¢å»ºè®®ã€‚</p><ul><li><p>å¦‚æœè¦ä½¿ç”¨è¯¥æ§ä»¶ï¼Œéœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>omnibox</code> ä¸­è¿›è¡Œå£°æ˜æ³¨å†Œã€‚å½“ Omnibox è¢«è§¦å‘æ—¶ï¼Œæ‰©å±•ç¨‹åºå›¾æ ‡ï¼ˆä»¥ç°é˜¶çš„å½¢å¼å±•ç¤ºï¼‰å’Œåç§°ä¼šæ˜¾ç¤ºåœ¨åœ°å€æ çš„å·¦ä¾§ï¼Œä¸ºäº†ä¾¿äºè¯†åˆ«ï¼Œéœ€è¦åœ¨é…ç½®æ¸…å•çš„é€‰é¡¹ <code>icons</code> ä¸­æŒ‡å®šå›¾æ ‡æ–‡ä»¶ï¼Œæœ€å¥½æä¾›å¤šç§å°ºå¯¸çš„å›¾ç‰‡æ–‡ä»¶ï¼ˆé»˜è®¤ä½¿ç”¨é«˜å’Œå®½ä¸º 16px çš„å›¾æ ‡ï¼‰ã€‚</p><p>è¯¥æ§ä»¶çš„äº¤äº’é€»è¾‘åœ¨<strong>åå°è„šæœ¬</strong>çš„ service worker ä¸­è®¾ç½®ï¼ˆéœ€è¦åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>background.service_worker</code> ä¸­å£°æ˜æ³¨å†Œï¼‰ï¼ŒåŸºäºäº‹ä»¶ç›‘å¬-å“åº”çš„åŸç†ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;service_worker&quot;</span><span class="token operator">:</span> <span class="token string">&quot;background.js&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;omnibox&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;keyword&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;demo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon-bitty.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon-small.png&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;icon-large.png&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ä»¥ä¸Šç¤ºä¾‹å°†æ‰©å±•ç¨‹åºçš„ Omnibox è§¦å‘å…³é”®è¯è®¾å®šä¸º <code>demo</code>ï¼Œå½“ç”¨æˆ·åœ¨åœ°å€æ è¾“å…¥ demo æ—¶ï¼Œä¼šåœ¨ä¸‹æ‹‰æ¡†æ˜¾ç¤ºä¸€ä¸ªæ‰©å±•ç¨‹åºåç§°çš„é€‰é¡¹ï¼Œå¯ä»¥ç‚¹å‡»è¯¥é€‰é¡¹ï¼Œæˆ–æŒ‰ Tab é”®ï¼Œæˆ–é”®å…¥ç©ºæ ¼ Spaceï¼Œå³å¯è§¦å‘ Omniboxã€‚</p><p><img src="/blog-web/assets/UI-Omnibox-trigger.d0c5de0c.png" alt="Omnibox è§¦å‘"></p></li><li><p>å¸¸ç”¨äºç›‘å¬äº‹ä»¶çš„ API å¦‚ä¸‹ï¼š</p><ul><li><p><code>onInputChanged</code> è¿›å…¥ Omnibox æ¨¡å¼åï¼Œå½“ç”¨æˆ·åœ¨åœ°å€æ ä¸­è¾“å…¥å†…å®¹æ—¶ä¼šè§¦å‘ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>omnibox<span class="token punctuation">.</span>onInputChanged<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> suggest</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>text<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token function">suggest</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
          content<span class="token operator">:</span> text<span class="token punctuation">,</span>
          description<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">search for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>äº‹ä»¶å¤„ç†å‡½æ•°ä¸­æ¥æ”¶ä¸¤ä¸ªå…¥å‚ï¼Œç¬¬ä¸€ä¸ªå‚æ•° <code>text</code> æ˜¯ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>suggest</code> æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸€ç³»åˆ—çš„å»ºè®®ç»“æœ SuggestResultï¼Œè¯¥æ–¹æ³•ä¼šå°†è¿™äº›å»ºè®®é€‰é¡¹ä¼ é€’å›æµè§ˆå™¨ï¼Œæ˜¾ç¤ºåœ¨åœ°å€æ çš„ä¸‹æ‹‰æ¡†ä¸­ã€‚</p><p>ğŸ’¡ å»ºè®®ç»“æœ SuggestResult æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾›ç”¨æˆ·é€‰æ‹©ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å±æ€§ï¼š</p><ul><li><code>content</code> å®é™…ä¸Šä¼šè¾“å…¥åˆ°åœ°å€æ çš„å†…å®¹ï¼Œå½“ç”¨æˆ·é€‰ä¸­è¯¥å»ºè®®é€‰é¡¹æ—¶ï¼Œä¼šä¼ é€’ç»™æ‰©å±•ç¨‹åºçš„å†…å®¹</li><li><code>deletable</code> è¯¥å»ºè®®é€‰é¡¹æ˜¯å¦å¯ä»¥è®©ç”¨æˆ·åˆ é™¤</li><li><code>description</code> æè¿°å†…å®¹ï¼Œæ˜¾ç¤ºåœ¨åœ°å€æ çš„ä¸‹æ‹‰æ¡†ä¸­ï¼Œå¯ä»¥åŒ…å« XML é£æ ¼çš„æ ·å¼ä¿®é¥°ã€‚ä½†æ˜¯ä¸èƒ½åŒ…å« 5 ç§ <a href="https://stackoverflow.com/questions/1091945/what-characters-do-i-need-to-escape-in-xml-documents/1091953#1091953" target="_blank" rel="noopener noreferrer">XML è½¬ä¹‰å­—ç¬¦</a>ã€‚</li></ul><p>ğŸ’¡ å¯ä»¥ä½¿ç”¨æ–¹æ³• <code>chrome.omnibox.setDefaultSuggestion(suggestion)</code> è®¾ç½®é»˜è®¤çš„å»ºè®®é€‰é¡¹ï¼Œè¯¥æ–¹æ³•æ¥æ”¶çš„å…¥å‚æ˜¯ä¸€ä¸ªä¸å®Œæ•´ suggestionResult å¯¹è±¡ï¼Œ<strong>æ²¡æœ‰ <code>content</code> å±æ€§</strong>ï¼Œå…¶ä½œç”¨ç±»ä¼¼äºè¾“å…¥æ¡†ä¸­çš„ placeholderã€‚å½“è§¦å‘äº† Omnibox æ—¶ï¼Œåœ¨ç”¨æˆ·è¿˜æ²¡è¾“å…¥å†…å®¹æ—¶ï¼Œè¯¥é»˜è®¤å»ºè®®å°±ä¼šå‡ºç°åœ¨åœ°å€æ çš„ä¸‹æ‹‰æ¡†ä¸­ç¬¬ä¸€æ¡çš„ä½ç½®ã€‚</p><p><mark>âš ï¸ æ ¹æ®ä¸€ä¸ª <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=1186804" target="_blank" rel="noopener noreferrer">Bug æŠ¥å‘Š</a>ï¼Œç”±äº Omnibox çš„æœç´¢å»ºè®®å†…å®¹æ”¯æŒ XMLï¼Œæ‰€ä»¥éœ€è¦è°ƒç”¨ DomParserï¼Œä½†æ˜¯åå°è„šæœ¬åœ¨ MV3 ç‰ˆæœ¬è¿ç§»æ”¹ç”¨äº† service workerï¼Œè¯¥è¿è¡Œç¯å¢ƒå¹¶æ²¡æœ‰ DomParserï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æŠ¥é”™ï¼Œä¸”æ— æ³•æ­£å¸¸æ˜¾ç¤ºæœç´¢å»ºè®®é€‰é¡¹ã€‚</mark></p></li><li><p><code>onInputEntered</code> åœ¨ç”¨æˆ·é€‰æ‹©æ‰§è¡Œä¸€ä¸ªå»ºè®®é€‰é¡¹åï¼Œè§¦å‘å›è°ƒå‡½æ•°ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>omnibox<span class="token punctuation">.</span>onInputEntered<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> disposition</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>text<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;inputEntered: &#39;</span> <span class="token operator">+</span> text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Encode user input for special characters , / ? : @ &amp; = + $ #</span>
  <span class="token keyword">var</span> newURL <span class="token operator">=</span> <span class="token string">&#39;https://www.google.com/search?q=&#39;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span> url<span class="token operator">:</span> newURL <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>disposition<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>äº‹ä»¶å¤„ç†å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•° <code>text</code> æ˜¯è¾“å…¥åˆ°åœ°å€æ çš„å†…å®¹ï¼Œç¬¬äºŒä¸ªå‚æ•° <code>disposition</code> æ˜¯è¿›è¡Œæœå¯»æ—¶çª—å£çš„è®¾ç½®ï¼Œæœ‰ä¸‰ç§å¯èƒ½çš„ç»“æœï¼š</p><ul><li><p><code>currentTab</code> åœ¨å½“å‰æ ‡ç­¾é¡µè¿›è¡Œæœå¯»</p></li><li><p><code>newForegroundTab</code> æ–°å»ºä¸€ä¸ªæ ‡ç­¾é¡µè¿›è¡Œæœå¯»ï¼ŒåŒæ—¶åˆ‡æ¢åˆ°è¯¥æ ‡ç­¾é¡µ</p></li><li><p><code>newBackgroundTab</code> æ–°å»ºä¸€ä¸ªæ ‡ç­¾é¡µè¿›è¡Œæœå¯»ï¼Œä½†ä¸è¿›è¡Œæ ‡ç­¾é¡µçš„åˆ‡æ¢</p></li></ul><p>ä»¥ä¸Šç¤ºä¾‹è°ƒç”¨äº† <code>chrome.tabs.create()</code> æ–¹æ³•ï¼Œåœ¨å½“å‰æ ‡ç­¾é¡µè¿›è¡Œæœç´¢ï¼Œæ‰€ä»¥ç»ˆç«¯æ‰“å°çš„å€¼æ˜¯ <code>currentTab</code></p></li></ul></li></ul><h3 id="override-pages" tabindex="-1"><a class="header-anchor" href="#override-pages" aria-hidden="true">#</a> Override Pages</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/mv3/override/" target="_blank" rel="noopener noreferrer">Overriding Chrome pages</a></li><li>å…³äº Override Pages çš„å®˜æ–¹ç¤ºä¾‹ <ul><li><a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/history/historyOverride" target="_blank" rel="noopener noreferrer">historyOverride</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li><li><a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/override/blank_ntp" target="_blank" rel="noopener noreferrer">blank_ntp</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li><li><a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/override/override_igoogle" target="_blank" rel="noopener noreferrer">override_igoogle</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li></ul></li></ul><p><img src="/blog-web/assets/UI-Override-Page-NewTab.e4cb0143.png" alt="è¦†å†™æ–°å»ºæ ‡ç­¾é¡µ"></p><p>è¯¥äº¤äº’æ§ä»¶æ˜¯é€šè¿‡<strong>è¦†å†™é¡µé¢</strong>å®ç°çš„ï¼Œæ‰©å±•ç¨‹åºå¯ä»¥è¦†å†™ä¸‰ä¸ª Chrome çš„ç‰¹æ®Šé¡µé¢ï¼š</p><ul><li>Bookmark Managerï¼šä¹¦ç­¾ç®¡ç†é¡µé¢ <code>chrome://bookmarks</code></li><li>Historyï¼šå†å²è®°å½•é¡µé¢ <code>chrome://history</code></li><li>New Tabï¼šæ–°å»ºæ ‡ç­¾é¡µ <code>chrome://newtab</code></li></ul><p>ğŸ’¡ æ¯ä¸€ä¸ªæ‰©å±•ç¨‹åº<strong>åªèƒ½è¦†å†™ä»¥ä¸Šä¸‰ä¸ªç‰¹æ®Š Chrome é¡µé¢ä¹‹</strong>ï¼Œè€Œæ¯ä¸€ç§ç‰¹æ®Š Chrome é¡µé¢ï¼Œåªèƒ½é€‰æ‹©è¢«ä¸€ä¸ªæ‰©å±•ç¨‹åºè¿›è¡Œè¦†å†™ã€‚æ­¤å¤–éšèº«æ¨¡å¼ä¸‹ï¼Œæ–°å»ºæ ‡ç­¾é¡µä¸èƒ½è¢«è¦†å†™ã€‚</p><ul><li><p>å¦‚æœè¦ä½¿ç”¨è¯¥æ§ä»¶ï¼Œéœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>chrome_url_overrides</code> ä¸­è¿›è¡Œå£°æ˜æ³¨å†Œï¼Œå°†éœ€è¦è¦†å†™çš„é¡µé¢ä½œä¸ºå±æ€§ï¼Œ<code>bookmarks</code>ã€<code>history</code>ã€<code>newtab</code> ä¸‰è€…ä¹‹ä¸€ï¼Œå±æ€§å€¼å°±æ˜¯ç”¨ä»¥æ›¿æ¢çš„ HTML é¡µé¢æ–‡æ¡£çš„ç›¸å¯¹è·¯å¾„ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;chrome_url_overrides&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;newTab&quot;</span><span class="token operator">:</span> <span class="token string">&quot;newPage.html&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li><li><p>ä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œç”¨ä»¥æ›¿æ¢çš„é¡µé¢åº”è¯¥éµå¾ªä»¥ä¸‹æŒ‡å¼•ï¼š</p><ul><li>é¡µé¢æ–‡ä»¶å¤§å°åº”è¯¥è¾ƒå°ï¼Œä¾¿äºå¿«é€ŸåŠ è½½æ˜¾ç¤ºï¼Œé¿å…ä½¿ç”¨åŒæ­¥è®¿é—®ç½‘ç»œæˆ–æ•°æ®åº“èµ„æºï¼Œå¯¼è‡´æ¸²æŸ“é˜»å¡ã€‚</li><li>åŒ…å«æ˜ç¡®çš„ä¿¡æ¯ï¼Œå‘ŠçŸ¥ç”¨æˆ·å½“å‰æµè§ˆçš„æ˜¯ Chrome çš„ç‰¹æ®Šé¡µé¢ã€‚</li><li>ä¸è¦åœ¨æ–°å»ºæ ‡ç­¾é¡µä½¿ç”¨è¾“å…¥æ¡†èšç„¦åŠŸèƒ½ï¼Œå› ä¸ºæ–°å»ºé¡µé¢æ—¶ï¼Œæ ‡ç­¾é¡µçš„åœ°å€æ ä¼šé¦–å…ˆè·å–ç„¦ç‚¹ã€‚</li></ul></li></ul><p>ğŸ’¡ ç”¨ä»¥æ›¿æ¢çš„é¡µé¢å¯ä»¥å¼•å…¥æ ·å¼æ–‡ä»¶æˆ–è„šæœ¬æ–‡ä»¶ï¼Œä½†<strong>ä¸</strong>æ”¯æŒè¡Œå†…è„šæœ¬ inline JavaScript</p><h3 id="commands" tabindex="-1"><a class="header-anchor" href="#commands" aria-hidden="true">#</a> Commands</h3><p>å‚è€ƒï¼š</p><ul><li><p><a href="https://developer.chrome.com/docs/extensions/reference/commands/" target="_blank" rel="noopener noreferrer"><code>chrome.commands</code> API</a></p></li><li><p>å…³äº Commands çš„<a href="https://developer.chrome.com/docs/extensions/reference/commands/#examples" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a></p></li></ul><p>è¯¥äº¤äº’æ§ä»¶æ˜¯æŒ‡ä½¿ç”¨<strong>å¿«æ·é”®</strong>æ“ä½œæ‰©å±•ç¨‹åºï¼Œå¯ä»¥é€šè¿‡å¿«æ·é”®æ¿€æ´» action æˆ–æ‰§è¡Œç‰¹å®šçš„å‘½ä»¤ã€‚</p><p>ğŸ’¡ æ‰€æœ‰æ‰©å±•ç¨‹åºçš„å¿«æ·é”®éƒ½åœ¨ <code>chrome://extensions/shortcuts</code> ä¸­æ˜¾ç¤ºï¼Œ<strong>ç”¨æˆ·å¯ä»¥åœ¨å…¶ä¸­ä¿®æ”¹å¿«æ·é”®çš„ç»„åˆå€¼ï¼Œæˆ–å¿«æ·é”®çš„å±€éƒ¨ä¸å…¨å±€é€‚ç”¨æ€§</strong>ã€‚</p><p><img src="/blog-web/assets/UI-Commands-Shortcuts-Setting.644ac56c.png" alt="ä¿®æ”¹æ‰©å±•ç¨‹åºå¿«æ·é”®"></p><ul><li><p>å¦‚æœè¦ä½¿ç”¨è¯¥æ§ä»¶ï¼Œéœ€è¦å…ˆå°†è¿™äº›å¿«æ·é”®åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>commands</code> ä¸­è¿›è¡Œå£°æ˜æ³¨å†Œï¼Œè¯¥é€‰é¡¹çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå±æ€§åæ˜¯ä¸€ä¸ªæè¿°å‘½ä»¤çš„åç§°ï¼Œå±æ€§å€¼æ˜¯å…³äºå¿«æ·é”®å®šä¹‰çš„å¯¹è±¡ï¼Œä¸€èˆ¬æœ‰ä¸¤ä¸ªé€‰é¡¹ï¼š</p><ul><li><code>suggested_key</code>ï¼ˆå¯é€‰ï¼‰å£°æ˜é»˜è®¤çš„å¿«æ·é”®ï¼Œå…¶å€¼å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨ç¤ºï¼ˆè·¨å¹³å°é€‚ç”¨çš„ï¼‰å¿«æ·é”®çš„å­—ç¬¦ä¸²ï¼Œæˆ–æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥<strong>é’ˆå¯¹ä¸åŒçš„ç³»ç»Ÿå¹³å°</strong>è®¾å®šä¸åŒçš„å¿«æ·é”®ï¼Œå…¶ä¸­ç³»ç»Ÿå¹³å°æ”¯æŒ <code>default</code>ã€<code>chromeos</code>ã€<code>linus</code>ã€<code>mac</code>ã€<code>windows</code>ã€‚å¦‚æœè¯¥é€‰é¡¹<strong>çœç•¥</strong>ï¼Œåˆ™è¯¥å‘½ä»¤æ²¡æœ‰ç›¸åº”çš„è§¦å‘å¿«æ·é”®ï¼Œ<strong>ç­‰å¾…ç”¨æˆ·æ¥è®¾å®šåå†ç”Ÿæ•ˆ</strong>ã€‚</li><li><code>description</code> ä¸€æ®µå‘ŠçŸ¥ç”¨æˆ·è¯¥å¿«æ·é”®åŠŸèƒ½ä½œç”¨çš„å­—ç¬¦ä¸²ï¼Œå®ƒä¼šæ˜¾ç¤ºåœ¨æ‰©å±•ç¨‹åºçš„å¿«æ·é”®ç®¡ç†ç•Œé¢ä¸­ <code>chrome://extensions/shortcuts</code>ï¼Œå¯¹äºæ ‡å‡†å¿«æ·é”® standard commands å®ƒæ˜¯å¿…é¡»çš„ï¼Œå¯¹äº action commands æ˜¯å¯é€‰çš„ã€‚</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;commands&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;run-foo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;suggested_key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ctrl+Shift+Y&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Command+Shift+Y&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Run \&quot;foo\&quot; on the current page.&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;_execute_action&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;suggested_key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;windows&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ctrl+Shift+Y&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Command+Shift+Y&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;chromeos&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ctrl+Shift+U&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;linux&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ctrl+Shift+J&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>ğŸ’¡ å…¶ä¸­ <code>_execute_action</code> æ˜¯ä¿ç•™å±æ€§ï¼Œç”¨ä»¥å®šä¹‰<strong>æ¿€æ´» action çš„å¿«æ·é”®</strong>ï¼ˆå¯¹äº MV2 ç‰ˆæœ¬ï¼Œåˆ™æœ‰ <code>_execute_browser_action</code> å’Œ <code>_execute_page_action</code> ä¿ç•™å±æ€§ï¼Œåˆ†åˆ«è®¾å®šæ¿€æ´» browser action å’Œ page action çš„å¿«æ·é”®ï¼‰ï¼Œå¯¹äºæ¿€æ´» action çš„å¿«æ·é”®<em>æ— æ³•**è§¦</em>å‘ <code>command.onCommand</code> äº‹ä»¶ã€‚</p><p>ç„¶ååœ¨<strong>åå°è„šæœ¬</strong>ä¸­ä½¿ç”¨ <code>chrome.commands.onCommand.addListener()</code> API ç›‘å¬å¿«æ·é”®å‘½ä»¤è§¦å‘äº‹ä»¶</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Tab Flipper&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;commands&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;flip-tabs-forward&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;suggested_key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ctrl+Shift+Right&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Command+Shift+Right&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Flip tabs forward&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;flip-tabs-backwards&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;suggested_key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ctrl+Shift+Left&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;mac&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Command+Shift+Left&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Flip tabs backwards&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>commands<span class="token punctuation">.</span>onCommand<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token parameter">command</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¦‚æœç”¨æˆ·è§¦å‘äº†æ‰©å±•ç¨‹åºæ³¨å†Œçš„å¿«æ·é”®ï¼Œåˆ™ä¼ å…¥çš„å‚æ•° command æ˜¯å‘½ä»¤çš„åç§°</span>
  <span class="token comment">// command will be &quot;flip-tabs-forward&quot; or &quot;flip-tabs-backwards&quot;</span>

  chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">{</span>currentWindow<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">tabs</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Sort tabs according to their index in the window.</span>
    tabs<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>index <span class="token operator">-</span> b<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> activeIndex <span class="token operator">=</span> tabs<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tab</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> tab<span class="token punctuation">.</span>active<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> lastTab <span class="token operator">=</span> tabs<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> newIndex <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>command <span class="token operator">===</span> <span class="token string">&#39;flip-tabs-forward&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newIndex <span class="token operator">=</span> activeIndex <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> lastTab <span class="token operator">:</span> activeIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// &#39;flip-tabs-backwards&#39;</span>
      newIndex <span class="token operator">=</span> activeIndex <span class="token operator">===</span> lastTab <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> activeIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>tabs<span class="token punctuation">[</span>newIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token punctuation">{</span>active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> highlighted<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>ğŸ’¡ å½“æ–°å®‰è£…çš„æ‰©å±•ç¨‹åºçš„å¿«æ·é”®é»˜è®¤å€¼ï¼Œä¸å·²å®‰è£…çš„å…¶ä»–æ‰©å±•ç¨‹åºçš„å¿«æ·é”®å†²çªæ—¶ï¼Œå¯¹äºåæ¥å®‰è£…çš„æ‰©å±•ç¨‹åºï¼Œæµè§ˆå™¨å°±ä¸ä¼šå†æ³¨å†Œè¿™äº›å¿«æ·é”®ï¼Œé¿å…è¦†ç›–ä¹‹å‰å·²å­˜åœ¨çš„å¿«æ·é”®ã€‚ä¸ºäº†é¿å…è®©ç”¨æˆ·è§‰å¾—å¿«æ·é”®ã€Œæ— æ•…å¤±çµã€çš„ç°è±¡ï¼Œæˆ‘ä»¬åº”è¯¥é‡‡ç”¨ä»¥ä¸‹æ›´å¥å£®çš„æ–¹æ³•ï¼Œåœ¨å®‰è£…æ‰©å±•ç¨‹åºæ—¶ <code>chrome.runtime.onInstalled.addListener</code> å…ˆè¿›è¡Œæ£€æŸ¥å¿«æ·é”®å†²çªï¼Œå¹¶å‘ŠçŸ¥ç”¨æˆ·</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>

<span class="token comment">// Only use this function during the initial install phase. After</span>
<span class="token comment">// installation the user may have intentionally unassigned commands.</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onInstalled<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">===</span> chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>OnInstalledReason<span class="token punctuation">.</span><span class="token constant">INSTALL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">checkCommandShortcuts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">checkCommandShortcuts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è·å–å½“å‰æ’ä»¶å·²æ³¨å†Œçš„å¿«æ·é”®</span>
  chrome<span class="token punctuation">.</span>commands<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">commands</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> missingShortcuts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> <span class="token punctuation">{</span>name<span class="token punctuation">,</span> shortcut<span class="token punctuation">}</span> <span class="token keyword">of</span> commands<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å¦‚æœå†²çªæ— æ³•æ³¨å†Œå¿«æ·é”®é»˜è®¤å€¼ï¼Œåˆ™ shortcut å€¼ä¸ºç©ºå­—ç¬¦ä¸²</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>shortcut <span class="token operator">===</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        missingShortcuts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// å¦‚æœè¯¥æ‰©å±•ç¨‹åºä¸å…¶ä»–æ‰©å±•ç¨‹åºçœŸçš„å­˜åœ¨å¿«æ·é”®å†²çª</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>missingShortcuts<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Update the extension UI to inform the user that one or more</span>
      <span class="token comment">// commands are currently unassigned.</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div></li><li><p>å¿«æ·é”®<strong>å¿…é¡»åŒ…å« <code>Ctrl</code> æˆ– <code>Alt</code> ä¸¤è€…ä¹‹ä¸€</strong>ï¼Œå¯¹<strong>å¤§å°å†™æ•æ„Ÿ</strong>ï¼Œæ”¯æŒä½¿ç”¨ä»¥ä¸‹æŒ‰é”®ç»„åˆä¸ºå¿«æ·é”®ï¼š</p><ul><li>å­—æ¯é”® <code>A-Z</code></li><li>æ•°å­—é”® <code>0~9</code></li><li>æ ‡å‡†çš„åŠŸèƒ½é”® <ul><li>é€šç”¨é”® <code>Comma</code>, <code>Period</code>, <code>Home</code>, <code>End</code>, <code>PageUp</code>, <code>PageDown</code>, <code>Space</code>, <code>Insert</code>, <code>Delete</code></li><li>æ–¹å‘é”® <code>Up</code>, <code>Down</code>, <code>Left</code>, <code>Right</code></li></ul></li><li>ä¿®é¥°é”® <code>Ctrl</code>, <code>Alt</code>, <code>Shift</code>, <code>MacCtrl</code> (macOS only), <code>Command</code> (macOS only), <code>Search</code> (Chrome OS only)</li></ul><p>ğŸ’¡ ä¸æ”¯æŒ <code>Tab</code> é”®ï¼Œåª’ä½“é”®<strong>ä¸</strong>èƒ½ä¸ä¿®é¥°é”®ç»„åˆã€‚</p></li><li><p>ä¸ºäº†å“åº”å¿«æ·é”®ï¼Œéœ€è¦åœ¨<strong>åå°è„šæœ¬</strong>ä¸­ä½¿ç”¨ <code>chrome.commands.onCommand.addListener</code> API è¿›è¡Œç›‘å¬</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>commands<span class="token punctuation">.</span>onCommand<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">command</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Command: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>command<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>ğŸ’¡ å’Œæ ‡å‡†çš„å¿«æ·é”® standard commands ä¸åŒï¼Œå¯¹äºæ¿€æ´» action çš„å¿«æ·é”®ï¼Œ<strong>æ— æ³•</strong>é€šè¿‡ä»¥ä¸Šæ–¹æ³•è¿›è¡Œç›‘å¬ã€‚å¯ä»¥åœ¨å¼¹å‡ºæ¡† popup çš„è„šæœ¬æ–‡ä»¶ä¸­ï¼Œç›‘å¬ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/DOMContentLoaded_event" target="_blank" rel="noopener noreferrer"><code>DOMContentLoaded</code> äº‹ä»¶</a>æ¥æ›¿ä»£ã€‚</p></li><li><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ³¨å†Œçš„å¿«æ·é”®æ˜¯ Chrome æµè§ˆå™¨çš„å±€éƒ¨å¿«æ·é”®ï¼ˆå½“æµè§ˆå™¨æ˜¯å½“å‰ç³»ç»Ÿçš„æ¿€æ´»åº”ç”¨æ—¶ï¼ŒæŒ‰ä¸‹å¿«æ·é”®ï¼Œæ‰©å±•ç¨‹åºæ‰å“åº”ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨å¿«æ·é”®å®šä¹‰å¯¹è±¡ä¸­ï¼Œé€šè¿‡é€‰é¡¹ <code>global: true</code> è®¾å®šä¸ºå…¨å±€å¿«æ·é”®ã€‚<strong>å»ºè®®æ³¨å†Œå…¨å±€å¿«æ·é”®é™åˆ¶åœ¨ <code>Ctrl+Shift+[0..9]</code> èŒƒå›´ä¸­</strong>ï¼Œä»¥é¿å…è¦†ç›–æ‰å…¶ä»–ç³»ç»Ÿçº§åˆ«çš„å¿«æ·é”®ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;commands&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;toggle-feature-foo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;suggested_key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Ctrl+Shift+5&quot;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Toggle feature foo&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;global&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ğŸ’¡ ä½†æ˜¯ Chrome OS ä¸æ”¯æŒæ‰©å±•ç¨‹åºè®¾å®šå…¨å±€å¿«æ·é”®</p></li></ul><h2 id="å®šåˆ¶æµè§ˆå™¨ä½“éªŒ" tabindex="-1"><a class="header-anchor" href="#å®šåˆ¶æµè§ˆå™¨ä½“éªŒ" aria-hidden="true">#</a> å®šåˆ¶æµè§ˆå™¨ä½“éªŒ</h2><p>æ‰©å±•ç¨‹åºå¯ä»¥ä½¿ç”¨å¾ˆå¤šç›¸å…³çš„ API ä»¥å®šåˆ¶æµè§ˆå™¨ä½“éªŒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/bookmarks/" target="_blank" rel="noopener noreferrer">Bookmarks</a> ä¹¦ç­¾ç®¡ç†</li><li><a href="https://developer.chrome.com/docs/extensions/reference/browsingData/" target="_blank" rel="noopener noreferrer">Browsing Data</a> ç”¨æˆ·æµè§ˆæ•°æ®</li><li><a href="https://developer.chrome.com/docs/extensions/reference/downloads/" target="_blank" rel="noopener noreferrer">Downloads</a> ä¸‹è½½é¡¹ç®¡ç†</li><li><a href="https://developer.chrome.com/docs/extensions/reference/fontSettings/" target="_blank" rel="noopener noreferrer">Font Settings</a> å­—ä½“è®¾ç½®</li><li><a href="https://developer.chrome.com/docs/extensions/reference/history/" target="_blank" rel="noopener noreferrer">History</a> æµè§ˆå†å²è®°å½•</li><li><a href="https://developer.chrome.com/docs/extensions/reference/privacy/" target="_blank" rel="noopener noreferrer">Privacy</a> éšç§æƒé™è®¾ç½®</li><li><a href="https://developer.chrome.com/docs/extensions/reference/proxy/" target="_blank" rel="noopener noreferrer">Proxy</a> ä»£ç†è®¾ç½®</li><li><a href="https://developer.chrome.com/docs/extensions/reference/sessions/" target="_blank" rel="noopener noreferrer">Sessions</a> ä»æµè§ˆä¼šè¯ä¸­æŸ¥è¯¢å’Œæ¢å¤æ ‡ç­¾é¡µæˆ–çª—å£</li><li><a href="https://developer.chrome.com/docs/extensions/reference/tabs/" target="_blank" rel="noopener noreferrer">Tabs</a> åˆ›å»ºã€ä¿®æ”¹ã€é‡æ’æ ‡ç­¾é¡µ</li><li><a href="https://developer.chrome.com/docs/extensions/reference/topSites/" target="_blank" rel="noopener noreferrer">Top Sites</a> è®¿é—®ç”¨æˆ·æœ€å¸¸æµè§ˆçš„ç½‘é¡µ</li><li><a href="https://developer.chrome.com/docs/extensions/mv3/themes/" target="_blank" rel="noopener noreferrer">Themes</a> æ”¹å˜æµè§ˆå™¨å¤–è§‚ä¸ä¸»é¢˜</li><li><a href="https://developer.chrome.com/docs/extensions/reference/windows/" target="_blank" rel="noopener noreferrer">Windows</a> åˆ›å»ºã€ä¿®æ”¹ã€é‡æ’æµè§ˆå™¨çª—å£</li></ul><h3 id="bookmarks" tabindex="-1"><a class="header-anchor" href="#bookmarks" aria-hidden="true">#</a> Bookmarks</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/bookmarks/" target="_blank" rel="noopener noreferrer"><code>Chrome.bookmarks</code> API</a></li><li>å…³äº Bookmarks çš„<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/api/action" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a><ul><li><a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/bookmarks/basic" target="_blank" rel="noopener noreferrer">bookmarks basic</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li><li><a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/examples/bookmarks" target="_blank" rel="noopener noreferrer">bookmarks</a></li></ul></li></ul><p>å¯ä»¥ä½¿ç”¨æ‰©å±•ç¨‹åºå®šåˆ¶æµè§ˆå™¨çš„ä¹¦ç­¾ç®¡ç†è¡Œä¸ºã€‚é™¤äº†å¯ä»¥ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/mv3/override/" target="_blank" rel="noopener noreferrer">è¦†å†™é¡µé¢ Override Page</a> çš„æ–¹å¼<strong>å®šåˆ¶ä¹¦ç­¾ç®¡ç†é¡µé¢</strong>ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>Chrome.bookmarks</code> ä¸€äº›åˆ— API æ“ä½œä¹¦ç­¾ã€‚</p><p>å¦‚æœè¦ä½¿ç”¨ <code>Chrome.bookmarks</code> APIï¼Œéœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>permissions</code> ä¸­è¿›è¡Œæƒé™å£°æ˜æ³¨å†Œ</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;bookmarks&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¹¦ç­¾æ•°æ®æ˜¯ä»¥<strong>æ ‘å½¢</strong>ç»“æ„ç»„ç»‡çš„ï¼Œæ¯ä¸€ä¸ª<a href="https://developer.chrome.com/docs/extensions/reference/bookmarks/#type-BookmarkTreeNode" target="_blank" rel="noopener noreferrer">èŠ‚ç‚¹å¯¹è±¡ <code>bookmarks.BookmarkTreeNode</code></a> æ˜¯ä¸€ä¸ªä¹¦ç­¾æˆ–ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ˆä¹Ÿç§°ä¸ºç»„ï¼‰ï¼Œå®ƒå…·æœ‰å¤šç§<a href="https://developer.chrome.com/docs/extensions/reference/bookmarks/#type-BookmarkTreeNode" target="_blank" rel="noopener noreferrer">å±æ€§</a>ï¼Œä»¥ä¸‹åˆ—å‡ºå¸¸ç”¨çš„å‡ ä¸ªï¼š</p><ul><li><code>children</code> å­èŠ‚ç‚¹åˆ—è¡¨</li><li><code>id</code> ï¼ˆå¿…é¡»ï¼‰å”¯ä¸€æ ‡è¯†ç¬¦</li><li><code>index</code> åœ¨çˆ¶çº§æ–‡ä»¶å¤¹ä¸­çš„ç´¢å¼•ï¼ˆä» <code>0</code> å¼€å§‹ï¼‰</li><li><code>parentId</code> çˆ¶çº§æ–‡ä»¶å¤¹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆ<strong>æ ¹èŠ‚ç‚¹</strong>çœç•¥è¯¥å±æ€§ï¼‰</li><li><code>title</code> ï¼ˆå¿…é¡»ï¼‰èŠ‚ç‚¹æ‰€å±•ç¤ºçš„åç§°</li><li><code>url</code> ä¹¦ç­¾çš„é“¾æ¥ï¼Œæ–‡ä»¶å¤¹å¯ä»¥çœç•¥è¯¥å±æ€§</li></ul><p>âš ï¸ æ ¹èŠ‚ç‚¹æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸èƒ½åˆ é™¤ï¼Œä¸”åªèƒ½æœ‰ä¸€ä¸ªã€‚ è€Œä¸”ä¸èƒ½é‡å‘½åç‰¹æ®Šçš„èŠ‚ç‚¹ï¼ˆæ–‡ä»¶å¤¹ï¼‰ğŸ“ ä¹¦ç­¾æ  <code>Bookmarks Bar</code> å’Œ ğŸ“ å…¶ä»–ä¹¦ç­¾ <code>Other Bookmarks</code></p><p>ä½¿ç”¨æ–¹æ³• <code>chrome.bookmarks.create()</code> åˆ›å»ºä¸€ä¸ªä¹¦ç­¾èŠ‚ç‚¹ï¼Œæ¥æ”¶ä¸¤ä¸ªå…¥å‚ï¼Œç¬¬ä¸€ä¸ªæ˜¯èŠ‚ç‚¹çš„å±æ€§ï¼Œç¬¬äºŒä¸ªï¼ˆå¯é€‰ï¼‰å‚æ•°æ˜¯å›è°ƒå‡½æ•°</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œåä¸º Extension bookmarks</span>
chrome<span class="token punctuation">.</span>bookmarks<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span><span class="token string">&#39;parentId&#39;</span><span class="token operator">:</span> bookmarkBar<span class="token punctuation">.</span>id<span class="token punctuation">,</span> <span class="token string">&#39;title&#39;</span><span class="token operator">:</span> <span class="token string">&#39;Extension bookmarks&#39;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newFolder</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;added folder: &quot;</span> <span class="token operator">+</span> newFolder<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»ºä¸€ä¸ªä¹¦ç­¾ï¼Œåä¸º Extensions docï¼Œé“¾æ¥ä¸º https://developer.chrome.com/docs/extensions</span>
chrome<span class="token punctuation">.</span>bookmarks<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&#39;parentId&#39;</span><span class="token operator">:</span> extensionsFolderId<span class="token punctuation">,</span>
  <span class="token string">&#39;title&#39;</span><span class="token operator">:</span> <span class="token string">&#39;Extensions doc&#39;</span><span class="token punctuation">,</span>
  <span class="token string">&#39;url&#39;</span><span class="token operator">:</span> <span class="token string">&#39;https://developer.chrome.com/docs/extensions&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="browsing-data" tabindex="-1"><a class="header-anchor" href="#browsing-data" aria-hidden="true">#</a> Browsing Data</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/browsingData/" target="_blank" rel="noopener noreferrer"><code>chrome.browsingData</code> API</a></li><li>å…³äº Browsing Data çš„<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/browsingData/basic" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li></ul><p>æ‰©å±•ç¨‹åºå¯ä»¥åˆ é™¤ç‰¹å®šæ—¶é—´æ®µçš„ç”¨æˆ·æµè§ˆæ•°æ®ã€‚</p><p>å¦‚æœè¦ä½¿ç”¨ <code>Chrome.bookmarks</code> APIï¼Œéœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>permissions</code> ä¸­è¿›è¡Œæƒé™å£°æ˜æ³¨å†Œ</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;browsingData&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä½¿ç”¨æ–¹æ³• <code>chrome.browsingData.remove()</code> åˆ é™¤ç”¨æˆ·æµè§ˆæ•°æ®ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åˆ é™¤ä¸€å‘¨ä»¥æ¥çš„æ•°æ®</span>
<span class="token keyword">const</span> millisecondsPerWeek <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> oneWeekAgo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> millisecondsPerWeek<span class="token punctuation">;</span>

<span class="token comment">// åˆ é™¤æ‰€æœ‰ç”¨æˆ·æ“ä½œæ•°æ®</span>
chrome<span class="token punctuation">.</span>browsingData<span class="token punctuation">.</span><span class="token function">removeCookies</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;since&quot;</span><span class="token operator">:</span> oneWeekAgo
<span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Do something clever here once data has been removed.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ğŸ’¡ åˆ é™¤ç”¨æˆ·æ•°æ®å¯èƒ½éœ€è¦è¾ƒé•¿çš„æ—¶é—´ï¼ˆåŸºäºç”¨æˆ·äº§ç”Ÿäº†å¤šå°‘æ“ä½œå†å²æ•°æ®ï¼‰ï¼Œå› æ­¤æ¨èè®¾ç½®å›è°ƒå‡½æ•°ï¼ˆå®ƒåœ¨æ¸…é™¤å®Œæˆåæ‰§è¡Œï¼‰ï¼Œä»¥å‘ŠçŸ¥ç”¨æˆ·æœ€æ–°çš„çŠ¶æ€ã€‚</p><p>âš ï¸ æ–¹æ³• <code>chrome.browsingData.remove()</code> å¯èƒ½åœ¨æ¸…é™¤å®Œ cookie åè‡ªåŠ¨è®¾ç½®å®ƒä»¬ï¼Œä»¥ä¾¿è®©è´¦æˆ·çš„æ•°æ®åŒæ­¥åŠŸèƒ½æ­£å¸¸è¿ä½œï¼Œè¿™æ ·æ‰å¯ä»¥è®©æœåŠ¡å™¨ä¸­å·²åŒæ­¥çš„ç›¸åº”æ•°æ®ä¹Ÿè¦†ç›–æ¸…é™¤æ‰ï¼›è€Œä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/reference/browsingData/#method-removeCookies" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.browsingData.removeCookies</code></a> æ¸…é™¤ cookie æ—¶ï¼Œä¼šåœæ­¢åŒæ­¥åŠŸèƒ½ã€‚</p><p>ğŸ’¡ å¯ä»¥ä¼ é€’ä¸€ä¸ª JSON å½¢å¼çš„å¯¹è±¡ï¼ŒæŒ‡å®šéœ€è¦åˆ é™¤å“ªå‡ ç§æµè§ˆå™¨æ•°æ®ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨<a href="https://developer.chrome.com/docs/extensions/reference/browsingData/#methods" target="_blank" rel="noopener noreferrer">å¯¹åº”çš„æ–¹æ³•</a>æ¥åˆ é™¤ç›¸åº”ç±»å‹çš„ç”¨æˆ·æ•°æ®ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åˆ é™¤æŒ‡å®šçš„ç”¨æˆ·æ“ä½œæ•°æ®</span>
chrome<span class="token punctuation">.</span>browsingData<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;since&quot;</span><span class="token operator">:</span> oneWeekAgo
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;appcache&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;cache&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;cacheStorage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;cookies&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;downloads&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;fileSystems&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;formData&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;history&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;indexedDB&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;localStorage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;passwords&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;serviceWorkers&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;webSQL&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>ğŸ’¡ è¿˜å¯ä»¥åˆ é™¤åœ¨æŒ‡å®šç½‘é¡µï¼ˆæˆ–ä¸åŒ…å«æŒ‡å®šç½‘é¡µï¼‰ä¸‹çš„ç”¨æˆ·æ•°æ®ï¼ˆé€‚ç”¨äºcookiesã€cacheã€storage (CacheStorage, FileSystems, IndexedDB, LocalStorage, ServiceWorkers, and WebSQL) ç±»å‹çš„æ•°æ®ï¼‰ï¼Œå¯ä»¥åœ¨æ–¹æ³• <code>chrome.browsingData.remove()</code> çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸­è®¾ç½®é€‰é¡¹ <code>origins</code> æˆ– <code>excludeOrigins</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>chrome<span class="token punctuation">.</span>browsingData<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;origins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://www.example.com&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;cacheStorage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;cookies&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;fileSystems&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;indexedDB&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;localStorage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;serviceWorkers&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string">&quot;webSQL&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>ç”±äº cookies æ˜¯åŸºäºåŸŸåçš„ï¼Œæ‰€ä»¥åˆ é™¤ç‰¹å®šç½‘é¡µçš„ cookies æ—¶ä¼šåˆ é™¤è¯¥åŸŸåä¸‹çš„æ‰€æœ‰ cookiesï¼Œä¾‹å¦‚åˆ é™¤ <code>https://www.example.com</code> ä¼šåˆ é™¤ <code>.example.com</code> åŸŸåä¸‹æ‰€æœ‰çš„ cookieã€‚</p><h3 id="downloads" tabindex="-1"><a class="header-anchor" href="#downloads" aria-hidden="true">#</a> Downloads</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/downloads/" target="_blank" rel="noopener noreferrer"><code>chrome.downloads</code> API</a></li><li>å…³äº Downloads çš„<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/downloads" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li></ul><p>æ‰©å±•ç¨‹åºå¯ä»¥å¯¹æµè§ˆå™¨ä¸­çš„ä¸‹è½½åŠŸèƒ½è¿›è¡Œæ“ä½œï¼Œé€šè¿‡ <code>chrome.downloads</code> API å¯ä»¥å¯åŠ¨ã€ç›‘æ§ã€æ“ä½œå’Œæœç´¢ä¸‹è½½é¡¹ã€‚</p><p>å¦‚æœè¦ä½¿ç”¨ <code>Chrome.downloads</code> APIï¼Œéœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>permissions</code> ä¸­è¿›è¡Œæƒé™å£°æ˜æ³¨å†Œ</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;downloads&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="history" tabindex="-1"><a class="header-anchor" href="#history" aria-hidden="true">#</a> History</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/history/" target="_blank" rel="noopener noreferrer"><code>chrome.history</code> API</a></li><li>å…³äº History çš„<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/history" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li></ul><p>æ‰©å±•ç¨‹åºå¯ä»¥æ“ä½œæµè§ˆå™¨çš„å†å²è®°å½•ã€‚é™¤äº†å¯ä»¥ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/mv3/override/" target="_blank" rel="noopener noreferrer">è¦†å†™é¡µé¢ Override Page</a> çš„æ–¹å¼<strong>å®šåˆ¶å†å²è®°å½•é¡µé¢</strong>ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>Chrome.history</code> ä¸€äº›åˆ— API æ“ä½œå†å²è®°å½•ã€‚</p><p>å¦‚æœè¦ä½¿ç”¨ <code>Chrome.history</code> APIï¼Œéœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>permissions</code> ä¸­è¿›è¡Œæƒé™å£°æ˜æ³¨å†Œ</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;history&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ğŸ’¡ æµè§ˆçš„å†å²è®°å½•æ˜¯é€šè¿‡<a href="https://developer.chrome.com/docs/extensions/reference/history/#transition-types" target="_blank" rel="noopener noreferrer">ä¸åŒç±»å‹çš„é¡µé¢è·³è½¬ transition type</a> æ‰€äº§ç”Ÿçš„ï¼Œä¾‹å¦‚ç”¨æˆ·ä»ä¸€ä¸ªç½‘é¡µä¸­ç‚¹å‡»ä¸€ä¸ªé“¾æ¥è·³è½¬åˆ°å¦ä¸€ä¸ªç½‘é¡µï¼Œè¿™æ—¶å€™äº§ç”Ÿçš„å†å²è®°å½•çš„ç±»å‹æ˜¯ <code>link</code>ã€‚</p><h3 id="tabs" tabindex="-1"><a class="header-anchor" href="#tabs" aria-hidden="true">#</a> Tabs</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/tabs/" target="_blank" rel="noopener noreferrer"><code>chrome.tabs</code> API</a></li><li>å…³äº Tabs çš„<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/downloads" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li></ul><p>æ‰©å±•ç¨‹åºå¯ä»¥åˆ›å»ºã€ä¿®æ”¹ã€é‡æ’æ ‡ç­¾é¡µã€‚</p><p>è™½ç„¶ä½¿ç”¨ <code>Chrome.tabs</code> éƒ¨åˆ†çš„ API å¯ä»¥ä¸è¿›è¡Œæƒé™å£°æ˜ï¼Œä½†æ˜¯ä»<strong>æ¨è</strong>åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>permissions</code> ä¸­è¿›è¡Œæƒé™å£°æ˜æ³¨å†Œï¼Œå› ä¸ºéœ€è¦è®¿é—®æ ‡ç­¾çš„å±æ€§ <code>url</code>ã€<code>pendingUrl</code>ã€<code>title</code>ã€<code>favIconUrl</code> æ—¶æ˜¯éœ€è¦æƒé™è®¸å¯çš„ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;tabs&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š</p><ul><li><p>ä½¿ç”¨æ–¹æ³• <code>chrome.tabs.create()</code> åœ¨æ–°çš„æ ‡ç­¾é¡µæ‰“å¼€ä¸€ä¸ªç½‘é¡µ</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
<span class="token comment">// å¯ä»¥åœ¨å®‰è£…æˆåŠŸåï¼Œæ‰“å¼€æ‰©å±•ç¨‹åºçš„ä»‹ç»é¡µé¢</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onInstalled<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>reason <span class="token operator">===</span> chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>OnInstalledReason<span class="token punctuation">.</span><span class="token constant">INSTALL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      url<span class="token operator">:</span> <span class="token string">&#39;onboarding.html&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>âš ï¸ å†…å®¹è„šæœ¬ content scripts <strong>ä¸</strong>èƒ½ä½¿ç”¨æ–¹æ³• <code>chrome.tabs.create()</code></p></li><li><p>ä½¿ç”¨æ–¹æ³• <code>chrome.tabs.query({ active: true, currentWindow: true })</code> è·å–ç¬¦åˆæ¡ä»¶çš„æ ‡ç­¾é¡µ</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getCurrentTab</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> queryOptions <span class="token operator">=</span> <span class="token punctuation">{</span> active<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> currentWindow<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// æŸ¥è¯¢è¿”å›çš„æ˜¯ç¬¦åˆæ¡ä»¶çš„æ ‡ç­¾é¡µå¯¹è±¡åˆ—è¡¨ï¼Œå½“å‰é¡µé¢åªæœ‰ä¸€ä¸ªï¼Œå¯ä»¥ç›´æ¥ç”¨è§£æ„æ¥è·å–</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>tab<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>queryOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> tab<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>âš ï¸ å†…å®¹è„šæœ¬ content scripts <strong>ä¸</strong>èƒ½ä½¿ç”¨æ–¹æ³• <code>chrome.tabs.query()</code></p></li><li><p>ä½¿ç”¨æ–¹æ³• <code>chrome.tabs.update()</code> æ›´æ–°æ ‡ç­¾é¡µé¢çš„çŠ¶æ€</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
<span class="token keyword">function</span> <span class="token function">toggleMuteState</span><span class="token punctuation">(</span><span class="token parameter">tabId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">tab</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// è·å–æ ‡ç­¾é¡µçš„é™éŸ³çŠ¶æ€ï¼Œå¹¶è¿›è¡Œåˆ‡æ¢</span>
    <span class="token keyword">let</span> muted <span class="token operator">=</span> <span class="token operator">!</span>tab<span class="token punctuation">.</span>mutedInfo<span class="token punctuation">.</span>muted<span class="token punctuation">;</span>
    <span class="token comment">// æ›´æ–°æ ‡ç­¾é¡µçš„é™éŸ³çŠ¶æ€</span>
    <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span> muted <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Tab </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>tab<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> muted <span class="token operator">?</span> <span class="token string">&#39;muted&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;unmuted&#39;</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>âš ï¸ å†…å®¹è„šæœ¬ content scripts <strong>ä¸</strong>èƒ½ä½¿ç”¨æ–¹æ³• <code>chrome.tabs.get()</code> å’Œ <code>chrome.tabs.update()</code></p></li><li><p>ä½¿ç”¨æ–¹æ³• <code>chrome.tabs.move()</code> é‡æ’æ ‡ç­¾é¡µ</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
<span class="token comment">// ç›‘å¬æ ‡ç­¾é¡µæ¿€æ´»äº‹ä»¶ï¼ˆç‚¹å‡»æµè§ˆå™¨æœ€é¡¶éƒ¨ä¸€æ è¿›è¡Œæ ‡ç­¾é¡µåˆ‡æ¢æ—¶è§¦å‘ï¼‰</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span>onActivated<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token parameter">activeInfo</span> <span class="token operator">=&gt;</span> <span class="token function">move</span><span class="token punctuation">(</span>activeInfo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å°†æ¿€æ´»çš„æ ‡ç­¾é¡µç§»åˆ°ç¬¬ä¸€çš„ä½ç½®</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token parameter">activeInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>activeInfo<span class="token punctuation">.</span>tabId<span class="token punctuation">,</span> <span class="token punctuation">{</span>index<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Success.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// å¦‚æœç”¨æˆ·åœ¨æ‹–æ‹½æ ‡ç­¾é¡µæ—¶</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">==</span> <span class="token string">&#39;Error: Tabs cannot be edited right now (user may be dragging a tab).&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">move</span><span class="token punctuation">(</span>activeInfo<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul><h3 id="windows" tabindex="-1"><a class="header-anchor" href="#windows" aria-hidden="true">#</a> Windows</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/windows/" target="_blank" rel="noopener noreferrer"><code>chrome.windows</code> API</a></li><li>å…³äº Windows çš„å®˜æ–¹ç¤ºä¾‹ <ul><li><a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/windows/merge_windows" target="_blank" rel="noopener noreferrer">merge_windows</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li><li><a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/tabs/inspector" target="_blank" rel="noopener noreferrer">inspector</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li></ul></li></ul><p>æ‰©å±•ç¨‹åºå¯ä»¥åˆ›å»ºã€ä¿®æ”¹ã€é‡æ’æµè§ˆå™¨çª—å£ã€‚</p><p>ç”±äºä½¿ç”¨ <code>Chrome.windows</code> API æ—¶ï¼Œä¼šè·å–æ ‡ç­¾é¡µçš„ç›¸å…³ä¿¡æ¯ ï¼Œæ‰€ä»¥éœ€è¦å…ˆåœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>permissions</code> ä¸­è¿›è¡Œ <code>tabs</code> çš„æƒé™å£°æ˜ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;tabs&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ğŸ’¡ å½“å‰çª—å£æ˜¯æŒ‡ç›®å‰æ‰©å±•ç¨‹åºæ‰§è¡Œä»£ç æ‰€åœ¨çš„çª—å£ï¼Œè€Œä¸ä¸€å®šæ˜¯æµè§ˆå™¨çš„ç½®é¡¶çª—å£æˆ–å½“å‰èšç„¦çª—å£ï¼Œä¾‹å¦‚æ‰©å±•ç¨‹åºåœ¨ä¸€ä¸ªçª—å£ä¸­æ‰“å¼€äº†ä¸€ä¸ª HTML æ–‡æ¡£ï¼Œåœ¨æ–‡æ¡£ä¸­è°ƒç”¨äº† <code>chrome.tabs.query()</code> æ–¹æ³•ï¼Œåˆ™<strong>å½“å‰çª—å£</strong>æ˜¯æŒ‡è¯¥ HTML æ–‡æ¡£æ‰€åœ¨çš„çª—å£ã€‚æœ‰äº›æƒ…å†µä¸‹å¯¹äºåå°è„šæœ¬æ²¡æœ‰ç›¸åº”çš„å½“å‰çª—å£ã€‚</p><h2 id="å®šåˆ¶ç½‘é¡µä½“éªŒ" tabindex="-1"><a class="header-anchor" href="#å®šåˆ¶ç½‘é¡µä½“éªŒ" aria-hidden="true">#</a> å®šåˆ¶ç½‘é¡µä½“éªŒ</h2><p>æ‰©å±•ç¨‹åºå¯ä»¥ä½¿ç”¨å¾ˆå¤šç›¸å…³çš„ API ä»¥å®šåˆ¶ç½‘é¡µçš„ä½“éªŒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/mv3/manifest/activeTab/" target="_blank" rel="noopener noreferrer">Active Tab</a> å¯ä»¥ç›´æ¥è®¿é—®å½“å‰çš„æ¿€æ´»æ ‡ç­¾é¡µï¼Œè€Œä¸éœ€è¦å…ˆä¸ºç‰¹å®šçš„åŸŸåè®¾ç½®æƒé™ <code>host_permission</code>ï¼ˆæˆ–ä½¿ç”¨ <code>&lt;all_urls&gt;</code> ä¸ºæ‰€æœ‰åŸŸåè®¾ç½®æƒé™ï¼‰</li><li><a href="https://developer.chrome.com/docs/extensions/reference/contentSettings/" target="_blank" rel="noopener noreferrer">Content Settings</a> è®¾ç½®ç½‘é¡µå¯ä»¥è¿è¡Œçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ cookiesã€JavaScriptã€pluginsã€camera ç­‰è®¸å¯è®¾ç½® ğŸ’¡<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/c2437ba5364f92e8f0276f9213fdbe7ff0f4fb64/mv2-archive/api/contentSettings" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li><li><a href="https://developer.chrome.com/docs/extensions/mv3/content_scripts/" target="_blank" rel="noopener noreferrer">Content Scripts</a> å†…å®¹è„šæœ¬ï¼Œæ¤å…¥åˆ°ç½‘é¡µä¸­è¿è¡Œçš„è„šæœ¬</li><li><a href="https://developer.chrome.com/docs/extensions/reference/cookies/" target="_blank" rel="noopener noreferrer">Cookies</a> è·å–æˆ–ä¿®æ”¹ç›¸åº”åŸŸåä¸‹çš„ cookie ğŸ’¡ <a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/cookies" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li><li><a href="https://developer.chrome.com/docs/extensions/mv3/xhr/" target="_blank" rel="noopener noreferrer">Cross-Origin XHR</a> å‘è¿œç¨‹æœåŠ¡å™¨å‘é€å’Œæ¥æ”¶æ•°æ®</li><li><a href="https://developer.chrome.com/docs/extensions/reference/desktopCapture/" target="_blank" rel="noopener noreferrer">Desktop Capture</a> æ•è·å±å¹•ã€å•ä¸ªçª—å£æˆ–æ ‡ç­¾é¡µçš„å†…å®¹</li><li><a href="https://developer.chrome.com/docs/extensions/reference/pageCapture/" target="_blank" rel="noopener noreferrer">Page Capture</a> å°†æ ‡ç­¾é¡µçš„æºä¿¡æ¯ä¿å­˜ä¸º MHTML</li><li><a href="https://developer.chrome.com/docs/extensions/reference/tabCapture/" target="_blank" rel="noopener noreferrer">Tab Capture</a> ä¸æ ‡ç­¾é¡µçš„åª’ä½“æµè¿›è¡Œäº¤äº’</li><li><a href="https://developer.chrome.com/docs/extensions/reference/webNavigation/" target="_blank" rel="noopener noreferrer">Web Navigation</a> å®æ—¶æ›´æ–°å¯¼èˆªè¯·æ±‚çš„çŠ¶æ€ ğŸ’¡ <a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/webNavigation" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰</li><li><a href="https://developer.chrome.com/docs/extensions/reference/declarativeNetRequest/" target="_blank" rel="noopener noreferrer">Declarative Net Request</a> å£°æ˜è§„åˆ™è®© Chrome å®æ—¶æ‹¦æˆªã€é˜»æ­¢æˆ–ä¿®æ”¹ç½‘ç»œè¯·æ±‚ ğŸ’¡ <a href="https://developer.chrome.com/docs/extensions/reference/declarativeNetRequest/#example" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a></li></ul><h3 id="active-tab" tabindex="-1"><a class="header-anchor" href="#active-tab" aria-hidden="true">#</a> Active Tab</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/mv3/manifest/activeTab/" target="_blank" rel="noopener noreferrer">The activeTab permission</a></li><li>å…³äº Windows çš„<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/examples/page-redder" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a></li></ul><p>åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>permissions</code> ä¸­å£°æ˜ <code>activeTab</code> æƒé™ï¼Œå¯ä»¥<strong>ä¸´æ—¶è·å–è®¸å¯ï¼Œä»¥è®¿é—®å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µ</strong>ï¼Œå¹¶åœ¨å½“å‰é¡µé¢ä½¿ç”¨ <a href="https://developer.chrome.com/docs/extensions/reference/tabs/" target="_blank" rel="noopener noreferrer">tabs ç›¸å…³çš„ API</a>ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;activeTab&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ç”±äºæ‰©å±•ç¨‹åºçš„å¾ˆå¤šä½¿ç”¨åœºæ™¯éƒ½åªéœ€ä¸´æ—¶è®¿é—®å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç‰¹å®šçš„ç½‘é¡µï¼Œæ‰€ä»¥ä¸åŸºäº URL è§„åˆ™è·å–çš„æ°¸ä¹…è®¿é—®æƒé™ç›¸æ¯”ï¼Œè¯¥ç±»å‹çš„æƒé™æ›´å¸¸ç”¨ã€‚è¯¥æƒé™åŸºäºç”¨æˆ·çš„ä¸»åŠ¨è¯·æ±‚ä¸´æ—¶è·å–çš„ï¼ˆä¾‹å¦‚é€šè¿‡ç‚¹å‡» Action æ§ä»¶ï¼‰ï¼Œè€Œä¸”ä»…é™åˆ¶åœ¨å½“å‰æ¿€æ´»é¡µé¢ï¼Œç›¸å¯¹è€Œè¨€æ›´å®‰å…¨ã€‚</p><p>æ”¯æŒå¤šç§ç”¨æˆ·äº¤äº’æ–¹å¼æ¿€æ´» <code>activeTab</code> æƒé™ï¼Œä»¥ä¸å½“å‰æ ‡ç­¾é¡µè¿›è¡Œäº¤äº’ï¼š</p><ul><li><p>é€šè¿‡ <a href="#Action">Action</a></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ç‚¹å‡»æµè§ˆå™¨å·¥å…·æ ä¸Šçš„æ‰©å±•ç¨‹åºå›¾æ ‡</span>
chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span>onClicked<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tab</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// è·å–å½“å‰æ¿€æ´»çš„æ ‡ç­¾é¡µå¯¹è±¡</span>
  <span class="token comment">// å¹¶æ¤å…¥å†…å®¹è„šæœ¬</span>
  chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span> tabId<span class="token operator">:</span> tab<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token operator">:</span> reddenPage
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å°†ç½‘é¡µèƒŒæ™¯è‰²å˜ä¸ºç»¿è‰²</span>
<span class="token keyword">function</span> <span class="token function">reddenPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">&#39;green&#39;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li><li><p>é€šè¿‡ <a href="https://developer.chrome.com/docs/extensions/reference/contextMenus/" target="_blank" rel="noopener noreferrer">Context Menu</a></p></li><li><p>é€šè¿‡ <a href="#Commands">Commands</a></p></li><li><p>é€šè¿‡ <a href="#Omnibox">Omnibox</a></p></li></ul><p>ğŸ’¡ å½“å‰æ ‡ç­¾é¡µè·å–æƒé™åï¼Œå½“åç»­çš„å¯¼èˆªåœ¨åŒæº origin ä¸­è¿›è¡Œåˆ™æƒé™è¿˜ç”Ÿæ•ˆï¼Œä¾‹å¦‚å½“å‰é¡µé¢çš„ URL ä» <code>https://example.com</code> åˆ‡æ¢åˆ° <code>https://example.com/foo</code>ï¼›å¦‚æœå¯¼èˆªåˆ°å…¶ä»–æº originï¼Œæˆ–å…³é—­å½“å‰é¡µé¢åï¼Œæƒé™å°±éœ€è¦é‡æ–°è·å–ã€‚</p><p>ğŸ’¡ è¯¥æƒé™ä¸€èˆ¬ç”¨ä»¥æ›¿ä»£åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>host_permissions</code> ä¸­å£°æ˜çš„ <code>&lt;all_urls&gt;</code> æƒé™ï¼Œè¾¾åˆ°è®¿é—®ï¼ˆä»»æ„ urlï¼‰å½“å‰é¡µé¢çš„æ•ˆæœï¼Œè€Œä¸”<strong>ä¸ä¼šåœ¨å®‰è£…æ‰©å±•ç¨‹åºæ—¶å¼¹å‡ºè­¦å‘Š</strong>ã€‚</p><p><img src="/blog-web/assets/without-activetab.d43074e1.png" alt="without activeTab"></p><p><em>without activeTab</em></p><p><img src="/blog-web/assets/with-activetab.6d9e62d1.png" alt="with activeTab"></p><p><em>with activeTab</em></p><h3 id="content-scripts" tabindex="-1"><a class="header-anchor" href="#content-scripts" aria-hidden="true">#</a> Content Scripts</h3><p>å‚è€ƒï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/mv3/content_scripts/" target="_blank" rel="noopener noreferrer">Content scripts</a></li><li>å…³äº Windows çš„<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/examples/page-redder" target="_blank" rel="noopener noreferrer">å®˜æ–¹ç¤ºä¾‹</a></li></ul><h4 id="å¯ä½¿ç”¨çš„-api" tabindex="-1"><a class="header-anchor" href="#å¯ä½¿ç”¨çš„-api" aria-hidden="true">#</a> å¯ä½¿ç”¨çš„ API</h4><p>å†…å®¹è„šæœ¬ content script æ˜¯è¿è¡Œåœ¨é¡µé¢ä¸­çš„ JavaScript ä»£ç ï¼Œå®ƒé™¤äº†å¯ä»¥è®¿é—®é¡µé¢çš„ DOM å¯¹è±¡ï¼Œè¿˜å¯ä»¥ä»¥é€šè¿‡ä¿¡æ¯ä¼ é€’ message passing çš„æ–¹å¼ä¸æ‰©å±•ç¨‹åºè¿›è¡Œé€šè®¯ï¼Œå¯ä»¥å°†å®ƒçœ‹ä½œæ˜¯é¡µé¢ä¸æ‰©å±•ç¨‹åºä¹‹é—´çš„æ¡¥æ¢è§’è‰²ã€‚</p><p>é™¤äº†å€ŸåŠ©æ‰©å±•ç¨‹åºï¼ˆé€šè¿‡ message passing çš„æ–¹å¼ï¼‰é—´æ¥è°ƒç”¨ Chrome æä¾›çš„ APIï¼Œå®ƒè¿˜å¯ä»¥<strong>ç›´æ¥è®¿é—®</strong>éƒ¨åˆ† APIï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/reference/i18n/" target="_blank" rel="noopener noreferrer"><code>chrome.i18n</code> API</a></li><li><a href="https://developer.chrome.com/docs/extensions/reference/storage/" target="_blank" rel="noopener noreferrer"><code>chrome.storage</code> API</a></li><li>runtime API <ul><li><a href="https://developer.chrome.com/docs/extensions/reference/runtime#method-connect" target="_blank" rel="noopener noreferrer"><code>chrome.runtime.connect()</code></a> å‘èµ·ï¼ˆä¸æŒ‡å®šçš„æ‰©å±•ç¨‹åºé—´ï¼‰å»ºç«‹é•¿è¿æ¥çš„ä¿¡æ¯é€šé“çš„è¯·æ±‚ï¼›è€Œå¦‚æœæ˜¯ä»æ‰©å±•ç¨‹åºå‘èµ·é•¿è¿æ¥è¯·æ±‚ï¼Œåˆ™ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/reference/tabs/#method-connect" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.tabs.connect()</code></a>ã€‚</li><li><a href="https://developer.chrome.com/docs/extensions/reference/runtime#method-getManifest" target="_blank" rel="noopener noreferrer"><code>chrome.runtime.getManifest()</code></a> è¿”å›ä¸€ä¸ªæ‰©å±•ç¨‹åºçš„é…ç½®æ¸…å•å¯¹è±¡</li><li><a href="https://developer.chrome.com/docs/extensions/reference/runtime#method-getURL" target="_blank" rel="noopener noreferrer"><code>chrome.runtime.getURL(relatviePath)</code></a> å°†ç›¸å¯¹äºæ‰©å±•ç¨‹åºçš„è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„ï¼ˆåŸºäºæ‰©å±•ç¨‹åºçš„å®‰è£…ä¿¡æ¯ï¼‰</li><li><a href="https://developer.chrome.com/docs/extensions/reference/runtime#property-id" target="_blank" rel="noopener noreferrer"><code>id</code></a> æ‰©å±•ç¨‹åºçš„å”¯ä¸€æ ‡è¯†ç¬¦</li><li><a href="https://developer.chrome.com/docs/extensions/reference/runtime#event-onConnect" target="_blank" rel="noopener noreferrer"><code>chrome.runtime.onConnect</code></a> ç›‘å¬å¹¶å“åº”æ‰©å±•ç¨‹åºå‘èµ·é•¿è¿æ¥çš„è¯·æ±‚</li><li><a href="https://developer.chrome.com/docs/extensions/reference/runtime#event-onMessage" target="_blank" rel="noopener noreferrer"><code>chrome.runtime.onMessage</code></a> ç›‘å¬å•æ¬¡è¯·æ±‚ä¿¡æ¯</li><li><a href="https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage" target="_blank" rel="noopener noreferrer"><code>chrome.runtime.sendMessage</code></a> ä¼ é€’å•æ¬¡è¯·æ±‚ä¿¡æ¯</li></ul></li></ul><p>ä¾‹å¦‚å¯ä»¥å°†æ‰©å±•ç¨‹åºçš„é™æ€èµ„æºå±•ç¤ºåœ¨ç½‘é¡µä¸Š</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// Code for displaying &lt;extensionDir&gt;/images/myimage.png</span>

<span class="token comment">// è®¿é—®æ‰©å±•ç¨‹åºçš„é™æ€èµ„æºï¼ˆå›¾ç‰‡ï¼‰</span>
<span class="token keyword">var</span> imgURL <span class="token operator">=</span> chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span><span class="token string">&quot;images/myimage.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å°†å›¾ç‰‡å±•ç¤ºåœ¨è¿è¡Œç€å†…å®¹è„šæœ¬çš„é¡µé¢ä¸Š</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;someImage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> imgURL<span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="ç‹¬ç«‹è¿è¡Œç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#ç‹¬ç«‹è¿è¡Œç¯å¢ƒ" aria-hidden="true">#</a> ç‹¬ç«‹è¿è¡Œç¯å¢ƒ</h4><p>å†…å®¹è„šæœ¬ content script åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒä¸­æ‰§è¡Œï¼ˆç§æœ‰ä½œç”¨åŸŸï¼‰ï¼Œå› æ­¤é¡µé¢å’Œæ‰©å±•ç¨‹åºéƒ½<strong>æ— æ³•</strong>è®¿é—®å†…å®¹è„šæœ¬ content script çš„å˜é‡ï¼Œå¯ä»¥é¿å…ä¸é¡µé¢æˆ–æ‰©å±•ç¨‹åºçš„è„šæœ¬å‘ç”Ÿå†²çªã€‚</p><p>å¦‚æœé¡µé¢åŸæ¥å°±æœ‰ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»çš„äº‹ä»¶ç›‘å¬å™¨</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mybutton<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">const</span> greeting <span class="token operator">=</span> <span class="token string">&quot;hello, &quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;mybutton&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    button<span class="token punctuation">.</span>person_name <span class="token operator">=</span> <span class="token string">&quot;Bob&quot;</span><span class="token punctuation">;</span>
    button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token function">alert</span><span class="token punctuation">(</span>greeting <span class="token operator">+</span> button<span class="token punctuation">.</span>person_name <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>åœ¨å†…å®¹è„šæœ¬æ¤å…¥åˆ°é¡µé¢åï¼Œè®¾ç½®å¦ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»çš„äº‹ä»¶ç›‘å¬å™¨</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> greeting <span class="token operator">=</span> <span class="token string">&quot;hola, &quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;mybutton&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
button<span class="token punctuation">.</span>person_name <span class="token operator">=</span> <span class="token string">&quot;Roberto&quot;</span><span class="token punctuation">;</span>
button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>greeting <span class="token operator">+</span> button<span class="token punctuation">.</span>person_name <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ä¸¤ä¸ªè„šæœ¬äº’ä¸å†²çªï¼Œæ‰€ä»¥æœ€åç‚¹å‡»ä¸€æ¬¡æŒ‰é’®åï¼Œä¼šæœ‰ä¸¤æ¬¡ alert å¼¹å‡ºã€‚</p><p>âš ï¸ è™½ç„¶å†…å®¹è„šæœ¬ content scripts è¿è¡Œåœ¨ç‹¬ç«‹ç¯å¢ƒï¼Œä½†æ˜¯å®ƒå¯ä»¥ä¸ç½‘é¡µäº¤äº’çš„ç‰¹ç‚¹ï¼Œå¾ˆå¯èƒ½ä¼šè¢«æ¶æ„ç¨‹åºåˆ©ç”¨ï¼Œå› æ­¤åœ¨å†…å®¹è„šæœ¬ content scripts ä¸­è¯·æ±‚è®¿é—®å¤–éƒ¨æœåŠ¡å™¨çš„æ•°æ®æ—¶ï¼Œéœ€è¦<a href="https://developer.chrome.com/docs/extensions/mv3/content_scripts/#security" target="_blank" rel="noopener noreferrer">è°¨æ…</a>ï¼Œé¿å… <a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank" rel="noopener noreferrer">XSS æ”»å‡»</a>æˆ–<a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noopener noreferrer">ä¸­é—´äººæ”»å‡»</a>ã€‚</p><h4 id="æ¤å…¥è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#æ¤å…¥è„šæœ¬" aria-hidden="true">#</a> æ¤å…¥è„šæœ¬</h4><p>å†…å®¹è„šæœ¬ content script å¯ä»¥é€šè¿‡å£°æ˜çš„æ–¹å¼<strong>é™æ€æ¤å…¥</strong>ï¼Œæˆ–é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼<strong>åŠ¨æ€æ¤å…¥</strong>ï¼š</p><ul><li><p>é™æ€æ¤å…¥</p><p>åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>cjontent_scripts</code> ä¸­å£°æ˜çš„ JavaScript è„šæœ¬æ–‡ä»¶å’Œ CSS æ ·å¼æ–‡ä»¶ï¼Œä¼šæ¤å…¥åˆ°<a href="https://developer.chrome.com/docs/extensions/mv3/match_patterns/" target="_blank" rel="noopener noreferrer">åŒ¹é…</a>çš„ç½‘é¡µã€‚</p><ul><li>ï¼ˆå¿…é¡»ï¼‰å±æ€§ <code>match</code> æ˜¯åŒ…å«ä¸€ç³»åˆ—åŒ¹é…è§„åˆ™çš„æ•°ç»„ï¼Œç”¨ä»¥ç­›é€‰åŒ¹é…é‚£äº›ç½‘é¡µéœ€è¦é™æ€æ¤å…¥å†…å®¹è„šæœ¬</li><li>å±æ€§ <code>exclude_match</code> æ’é™¤åŒ¹é…çš„ç½‘é¡µ</li><li>å±æ€§ <code>css</code> å’Œæ˜¯åŒ…å«ä¸€ç³»åˆ—æ ·å¼æ–‡ä»¶ï¼ˆè·¯å¾„ï¼‰çš„æ•°ç»„ï¼Œæ ·å¼æ–‡ä»¶ä¼šåœ¨é¡µé¢çš„ DOM æ„å»ºå®Œæˆ<strong>ä¹‹å‰</strong>ï¼ŒæŒ‰ç…§æ•°ç»„å…ƒç´ çš„é¡ºåºä¾æ¬¡æ¤å…¥</li><li>å±æ€§ <code>js</code> æ˜¯åŒ…å«ä¸€ç³»åˆ—è„šæœ¬æ–‡ä»¶ï¼ˆè·¯å¾„ï¼‰çš„æ•°ç»„ï¼Œè„šæœ¬æŒ‰ç…§æ•°ç»„å…ƒç´ çš„é¡ºåºä¾æ¬¡æ¤å…¥</li><li>å±æ€§ <code>match_about_blank</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œé»˜è®¤å€¼ä¸º <code>false</code>ï¼Œä»¥æ§åˆ¶å†…å®¹è„šæœ¬ content script æ˜¯å¦æ¤å…¥åˆ° <code>about:blank</code> ç©ºé¡µé¢ä¸­ï¼ˆå½“ç©ºé¡µé¢ä¸ <code>match</code> æ¡ä»¶ä¹‹ä¸€åŒ¹é…æ—¶ï¼‰</li><li>å±æ€§ <code>run_at</code> è®¾ç½®è„šæœ¬æ¤å…¥çš„æ—¶é—´ç‚¹ï¼Œé»˜è®¤å€¼æ˜¯ <code>document_idle</code>ï¼Œè®©æµè§ˆå™¨å†³å®šåœ¨ <code>document_end</code>ï¼ˆDOM æ ‘æ„å»ºå®Œæˆæ—¶ï¼‰å’Œ <code>window.onload</code> äº‹ä»¶è§¦å‘ä¹‹é—´æ‹©æ—¶æ¤å…¥ï¼›è¿˜å¯ä»¥è®¾ç½®ä¸º <code>document_start</code> æˆ– <code>document_end</code></li><li>å±æ€§ <code>all_frames</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œç”¨ä»¥æ§åˆ¶æ¤å…¥çš„è„šæœ¬æ˜¯å¦åœ¨æ ‡ç­¾é¡µä¸­æ‰€æœ‰çš„ frame ä¸­è¿è¡Œï¼Œé»˜è®¤å€¼æ˜¯ <code>false</code>ï¼Œå³è„šæœ¬åªæ˜¯æ¤å…¥åˆ°ä¸»æ¡†æ¶ä¸­</li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
 <span class="token comment">// ...</span>
 <span class="token property">&quot;content_scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
     <span class="token property">&quot;matches&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://*.nytimes.com/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token property">&quot;css&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;my-styles.css&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token property">&quot;js&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;content-script.js&quot;</span><span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ğŸ’¡ è¿˜æœ‰ä¸€ç§è®¾ç½®ç½‘é¡µåŒ¹é…è§„åˆ™çš„æ–¹å¼æ˜¯å±æ€§ <code>include_globs</code> å’Œ <code>exclude_globs</code>ï¼Œå®ƒä»¬çš„<a href="https://developer.chrome.com/docs/extensions/mv3/content_scripts/#matchAndGlob" target="_blank" rel="noopener noreferrer">è§„åˆ™</a>æ›´åŠ çµæ´»</p></li><li><p>åŠ¨æ€æ¤å…¥</p><p>åœ¨åå°è„šæœ¬ä¸­å°±å¯ä»¥ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/reference/scripting/" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.scripting.executeScript()</code></a> ä¸ºé¡µé¢åŠ¨æ€æ¤å…¥ä»£ç ï¼Œéœ€è¦åœ¨é…ç½®æ¸…å• <code>manifest.json</code> ä¸­å…ˆå£°æ˜æƒé™</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;scripting&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸ºäº†å¯ä»¥åœ¨è¿è¡Œæ—¶ä»¥ç¼–ç¨‹çš„æ–¹å¼åŠ¨æ€åœ°åœ¨é¡µé¢æ¤å…¥è„šæœ¬ï¼Œéœ€è¦åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>host_permissions</code> ä¸­è·å–è®¿é—®ç›¸åº”é¡µé¢çš„æƒé™ï¼›æˆ–è€…åœ¨é€‰é¡¹ <code>permissions</code> ä¸­å£°æ˜ <code>activeTab</code> æƒé™ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ºå½“å‰æ¿€æ´»é¡µé¢æ¤å…¥è„šæœ¬ã€‚</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;scripting&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;activeTab&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;service_worker&quot;</span><span class="token operator">:</span> <span class="token string">&quot;background.js&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// content-script.js</span>
<span class="token comment">// éœ€è¦æ¤å…¥çš„ä»£ç </span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">&#39;orange&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span>onClicked<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">tab</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// åœ¨æŒ‡å®šçš„æ ‡ç­¾é¡µä¸­æ¤å…¥æŒ‡å®šçš„è„šæœ¬æˆ–æ ·å¼æ–‡ä»¶</span>
  chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span> tabId<span class="token operator">:</span> tab<span class="token punctuation">.</span>id <span class="token punctuation">}</span><span class="token punctuation">,</span>
    files<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;content-script.js&#39;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><a href="https://developer.chrome.com/docs/extensions/reference/scripting/" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.scription.executeScript()</code></a> å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ‰§è¡Œè„šæœ¬çš„é…ç½®å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ã€‚</p><ul><li><p>æ‰§è¡Œè„šæœ¬çš„é…ç½®å¯¹è±¡æœ‰å¤šä¸ªå±æ€§ï¼š</p><ul><li><p>ï¼ˆå¿…é¡»ï¼‰å±æ€§ <code>target</code> è®¾ç½®æ¤å…¥ç›®æ ‡å¯¹è±¡ï¼ˆæ ‡ç­¾é¡µï¼‰</p></li><li><p>å±æ€§ <code>files</code> æ˜¯ä¸€ä¸ªåŒ…å«è„šæœ¬æ–‡ä»¶ï¼ˆè·¯å¾„ï¼‰æˆ–æ ·å¼æ–‡ä»¶ï¼ˆè·¯å¾„ï¼‰çš„æ•°ç»„ï¼ˆğŸ’¡ å½“å‰æœ€å¤šåªæ”¯æŒä¸€ä¸ªæ–‡ä»¶ï¼‰ã€‚å¦‚æœæ¤å…¥çš„æ˜¯ JavaScript è„šæœ¬ï¼Œè¿˜æ”¯æŒæŒ‡å®š<strong>éœ€è¦æ‰§è¡Œçš„å‡½æ•°</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> document<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> tabId <span class="token operator">=</span> <span class="token function">getTabId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span>tabId<span class="token operator">:</span> tabId<span class="token punctuation">}</span><span class="token punctuation">,</span>
    func<span class="token operator">:</span> getTitle<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>âš ï¸ å¦‚æœæ¤å…¥çš„æ˜¯å‡½æ•°ï¼Œå®ƒå¹¶<strong>ä¸ä¼š</strong>æºå¸¦åœ¨å®šä¹‰å¤„çš„ä¸Šä¸‹æ–‡ï¼Œå› æ­¤å‡½æ•°ä¸­ç±»ä¼¼ <code>this</code> å’ŒæŒ‡å‘å‡½æ•°å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡ä¼šå¤±æ•ˆè€ŒæŠ¥é”™ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token function">getUserColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">changeBackgroundColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> color<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> tabId <span class="token operator">=</span> <span class="token function">getTabId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span>tabId<span class="token operator">:</span> tabId<span class="token punctuation">}</span><span class="token punctuation">,</span>
      func<span class="token operator">:</span> changeBackgroundColor<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// result in a ReferenceError</span>
<span class="token comment">// because `color` is undefined when the function executes</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>å¦‚æœå¸Œæœ›ä½¿ç”¨å‡½æ•°ä½œç”¨åŸŸå¤–éƒ¨çš„å˜é‡ï¼Œå¯ä»¥é€šè¿‡é€‰é¡¹ <code>args</code> é¢„å…ˆå£°æ˜ï¼Œå®ƒä¼š<strong>ä½œä¸ºå‚æ•°</strong>ä¼ å…¥åˆ°å‡½æ•°ä¸­</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> color <span class="token operator">=</span> <span class="token function">getUserColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">changeBackgroundColor</span><span class="token punctuation">(</span><span class="token parameter">backgroundColor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> backgroundColor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> tabId <span class="token operator">=</span> <span class="token function">getTabId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span>tabId<span class="token operator">:</span> tabId<span class="token punctuation">}</span><span class="token punctuation">,</span>
    func<span class="token operator">:</span> changeBackgroundColor<span class="token punctuation">,</span>
    args<span class="token operator">:</span> <span class="token punctuation">[</span>color<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li><p>å±æ€§ <code>allFrames</code> æ˜¯æ§åˆ¶æ³¨å…¥çš„è„šæœ¬è¿è¡Œåœ¨æ ‡ç­¾é¡µé‡Œçš„æ‰€æœ‰ frameï¼Œé»˜è®¤å€¼æ˜¯ <code>false</code>ï¼Œåªè¿è¡Œåœ¨ä¸»æ¡†æ¶ä¸­</p><p>ğŸ’¡ å¦‚æœå¸Œæœ›æ³¨å…¥çš„è„šæœ¬è¿è¡Œåœ¨æŒ‡å®šçš„ frame ä¸­ï¼Œå¯ä»¥åœ¨<a href="https://developer.chrome.com/docs/extensions/reference/webNavigation/" target="_blank" rel="noopener noreferrer">è®¾ç½® <code>frameIds</code> å±æ€§</a> <code>target: { tabId: tabId, FrameIds: frameIds }</code></p></li></ul></li></ul></li><li><p>ç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ï¼Œå®ƒæ¥æ”¶åŒ…å«è„šæœ¬æ‰§è¡Œå®Œæˆåè¿”å›å€¼çš„<strong>æ•°ç»„</strong>ä½œä¸ºå…¥å‚ï¼ˆæœ‰å¤šä¸ªè¿”å›å€¼æ˜¯å› ä¸ºæ¤å…¥è„šæœ¬å¯ä»¥åœ¨æ ‡ç­¾é¡µçš„æ‰€æœ‰ frame ä¸­éƒ½è¿è¡Œï¼‰ï¼Œå…¶ä¸­ä¸»æ¡†æ¶çš„è¿”å›å€¼æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè€Œå…¶ä»– frame çš„è¿”å›å€¼æ˜¯ä¹±åºçš„</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> document<span class="token punctuation">.</span>title<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> tabId <span class="token operator">=</span> <span class="token function">getTabId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">executeScript</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span>tabId<span class="token operator">:</span> tabId<span class="token punctuation">,</span> allFrames<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    func<span class="token operator">:</span> getTitle<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">injectionResults</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> frameResult <span class="token keyword">of</span> injectionResults<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Frame Title: &#39;</span> <span class="token operator">+</span> frameResult<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ul><p>ğŸ’¡ ä½¿ç”¨<a href="https://developer.chrome.com/docs/extensions/reference/scripting/#method-insertCSS" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>chrome.scriptiong.insertCSS()</code></a> æ¤å…¥æ ·å¼æ–‡ä»¶ï¼Œé™¤äº†æ”¯æŒä»¥æ–‡ä»¶æ•°ç»„çš„æ–¹å¼ï¼Œè¿˜æ”¯æŒ<strong>å­—ç¬¦ä¸²çš„å½¢å¼</strong>ï¼Œå¯¹äºç®€å•çš„æ ·å¼è¿™ä¸ªæ–¹å¼æ›´æ–¹ä¾¿ã€‚è¯¥æ–¹æ³•æ˜¯æ¤å…¥æ ·å¼åˆ°é¡µé¢çš„ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›å€¼ä½œä¸ºå›è°ƒå‡½æ•°çš„å…¥å‚ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> css <span class="token operator">=</span> <span class="token string">&#39;body { background-color: red; }&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> tabId <span class="token operator">=</span> <span class="token function">getTabId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
chrome<span class="token punctuation">.</span>scripting<span class="token punctuation">.</span><span class="token function">insertCSS</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token punctuation">{</span>tabId<span class="token operator">:</span> tabId<span class="token punctuation">}</span><span class="token punctuation">,</span>
    css<span class="token operator">:</span> css<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul><h4 id="ç›‘å¬ç½‘é¡µæ¶ˆæ¯" tabindex="-1"><a class="header-anchor" href="#ç›‘å¬ç½‘é¡µæ¶ˆæ¯" aria-hidden="true">#</a> ç›‘å¬ç½‘é¡µæ¶ˆæ¯</h4><p>å¯ä»¥å€ŸåŠ©å†…å®¹è„šæœ¬ content scriptsï¼Œå®ç°æ™®é€šçš„ç½‘é¡µå‘æ‰©å±•ç¨‹åºä¼ é€’ä¿¡æ¯ï¼Œä½¿ç”¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/postMessage" target="_blank" rel="noopener noreferrer">æ–¹æ³• <code>window.postMesage()</code></a> å‘è‡ªèº«ä¼ é€’ä¿¡æ¯ï¼Œç„¶ååœ¨å†…å®¹è„šæœ¬ content scripts ä¸­<strong>ç›‘å¬æ¶ˆæ¯äº‹ä»¶ <code>message</code></strong> ä»¥æ•è·å½“å‰é¡µé¢å‘é€ç»™è‡ªå·±çš„ä¿¡æ¯ï¼Œç„¶ååœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œå†…å®¹è„šæœ¬ content scripts å°±å¯ä»¥åŸºäºæ‹¦æˆªçš„ä¿¡æ¯ï¼Œæ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œä¾‹å¦‚ä¸æ‰©å±•ç¨‹åºè¿›è¡Œäº¤äº’ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// content scripts</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// We only accept messages from ourselves</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>source <span class="token operator">!=</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">&quot;FROM_PAGE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Content script received: &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    port<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- web page --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>send message<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;theButton&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;FROM_PAGE&quot;</span><span class="token punctuation">,</span> text<span class="token operator">:</span> <span class="token string">&quot;Hello from the webpage!&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="cross-origin-xhr" tabindex="-1"><a class="header-anchor" href="#cross-origin-xhr" aria-hidden="true">#</a> Cross-Origin XHR</h3><p>å¦‚æœå¸Œæœ›åœ¨æ‰©å±•ç¨‹åºè®¿é—®å¤–éƒ¨æœåŠ¡å™¨ï¼Œç”±äºåœ¨ MV3 ç‰ˆæœ¬ä¸­ï¼Œåå°è„šæœ¬ background script è¿è¡Œåœ¨ Service Workers ä¸­ï¼Œæ²¡æœ‰<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window" target="_blank" rel="noopener noreferrer">å…¨å±€å˜é‡ <code>window</code></a> å¯¹è±¡ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ XMLHttpRequest ï¼Œä½†å¯ä»¥ä½¿ç”¨æ–¹æ³• <code>fetch()</code> å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚</p><p>ç”±äºå†…å®¹è„šæœ¬ content script ä»¥æ¤å…¥ç½‘é¡µçš„æ–¹å¼è¿è¡Œï¼Œå› æ­¤å®ƒå—åˆ°<a href="https://en.wikipedia.org/wiki/Same_origin_policy" target="_blank" rel="noopener noreferrer">åŒæºç­–ç•¥</a>çš„é™åˆ¶ã€‚è€Œæ‰©å±•ç¨‹åºçš„åå°è„šæœ¬ background scripts å°±ä¸å—æ­¤é™åˆ¶ï¼Œåªéœ€è¦åœ¨ <code>host_permissions</code> ä¸­å£°æ˜åå°±å¯ä»¥è®¿é—®ç›¸åº”çš„è¿œç¨‹æœåŠ¡å™¨ï¼›å¦‚æœæ˜¯é€šè¿‡ <code>fetch()</code> çš„æ–¹å¼è·å–æ‰©å±•ç¨‹åºå†…éƒ¨çš„é™æ€èµ„æºï¼Œåˆ™ä¸éœ€è¦å£°æ˜æƒé™ã€‚</p><p>âš ï¸ åœ¨æ‰©å±•ç¨‹åºä¸­ä½¿ç”¨ä»å¤–éƒ¨æœåŠ¡å™¨çš„è¿”å›çš„æ•°æ®æ—¶ï¼Œéœ€è¦è°¨æ…å¤„ç†ï¼Œåº”è¯¥<a href="https://developer.chrome.com/docs/extensions/mv3/xhr/#xss" target="_blank" rel="noopener noreferrer">æ›´å®‰å…¨çš„é€»è¾‘ä»£ç  å’Œ API</a>ã€‚</p><p>ä¾‹å¦‚å¯¹äºä»¥ä¸‹ä¸å®‰å…¨çš„å¤„ç†æ–¹æ³•</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://api.example.com/data.json&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// WARNING! Might be evaluating an evil script!</span>
    <span class="token keyword">var</span> resp <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;(&quot;</span> <span class="token operator">+</span> xhr<span class="token punctuation">.</span>responseText <span class="token operator">+</span> <span class="token string">&quot;)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://api.example.com/data.json&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// WARNING! Might be injecting a malicious script!</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;resp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>åº”è¯¥æ”¹ç”¨æ›´å®‰å…¨çš„æ–¹å¼</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://api.example.com/data.json&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// JSON.parse does not evaluate the attacker&#39;s scripts.</span>
    <span class="token keyword">var</span> resp <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;https://api.example.com/data.json&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// textContent does not let the attacker inject HTML elements.</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;resp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> xhr<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>âš ï¸ ç”±äºå†…å®¹è„šæœ¬ content scripts å—åˆ°åŒæºæ”¿ç­–çš„é™åˆ¶ï¼Œå¯ä»¥é€šè¿‡ä¿¡æ¯ä¼ é€’ message passing å€ŸåŠ©æ‰©å±•ç¨‹åºæ¥ fetch ç›¸åº”çš„æœåŠ¡å™¨è·å–æ•°æ®ã€‚ä½†æ˜¯è¿™ç§å¤„ç†æ–¹å¼ä¼šè®©æ¶æ„ç½‘é¡µæœ‰å¯ä¹˜ä¹‹æœºï¼Œå®ƒä»¬å¯ä»¥ä¼ªé€ ä¿¡æ¯è¯·æ±‚ï¼Œè€Œè®©æ‰©å±•ç¨‹åºè®¿é—®æŒ‡å®šçš„æœåŠ¡å™¨ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// content-script.js</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    contentScriptQuery<span class="token operator">:</span> <span class="token string">&#39;fetchUrl&#39;</span><span class="token punctuation">,</span>
    url<span class="token operator">:</span> <span class="token string">&#39;https://another-site.com/price-query?itemId=&#39;</span> <span class="token operator">+</span>
              <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>itemId<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token function">parsePrice</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// background.js</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>contentScriptQuery <span class="token operator">==</span> <span class="token string">&#39;fetchUrl&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// WARNING: SECURITY PROBLEM - a malicious web page may abuse</span>
      <span class="token comment">// the message handler to get access to arbitrary cross-origin</span>
      <span class="token comment">// resources.</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=&gt;</span> <span class="token function">sendResponse</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// Will respond asynchronously.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>è¯¥é‡‡ç”¨æ›´å®‰å…¨çš„æ–¹å¼ï¼Œä¸è¦é€šè¿‡ä¿¡æ¯ä¼ é€’ message passing çš„æ–¹å¼ç›´æ¥ä¼ é€’å®Œæ•´çš„ URLï¼Œè€Œæ˜¯<strong>ä¼ é€’éƒ¨åˆ† query å‚æ•°</strong>ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ‰©å±•ç¨‹åºä¸­é¢„è®¾ï¼ˆé™åˆ¶ï¼‰å¯ä»¥è®¿é—®çš„åŸŸå</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// content-script.js</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    contentScriptQuery<span class="token operator">:</span> <span class="token string">&#39;queryPrice&#39;</span><span class="token punctuation">,</span>
    itemId<span class="token operator">:</span> <span class="token number">12345</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">price</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// backgound.js</span>
chrome<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>onMessage<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> sender<span class="token punctuation">,</span> sendResponse</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>contentScriptQuery <span class="token operator">==</span> <span class="token string">&#39;queryPrice&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token string">&#39;https://another-site.com/price-query?itemId=&#39;</span> <span class="token operator">+</span>
            <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>itemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">text</span> <span class="token operator">=&gt;</span> <span class="token function">parsePrice</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">price</span> <span class="token operator">=&gt;</span> <span class="token function">sendResponse</span><span class="token punctuation">(</span>price<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token operator">...</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// Will respond asynchronously.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="å®šåˆ¶å¼€å‘è°ƒè¯•å·¥å…·" tabindex="-1"><a class="header-anchor" href="#å®šåˆ¶å¼€å‘è°ƒè¯•å·¥å…·" aria-hidden="true">#</a> å®šåˆ¶å¼€å‘è°ƒè¯•å·¥å…·</h2><p>å¯ä»¥ä½¿ç”¨ <code>chrome.debugger</code> API æˆ– Chrome å†…ç½®çš„å¼€å‘è€…å·¥å…· DevTools è¿›è¡Œå¼€å‘è°ƒè¯•ï¼ˆä½†ä¸¤è€…ä¸å¯æ··ç”¨ï¼Œä½†ç”¨æˆ·å”¤èµ·å¼€å‘è€…å·¥å…·æ—¶ï¼Œï¼‰ã€‚</p><p>å¯ä»¥å°† debugger é™„åŠ åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾é¡µä¸­ï¼Œä»¥æ£€æµ‹ç½‘ç»œäº¤äº’ã€è°ƒè¯• JavaScriptã€æ”¹å˜ DOM å’Œ CSS ç­‰ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥æŸ¥çœ‹<a href="https://developer.chrome.com/docs/extensions/reference/debugger/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>å’Œ<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/debugger" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰ã€‚</p><p>æ‰©å±•ç¨‹åºä¹Ÿå¯ä»¥ä¸º Chrome çš„å¼€å‘è€…å·¥å…· DevTools å¢æ·»åŠŸèƒ½ï¼Œä¾‹å¦‚æ·»åŠ æ–°çš„ UI é¢æ¿å’Œä¾§è¾¹æ ï¼Œä¸è¢«æ£€æŸ¥çš„é¡µé¢äº¤äº’ï¼Œè·å–æœ‰å…³ç½‘ç»œè¯·æ±‚çš„ä¿¡æ¯ç­‰ã€‚è¿™ä¸€ç±»çš„æ‰©å±•ç¨‹åºé™¤äº†ä¸€èˆ¬å¸¸ç”¨çš„æ„æˆéƒ¨åˆ†ä»¥å¤–ï¼Œè¿˜éœ€è¦ä½¿ç”¨å¦ä¸€å¥— DevTools ç‰¹æœ‰çš„ APIï¼Œè¿˜æœ‰ä¸€ä¸ª <a href="https://developer.chrome.com/docs/extensions/mv3/devtools/#devtools-page" target="_blank" rel="noopener noreferrer">DevTools é¡µé¢</a>ï¼š</p><ul><li><a href="https://developer.chrome.com/docs/extensions/mv3/devtools.inspectedWindow" target="_blank" rel="noopener noreferrer"><code>chrome.devtools.inspectedWindow</code> API</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/devtools.network" target="_blank" rel="noopener noreferrer"><code>chrome.devtools.network</code> API</a></li><li><a href="https://developer.chrome.com/docs/extensions/mv3/devtools.panels" target="_blank" rel="noopener noreferrer"><code>chrome.devtools.panels</code> API</a></li></ul><p><img src="/blog-web/assets/devtools-extension.481dd0f8.png" alt="DevTools-extension"></p><p><em>åœ¨ MV3 ç‰ˆæœ¬ä¸­ï¼Œbackground page å·²å–æ¶ˆï¼Œåå°è„šæœ¬ background scripts è¿è¡Œåœ¨ service workers ä¸­</em></p><p>å…³äºå¢æ·»å¼€å‘è€…å·¥å…· DevTools åŠŸèƒ½çš„æ‰©å±•ç¨‹åºçš„å¼€å‘å¯ä»¥å‚è€ƒ<a href="https://developer.chrome.com/docs/extensions/mv3/devtools/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>å’Œ<a href="https://github.com/GoogleChrome/chrome-extensions-samples/tree/main/mv2-archive/api/devtools" target="_blank" rel="noopener noreferrer">ç¤ºä¾‹</a>ï¼ˆMV2 ç‰ˆæœ¬ï¼‰ï¼Œä»¥åŠä¸€äº›<a href="https://developer.chrome.com/docs/extensions/mv3/devtools/#devtools-extension-examples" target="_blank" rel="noopener noreferrer">å®ä¾‹</a>ã€‚</p><h2 id="æ‰©å±•ç¨‹åºå‘å¸ƒ" tabindex="-1"><a class="header-anchor" href="#æ‰©å±•ç¨‹åºå‘å¸ƒ" aria-hidden="true">#</a> æ‰©å±•ç¨‹åºå‘å¸ƒ</h2><p>æ‰©å±•ç¨‹åºä¸»è¦æ˜¯é€šè¿‡ <a href="https://chrome.google.com/webstore/category/extensions" target="_blank" rel="noopener noreferrer">Chrome ç½‘ä¸Šåº”ç”¨åº—</a>è¿›è¡Œåˆ†å‘ã€‚</p><p>å¼€å‘è€…é€šè¿‡ <a href="https://chrome.google.com/webstore/developer/dashboard" target="_blank" rel="noopener noreferrer">Developer Dashboard</a> å¹³å°ï¼Œå°†æ‰©å±•ç¨‹åºé¡¹ç›®æ‰“åŒ… <code>.zip</code> æ–‡ä»¶è¿›è¡Œä¸Šä¼ ï¼›ç„¶åè¯¥å¹³å°ä¼šå¯¹æ‰©å±•ç¨‹åºè¿›è¡Œå®‰å…¨å®¡æ ¸ä»¥<a href="https://blog.chromium.org/2015/05/continuing-to-protect-chrome-users-from.html" target="_blank" rel="noopener noreferrer">ä¿æŠ¤ç”¨æˆ·</a>ï¼Œå®¡æ ¸æˆåŠŸåæ‰©å±•ç¨‹åºä¼šè½¬æ¢æˆåç¼€ä¸º <code>.crx</code> çš„ç‰¹æ®Š ZIP å‹ç¼©åŒ…ï¼Œå†åˆ†å‘ç»™ç”¨æˆ·ã€‚</p><p>ğŸ’¡ å…³äºæ‰©å±•ç¨‹åºçš„æ›´æ–°ï¼ŒChrome æµè§ˆå™¨ä¼šå®šæœŸæ£€æŸ¥å·²å®‰è£…æ‰©å±•ç¨‹åºçš„ç‰ˆæœ¬ï¼Œå¦‚æœå‘ç°æ–°ç‰ˆæœ¬å°±ä¼šè¿›è¡Œæ›´æ–°ï¼Œæ— éœ€ç”¨æˆ·å¹²é¢„ã€‚æ‰©å±•ç¨‹åºçš„ç‰ˆæœ¬åœ¨é…ç½®æ¸…å• <code>manifest.json</code> çš„é€‰é¡¹ <code>version</code> ä¸­è®¾ç½®</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.5&quot;</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>é€šè¿‡æå‡æ•°å€¼æ¥è¡¨ç¤ºæ–°ç‰ˆæœ¬</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  ...
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.5&quot;</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ç„¶åå°†æ–°çš„æ‰©å±•ç¨‹åºé¡¹ç›®æ‰“åŒ…ä¸º <code>.zip</code> æ–‡ä»¶ï¼Œåœ¨ <a href="https://chrome.google.com/webstore/developer/dashboard" target="_blank" rel="noopener noreferrer">Developer Dashboard</a> å¹³å°ä¸­æ‰¾åˆ°ç›¸åº”æ‰©å±•ç¨‹åºçš„æ—§ç‰ˆæœ¬ï¼Œé€‰æ‹© <code>Edit</code> ä¸Šä¼ å‹ç¼©åŒ…ï¼Œå†ç‚¹å‡» <code>Publish</code> è¿›è¡Œå‘å¸ƒã€‚</p><p>ğŸ’¡ å…¶ä»–æ‰©å±•ç¨‹åºçš„åˆ†å‘æ–¹å¼å¯ä»¥å‚è€ƒ<a href="https://developer.chrome.com/docs/extensions/mv3/external_extensions/" target="_blank" rel="noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">æ›´æ–°æ—¶é—´: </span><span class="meta-item-info">2021/9/24 ä¸‹åˆ4:09:23</span></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><div style="width:0px;" class="catalog-container absolute top-0 right-0 h-full hidden lg:block"><div class="headings-container sticky top-36" data-v-c28348e0><ul class="max-w-max m-2 pl-7 xl:pl-16 2xl:pl-20 py-4 opacity-50 hover:opacity-100 transition-all duration-300" data-v-c28348e0><!--[--><!--]--></ul></div></div><div style="display:none;" tabindex="0" class="sidebar-container fixed inset-y-0 left-0 z-20 lg:hidden opacity-10 hover:opacity-95"><div class="headings-container px-2 space-y-2 transition-all duration-300 py-20" data-v-6eed9461><!--[--><!--]--></div></div></div><footer class="bg-gray-200 p-8 grid grid-cols-1 md:grid-cols-3 gap-4 items-center"><div class="flex justify-center md:justify-start items-center"><a class="p-2 hover:bg-gray-300 rounded-md" href="https://benbinbin.github.io/" target="_blank"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="text-center space-y-0.5"><p class="text-sm text-gray-600"> Â©2021 <span class="author">Benbinbin</span>. All Right Reserved. </p><p class="text-xs text-center text-gray-400"> é™¤ç‰¹æ®Šè¯´æ˜å¤–ï¼Œæœ¬ç«™çš„æ–‡ç« éµå¾ª <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" target="_blank" class="text-blue-400">CC-BY-SA-4.0</a> åè®® </p><p class="text-xs text-center text-gray-400"> ç½‘ç«™ä¸»é¢˜é‡‡ç”¨ <a href="https://github.com/Benbinbin/two-dishes-one-fish" target="_blank" class="text-blue-400">Two Dishes One Fish</a></p></div><div class="btn-container flex justify-center md:justify-end items-center space-x-0.5"><!--[--><a class="p-2 hover:bg-gray-300 rounded-md" href="mailto:benthomsonbin@gmail.com" target=""><img src="/blog-web/images/icons/email.svg" alt="email" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://github.com/Benbinbin" target="_blank"><img src="/blog-web/images/icons/github.svg" alt="github" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://juejin.cn/user/3175045314389278/posts" target="_blank"><img src="/blog-web/images/icons/juejin.svg" alt="juejin" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://dribbble.com/BinBinDesign" target="_blank"><img src="/blog-web/images/icons/dribbble.svg" alt="dribbble" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://twitter.com/Benbinbin_fun" target="_blank"><img src="/blog-web/images/icons/twitter.svg" alt="twitter" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://weibo.com/binbindesign" target="_blank"><img src="/blog-web/images/icons/weibo.svg" alt="weibo" class="w-auto h-6"></a><!--]--></div></footer></div><!--]--></div>
    <script type="module" src="/blog-web/assets/app.43fe0c63.js" defer></script>
  </body>
</html>
