<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/blog-web/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css"><title>HTML5 Canvas | Blog</title><meta name="description" content="A blog and knowledge management system about web.">
    <link rel="modulepreload" href="/blog-web/assets/app.43fe0c63.js"><link rel="modulepreload" href="/blog-web/assets/Canvas.html.833f67e5.js"><link rel="modulepreload" href="/blog-web/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/blog-web/assets/Canvas.html.58fe5e6c.js">
    <link rel="stylesheet" href="/blog-web/assets/style.b42fd117.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="min-h-screen flex flex-col"><nav class="px-4 sm:px-8 py-2 flex justify-between items-center sticky top-0 z-30 bg-white"><div class="left flex items-center space-x-0.5"><!--[--><button class="text-gray-400 hover:bg-gray-100 catelog-btn p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--><a class="avatar p-2 hover:bg-gray-100 rounded-md" href="/blog-web/#"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="right hidden sm:flex items-center space-x-0.5"><!--[--><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">All</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Network</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Frontend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Backend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Project</button><!--]--><!--[--><button class="text-gray-900 bg-gray-100 hover:bg-gray-200 p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md hidden lg:block"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--></div><div class="more-container sm:hidden relative"><button style="" class="p-2 select-none hover:bg-gray-100 rounded-md text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"></path></svg></button><button style="display:none;" class="p-2 select-none hover:bg-gray-100 rounded-md text-red-400 hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path></svg></button><div style="display:none;" class="more-modal p-2 absolute top-10 right-0 z-10 flex flex-col space-y-2 bg-gray-100 rounded-md opacity-90"><!--[--><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">All</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Network</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Frontend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Backend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Project</button><!--]--></div></div></nav><div class="relative flex-grow"><div class="theme-container no-navbar no-sidebar"><!--[--><!----><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="html5-canvas" tabindex="-1"><a class="header-anchor" href="#html5-canvas" aria-hidden="true">#</a> HTML5 Canvas</h1><p>参考：</p><ul><li><a href="http://diveintohtml5.info/canvas.html#text" target="_blank" rel="noopener noreferrer">Canvas - Dive Into HTML5</a></li></ul><p>使用标签 <code>&lt;canvas&gt;</code> 在页面创建一个 canvas 画布，一个 2D 平面，并渲染出指定的画面，如形状、图像、文字、图案等。</p><h2 id="创建-canvas" tabindex="-1"><a class="header-anchor" href="#创建-canvas" aria-hidden="true">#</a> 创建 canvas</h2><p>使用标签 <code>&lt;canvas&gt;</code> 创建画布，该标签可设置多种属性，如 <code>width</code> 和 <code>height</code> 设置画布宽和高（大小）</p><p>canvas 使用坐标系定位图像，在二维图像中，左上角为 <code>(0,0)</code> 坐标值依次向右侧（<code>x</code> 值）和向下方（<code>y</code> 值）增大</p><h2 id="操作-canvas" tabindex="-1"><a class="header-anchor" href="#操作-canvas" aria-hidden="true">#</a> 操作 canvas</h2><p>使用 JavaScript 操作 canvas</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>c<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>200<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
    // 在标签 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span><span class="token punctuation">&gt;</span></span> 下使用 JavaScript 操作画布
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">var</span> c <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用 id 属性获取 canvas 元素</span>
        <span class="token keyword">var</span> ctx <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用方法 getContext 获取 canvas 的内容，传递参数 2d 以获取画布平面内容</span>

        <span class="token comment">// 创建一个新的 image 元素，并将其添加到画布中</span>
        <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;http://lorempixel.com/300/300&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 设置图片来源</span>
        <span class="token comment">// 由于图片加载是异步的，因此使用方法 onload() 待图片加载完成后进行操作</span>
        img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	        ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>width<span class="token punctuation">,</span> c<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 使用方法 drawImage 将图像 img 绘制到画布上，定位坐标是 (0,0)，图片大小与画布大小一致</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="绘制图像-drawimage" tabindex="-1"><a class="header-anchor" href="#绘制图像-drawimage" aria-hidden="true">#</a> 绘制图像 drawImage</h3><p>使用 canvas 对象<a href="https://www.w3school.com.cn/tags/canvas_drawimage.asp" target="_blank" rel="noopener noreferrer">方法 <code>darwImage()</code></a> 在画布上绘制图像、画布或视频。也可以绘制图像的某些部分，以及/或者增加或减少图像的尺寸。</p><p>可设置的参数值</p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td><code>img</code></td><td>规定要使用的图像、画布或视频（对象）。</td></tr><tr><td><code>sx</code></td><td>可选。开始剪切的 <code>x</code> 坐标位置。</td></tr><tr><td><code>sy</code></td><td>可选。开始剪切的<code>y</code>坐标位置。</td></tr><tr><td><code>swidth</code></td><td>可选。被剪切图像的宽度。</td></tr><tr><td><code>sheight</code></td><td>可选。被剪切图像的高度。</td></tr><tr><td><code>x</code></td><td>在画布上放置图像的<code>x</code> 坐标位置。</td></tr><tr><td><code>y</code></td><td>在画布上放置图像的 <code>y</code> 坐标位置。</td></tr><tr><td><code>width</code></td><td>可选。要使用的图像的宽度。（伸展或缩小图像）</td></tr><tr><td><code>height</code></td><td>可选。要使用的图像的高度。（伸展或缩小图像）</td></tr></tbody></table><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 剪切图像，并在画布上定位被剪切的部分：</span>
context<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span>sx<span class="token punctuation">,</span>sy<span class="token punctuation">,</span>swidth<span class="token punctuation">,</span>sheight<span class="token punctuation">,</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>width<span class="token punctuation">,</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="下载图像-todataurl" tabindex="-1"><a class="header-anchor" href="#下载图像-todataurl" aria-hidden="true">#</a> 下载图像 toDataURL</h3><p>使用 canvas 对象方法 <code>toDataURL()</code> 输出画布中的图像，该方法创建一个可以表现画布图片的<strong>字符串</strong>，支持输出各种格式的图片。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 输出图片到变量 saveImage 中</span>
<span class="token keyword">var</span> savedImage <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 打开变量保存的图片</span>
window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>savedImage<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>⚠️ 图片资源需要托管在服务器，从服务器（或本地服务器）加载才可以使用 <code>toDataURL()</code> 下载</p><h3 id="绘制矩形" tabindex="-1"><a class="header-anchor" href="#绘制矩形" aria-hidden="true">#</a> 绘制矩形</h3><p>使用 canvas 对象（内容）方法 <code>fillRect()</code>或 <code>strokeRect()</code> 绘制实心矩形或空心矩形</p><ul><li>可以传递不同的参数以定制矩形外观 <code>fillRect(posX, posY, width, height)</code></li><li>使用画布 canvas 对象（内容）属性 <code>fillStyle</code> 设置填充颜色，或 <code>strokeStyle</code> 设置边框颜色属性</li></ul><p>示例</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> c <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;#c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ctx <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ctx<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">&quot;blue&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// Start at (0,0) and draw a 50px x 50px blue rectangle.</span>
ctx<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="路径" tabindex="-1"><a class="header-anchor" href="#路径" aria-hidden="true">#</a> 路径</h3><p>可以通过 <a href="https://www.w3.org/TR/2dcontext/#building-paths" target="_blank" rel="noopener noreferrer">创建路径 Path</a> 来创作出一个复杂的形状</p><ul><li>使用 canvas 对象（内容）方法 <code>beginPath()</code> 「声明」需要创建一个新的路径</li><li>配合使用canvas 对象（内容）方法方法 <code>moveTo(x, y)</code> 和 <code>lineTo(x, y)</code> 创建路径，前一个方法确定路径开始点，后一个方法基于上方的坐标和该方法给出的坐标之间创建一条路径</li><li>使用 canvas 对象（内容）方法 <code>fill()</code> 或 <code>stroke()</code> 结束路径并创建实心或空心的图形</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    ctx<span class="token punctuation">.</span><span class="token function">strokeRect</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">125</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>画布结果 <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAP0AAAECCAIAAAC65EbTAAAACXBIWXMAABJ0AAASdAHeZh94AAAE0UlEQVR4nO3dLXMqWRiFUbg1Kuj41vjo4POn8oOio/HooNtHB8sIplJzv0iA7j7n9F5LBZW3qKea7Xp5PB4XEOZH6QOgAN2TSPck0j2JdE8i3ZNI9yTSPYl0TyLdk0j3JNI9iXRPIt2TSPck0j2JdE8i3ZNI9yTSPYl0TyLdk0j3JNI9iXRPIt2TSPck0j2JdE8i3ZNI9yTSPYl0TyLdk0j3JNI9iXRPIt2TSPck0j2JdE8i3ZNI9yTSPYl0TyLdk0j3JNI9iXRPon/K/vu+7/u+L3sDg+i6ruu60ld8V/nut9tt2RsYxGazaah7O4dEhZ/3n9r6leRTo0u1ou43m03pK7jYdrttsXs7h0S6J5HuSaR7EumeRLonke5JpHsS6Z5EuieR7kmkexLpnkS6J5HuSaR7EumeRLonke5JpHsS6Z5EuieR7kmkexLpnkS6J5HuSaR7EumeRLonke5JpHsS6Z5EuidRLe/5mVLf929vb/v9/nA4lL5lFI+Pj16adF5i9+/v77vd7uXlpe/7j4+P0ucM7/n5WffnJXa/Xq/v7u4Wi8Xr6+tutyt9DgUkdr9arbque3p6On3c7/ezfOpzRmL3i8VitVo9PDyc/j4cDnMdPPxNaPcnBk+s6O4NnljR3S8MnlTp3Z8YPGl0v1gYPHl0/x+DJ4ruf2LwhND9TwyeELr/lcGTQPd/ZvDMm+7/zOCZN93/lcEzY7r/gsEzS7r/gsEzS7r/msEzP7r/LoNnTnT/XQbPnOj+AgbPbOj+YgbPDOj+YgbPDOj+GgZP63R/PYOnXbq/nsHTLt3fxOBplO4HYPA0R/cDMHiao/thGDxt0f2QDJ5W6H5IBk8rdD8wg6cJuh+FwVM53Y/C4Kmc7sdi8NRM9+MyeOqk+3EZPHXS/egMngrpfiIGT1V0PxGDpyq6n47BUw/dT83gqYHup2bw1ED3BRg8xem+GIOnIN0XY/AUpPuSDJ5SdF+ewTM93Zdn8ExP91UweCam+4q0O3iWy2XpEy6j+4q0O3iOx2PpEy6j+7oYPNPQfY3aHTyt0H2N2h08rdB9pQyeUem+agbPSHRfNYNnJLqvncEzBt23weAZlu7bYPAMS/fNMHgGpPvGGDyD0H1jDJ5B6L49Bs/tdN8qg+cWum+VwXML3TfM4Lma7ptn8FxB9837ffCUvacJup+DXwbP6fHPGbqfj8/Bs16vS99SO93Px+fgub+/L31L7XQ/K/8fPJzxo/QBUIDuSaR7EumeRLonke5JpHsS6Z5EuieR7kmkexLpnkS6J5HuSaR7EumeRLonke5JpHsS6Z5EuieR7kmkexLpnkS6J5HuSaR7EumeRLonke5JpHsS6Z5EuieR7klUy3t++r7fbrelr+Bifd+XPuEaFXXf6DdIi+ycayyXy9IncJPCz/uu6zabTdkbGETXdaVPuMDyeDyWvgGmZueQSPck0j2JdE8i3ZNI9yTSPYl0TyLdk0j3JNI9iXRPIt2TSPck0j2JdE8i3ZNI9yTSPYl0TyLdk0j3JNI9iXRPIt2TSPck0j2JdE8i3ZNI9yTSPYl0TyLdk0j3JNI9iXRPIt2TSPck0j2JdE8i3ZNI9yTSPYl0TyLdk0j3JNI9iXRPIt2TSPck0j2JdE8i3ZPoX9w1QG6ydGTCAAAAAElFTkSuQmCC" alt="路径"></p><h3 id="颜色" tabindex="-1"><a class="header-anchor" href="#颜色" aria-hidden="true">#</a> 颜色</h3><p>使用 canvas 对象（内容）属性 <code>fillStyle</code> 或 <code>strokeStyle</code> 设置填充或线框颜色，支持使用 CSS 规范声明的约 140 种<a href="https://zh.wikipedia.org/wiki/%E7%BD%91%E9%A1%B5%E9%A2%9C%E8%89%B2" target="_blank" rel="noopener noreferrer">颜色名称</a>或 RGB 十六进制码</p><p>注意：设置的颜色仅适用于（该转换命令后创建的）后续对象</p><h3 id="擦除画布-clearrect" tabindex="-1"><a class="header-anchor" href="#擦除画布-clearrect" aria-hidden="true">#</a> 擦除画布 clearRect</h3><p>使用 canvas 对象（内容）方法 <code>clearRect(posX, posY, width, height)</code> 擦除特定区域的画布</p><p>示例</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 将参数设置为画布的尺寸，擦除整个画布</span>
ctx<span class="token punctuation">.</span><span class="token function">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>width<span class="token punctuation">,</span> c<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="变换图像" tabindex="-1"><a class="header-anchor" href="#变换图像" aria-hidden="true">#</a> 变换图像</h3><p>注意：下述设置的任何转换都适用于（该转换命令后创建的）所有后续对象</p><h4 id="缩放-scale" tabindex="-1"><a class="header-anchor" href="#缩放-scale" aria-hidden="true">#</a> 缩放 scale</h4><p>使用 canvas 对象（内容）的方法 <code>scale(x,y)</code> 将后续绘制命令的 <code>x</code> 和 <code>y</code> 值乘以给定系数，即放大相应的倍数</p><h4 id="移动-translate" tabindex="-1"><a class="header-anchor" href="#移动-translate" aria-hidden="true">#</a> 移动 translate</h4><p>使用 canvas 对象（内容）的方法 <code>translate(x,y)</code> 将所有后续绘制命令水平移动 <code>x</code> 个像素，垂直移动 <code>y</code> 个像素。</p><h4 id="旋转-rotate" tabindex="-1"><a class="header-anchor" href="#旋转-rotate" aria-hidden="true">#</a> 旋转 rotate</h4><p>使用 canvas 对象（内容）的方法 <code>rotate(angleRadians)</code> 将对象（通常）绕中心转动特定弧度</p><p>提示：度数与弧度的关系 <code>radians = degrees * (Math.PI/180)</code></p><h3 id="保存与恢复画布状态" tabindex="-1"><a class="header-anchor" href="#保存与恢复画布状态" aria-hidden="true">#</a> 保存与恢复画布状态</h3><p>使用 canvas 对象（内容）的方法 <code>save()</code> 和 <code>restore()</code> 来保存和恢复画布状态，更方便地在不同样式间切换，以绘画出不同的图形。</p><p>可以保存的画布状态包括：</p><ul><li>当前转换矩阵（旋转、缩放、移动）</li><li><code>strokeStyle</code></li><li><code>fillStyle</code></li><li><code>font</code></li><li><code>globalAlpha</code></li><li><code>lineWidth</code></li><li><code>lineCap</code></li><li><code>lineJoin</code></li><li><code>miterLimit</code></li><li><code>shadowOffsetX</code></li><li><code>shadowOffsetY</code></li><li><code>shadowBlur</code></li><li><code>shadowColor</code></li><li><code>globalCompositeOperation</code></li><li><code>textAlign</code></li><li><code>textBaseline</code></li><li>当前剪辑区域</li></ul><h3 id="绘制文本" tabindex="-1"><a class="header-anchor" href="#绘制文本" aria-hidden="true">#</a> 绘制文本</h3><p>使用 canvas 对象（内容）的方法 <code>fillText(string, x, y)</code> 或 <code>strokeText(string, x, y)</code> <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Drawing_text" target="_blank" rel="noopener noreferrer">绘制（空心或实心）文本</a>，其中坐标为字符串左下角位置。</p><ul><li>文本的填充样式或边框样式与当前（命令上方）设置的样式一致</li><li>使用 canvas 对象（内容）属性 <code>font</code> 设置字体样式与字体大小，默认使用 CSS <code>font</code> 属性相同的语法，默认值字体和大小是 <code>10px sans-serif</code></li><li>使用 canvas 对象（内容）属性 <code>textAlign</code> 设置文本对齐方式，可选的值包括 <ul><li><code>start</code> 默认值</li><li><code>end</code></li><li><code>left</code></li><li><code>right</code></li><li><code>center</code></li></ul></li><li>使用 canvas 对象（内容）属性 <code>fillStyle</code> 或 <code>strokeStyle</code> 设置填充颜色</li><li>使用 canvas 对象（内容）属性 <code>lineWidth</code> 设置边框宽度</li></ul><h3 id="图片数据" tabindex="-1"><a class="header-anchor" href="#图片数据" aria-hidden="true">#</a> 图片数据</h3><p>画布支持的图片使用 JavaScript 表示为一个 <code>ImageData</code> 对象，该对象包含源图像三种属性</p><ul><li>宽度 <code>width</code></li><li>高度 <code>height</code></li><li>数据 <code>data</code> 存储每个像素的 RGB 数据 和 Alpha 值（范围是 0-255，其中 0 是透明的，255 是完全可见的），一般使用 <code>Uint8ClampedArray</code> 数组表示，数组每四个元素表示一个像素点信息，即 RGBA 值</li></ul><p>尝试用以下函数检索或修改图片数据</p><ul><li><code>createImageData</code> 初始化一个空的图像数据对象</li><li><a href="https://www.w3school.com.cn/tags/canvas_getimagedata.asp" target="_blank" rel="noopener noreferrer"><code>getImageData(x, y, width, height)</code></a> 复制画布上指定矩形的像素数据，起始点为 <code>(x,y)</code> ，大小范围是宽 <code>width</code>，高 <code>height</code></li><li><code>putImageData</code> 存储数据到背景画布</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 将画布中每隔 10 个像素设置为绿色</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">var</span> imgData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>width<span class="token punctuation">,</span> c<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">paintGreen</span><span class="token punctuation">(</span><span class="token parameter">imagData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> numPix <span class="token operator">=</span> imgData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numPix<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">10</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                imgData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span> <span class="token comment">// 将第 i 个像素的 Green 值设置为 255（需要背景原色为白色，否则还需要编辑 red 值和 blue 值</span>
                imgData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span> <span class="token comment">// 将第 i 个像素的 Alpha 值设置为 255（非透明）</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        ctx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>imgData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">paintGreen</span><span class="token punctuation">(</span>imgData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 将彩色图片转换为黑白（灰）图片</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">var</span> img <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;test.jpg&quot;</span><span class="token punctuation">;</span>
    img<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>width<span class="token punctuation">,</span> c<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        imgData <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span>width<span class="token punctuation">,</span> c<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">gray</span><span class="token punctuation">(</span>imgData<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用灰度函数</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 灰度函数</span>
    <span class="token keyword">function</span> <span class="token function">gray</span><span class="token punctuation">(</span><span class="token parameter">imagData</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> numPix <span class="token operator">=</span> imgData<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numPix<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> gray <span class="token operator">=</span> <span class="token punctuation">(</span>imgData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> imgData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> imgData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">3</span>
            imgData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> gray<span class="token punctuation">;</span>
            imgData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> gray<span class="token punctuation">;</span>
            imgData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> gray<span class="token punctuation">;</span>
            imgData<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        ctx<span class="token punctuation">.</span><span class="token function">putImageData</span><span class="token punctuation">(</span>imgData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="视频特效" tabindex="-1"><a class="header-anchor" href="#视频特效" aria-hidden="true">#</a> 视频特效</h3><p>参考：</p><ul><li><a href="https://juejin.im/post/5a82f0626fb9a06358657c9c" target="_blank" rel="noopener noreferrer">你需要知道的requestAnimationFrame</a></li><li><a href="https://www.paulirish.com/2011/requestanimationframe-for-smart-animating/" target="_blank" rel="noopener noreferrer">requestAnimationFrame for Smart Animating</a></li><li><a href="https://www.kirupa.com/html5/animating_with_requestAnimationFrame.htm" target="_blank" rel="noopener noreferrer">Animating with requestAnimationFrame</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/window/requestAnimationFrame" target="_blank" rel="noopener noreferrer">window.requestAnimationFrame - Web API 接口参考 | MDN</a></li></ul><p>将视频放置在画布中，通过提取其帧图像，利用图片数据处理方法，可以为视频添加特效。</p><p>为了可以流畅在视频播放时流畅地「抽帧」应使用函数 <code>requestAnimationFrame</code> ，其作用相当于一个定时器（类似于 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setTimeout" target="_blank" rel="noopener noreferrer">setTimeout</a> 和 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setInterval" target="_blank" rel="noopener noreferrer">setInterval</a>） 让浏览器流畅地循环执行（渲染）一帧动画的操作</p><p>函数 <code>requestAnimationFrame</code> 接受一个动画执行函数作为参数，这个函数的作用是仅执行一帧动画的渲染，并根据条件判断是否结束，如果动画没有结束，则继续调用 <code>requestAnimationFrame</code> 并将<strong>函数自身</strong>作为参数传入（循环调用）。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">animationWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;box&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token string">&#39;px&#39;</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span>div<span class="token punctuation">.</span>style<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>animationWidth<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">animationWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/blog-web/assets/20200109205948124_21966.169d2165.gif" alt="动画效果"></p><p>提示：游戏循环是使用应用或游戏时连续运行的一系列事件，<code>requestAnimationFrame</code> 会处理大多数繁重的工作，以便确保在活跃查看应用时，应用的运行速度尽可能达到 60 帧/秒。</p><h3 id="处理键盘输入" tabindex="-1"><a class="header-anchor" href="#处理键盘输入" aria-hidden="true">#</a> 处理键盘输入</h3><p>尽管手动处理键盘流程并不太难，但我更愿意站在巨人的肩膀上，使用具有能帮助我执行所需操作的完善库的开源项目。</p><p>在遵循 <a href="https://github.com/marquete/kibo" target="_blank" rel="noopener noreferrer">Kibo</a> 公共命名 <code>(&#39;a&#39;, &#39;3&#39;, &#39;up&#39;)</code> 的基础上允许你引用按键值而不是它们的<a href="https://segmentfault.com/a/1190000005828048" target="_blank" rel="noopener noreferrer">键码值</a>，这将会极大地简化你的代码。你也可以在按下或者松开的时候附加事件同样适用于修饰键和通配符。</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> k <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Kibo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
k<span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span>\<span class="token punctuation">[</span><span class="token string">&#39;up&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;w&#39;</span>\<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something cool on the canvas</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

k<span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span>\<span class="token punctuation">[</span><span class="token string">&#39;enter&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;q&#39;</span>\<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do other stuff.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="处理鼠标输入" tabindex="-1"><a class="header-anchor" href="#处理鼠标输入" aria-hidden="true">#</a> 处理鼠标输入</h3><p>就像许多其他的 DOM 元素，画布可以接收 <strong>点击</strong> 和 <strong>鼠标按下</strong>事件。我们确实需要做点小工作来确定用户在画布上的哪个位置点击了。鼠标点击事件返回 <code>clientX</code> 和 <code>clientY</code> 在浏览器窗口全局中的位置。每个元素知道它相对于浏览器 <code>(0,0)</code> 即 (<code>offsetLeft</code>和<code>offsetTop</code>)的位置。要获取一次相对于画布的点击，你需要从 <code>clientX</code> 和 <code>clientY</code> 中减去 <code>offsetLeft</code> 和 <code>offsetTop</code> 值。 查看下面的示例代码:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> c <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;canvas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleMouseClick</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> evt<span class="token punctuation">.</span>clientX <span class="token operator">-</span> c<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">;</span>
        y <span class="token operator">=</span> evt<span class="token punctuation">.</span>clientY <span class="token operator">-</span> c<span class="token punctuation">.</span>offsetTop<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;x,y:&quot;</span><span class="token operator">+</span>x<span class="token operator">+</span><span class="token string">&quot;,&quot;</span><span class="token operator">+</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
c<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> handleMouseClick<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><a href="https://github.com/marquete/kibo" target="_blank" rel="noopener noreferrer">Kibo.js</a> 是处理键盘输入的一个 JavaScript 库。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">更新时间: </span><span class="meta-item-info">2021/7/6 上午2:38:22</span></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><div style="width:0px;" class="catalog-container absolute top-0 right-0 h-full hidden lg:block"><div class="headings-container sticky top-36" data-v-c28348e0><ul class="max-w-max m-2 pl-7 xl:pl-16 2xl:pl-20 py-4 opacity-50 hover:opacity-100 transition-all duration-300" data-v-c28348e0><!--[--><!--]--></ul></div></div><div style="display:none;" tabindex="0" class="sidebar-container fixed inset-y-0 left-0 z-20 lg:hidden opacity-10 hover:opacity-95"><div class="headings-container px-2 space-y-2 transition-all duration-300 py-20" data-v-6eed9461><!--[--><!--]--></div></div></div><footer class="bg-gray-200 p-8 grid grid-cols-1 md:grid-cols-3 gap-4 items-center"><div class="flex justify-center md:justify-start items-center"><a class="p-2 hover:bg-gray-300 rounded-md" href="https://benbinbin.github.io/" target="_blank"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="text-center space-y-0.5"><p class="text-sm text-gray-600"> ©2021 <span class="author">Benbinbin</span>. All Right Reserved. </p><p class="text-xs text-center text-gray-400"> 除特殊说明外，本站的文章遵循 <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" target="_blank" class="text-blue-400">CC-BY-SA-4.0</a> 协议 </p><p class="text-xs text-center text-gray-400"> 网站主题采用 <a href="https://github.com/Benbinbin/two-dishes-one-fish" target="_blank" class="text-blue-400">Two Dishes One Fish</a></p></div><div class="btn-container flex justify-center md:justify-end items-center space-x-0.5"><!--[--><a class="p-2 hover:bg-gray-300 rounded-md" href="mailto:benthomsonbin@gmail.com" target=""><img src="/blog-web/images/icons/email.svg" alt="email" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://github.com/Benbinbin" target="_blank"><img src="/blog-web/images/icons/github.svg" alt="github" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://juejin.cn/user/3175045314389278/posts" target="_blank"><img src="/blog-web/images/icons/juejin.svg" alt="juejin" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://dribbble.com/BinBinDesign" target="_blank"><img src="/blog-web/images/icons/dribbble.svg" alt="dribbble" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://twitter.com/Benbinbin_fun" target="_blank"><img src="/blog-web/images/icons/twitter.svg" alt="twitter" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://weibo.com/binbindesign" target="_blank"><img src="/blog-web/images/icons/weibo.svg" alt="weibo" class="w-auto h-6"></a><!--]--></div></footer></div><!--]--></div>
    <script type="module" src="/blog-web/assets/app.43fe0c63.js" defer></script>
  </body>
</html>
