# ç‰¹è‰²åŠŸèƒ½
Nuxt ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ç³»åˆ—çš„ç‰¹è‰²åŠŸèƒ½ï¼Œè®©å¼€å‘ä½“éªŒæ›´æµç•…ã€‚

## ç½‘é¡µå¤´éƒ¨
Nuxt æä¾›äº†å¤šç§æ–¹æ³•ä¸ºåº”ç”¨çš„æ‰€æœ‰ç½‘é¡µæˆ–ç‰¹å®šç½‘é¡µè®¾ç½®å¤´éƒ¨ `<head>` æ ‡ç­¾çš„ä¿¡æ¯ã€‚

Nuxt é»˜è®¤ä¸ºåº”ç”¨çš„æ¯ä¸ªç½‘é¡µçš„ `<head>` è®¾ç½®ä»¥ä¸‹ä¸¤ä¸ª `<meta>` æ ‡ç­¾ï¼š

* `<meta charset="UTF-8">`

* `<meta name="viewport" content="width=device-width, initial-scale=1.0">`

å¯ä»¥é€šè¿‡ Nuxt çš„[é…ç½®æ–‡ä»¶](https://v3.nuxtjs.org/api/configuration/nuxt.config#head) :page_facing_up: `nuxt.config.ts` çš„ä¸¤ä¸ªå±æ€§å¿«é€Ÿå¯¹è¿™ä¸¤ä¸ªé»˜è®¤çš„ `<meta>` æ ‡ç­¾è¿›è¡Œä¿®æ”¹

```ts
// ğŸ“„ nuxt.config.ts
import { defineNuxtConfig } from 'nuxt'

export default defineNuxtConfig({
  app: {
    // é…ç½®ç½‘é¡µå¤´éƒ¨
    // ä»¥ä¸‹æ˜¯é»˜è®¤å€¼
    head: {
      "charset": "utf-8",
      "viewport": "width=device-width, initial-scale=1",
      "meta": [],
      "link": [],
      "style": [],
      "script": []
    }
  }
})
```

ä¹Ÿå¯ä»¥ç”¨å…¶ä»–å±æ€§æ·»åŠ ä¸€äº›é¢å¤–çš„æ ‡ç­¾åˆ° Nuxt åº”ç”¨çš„æ¯ä¸ªé¡µé¢çš„ `<head>` å¤´éƒ¨å†…

```ts
// ğŸ“„ nuxt.config.ts
import { defineNuxtConfig } from 'nuxt'

export default defineNuxtConfig({
  app: {
    head: {
      meta: [
        // <meta name="viewport" content="width=device-width, initial-scale=1">
        { name: 'viewport', content: 'width=device-width, initial-scale=1' }
      ],
      script: [
        // <script src="https://myawesome-lib.js"></script>
        { src: 'https://awesome-lib.js' }
      ],
      link: [
        // <link rel="stylesheet" href="https://myawesome-lib.css">
        { rel: 'stylesheet', href: 'https://awesome-lib.css' }
      ],
      // please note that this is an area that is likely to change
      style: [
        // <style type="text/css">:root { color: red }</style>
        { children: ':root { color: red }', type: 'text/css' }
      ]
    }
  }
})
```

è¿˜å¯ä»¥ä½¿ç”¨ `useHead()` ç»„åˆå¼ API æ¥è®¾ç½®ç‰¹å®šçš„é¡µé¢ï¼ˆç»„ä»¶ï¼‰çš„å¤´éƒ¨ä¿¡æ¯ï¼Œå…¥å‚æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è¿”å›å¯¹è±¡çš„å‡½æ•°ï¼Œè¯¥å¯¹è±¡å¯ä»¥å…·æœ‰ä»¥ä¸‹å±æ€§ï¼š

* `title` è®¾ç½®ç½‘é¡µçš„æ ‡é¢˜
* `titleTemplate` è®¾ç½®ç½‘é¡µçš„æ ‡é¢˜æ¨¡æ¿
* `base` è®¾ç½®æ–‡æ¡£æ ¹ URL å…ƒç´ ï¼Œå³ [`<base>` æ ‡ç­¾](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/base)
* `script` è®¾ç½®è„šæœ¬
* `style` è®¾ç½®ç½‘é¡µæ ·å¼
* `meta` è®¾ç½®å…ƒä¿¡æ¯
* `link` è®¾ç½®æ ·å¼è¡¨
* `charset` è®¾ç½® `<meta charset="UTF-8">` æ ‡ç­¾
* `viewport` è®¾ç½® `<meta name="viewport" ...>` æ ‡ç­¾
* `htmlAttrs` ä¸º `<html>` å…ƒç´ æ·»åŠ å±æ€§
* `bodyAttrs` ä¸º `<body>` å…ƒç´ æ·»åŠ å±æ€§

```vue
<script setup>
useHead({
  // è®¾ç½®ç½‘é¡µçš„æ ‡é¢˜æ¨¡æ¿ï¼ŒåŸºäºåŸæœ‰çš„ç½‘é¡µæ ‡é¢˜è¿›è¡Œæ›´æ”¹
  titleTemplate: 'My App - %s', // or, title => `My App - ${title}`
  // è®¾ç½® <meta name="viewport" ...> æ ‡ç­¾
  viewport: 'width=device-width, initial-scale=1, maximum-scale=1',
  // è®¾ç½® <meta charset="UTF-8"> æ ‡ç­¾
  charset: 'utf-8',
  // æ·»åŠ  <meta> æ ‡ç­¾
  meta: [
    { name: 'description', content: 'My amazing site.' }
  ],
  // ä¸º <body> æ·»åŠ ç±»å
  bodyAttrs: {
    class: 'test'
  }
})
</script>
```

ä¾‹å¦‚åœ¨ç‰¹å®šé¡µé¢ä½¿ç”¨ `definePageMeta()` æ–¹æ³•ä¸ºè¯¥é¡µé¢æ‰€å¯¹åº”çš„è·¯ç”±æ·»åŠ å…ƒä¿¡æ¯ï¼Œç„¶åå†åœ¨å¸ƒå±€ç»„ä»¶ä¸­é€šè¿‡ `useHead()` æ¥åŸºäºè·¯ç”±å…ƒä¿¡æ¯ä¸ºç½‘é¡µè®¾ç½®å¤´éƒ¨ä¿¡æ¯ã€‚

```vue
<script setup>
// ğŸ“„ pages/some-page.vue
definePageMeta({
  title: 'Some Page'
})
</script>
```

```vue
<script setup>
// ğŸ“„ layouts/default.vue
const route = useRoute()

useHead({
  meta: [{ name: 'og:title', content: `App Name - ${route.meta.title}` }]
})
</script>
```

Nuxt è¿˜æä¾›äº†ä¸€äº›å†…ç½®çš„ç»„ä»¶æ¥è®¾ç½®ç½‘é¡µçš„å¤´éƒ¨ä¿¡æ¯ï¼š

* `<Title>`
* `<Base>`
* `<Script>`
* `<Meta>`
* `<Link>`
* `<Body>`
* `<Html>`
* `<Head>`

:bulb: åŸºäºä½¿ç”¨ä¹ æƒ¯ï¼Œå…è®¸åœ¨ `<Head>` å’Œ `<Body>` å†…éƒ¨åµŒå¥—ä½¿ç”¨å…¶ä»–çš„ç»„ä»¶ï¼Œä½†æ˜¯æœ€ç»ˆè¿™äº›ç”¨äºè®¾ç½®ç½‘é¡µå¤´éƒ¨ä¿¡æ¯çš„ç»„ä»¶æ¸²æŸ“æˆä¸ºç›¸åº”çš„ `<meta>` çš„ä½ç½®æ˜¯åœ¨ç½‘é¡µçš„å¤´éƒ¨æ ‡ç­¾å†…çš„

```vue
<script setup>
const title = ref('Hello World')
</script>

<template>
  <div>
    <Head>
      <Title>{{ title }}</Title>
      <Meta name="description" :content="title" />
      <Style type="text/css" children="body { background-color: green; }" />
    </Head>

    <h1>{{ title }}</h1>
  </div>
</template>
```

:warning: ç”±äºè¿™äº›ç»„ä»¶ä¸ HTML çš„æ ‡ç­¾ç±»ä¼¼ï¼Œæ‰€ä»¥è®°å¾—ä½¿ç”¨è¿™äº›ç»„ä»¶æ—¶ï¼Œå®ƒä»¬æ˜¯ä»¥å¤§å†™å¼€å¤´çš„

## æ•°æ®è·å–
Nuxt æä¾›äº†å¤šä¸ªç»„åˆå¼ API ç”¨äºè·å–æ•°æ®ï¼š

* `useAsyncData()` æ–¹æ³•ï¼šåœ¨é¡µé¢ã€ç»„ä»¶ã€æ’ä»¶ä¸­ä½¿ç”¨è¯¥æ–¹æ³•å¼‚æ­¥è·å–æ•°æ®ï¼Œå¯ä»¥ååºåˆ—åŒ–å“åº”è¿”å›çš„ JSON å¯¹è±¡ã€‚

  ```ts
  // æœåŠ¡ç«¯çš„ API
  // ğŸ“„ server/api/count.ts
  let counter = 0

  export default () => {
    counter++
    return JSON.stringify(counter)
  }
  ```

  ```vue
  <script setup>
  // å®¢æˆ·ç«¯åº”ç”¨
  // ğŸ“„ app.vue
  const { data } = await useAsyncData('count', () => $fetch('/api/count'))
  // $fetch ä¹Ÿæ˜¯ Nuxt æä¾›çš„ä¸€ä¸ªå‡½æ•°ï¼Œå°è£…äº† fetch æä¾›æ›´ä¸°å¯Œçš„åŠŸèƒ½
  // å¦‚æœç”¨äºå®¢æˆ·ç«¯çš„ä»£ç ä¸­ï¼Œè‹¥è¦è¯·æ±‚ Nuxt åº”ç”¨åœ¨æœåŠ¡ç«¯è®¾ç½®çš„ apiï¼Œå¯ä»¥åŸºäº url çš„ç›¸å¯¹è·¯å¾„å‘èµ·è¯·æ±‚
  // å¦‚æœç”¨äºæœåŠ¡ç«¯çš„ä»£ç ä¸­ï¼Œåˆ™æ˜¯è°ƒç”¨ç›¸åº”çš„æ–¹æ³•è·å–æ•°æ®ï¼Œè€Œä¸æ˜¯å‘èµ·å¼‚æ­¥è¯·æ±‚
  </script>

  <template>
    Page visits: {{ data }}
  </template>
  ```

  :bulb: è¯¥æ–¹æ³•é»˜è®¤ä¼š**é˜»ç¢è·¯ç”±å¯¼èˆª**ç›´åˆ°å¼‚æ­¥è¯·æ±‚çš„ç»“æœè¿”å›ï¼Œå¦‚æœå¸Œæœ›å…ˆåŠ è½½é¡µé¢ï¼Œç„¶åå†é€šè¿‡è¯¥æ–¹æ³•å¼‚æ­¥è·å–æ•°æ®ï¼Œå¯ä»¥åœ¨æ–¹æ³• `useAsyncData(key, handler, options)` ç¬¬ä¸‰ä¸ªï¼ˆå¯é€‰ï¼‰å‚æ•°ä¸­è®¾ç½®å±æ€§ `lazy` ä¸º `true`ï¼Œæ›´å¤šçš„è®¾ç½®å¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://v3.nuxtjs.org/api/composables/use-async-data/)ã€‚

* `useLazyAsyncData()` æ–¹æ³•ï¼šå’Œ `useAsyncData()` æ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºå¼‚æ­¥è·å–æ•°æ®ï¼Œä½†æ˜¯é‡‡ç”¨ã€Œæ‡’åŠ è½½ã€çš„æ–¹å¼ï¼Œå³ä¸é˜»ç¢é¡µé¢/è·¯ç”±çš„åŠ è½½ï¼Œç­‰åˆ°é¡µé¢åŠ è½½åè¯¥æ–¹æ³•å†å¼‚æ­¥è·å–æ•°æ®ã€‚

  :warning: ç”±äºè¯¥æ–¹æ³•ä¸ä¼šé˜»ç¢è·¯ç”±å¯¼èˆªï¼Œæ‰€ä»¥åœ¨è®¾è®¡é¡µé¢æ—¶éœ€è¦èƒ½å¤Ÿ**å¤„ç†æœªè·å–åˆ°æ•°æ®çš„æƒ…å†µ**ï¼ˆæ•°æ®å¯ä»¥æ˜¯ `null` æˆ–ç”±è¯¥æ–¹æ³•çš„ `default` å·¥å‚å‡½æ•°æä¾›çš„é»˜è®¤å€¼ï¼‰ã€‚

  ```vue
  <template>
    <div>
      {{ pending ? 'Loading' : count }}
    </div>
  </template>

  <script setup>
  /* Navigation will occur before fetching is complete.
    Handle pending and error states directly within your component's template
  */
  const { pending, data: count } = useLazyAsyncData('count', () => $fetch('/api/count'))

  // é€šè¿‡ç›‘å¬ count ç­‰åˆ°å®ƒè·å–åˆ°æ•°æ®æ—¶å†æ‰§è¡Œç›¸åº”çš„æ“ä½œ
  watch(count, (newCount) => {
    // Because count starts out null, you won't have access
    // to its contents immediately, but you can watch it.
  })
  </script>
  ```

* `useFetch()` æ–¹æ³•ï¼šä¸€ä¸ªé€šç”¨çš„è·å–æ•°æ®çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼š**é˜»ç¢è·¯ç”±å¯¼èˆª**ã€‚

  å®ƒå°è£…äº† `useAsyncData()` æ–¹æ³•å’Œ `$fetch()` æ–¹æ³•ï¼Œå®ƒä½¿ç”¨èµ·æ¥æ›´ç®€å•ï¼Œç›´æ¥ä»¥ URL ä½œä¸ºå‚æ•°å³å¯ï¼Œè¯¥æ–¹æ³•ä¼šåŸºäº URL è‡ªåŠ¨ç”Ÿæˆ `key`ï¼ˆè€Œ `useAsyncData()` æ–¹æ³•å’Œ `useLazyAsyncData()` æ–¹æ³•éƒ½éœ€è¦æ‰‹åŠ¨è®¾ç½®ï¼‰ï¼Œæ›´å¤šçš„è®¾ç½®å¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://v3.nuxtjs.org/api/composables/use-fetch/)ã€‚

  ```vue
  <script setup>
  const { data } = await useFetch('/api/count')
  </script>

  <template>
    Page visits: {{ data.count }}
  </template>
  ```

* `useLazyFetch()` æ–¹æ³•ï¼šå’Œ `useFetch()` æ–¹æ³•ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé€šç”¨çš„è·å–æ•°æ®çš„æ–¹æ³•ï¼Œä½†æ˜¯é‡‡ç”¨ã€Œæ‡’åŠ è½½ã€çš„æ–¹å¼ï¼Œå³ä¸é˜»ç¢é¡µé¢/è·¯ç”±çš„åŠ è½½ï¼Œæ‰€ä»¥åœ¨è®¾è®¡é¡µé¢æ—¶éœ€è¦èƒ½å¤Ÿ**å¤„ç†æœªè·å–åˆ°æ•°æ®çš„æƒ…å†µ**ã€‚

  ```vue
  <template>
    <!-- you'll need to handle a loading state -->
    <div v-if="pending">
      Loading ...
    </div>
    <div v-else>
      <div v-for="post in posts">
        <!-- do something -->
      </div>
    </div>
  </template>

  <script setup>
  /* Navigation will occur before fetching is complete.
    Handle pending and error states directly within your component's template
  */
  const { pending, data: posts } = useLazyFetch('/api/posts')

  watch(posts, (newPosts) => {
    // Because posts starts out null, you won't have access
    // to its contents immediately, but you can watch it.
  })
  </script>
  ```

:bulb: è¿™äº›ç»„åˆå¼ API éƒ½åªèƒ½ç”¨äº Vue ç»„ä»¶çš„ `setup()` æˆ–ç›¸åº”çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¸­ã€‚

æœ‰æ—¶å€™åœ¨é¡µé¢åŠ è½½æ•°æ®åï¼ŒæœåŠ¡å™¨çš„æ•°æ®æ›´æ–°äº†æˆ–ç”¨æˆ·åˆ‡æ¢åˆ†é¡µæ—¶ï¼Œéœ€è¦æ›´æ–°é¡µé¢ä¸Šçš„æ•°æ®ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨ä»¥ä¸Šå››ç§æ–¹æ³•åœ¨å“åº”è¿”å›çš„å¯¹è±¡ä¸­æ‰€æä¾›çš„ **`refresh()` å‡½æ•°**ï¼Œè¯¥å‡½æ•°ç›¸å½“äºåŸæœ‰æ–¹æ³•çš„ä¸€ä¸ª**å¿«æ·æ–¹å¼**ï¼Œé€šè¿‡è°ƒç”¨å®ƒæ¥å†æ¬¡å‘åŸæœ‰çš„ URLï¼ˆå¦‚æœ URL æ˜¯æ‹¼æ¥è€Œæˆçš„ï¼Œä¹Ÿæ˜¯é‡‡ç”¨å½“å‰çš„å‚æ•°å‡­å€Ÿå‡º URLï¼Œåˆ™ä¸ä¸€å®šä¸åŸæ¥çš„ URL ç›¸åŒï¼‰å‘é€è¯·æ±‚ï¼Œå¹¶å°†è·å–çš„çš„æ–°æ•°æ®æ›´æ–°åˆ°é¡µé¢ä¸Šã€‚

```vue
<script setup>
const page = ref(1);

const { data:users, loading, refresh, error } = await useFetch(
  () => `users?page=${page.value}&take=6`, { baseURL: config.API_BASE_URL }
);

// ç”¨æˆ·å‘å‰æˆ–å‘åç¿»é¡µæ—¶
// é€šè¿‡è°ƒç”¨ refresh() å†æ¬¡å‘ç›¸åº”çš„ URL å‘é€è¯·æ±‚ï¼Œä»¥è·å–æ–°çš„æ•°æ®
function previous(){
  page.value--;
  refresh();
}

function next() {
  page.value++;
  refresh();
}
</script>
```

:bulb: å¦‚æœé¡µé¢ä½¿ç”¨äº†ç¼“å­˜ï¼Œå¯ä»¥é€šè¿‡ `refreshNuxtData()` [æ–¹æ³•](https://v3.nuxtjs.org/api/utils/refresh-nuxt-data/)æ¥å–æ¶ˆ**å¼ºè¡Œè¿›è¡Œåˆ·æ–°**ï¼ˆé‡æ–°å‘ç”Ÿè¯·æ±‚è·å–æ•°æ®ï¼‰

```vue
<template>
  <div>
    {{ pending ? 'Loading' : count }}
  </div>
  <button @click="refresh">Refresh</button>
</template>

<script setup>
const { pending, data: count } = useLazyAsyncData('count', () => $fetch('/api/count'))

const refresh = () => refreshNuxtData('count')
// å¯ä»¥æŒ‡å®š key ä»¥åˆ·æ–°ï¼ˆç”± useAsyncData() æ–¹æ³•å’Œ useLazyAsyncData() æ–¹æ³•è·å–çš„ï¼‰æŒ‡å®šçš„æ•°æ®
// å¦‚æœä¸æŒ‡å®š key å°±ä¼šåˆ·æ–°æ‰€æœ‰é€šè¿‡ useAsyncData() æ–¹æ³•ï¼ˆæˆ– useLazyAsyncData() æ–¹æ³•ï¼‰å’Œ useFetch()ï¼ˆæˆ– useLazyFetch() æ–¹æ³•ï¼‰è·å–çš„ æ•°æ®
</script>
```

:warning: å¯¹äºè¯·æ±‚éœ€è¦[è®¾ç½®å¤´éƒ¨ä¿¡æ¯](https://v3.nuxtjs.org/guide/features/data-fetching#example-pass-client-headers-to-the-api)æˆ–[é™„å¸¦ Cookie](https://v3.nuxtjs.org/guide/features/data-fetching#example-pass-on-cookies-from-server-side-api-calls-on-ssr-response) çš„åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯åœ¨ SSR æœåŠ¡ç«¯æ¸²æŸ“è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://v3.nuxtjs.org/guide/features/data-fetching#isomorphic-fetch-and-fetch)ã€‚

## çŠ¶æ€ç®¡ç†
Nuxt æä¾›äº†[ä¸€ä¸ªç»„åˆå¼ API](https://v3.nuxtjs.org/api/composables/use-state/) `useState()` æ¥åˆ›å»ºä¸€ä¸ªå“åº”å¼çŠ¶æ€ï¼Œå®ƒç”¨äºæ›¿ä»£ Vue çš„ç»„åˆå¼ API `ref()`ï¼Œå¯åŒæ—¶**é€‚ç”¨äº SSR æœåŠ¡ç«¯æ¸²æŸ“**ï¼Œåˆå§‹åŒ–åå¯ä»¥ä¼ é€’ç»™å‰ç«¯çš„å„ç»„ä»¶ä½¿ç”¨ã€‚

è¯¥æ–¹æ³•å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•° `useState(key, initFn)` ç¬¬ä¸€ä¸ªå‚æ•° `key` æ˜¯è¯¥çŠ¶æ€çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼›ç¬¬äºŒä¸ªï¼ˆå¯é€‰ï¼‰å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè®¾ç½®çŠ¶æ€çš„åˆå§‹å€¼ã€‚

:warning: `useState()` åªå¯ç”¨äº `setup()` å’Œ Vue çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¸­ã€‚

```vue
<script setup>
const counter = useState('counter', () => Math.round(Math.random() * 1000))
</script>

<template>
  <div>
    Counter: {{ counter }}
    <button @click="counter++">
      +
    </button>
    <button @click="counter--">
      -
    </button>
  </div>
</template>
```

ä»¥ä¸Šä¾‹å­åœ¨ä¸€ä¸ªç»„ä»¶å†…ä½¿ç”¨ `useState()` æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ª key ä¸º `counter` çš„å“åº”å¼çŠ¶æ€ï¼Œå¯ä»¥ç”¨äºè¯¥ç»„ä»¶å†…ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶ä»–ç»„ä»¶é€šè¿‡ `useState('counter')`ï¼ˆå½“ç„¶å¯ä»¥ç›´æ¥ä½¿ç”¨å˜é‡ `counter`ï¼‰æ¥è·å–è¯¥çŠ¶æ€çš„å€¼ :question:ã€‚

## æ’ä»¶
Nuxt æ”¯æŒä½¿ç”¨æ’ä»¶ä»¥æ‰©å±•åŠŸèƒ½ã€‚

## æœåŠ¡ç«¯è·¯ç”±
Nuxt ä¼šåŸºäºé¡¹ç›®çš„æ–‡ä»¶ç»“æ„æ¥æ„å»ºåº”ç”¨çš„ï¼Œä»¥ä¸‹ 3 ä¸ªæ–‡ä»¶å¤¹ä¼šè¢«è‡ªåŠ¨æ‰«æï¼Œé‡Œé¢çš„æ–‡ä»¶ä¼šè¢«ç”¨äºæ³¨å†ŒæœåŠ¡ç«¯çš„ APIï¼š

* :file_folder: `~/server/api` æ–‡ä»¶å¤¹ï¼šNuxt ä¼šè‡ªåŠ¨åŸºäºè¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ›å»ºå‰ç¼€ä¸º `/api` çš„è·¯ç”±

  ```ts
  // åœ¨æœåŠ¡ç«¯å®šä¹‰ä¸€ä¸ª API
  // ğŸ“„ /server/api/hello.ts
  export default defineEventHandler((event) => {
    return {
      api: 'works'
    }
  })
  // ç„¶åå¯ä»¥åœ¨å®¢æˆ·ç«¯é€šè¿‡ `await $fetch('/api/hello')` æ¥å‘é€è¯·æ±‚
  ```

  Nuxt é™¤äº†åŸºäºé¡¹ç›®çš„æ–‡ä»¶å¤¹ç»“æ„æ¥æ„å»ºè·¯ç”±ï¼Œè¿˜å¯ä»¥åŸºäº**æ–‡ä»¶å**æ¥åˆ›å»ºè·¯ç”±

    * å¯ä»¥åœ¨æ–‡ä»¶åä¸­ä½¿ç”¨æ–¹æ‹¬å· `[]` æ¥åˆ›å»º**åŠ¨æ€è·¯ç”±**ï¼Œä¾‹å¦‚é€šè¿‡æ–‡ä»¶ `~/server/api/hello/[name].ts` åˆ›å»ºäº†ä¸€ä¸ªåŠ¨æ€è·¯ç”±

      ```ts
      // ğŸ“„ /server/api/hello/[name].ts
      // é€šè¿‡ event.context.params è·å–è¯¥åŠ¨æ€è·¯ç”±çš„å‚æ•°å€¼
      export default defineEventHandler(event => `Hello, ${event.context.params.name}!`)
      ```

      å½“å‰ç«¯å‘é€è¯·æ±‚ `await $fetch('/api/hello/ben')` æ—¶ï¼Œåˆ™å¯ä»¥è·å¾—çš„å“åº”å€¼æ˜¯ `Hello, ben!`

      :tada: å¯ä»¥é€šè¿‡ `[...]` æ¥åŒ¹é…æ‰€æœ‰çš„ URLï¼Œå³è®¾ç½®ä¸€ä¸ªé€šç”¨çš„è·¯ç”±ï¼Œä¾‹å¦‚åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ `~/server/api/foo/[...].ts` å¯ä»¥å“åº”ä¸€ç³»åˆ—çš„è¯·æ±‚ï¼Œè­¬å¦‚å‘ `/api/foo/bar/baz` å‘é€çš„è¯·æ±‚ã€‚

  * å¯ä»¥å°†è¯·æ±‚çš„æ–¹æ³•ä½œä¸ºæ–‡ä»¶åçš„åç¼€ï¼Œä¸ºåŒä¸€ä¸ªæœåŠ¡ç«¯è·¯ç”±çš„**ä¸åŒè¯·æ±‚æ–¹å¼è®¾ç½®ä¸åŒçš„å¤„ç†å‡½æ•°**

    ```ts
    // ğŸ“„ /server/api/test.get.ts
    // å¤„ç†ä½¿ç”¨ GET æ–¹æ³•å‘è¯¥è·¯ç”±å‘é€è¿‡æ¥çš„è¯·æ±‚
    export default defineEventHandler(() => 'Test get handler')
    ```

    ```ts
    // ğŸ“„ /server/api/test.post.ts
    // å¤„ç†ä½¿ç”¨ POST æ–¹æ³•å‘è¯¥è·¯ç”±å‘é€è¿‡æ¥çš„è¯·æ±‚
    export default defineEventHandler(() => 'Test post handler')
    ```

    ä»¥ä¸Šä¾‹å­ä¸º `/test` è·¯ç”±è®¾ç½®äº†ä¸¤ä¸ªå¤„ç†å‡½æ•°ï¼Œåªæœ‰å½“é‡‡ç”¨ `GET` å’Œ `POST` æ–¹æ³•æ¥å‘è¯¥ API å‘é€è¯·æ±‚æ—¶æ‰ä¼šæ¥æ”¶åˆ°å“åº”ï¼Œå…¶ä»–æ–¹æ³•ä¼šè¿”å› `404` é”™è¯¯æç¤ºã€‚

    å› ä¸ºä¸åŒçš„è¯·æ±‚æ–¹æ³•ä¼ é€’çš„ä¿¡æ¯å’Œæ ¼å¼ä¸ç›¸åŒï¼ˆä¾‹å¦‚ä½¿ç”¨ POST æ–¹æ³•å‘é€è¯·æ±‚æ—¶ï¼Œå¯ä»¥åŒæ—¶å‘é€è¯·æ±‚ä½“ï¼‰ï¼Œéœ€è¦ä¸åŒçš„å¤„ç†æ‰‹æ®µã€‚

    ```ts
    // ğŸ“„ /server/api/submit.post.ts
    export default defineEventHandler(async (event) => {
        // ä½¿ç”¨ useBody() æ–¹æ³•è·å–è¯·æ±‚ä½“
        const body = await useBody(event)
        return { body }
    })
    ```

    ä»¥ä¸Šçš„æœåŠ¡å™¨è·¯ç”±å¤„ç†å‡½æ•°åªä¼šå“åº”é€šè¿‡ `POST` å‘é€çš„è¯·æ±‚ï¼Œè¿™æ ·åœ¨å¤„ç†å‡½æ•°å†…å°±å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨ç»„åˆå¼ API `useBody()` è·å–è¯·æ±‚ä½“ã€‚å¦‚æœå¤„ç†å‡½æ•°ä¸å¯¹è¯·æ±‚æ–¹æ³•åŠ ä»¥åŒºåˆ†ï¼Œå¯¹é€šè¿‡ `GET` æ–¹æ³•å‘é€è¿‡æ¥çš„è¯·æ±‚ä¹Ÿè°ƒç”¨äº† `useBody(event)`ï¼Œåˆ™ä¼šå¼•èµ· `405 Method Not Allowed` çš„é”™è¯¯ã€‚

  :bulb: å¦‚æœä¸æƒ³æ·»åŠ  `/api` å‰ç¼€ï¼Œå¯ä»¥å°†æ–‡ä»¶æ”¾ç½®åœ¨ :file_folder: `~/server/routes` ç›®å½•ä¸‹

* :file_folder: `~/server/routes` æ–‡ä»¶å¤¹

  ```ts
  // ğŸ“„ /server/routes/hello.ts
  // åˆ›å»ºä¸€ä¸ª /hello è·¯ç”±
  export default defineEventHandler(() => 'Hello World!')
  // å¦‚æœåœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œåˆ™å¯ä»¥åœ¨å®¢æˆ·ç«¯é€šè¿‡ http://localhost:3000/hello è®¿é—®è¯¥ API
  ```

* :file_folder: `~/server/middleware` æ–‡ä»¶å¤¹ï¼šNuxt ä¼šå°†è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ä½œä¸ºæœåŠ¡å™¨çš„ä¸­é—´ä»¶ï¼Œå®ƒä»¬ä¼šåœ¨æ¯ä¸€ä¸ªè¯·æ±‚è¿›å…¥æœåŠ¡å™¨ç›¸åº”è·¯ç”±å‰æ‰§è¡Œï¼Œä»¥ä¾¿æ£€æŸ¥è¯·æ±‚æˆ–ä¿®æ”¹è¯·æ±‚å†…å®¹ã€‚

  :warning: ä¸­é—´ä»¶çš„å¤„ç†å‡½æ•°ä¸åº”è¯¥é˜»æ­¢è¯·æ±‚æˆ–è¿”å›ä»»ä½•å€¼ä½œä¸ºå“åº”ï¼Œå®ƒä»¬åº”è¯¥åªæ£€æŸ¥è¯·æ±‚ï¼Œæˆ–æ‰©å±•è¯·æ±‚å†…å®¹ï¼Œæˆ–æŠ›å‡ºé”™è¯¯ã€‚

  ```ts
  // ğŸ“„ /server/middleware/log.ts
  // è®¾ç½®ä¸€ä¸ªä¸­é—´ä»¶
  // å…¶ä½œç”¨æ˜¯è¾“å‡ºæ¯ä¸€ä¸ªè¯·æ±‚çš„ç›®æ ‡ url
  export default defineEventHandler((event) => {
    console.log('New request: ' + event.req.url)
  })
  ```

  ```ts
  // ğŸ“„ /server/middleware/auth.ts
  // è®¾ç½®ä¸€ä¸ªä¸­é—´ä»¶
  // å…¶ä½œç”¨æ˜¯ä¸ºæ¯ä¸€ä¸ªè¯·æ±‚çš„å†…å®¹ä¸­æ·»åŠ ä¸€ä¸ªå±æ€§ auth
  export default defineEventHandler((event) => {
    event.context.auth = { user: 123 }
  })
  ```

:bulb: è¿™äº›æ–‡ä»¶å¤¹ä¸­çš„æ¯ä¸ªæ–‡ä»¶æœ€åéƒ½åº”è¯¥**å¯¼å‡ºä¸€ä¸ª `defineEventHandle(handler)` å‡½æ•°**ä»¥å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„ç›¸åº”è¯·æ±‚ã€‚

è¯¥å¤„ç†å‡½æ•° `handler(event)` çš„å…¥å‚æ˜¯ `event` å³å¯ä»¥æ˜¯è¯·æ±‚å¯¹è±¡ï¼ˆå¦‚æœè¯·æ±‚æ˜¯åœ¨å‰ç«¯å‘å‡ºçš„ï¼‰ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºäº‹ä»¶å¯¹è±¡ï¼ˆå¦‚æœä»£ç æ˜¯åœ¨ SSR æ¸²æŸ“æ—¶æ‰§è¡Œçš„ï¼Œæ˜¯ç”±æœåŠ¡å™¨å‘å‡ºçš„æ¨¡æ‹Ÿè¯·æ±‚ï¼Œå®é™…æ˜¯åˆ†å‘ç›¸åº”çš„äº‹ä»¶ï¼Œä»¥è§¦å‘å¤„ç†å‡½æ•° :question:ï¼‰ã€‚å¤„ç†å‡½æ•° `handler` æœ€ååº”è¯¥è¿”å›ä¸€ä¸ª JSON å¯¹è±¡æˆ–ä¸€ä¸ª Promise ä½œä¸ºå“åº”ï¼Œæˆ–ä½¿ç”¨ `event.res.end()` æ¥å‘é€å“åº”ï¼ˆä½†æ²¡æœ‰è¿”å›å…·ä½“çš„å†…å®¹ï¼‰ã€‚

Nuxt çš„æœåŠ¡å™¨è·¯ç”±æ˜¯ç”± `h3` åº“æ¥æ”¯æŒçš„ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—çš„ helper å‡½æ•°ï¼Œä»¥æ›´æ–¹ä¾¿åœ°è·å–è¯·æ±‚çš„æ•°æ®æˆ–æ„å»ºå“åº”æ•°æ®ç­‰ï¼š

* `useBody(event)` æ–¹æ³•ï¼šè·å–è¯·æ±‚ä½“
* `useQuery(event)` æ–¹æ³•ï¼šè·å–è¯·æ±‚å‚æ•°
* `useRUntimeConfig()` æ–¹æ³•ï¼šè·å–è¿è¡Œæ—¶çš„é…ç½®
* `useCookies(event)` æ–¹æ³•ï¼šè·å–è¯·æ±‚æ‰€é™„å¸¦çš„ Cookies

å…·ä½“å¯ä»¥è¯¥åº“çš„å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://github.com/unjs/h3)ã€‚ä¹Ÿå¯ä»¥åœ¨ :file_folder: `~/server/utils` æ–‡ä»¶å¤¹ä¸­åˆ›å»ºæœåŠ¡å™¨è·¯ç”±çš„è‡ªå®šä¹‰ helper å‡½æ•°ã€‚

:bulb: æ›´å¤šæœåŠ¡å™¨è·¯ç”±é…ç½®å’Œæ›´é«˜çº§çš„å¤„ç†è¯·æ±‚çš„åœºæ™¯å¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://v3.nuxtjs.org/guide/features/server-routes#advanced-usage-examples)

## è¿è¡Œæ—¶é…ç½®å¯¹è±¡
Nuxt æä¾›äº† API å»è®¿é—®è¿è¡Œæ—¶çš„é…ç½®å¯¹è±¡ï¼Œå¯ä»¥åœ¨åº”ç”¨ä¸­æˆ–æœåŠ¡å™¨çš„è·¯ç”±å¤„ç†å‡½æ•°ä¸­åŠæ—¶æ›´æ–°è¿è¡Œæ—¶çš„é…ç½®ã€‚

é¦–å…ˆéœ€è¦å…ˆåœ¨ Nuxt çš„é…ç½®æ–‡ä»¶ :page_facing_up: `nuxt.config.ts` ä¸­è®¾ç½®ä¸€äº›è¿è¡Œæ—¶ç›¸å…³çš„å‚æ•°ï¼Œå¯ä»¥è®¾ç½®**ä»…å…è®¸æœåŠ¡ç«¯è®¿é—®**çš„è¿è¡Œæ—¶å±æ€§ï¼Œä»¥åŠ**æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½å¯ä»¥è®¿é—®**çš„å±æ€§ã€‚

```ts
// ğŸ“„ nuxt.config.ts
export default defineNuxtConfig({
  runtimeConfig: {
    // The private keys which are only available within server-side
    apiSecret: '123',
    // Keys within public, will be also exposed to the client-side
    public: {
      apiBase: '/api'
    }
  }
})
```

ç„¶ååœ¨åº”ç”¨çš„æ¯ä¸ªé¡µé¢é™„åŠ ä¿¡æ¯ payload ä¸­éƒ½å«æœ‰è¿è¡Œæ—¶é…ç½®å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ç»„åˆå¼ API `useRuntimeConfig()` è·å–

```ts
const runtimeConfig = useRuntimeConfig()

console.log(runtimeConfig.apiSecret)
console.log(runtimeConfig.public.apiBase)
```

:bulb: æ­¤å¤– Nuxt CLI å†…ç½®äº† [dotenv](https://github.com/motdotla/dotenv)ï¼Œå› æ­¤åŸç”Ÿæ”¯æŒä¸ºé¡¹ç›®è®¾ç½®ç¯å¢ƒå˜é‡ environment variableï¼Œè¿™å¯¹äºä¸€äº›å‚æ•°åœ¨å¼€å‘è°ƒè¯•ç¯å¢ƒå’Œçº¿ä¸Šéƒ¨ç½²ç¯å¢ƒé‡‡ç”¨ä¸åŒçš„å€¼æ—¶ï¼Œæ›´æ–¹ä¾¿è¿›è¡Œåˆ‡æ¢ã€‚

å¯ä»¥åœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»º :page_facing_up: `.env` æ–‡ä»¶ï¼Œåœ¨è¯¥æ–‡ä»¶å†…è®¾ç½®ç¯å¢ƒå˜é‡

```
// ğŸ“„ .env
NUXT_API_SECRET=api_secret_token
NUXT_PUBLIC_BASE_URL=https://nuxtjs.org
```

ç„¶å Nuxt ä¼šå°†è¿™äº›ç¯å¢ƒå˜é‡åŠ è½½åˆ°é¡¹ç›®ä¸­ï¼Œå¯ä»¥é€šè¿‡ `process.env` æ¥è®¿é—®ï¼Œä¾‹å¦‚ `process.env.NUXT_API_SECRET`ã€‚

:tada: æ­¤å¤– Nuxt ä¼šåœ¨é¡¹ç›®è¿è¡Œçš„æ—¶å€™ï¼Œ**è‡ªåŠ¨å°†è¿è¡Œæ—¶é…ç½®ä¸­ã€ŒåŒåã€çš„å±æ€§æ›¿æ¢ä¸ºç¯å¢ƒå˜é‡çš„å€¼**ï¼Œæ‰€ä»¥ Nuxt çš„é…ç½®æ–‡ä»¶ :page_facing_up: `nuxt.config.ts` ä¸­æ‰€è®¾ç½®çš„å¯èƒ½åªæ˜¯è¿™äº›å±æ€§çš„é»˜è®¤å€¼

```ts
// ğŸ“„ nuxt.config.ts
export default defineNuxtConfig({
  runtimeConfig: {
    apiSecret: '',
    public: {
      apiBase: '', // Or a default value
    }
  },
})
```