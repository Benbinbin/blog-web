# å¼€å‘é…ç½®

åœ¨å¼€å‘å‰ï¼Œéœ€è¦åœ¨ç³»ç»Ÿé¢„å…ˆå®‰è£…ä»¥ä¸‹è½¯ä»¶å’Œæ’ä»¶ï¼š

* [Node.js](https://nodejs.org/en/download/)

* [Visual Studio Code](https://code.visualstudio.com/)

* [Volar æ’ä»¶](https://marketplace.visualstudio.com/items?itemName=johnsoncodehk.volar)

  :bulb: å¹¶åœæ‰ VSCode å†…ç½®çš„ TypeScript æ’ä»¶ï¼Œå¼€å¯ [Take Over Mode](https://github.com/johnsoncodehk/volar/discussions/471) åªé€šè¿‡ Volar æä¾› Vue å’Œ TypeScript çš„æ”¯æŒã€‚

  * Volar ç‰ˆæœ¬éœ€è¦é«˜äº 0.27.17
  * æŒ‰ä¸‹å¿«æ·é”® `Ctrl + Shift + P` å‘¼å‡ºå‘½ä»¤é¢æ¿ï¼Œå¹¶è¾“å…¥ `Extensions: Show Built-in Extensions` å‘½ä»¤ï¼Œæ‰“å¼€å†…ç½®çš„æ’ä»¶
  * æ‰¾åˆ° `TypeScript and JavaScript Language Features` æ’ä»¶ï¼Œå³é”®ç‚¹å‡»ï¼Œé€‰æ‹© `Disable (Workspace)` èœå•é€‰é¡¹ï¼Œåœ¨å½“å‰é¡¹ç›®çš„å·¥ä½œåŒºä¸­ç¦æ­¢ä½¿ç”¨å†…ç½®çš„ TypeScript æ’ä»¶
  * é‡å¯ VSCode
  * è¿˜è¦è®°å¾—åœ¨ Nuxt é¡¹ç›®çš„é…ç½®æ–‡ä»¶ `nuxt.config.ts` è¿›è¡Œä»¥ä¸‹è®¾ç½®ï¼Œä»¥å–æ¶ˆä¸º `*.vue` æ–‡ä»¶ç”Ÿæˆç›¸åº”çš„ shim æ–‡ä»¶ï¼ˆTS å£°æ˜æ–‡ä»¶ï¼‰

    ```ts
    // ...
    export default defineNuxtConfig({
      typescript: {
        shim: false
      }
    })
    ```

## æ–°å»ºé¡¹ç›®
Nuxt å®˜æ–¹æä¾›äº†ä¸€ä¸ª CLI å‘½ä»¤è¡Œå·¥å…· [nuxi](https://www.npmjs.com/package/@nuxt/cli) å’Œä¸€ä¸ªä½œä¸ºã€Œèµ·æ‰‹å¼ã€çš„[æ¨¡æ¿](https://github.com/nuxt/starter/tree/v3)ï¼Œåœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥ä½¿ç”¨è¯¥æ¨¡æ¿æ–°å»ºé¡¹ç›®

```bash
npx nuxi init nuxt3-app
```

ç„¶åä½¿ç”¨ VSCode æ‰“å¼€è¯¥é¡¹ç›®ï¼Œå¹¶åœ¨ VSCode æ•´åˆçš„ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£…é¡¹ç›®ä¾èµ–

```bash
npm install
```

æœ€ååœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ï¼Œé¢„è§ˆé¡¹ç›®æ•ˆæœ

```bash
npm run dev -- -o
```

## æ–‡ä»¶ç³»ç»Ÿ
ä¸€èˆ¬ Nuxt é¡¹ç›®ä¼šå…·æœ‰ä»¥ä¸‹æ–‡ä»¶ç³»ç»Ÿ

```
ğŸ“‚ root
 |-- ğŸ“ .nuxt
 |-- ğŸ“ .output
 |-- ğŸ“ assets
 |-- ğŸ“ components
 |-- ğŸ“ composables
 |-- ğŸ“ layouts
 |-- ğŸ“ middleware
 |-- ğŸ“ node_modules
 |-- ğŸ“ pages
 |-- ğŸ“ plugins
 |-- ğŸ“ public
 |-- ğŸ“ server
 |-- ğŸ“„ .gitignore
 |-- ğŸ“„ .nuxtignore
 |-- ğŸ“„ app.vue
 |-- ğŸ“„ nuxt.config.ts
 |-- ğŸ“„ package.json
 |-- ğŸ“„ tsconfig.json
```

### .nuxt ç›®å½•

:file_folder: `.nuxt` ç›®å½•æ˜¯åœ¨å¼€å‘ç¯å¢ƒä¸‹(æ‰§è¡Œ `nuxt dev` å‘½ä»¤æ—¶ï¼‰Nuxt è‡ªåŠ¨ç”Ÿæˆçš„ç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸­å­˜æ”¾çš„æ˜¯è¯¥é¡¹ç›®çš„å‰ç«¯éƒ¨åˆ†ï¼ˆå³ Vue åº”ç”¨ï¼‰ï¼Œä¸€èˆ¬ä¸éœ€è¦å¯¹è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€‚

è¯¥ç›®å½•åœ¨æ‰§è¡Œ `nuxt dev` å‘½ä»¤æ—¶ä¼šé‡æ–°ç”Ÿæˆã€‚

### .output ç›®å½•
:file_folder: `.output` ç›®å½•æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹(æ‰§è¡Œ `nuxt build` å‘½ä»¤æ—¶ï¼‰Nuxt è‡ªåŠ¨ç”Ÿæˆçš„ç›®å½•ï¼Œè¯¥é¡¹ç›®å­˜æ”¾é€‚ç”¨äºéƒ¨ç½²çš„ Nuxt åº”ç”¨ï¼Œä¸€èˆ¬ä¸éœ€è¦å†å¯¹è¯¥ç›®å½•ä¸‹æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼Œå¯ä»¥ç›´æ¥ç”¨äº[éƒ¨ç½²](https://v3.nuxtjs.org/guide/deploy)ã€‚

è¯¥ç›®å½•åœ¨æ‰§è¡Œ `nuxt build` å‘½ä»¤æ—¶é‡æ–°ç”Ÿæˆã€‚

### assets ç›®å½•
:file_folder: `assets` ç›®å½•æ˜¯ç”¨äºå­˜æ”¾é¡¹ç›®çš„èµ„äº§æ–‡ä»¶ï¼Œä¾‹å¦‚æ ·å¼è¡¨ã€å­—ä½“ã€å›¾ç‰‡ï¼ˆè¾ƒå°çš„å›¾ç‰‡ï¼‰ç­‰ï¼Œå®ƒä»¬ä¼šè¢« Nuxt å‹ç¼©å¤„ç†ï¼Œæ•´åˆï¼ˆå†…åµŒï¼‰åˆ°å‰ç«¯é¡µé¢ä¸­

:bulb: å¦‚æœå¸Œæœ›å°†æ–‡ä»¶æ‰˜ç®¡åˆ°çº¿ä¸ŠæœåŠ¡å™¨ä¸­ï¼Œå¯ä»¥æ”¾ç½®åœ¨ :file_folder: `public` ç›®å½•ä¸­

### components ç›®å½•
:file_folder: `components` ç›®å½•æ˜¯ç”¨äºå­˜æ”¾ Vue ç»„ä»¶ã€‚

Nuxt ä¼šå°†è¯¥ç›®å½•ä¸‹çš„ç»„ä»¶**è‡ªåŠ¨å¯¼å…¥**åˆ°ç›¸åº”çš„é¡µé¢å’Œå…¶ä»–ç»„ä»¶ä¸­ï¼Œå³åœ¨å…¶ä»– `*.vue` æ–‡ä»¶ä¸­ç”¨è¯¥ç›®å½•é‡Œçš„ç»„ä»¶æ—¶ï¼Œä¸éœ€è¦å†™ `import xxx from '/components/xxx'` è¿™æ ·ç¹ççš„è¯­å¥ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

```
// è¯¥ç›®å½•ä¸‹æœ‰ä¸¤ä¸ªç»„ä»¶
ğŸ“‚ components/
  |-- ğŸ“„ TheHeader.vue
  |-- ğŸ“„ TheFooter.vue
```

```vue
// åœ¨å¸ƒå±€æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨ç»„ä»¶
<template>
  <div>
    <TheHeader />
    <slot />
    <TheFooter />
  </div>
</template>
```

:tada: é€šè¿‡æ¨¡å— modules ä¸ºé¡¹ç›®æ³¨å†Œçš„ç»„ä»¶ä¹ŸåŒæ ·æ”¯æŒè‡ªåŠ¨å¯¼å…¥

:bulb: è¯¥ç›®å½•ä¸‹çš„ç»„ä»¶çš„å®é™…åç§°æ˜¯ç”±å…¶æ‰€åœ¨è·¯å¾„æ„æˆçš„ï¼Œå› æ­¤å½“ç»„ä»¶æ˜¯åœ¨**å­æ–‡ä»¶å¤¹**å†…ï¼Œåˆ™ä½¿ç”¨è¯¥ç»„ä»¶æ—¶å…¶åç§°æ˜¯ç”±**åµŒå¥—çš„å­æ–‡ä»¶å¤¹çš„åç§°å’Œæ–‡ä»¶åç§°ä¾æ¬¡æ‹¼æ¥è€Œæˆçš„**ã€‚

```
// ç»„ä»¶åœ¨å¤šçº§åµŒå¥—ç›®å½•ä¸‹
ğŸ“‚ components/
  |-- ğŸ“‚ base/
      |-- ğŸ“‚ foo/
            |-- ğŸ“„ Button.vue
```

```vue
<!-- ç»„ä»¶çš„åç§°æ˜¯æ‹¼æ¥è€Œæˆçš„ï¼Œæ³¨æ„å¤§å°å†™ -->
<BaseFooButton />
```

ä¸ºäº†ä½¿ç”¨çš„æ—¶å€™æ›´æ¸…æ™°æ˜äº†å’Œæ–¹ä¾¿ï¼Œæ¨èç›´æ¥å°†ç»„ä»¶çš„æ–‡ä»¶åæŒ‰ç…§å…¶æ‰€åœ¨çš„åµŒå¥—ï¼Œå³ä»¥ä¸Šç¤ºä¾‹ä¸­ç»„ä»¶çš„æ–‡ä»¶ååº”è¯¥ä½¿ç”¨ `BaseFooButton.vue`

:bulb: å¦‚æœå¸Œæœ›åœ¨[åŠ¨æ€ç»„ä»¶](https://vuejs.org/guide/essentials/component-basics.html#dynamic-components) `<component :is="componentName">` ä¸­ä½¿ç”¨ :file_folder: `/components/` ç›®å½•ä¸‹çš„ç»„ä»¶ï¼Œåˆ™è¿˜éœ€è¦ä½¿ç”¨ä¸€ä¸ª helper å‡½æ•° `resolveComponent(componentName)`ï¼ˆè¿™æ ·åœ¨ SSR æ¸²æŸ“ç”Ÿæˆé¡µé¢æ—¶æ‰å¯ä»¥æ­£å¸¸è§£æåŠ¨æ€ç»„ä»¶æ‰€å®é™…ä½¿ç”¨çš„ç»„ä»¶ :question:ï¼‰

```vue
<template>
  <component :is="clickable ? MyButton : 'div'" />
</template>

<script setup>
const MyButton = resolveComponent('MyButton')
</script>
```

:bulb: å¦‚æœå¸Œæœ›åŠ¨æ€å¯¼å…¥/ã€Œæ‡’åŠ è½½ã€ç»„ä»¶ï¼Œåªéœ€è¦åœ¨ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œ**åœ¨ç»„ä»¶åç§°å‰æ·»åŠ  `Lazy` å‰ç¼€å³å¯**ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°ä¼˜åŒ–é¡¹ç›® bundle æ–‡ä»¶å¤§å°ï¼ˆåŠ¨æ€å¯¼å…¥çš„ç»„ä»¶ä¼šè¢«åˆ†åŒ…åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œå»¶è¿ŸåŠ è½½ã€æŒ‰éœ€å¯¼å…¥ï¼‰ã€‚

```vue
<!-- ğŸ“„ pages/index.vue -->
<template>
  <div>
    <h1>Mountains</h1>
    <!-- åªæœ‰å½“ show ä¸º true æ—¶ï¼Œæ‰ä¼šå¼€å§‹ä¸‹è½½ç»„ä»¶ä»£ç å†æ¸²æŸ“åˆ°é¡µé¢ä¸Š -->
    <LazyMountainsList v-if="show" />
    <button v-if="!show" @click="show = true">Show List</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      show: false
    }
  }
}
</script>
```

:bulb: å¦‚æœéœ€è¦çº¦æŸç»„ä»¶ä»…åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œå¯ä»¥ä½¿ç”¨ Nuxt çš„å†…ç½®ç»„ä»¶ `<ClientOnly>` ç»„ä»¶æ¥åŒ…è£¹ç›®æ ‡ç»„ä»¶ï¼Œæ¨èåœ¨ `<ClientOnly>` å†…è®¾ç½®ä¸€ä¸ªåä¸º `fallback` çš„æ’æ§½ï¼Œåˆ™å½“ç½‘é¡µåœ¨æœåŠ¡ç«¯æ¸²æŸ“æ—¶ï¼Œä¼šæ˜¾ç¤ºè¯¥æ’æ§½çš„å†…å®¹ã€‚

```vue
<!-- ğŸ“„ pages/example.vue -->
<template>
  <div>
    <Sidebar />
    <ClientOnly>
      <!-- this component will only be rendered on client side -->
      <Comments />
      <template #fallback>
        <!-- this will be rendered on server side -->
        <p>Loading comments...</p>
      </template>
    </ClientOnly>
  </div>
</template>
```

### composables ç›®å½•
:file_folder: `composables` ç›®å½•æ˜¯ç”¨äºå­˜æ”¾è‡ªå®šä¹‰çš„ Vue ç»„åˆå¼å‡½æ•°ã€‚Nuxt ä¼šå°†è¯¥ç›®å½•ä¸‹çš„ç»„åˆå¼ API **è‡ªåŠ¨å¯¼å…¥**åˆ°ç›¸åº”çš„é¡µé¢ä¸­ã€‚

:warning: Nuxt åªä¼šæ‰«æè¯¥ç›®å½•ä¸‹çš„**ç›´æ¥å­æ–‡ä»¶**ï¼Œè€Œå¯¹äºå¤šçº§åµŒå¥—çš„åä»£ç›®å½•åªä¼šæ‰«æé‡Œé¢çš„ **`index.ts` æ–‡ä»¶**ï¼Œæ‰€ä»¥åœ¨æ¯ä¸€ä¸ªå¤šçº§åµŒå¥—çš„åä»£ç›®å½•ä¸­ï¼Œéœ€è¦è®¾ç½®ä¸€ä¸ªã€Œæ±‡æ€»ã€æ–‡ä»¶ `index.ts`ï¼ˆå®ƒä¼šå°†è¯¥ç›®å½•é‡Œçš„æ‰€æœ‰è‡ªå®šä¹‰ç»„åˆå¼ API æ–‡ä»¶ç»Ÿä¸€å¯¼å‡ºï¼‰

```
ğŸ“‚ composables
 |-- ğŸ“„ useFoo.ts âœ…
 |-- ğŸ“‚ useBar
      |-- ğŸ“„ supportingFile.ts
      |-- ğŸ“„ index.ts âœ…
```

ä»¥ä¸Šç¤ºä¾‹ä¸­ Nuxt åªä¼šæ‰«ææœç´¢åˆ° :page_facing_up: `useFoo.ts` å’Œ :page_facing_up: `useBar/index.ts` æ–‡ä»¶å¹¶è‡ªåŠ¨å¯¼å…¥ã€‚

è€Œå¯¹äºç»„åˆå¼ API çš„ä¸åŒå¯¼å‡ºæ–¹å¼ï¼Œä¼šå¯¼è‡´ä½¿ç”¨è¯¥ç»„åˆå¼ API æ—¶çš„åç§°ä¹Ÿä¸åŒï¼š

* å¦‚æœé‡‡ç”¨**é»˜è®¤å¯¼å‡º**ï¼Œåˆ™ä½¿ç”¨è¯¥è‡ªå®šä¹‰çš„ç»„åˆå¼ API æ—¶å°±é‡‡ç”¨æ–‡ä»¶åï¼Œå¯¹äº `index.ts` æ–‡ä»¶åˆ™æ¨èå…¶æ‰€åœ¨ç›®å½•ç›¸åŒçš„åç§°

  ```ts
  // ğŸ“„ composables/use-foo.ts æˆ– ğŸ“„ composables/useFoo.ts
  // It will be available as useFoo() (camelCase of file name without extension)
  export default function () {
    return useState('foo', () => 'bar')
  }
  ```

* å¦‚æœé‡‡ç”¨**å‘½åå¯¼å‡º**ï¼Œåˆ™ä½¿ç”¨è¯¥è‡ªå®šä¹‰çš„ç»„åˆå¼ API æ—¶å°±é‡‡ç”¨è¯¥åç§°

  ```ts
  // ğŸ“„ composables/useFoo.ts
  export const useFoo = () => {
    return useState('foo', () => 'bar')
  }
  ```

  :bulb: ä¸ºäº†ä¸é»˜è®¤å¯¼å‡ºçš„å‘½åä¹ æƒ¯ç›¸åŒï¼Œæ¨èå‘½åå¯¼å‡ºæ—¶ï¼Œè¯¥åç§°å’Œæ–‡ä»¶åç§°ç›¸åŒï¼Œå¯¹äº `index.ts` æ–‡ä»¶åˆ™æ¨èé‡‡ç”¨ä¸æ‰€åœ¨ç›®å½•ç›¸åŒçš„åç§°

ç„¶ååœ¨ç»„ä»¶ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ç›®å½•ä¸‹çš„è‡ªå®šä¹‰ç»„åˆå¼ API

```vue
<template>
  <div>
    {{ foo }}
  </div>
</template>

<script setup>
// è‡ªåŠ¨å¯¼å…¥çš„ç»„åˆå¼ API
const foo = useFoo()
</script>
```

### layouts ç›®å½•
:file_folder: `layouts` ç›®å½•ç”¨äºå­˜æ”¾å¸ƒå±€æ¨¡æ¿æ–‡ä»¶ã€‚

å¯¹äºåªæœ‰ä¸€ä¸ªé¡µé¢å¸ƒå±€çš„ SPA åº”ç”¨ï¼Œä¸€èˆ¬åªéœ€è¦å°† `app.vue` ä½œä¸ºåŸºç¡€çš„å¸ƒå±€ç»„ä»¶ï¼ˆä¸€èˆ¬ä¹Ÿæ˜¯æ ¹ç»„ä»¶ï¼‰ã€‚è€Œå¯¹äºæœ‰å¤šä¸ªå¸¸ç”¨çš„å¸ƒå±€ UIï¼Œå¯ä»¥å°†å®ƒä»¬åˆ†åˆ«æŠ½å–åˆ°ä¸€ä¸ª `*.vue` æ–‡ä»¶æ”¾ç½®åˆ°è¯¥ç›®å½•ä¸­ï¼Œæ„å»ºä¸ºå¯å¤ç”¨çš„ç»„ä»¶ã€‚è¯¥ç±»å‹çš„ç»„ä»¶å†…ä¸€èˆ¬ä¼šç”±**ä¸€ç³»åˆ—çš„ `<slot/>` æ’æ§½**ï¼Œä»¥ä¾¿ä½¿ç”¨æ—¶æ”¾ç½®å…·ä½“çš„å†…å®¹ã€‚

:warning: å’Œå…¶ä»–ç»„ä»¶ä¸åŒï¼Œå¸ƒå±€ç»„ä»¶å¿…é¡»**åªæœ‰ä¸€ä¸ªæ ¹å…ƒç´ ** a single root elementï¼ˆè€Œä¸”è¿™ä¸ªæ ¹å…ƒç´  :no_entry_sign: **ä¸èƒ½**æ˜¯ `<slot/>`ï¼‰ï¼Œä»¥ä¾¿ Nuxt åœ¨é¡µé¢è¿›è¡Œå¸ƒå±€åˆ‡æ¢æ—¶åº”ç”¨è¿‡æ¸¡æ•ˆæœ transitionã€‚

```vue
<!-- ğŸ“„ layouts/custom.vue -->
<template>
  <div>
    Some shared layout content:
    <!-- å…·åæ’æ§½ header -->
    <slot name="header">
      header slot content for title
    </slot>
    <!-- é»˜è®¤æ’æ§½ -->
    <slot />
  </div>
</template>
```

ç„¶åå¯ä»¥é€šè¿‡ Nuxt çš„å†…ç½®ç»„ä»¶ `<NuxtLayout name="layoutName">` æ¥ä½¿ç”¨è¿™äº›å¸ƒå±€ç»„ä»¶ï¼Œç›¸åº”çš„å¸ƒå±€æ¨¡æ¿å°±ä¼š**æŒ‰éœ€è‡ªåŠ¨å¼‚æ­¥å¯¼å…¥ asynchronous import**ã€‚

```vue
<!-- ğŸ“„ app.vue -->
<template>
  <NuxtLayout name="custom">
    <!-- å°†æŒ‡å®šçš„å†…å®¹æ’å…¥åˆ°å¸ƒå±€æ¨¡æ¿çš„é»˜è®¤æ’æ§½ä¸­ -->
    Hello world!
  </NuxtLayout>
</template>
```

:tada: è€Œå¯¹äº :file_folder: `~/pages` ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œè¿˜å¯ä»¥é€šè¿‡**è®¾ç½®é¡µé¢å…ƒä¿¡æ¯ page metadata** æ¥ä½¿ç”¨è¿™äº›å¸ƒå±€æ¨¡æ¿ã€‚

```vue
<!-- ğŸ“„ pages/index.vue -->
<script>
// é€šè¿‡è®¾ç½®é¡µé¢å…ƒä¿¡æ¯æ¥ä½¿ç”¨ç›¸åº”çš„å¸ƒå±€æ¨¡æ¿
// This will also work in `<script setup>`
definePageMeta({
  layout: "custom",
});
</script>
```

åœ¨ :file_folder: `~/pages` ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿå¯ä»¥é€šè¿‡ `<NuxtLayout name="layoutName">` ç»„ä»¶çš„æ–¹å¼æ¥ä½¿ç”¨å¸ƒå±€æ¨¡æ¿ï¼Œåªéœ€è¦å°†é¡µé¢å…ƒä¿¡æ¯è®¾ç½®ä¸º `false`

```vue
<!-- ğŸ“„ pages/index.vue -->
<template>
  <NuxtLayout name="custom">
    <template #header> Some header template content. </template>

    The rest of the page
  </NuxtLayout>
</template>

<script setup>
// å°†é¡µé¢å…ƒä¿¡æ¯è®¾ç½®ä¸º false
definePageMeta({
  layout: false,
});
</script>
```

:tada: é¡µé¢çš„å…ƒä¿¡æ¯å¯ä»¥é€šè¿‡é¡µé¢çš„è·¯ç”±å¯¹è±¡ `route` æ¥è·å–ï¼Œå®ƒæ˜¯ä¸€ä¸ªå“åº”å¼å˜é‡ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å®ƒçš„ç›¸åº”å±æ€§æ¥å®ç°é¡µé¢å¸ƒå±€çš„åˆ‡æ¢

```vue
<template>
  <div>
    <button @click="enableCustomLayout">Update layout</button>
  </div>
</template>

<script setup>
// è·¯ç”±å¯¹è±¡
const route = useRoute()
function enableCustomLayout () {
  // é€šè¿‡æ”¹å˜è¯¥é¡µé¢è·¯ç”±å¯¹è±¡çš„ç›¸åº”å±æ€§æ¥åˆ‡æ¢é¡µé¢çš„å¸ƒå±€
  route.meta.layout = "custom"
}

// è¯¥é¡µé¢å…ƒä¿¡æ¯è¡¨ç¤ºé»˜è®¤ä¸é‡‡ç”¨å¸ƒå±€æ¨¡æ¿
definePageMeta({
  layout: false,
});
</script>
```

### pages ç›®å½•
:file_folder: `pages` ç›®å½•ç”¨äºå­˜æ”¾åº”ç”¨çš„é¡µé¢æ–‡ä»¶ã€‚

æ–‡ä»¶ç±»å‹ä¸€èˆ¬æ˜¯ `*.vue`ï¼Œé‡‡ç”¨ Vue å•æ–‡ä»¶ç»„ä»¶ single-file components æ¥æ„å»ºä¸€ä¸ªç½‘é¡µé¡µé¢ã€‚

```vue
<!-- ğŸ“„ pages/index.vue -->
<template>
  <h1>Index page</h1>
</template>
```

:bulb: ä¹Ÿå¯ä»¥æ˜¯ `*.js`ã€`*.jsx`ã€`*.ts`ã€`*.tsx` æ–‡ä»¶

```ts
// ğŸ“„ pages/index.ts
// ä½¿ç”¨æ¸²æŸ“å‡½æ•°æ¥ç”Ÿæˆä¸€ä¸ªé¡µé¢
// https://vuejs.org/guide/extras/render-function.html
export default defineComponent({
  render () {
    return h('h1', 'Index page')
  }
})
```

```tsx
// ğŸ“„ pages/index.tsx
// ä½¿ç”¨ tsx è¯­æ³•å’Œæ¸²æŸ“å‡½æ•°æ¥ç”Ÿæˆä¸€ä¸ªé¡µé¢
// https://vuejs.org/guide/extras/render-function.html
export default defineComponent({
  render () {
    return h('h1', 'Index page')
  }
})
```

:warning: :file_folder: `pages` ç›®å½•ä¸‹çš„ vue å•æ–‡ä»¶ç»„ä»¶éƒ½å¿…é¡»**åªæœ‰ä¸€ä¸ªæ ¹å…ƒç´ **ï¼ˆHTML æ³¨é‡Šä¹Ÿç®—æ˜¯ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œä»¥ä¾¿åœ¨å‰ç«¯è¿›è¡Œé¡µé¢åˆ‡æ¢æ—¶è·¯ç”±å¯¹è±¡ä¹Ÿå¯ä»¥åŒæ­¥æ”¹å˜ :question:ã€‚

ä»¥ä¸Šçš„ç¤ºä¾‹æ‰€åˆ›å»ºçš„é¡µé¢æ‰€å¯¹åº”çš„è·¯ç”±æ˜¯ `/`ï¼Œç”±äº Nuxt ä¼šè‡ªåŠ¨åŸºäºè¯¥ç›®å½•çš„æ–‡ä»¶ç»“æ„ file-base æ¥åˆ›å»ºè·¯ç”±ï¼Œå³åŸºäºå…¶ä¸­å­ç›®å½•å’Œå­æ–‡ä»¶ä¹‹é—´çš„å±‚çº§åµŒå¥—å…³ç³»ï¼Œé€šè¿‡ vue router **åˆ›å»ºç›¸åº”çš„åµŒå¥—è·¯ç”±**ã€‚

:bulb: è¯¥ç›®å½•æ˜¯å¯é€‰çš„ï¼Œå¯¹äºç®€å•çš„åº”ç”¨ä¸€èˆ¬ä»…ä½¿ç”¨ `app.vue` ä½œä¸ºå”¯ä¸€é¡µé¢å³å¯ã€‚å¦‚æœé¡¹ç›®ä¸­**åŒæ—¶å­˜åœ¨ :page_facing_up: `~/app.vue` æ–‡ä»¶å’Œ :file_folder: `~/pages` ç›®å½•**ï¼Œåˆ™éœ€è¦åœ¨ :page_facing_up: `app.vue` æ–‡ä»¶ä¸­æ·»åŠ  `<NuxtPage/>` å†…ç½®ç»„ä»¶ï¼Œæ­¤æ—¶ `app.vue` ä½œä¸ºæ ¹ç»„ä»¶ï¼Œåœ¨ :file_folder: `~/pages` ç›®å½•ä¸­çš„æ–‡ä»¶å¯¹åº”æ¸²æŸ“æˆä¸ºä¸€ä¸ªç»„ä»¶ï¼ˆè€Œä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡µé¢ï¼Œå¯ä»¥ç†è§£ä¸º `app.vue` æ˜¯æ¯ä¸ªè·¯ç”±çš„ï¼ˆå…±ç”¨ï¼‰çˆ¶ç»„ä»¶ï¼Œè€Œä¸åŒè·¯ç”±æ‰€å¯¹åº”çš„é¡µé¢çš„ä¸åŒåˆ™ç”± `pages` ç›®å½•ä¸­çš„ç›¸åº”æ–‡ä»¶æ„æˆï¼Œå®ƒä»¬ä½œä¸º `app.vue` çš„å­ç»„ä»¶ï¼‰æ›¿æ¢ `<NuxtPage/>` æ‰€æŒ‡ç¤ºçš„ä½ç½®ã€‚

```vue
<!-- ğŸ“„ app.vue -->
<template>
  <div>
    <!-- åº”ç”¨ä¸­å„é¡µé¢çš„å…±ç”¨éƒ¨åˆ†ï¼Œä¾‹å¦‚å¯¼èˆªæ  -->
    <NuxtPage /> <!-- è¿™é‡Œæ˜¯ä¸€ä¸ªã€Œå ä½ç¬¦ã€ï¼Œåœ¨ä¸åŒè·¯ç”±ä¸‹ï¼Œä¼šè¢« pages ç›®å½•ä¸­çš„ç›¸åº”ç»„ä»¶æ›¿æ¢ -->
  </div>
</template>
```

:bulb: Nuxt é™¤äº†å¯ä»¥åŸºäºè¯¥ç›®å½•çš„æ–‡ä»¶ç»“æ„æ¥æ„å»ºé¡µé¢è·¯ç”±ï¼Œè¿˜å¯ä»¥åŸºäºæ–‡ä»¶åæ¥åˆ›å»ºè·¯ç”±ï¼Œåœ¨ç›®å½•æˆ–æ–‡ä»¶åç§°ä¸­**ä½¿ç”¨æ–¹æ‹¬å· `[]` æ¥åˆ›å»ºåŠ¨æ€è·¯ç”±**ï¼Œæ–¹æ‹¬å·ä¸­å°±æ˜¯åŠ¨æ€è·¯ç”±çš„å‚æ•°å˜é‡ï¼Œå¯ä»¥é€šè¿‡é¡µé¢çš„è·¯ç”±å¯¹è±¡ `route` çš„ç›¸åº”å±æ€§æ¥è·å–å‚æ•°å€¼

```
ğŸ“‚ pages
 |-- ğŸ“„ index.vue
 |-- ğŸ“‚ users-[group]
      |-- ğŸ“„ [id].vue
```

```vue
<!-- ğŸ“„ pages/users-[group]/[id].vue -->
<!-- è¯¥é¡µé¢å¯¹åº”ä¸€ç³»åˆ—çš„è·¯ç”±ï¼ˆåŠ¨æ€è·¯ç”±ï¼‰ -->
<template>
  <!-- ä½¿ç”¨ç»„åˆå¼ API è·å–åŠ¨æ€è·¯ç”±çš„å‚æ•° group å’Œ id çš„å€¼ -->
  <p>{{ $route.params.group }} - {{ $route.params.id }}</p>
</template>

<script setup>
// ä½¿ç”¨ç»„åˆå¼ API æ¥è®¿é—®è¯¥é¡µé¢çš„è·¯ç”±å¯¹è±¡
const route = useRoute()

if (route.params.group === 'admins' && !route.params.id) {
  console.log('Warning! Make sure user is authenticated!')
}
</script>
```



ä¾‹å¦‚å½“ç”¨æˆ·è®¿é—®çš„ URL ä¸º `/users-admins/123` æ—¶ï¼Œåˆ™ç”Ÿæˆçš„é¡µé¢ä¸º

```html
<p>admins - 123</p>
```

### middleware ç›®å½•
:file_folder: `middleware` ç›®å½•ç”¨äºå­˜æ”¾è·¯ç”±ä¸­é—´ä»¶ã€‚

è·¯ç”±ä¸­é—´ä»¶ route middleware æ˜¯æŒ‡åœ¨è¿è¡Œåœ¨ Vue å†…çš„ä¸€ç³»åˆ—å‡½æ•°ï¼Œå®ƒä»¬ä¼š**åœ¨åº”ç”¨è¿›å…¥ç‰¹å®šè·¯ç”±å‰æ‰§è¡Œ**ï¼Œå³è·¯ç”±å®ˆå«é’©å­å‡½æ•°ã€‚

é€šè¿‡å‡½æ•° `defineNuxtRouteMiddleware(handler)` åˆ›å»ºä¸€ä¸ªè·¯ç”±ä¸­é—´ä»¶ï¼Œè·¯ç”±å®ˆå«å‡½æ•° `handler(to, from)` æ¥æ”¶ä¸¤ä¸ªå‚æ•° `to` å’Œ `from`ï¼Œåˆ†åˆ«è¡¨ç¤ºå½“å‰é¡µé¢çš„è·¯ç”±å¯¹è±¡å’Œéœ€è¦å¯¼èˆªåˆ°çš„ç›®æ ‡é¡µé¢çš„è·¯ç”±å¯¹è±¡ã€‚è¯¥å‡½æ•°æœ€åå¯ä»¥è¿”å›ä»¥ä¸‹ç±»å‹çš„å€¼ï¼š

* æ— è¿”å›å€¼ï¼šè¿›å…¥ä¸‹ä¸€ä¸ªè·¯ç”±ä¸­é—´ä»¶ï¼Œæˆ–æ‰§è¡Œè·¯ç”±å¯¼èˆª

* `navigateTo(route)` å‡½æ•°ï¼šè·³è½¬åˆ°ç»™å®šçš„è·¯ç”±ã€‚

  :bulb: è¯¥æ–¹æ³•ä¹Ÿå¯ä»¥åœ¨å‰ç«¯é¡µé¢ç›´æ¥è°ƒç”¨ä»¥è§¦å‘è·¯ç”±å¯¼èˆª

* `abortNavigation(err)` å‡½æ•°ï¼šé˜»æ­¢è·¯ç”±å¯¼èˆªï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªï¼ˆå¯é€‰ï¼‰å‚æ•° `err` ä»¥åŒæ—¶æŠ›å‡ºé”™è¯¯ä¿¡æ¯

:bulb: Nuxt çš„è·¯ç”±ä¸­é—´ä»¶å’Œ vue router çš„è·¯ç”±å®ˆå«é’©å­å‡½æ•°ç±»ä¼¼ï¼Œå¯ä»¥å°è¯•è¿”å› vue router æ–‡æ¡£ä¸­è·¯ç”±å®ˆå«é’©å­å‡½æ•°æ”¯æŒçš„è¿”å›å€¼ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯å¯èƒ½åæœŸ Nuxt ç‰ˆæœ¬å‡çº§åå°±ä¸æ”¯æŒäº†ã€‚æ­¤å¤– Nuxt ä¸­é—´ä»¶çš„å®ˆå«é’©å­å‡½æ•°[æ²¡æœ‰ `next` ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°](https://router.vuejs.org/guide/advanced/navigation-guards.html#global-before-guards)ï¼Œå› æ­¤ :no_entry_sign: æ— æ³•ä½¿ç”¨ `next()` æ–¹æ³•ã€‚

```ts
export default defineNuxtRouteMiddleware((to, from) => {
  if (to.params.id === '1') {
    return abortNavigation()
  }
  return navigateTo('/')
})
```

:speaker: è¿™å’ŒæœåŠ¡å™¨çš„ä¸­é—´ä»¶ server middleware ä¸åŒï¼ˆè¿™äº›ä¸­é—´ä»¶æ˜¯åœ¨ Nitro å¼•æ“ä¸­è¿è¡Œçš„ä¸€ç³»åˆ—å‡½æ•°ï¼Œå®ƒä»¬çš„ä½œç”¨ä¸€èˆ¬æ˜¯å¯¹ HTTP è¯·æ±‚è¿›è¡Œæ£€éªŒã€ä¿®æ”¹ç­‰ï¼‰ã€‚

æœ‰ 3 ç§ç±»å‹çš„è·¯ç”±ä¸­é—´ä»¶ï¼š

* åŒ¿å/å†…è”è·¯ç”±ä¸­é—´ä»¶ anonymous/inline route middlewareï¼šç›´æ¥åœ¨ç‰¹å®šé¡µé¢çš„å…ƒä¿¡æ¯ä¸­è¿›è¡Œåˆ›å»º

  ```vue
  <!-- ğŸ“„ pages/example.vue -->
  <script setup>
  definePageMeta({
    // This is an example of inline middleware
    middleware: () => {
      console.log('Strictly forbidden.')
      return false
    }
  })
  </script>
  ```

* å…·åè·¯ç”±ä¸­é—´ä»¶ named route middlewareï¼šåœ¨ :file_folder: `middleware/` ç›®å½•ä¸­åˆ›å»ºï¼Œç„¶ååœ¨æ‰€éœ€åº”ç”¨è¯¥è·¯ç”±å®ˆå«çš„é¡µé¢çš„å…ƒä¿¡æ¯ä¸­è¿›è¡Œè®¾ç½®ï¼Œè¿™æ ·åœ¨å¯¼èˆªåˆ°è¯¥é¡µé¢æ—¶ï¼Œè¯¥è·¯ç”±å®ˆå«ä»£ç å°±ä¼š**å¼‚æ­¥åŠ è½½**

  ```ts
  // ğŸ“„ middleware/auth.ts
  export default defineNuxtRouteMiddleware((to, from) => {
    if (to.params.id === '1') {
      return abortNavigation()
    }
    return navigateTo('/')
  })
  ```

  ```vue
  <!-- ğŸ“„ pages/example.vue -->
  <script setup>
  definePageMeta({
    middleware: ["auth"]
    // or middleware: 'auth'
  })
  </script>
  ```

* å…¨å±€è·¯ç”±ä¸­é—´ä»¶ global route middlewareï¼šåœ¨ :file_folder: `middleware/` ç›®å½•ä¸­åˆ›å»ºï¼Œ**æ–‡ä»¶åå…·æœ‰ `.global` åç¼€**ï¼Œè‡ªåŠ¨åº”ç”¨åˆ°æ‰€æœ‰é¡µé¢ä¸Š

  ```ts
  // ğŸ“„ middleware/always-run.global.ts
  // å…¨å±€è·¯ç”±ä¸­é—´ä»¶ï¼Œæ–‡ä»¶åå…·æœ‰ .global åç¼€
  export default defineNuxtRouteMiddleware(() => {
    console.log('running global middleware')
  })
  ```

:bulb: è¿˜å¯ä»¥ä½¿ç”¨ Nuxt é€šè¿‡çš„ helper å‡½æ•° `addRouteMiddleware()` ä¸ºåº”ç”¨**åŠ¨æ€æ·»åŠ  dynamically**ä¸€ä¸ªå…·åè·¯ç”±ä¸­é—´ä»¶æˆ–å…¨å±€è·¯ç”±ä¸­é—´ä»¶

```ts
// ä¸€èˆ¬ç”¨äºæ’ä»¶ä¸­
export default defineNuxtPlugin(() => {
  // æ·»åŠ ä¸€ä¸ªå…¨å±€è·¯ç”±ä¸­é—´ä»¶
  addRouteMiddleware('global-test', () => {
    console.log('this global middleware was added in a plugin and will be run on every route change')
  }, { global: true })

  // æ·»åŠ ä¸€ä¸ªå…·åè·¯ç”±ä¸­é—´ä»¶
  addRouteMiddleware('named-test', () => {
    console.log('this named middleware was added in a plugin and would override any existing middleware of the same name')
  })
})
```

