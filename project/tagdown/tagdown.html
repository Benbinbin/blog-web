<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.27">
    <link rel="icon" href="/blog-web/images/favicon.ico"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.5/dist/katex.min.css"><title>TagDown | Blog</title><meta name="description" content="A blog and knowledge management system about web.">
    <link rel="modulepreload" href="/blog-web/assets/app.43fe0c63.js"><link rel="modulepreload" href="/blog-web/assets/tagdown.html.3869653d.js"><link rel="modulepreload" href="/blog-web/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/blog-web/assets/tagdown.html.dc2fd384.js">
    <link rel="stylesheet" href="/blog-web/assets/style.b42fd117.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="min-h-screen flex flex-col"><nav class="px-4 sm:px-8 py-2 flex justify-between items-center sticky top-0 z-30 bg-white"><div class="left flex items-center space-x-0.5"><!--[--><button class="text-gray-400 hover:bg-gray-100 catelog-btn p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md lg:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--><a class="avatar p-2 hover:bg-gray-100 rounded-md" href="/blog-web/#"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="right hidden sm:flex items-center space-x-0.5"><!--[--><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">All</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Network</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Frontend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Backend</button><button class="text-gray-400 p-2 select-none text-sm font-bold hover:text-gray-900 hover:bg-gray-100 rounded-md">Project</button><!--]--><!--[--><button class="text-gray-900 bg-gray-100 hover:bg-gray-200 p-2 select-none text-sm font-bold hover:text-gray-900 rounded-md hidden lg:block"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 11.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zm-3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm0 4a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path></svg></button><!--]--></div><div class="more-container sm:hidden relative"><button style="" class="p-2 select-none hover:bg-gray-100 rounded-md text-gray-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"></path></svg></button><button style="display:none;" class="p-2 select-none hover:bg-gray-100 rounded-md text-red-400 hover:text-red-500"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"></path><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"></path></svg></button><div style="display:none;" class="more-modal p-2 absolute top-10 right-0 z-10 flex flex-col space-y-2 bg-gray-100 rounded-md opacity-90"><!--[--><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">All</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Network</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Frontend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Backend</button><button class="text-gray-400 px-4 py-2 select-none text-sm text-center font-bold hover:text-gray-900 hover:bg-gray-200 rounded-md">Project</button><!--]--></div></div></nav><div class="relative flex-grow"><div class="theme-container no-navbar no-sidebar"><!--[--><!----><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="tagdown" tabindex="-1"><a class="header-anchor" href="#tagdown" aria-hidden="true">#</a> TagDown</h1><p><img src="/blog-web/assets/tagdown.a61dbc1c.png" alt="tagdown"></p><p>TagDown æ˜¯ä¸€æ¬¾å¼€æºçš„ä¹¦ç­¾ç®¡ç†æ’ä»¶ï¼Œ æ‚¨å¯ä»¥ä½¿ç”¨æ‰©å±•ç¨‹åº<em>æµè§ˆ</em>ã€<em>æ–°å¢</em>ã€<em>ä¿®æ”¹</em>ä¹¦ç­¾ï¼Œå®ƒä¹Ÿæ”¯æŒä»¥ä¸åŒæ–¹å¼<em>å¯¼å‡º</em>ä¹¦ç­¾ã€‚</p><p>é™¤äº†å¸¸è§çš„ä¹¦ç­¾ç®¡ç†åŠŸèƒ½ï¼Œè¿˜å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li><p>æ”¯æŒ ğŸ¬ <a href="https://www.bilibili.com/video/BV1up4y1s7VP?p=4" target="_blank" rel="noopener noreferrer">æ–°å¢</a>ä¹¦ç­¾ï¼Œå¹¶é™„åŠ é¢å¤–çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ <code>tags</code>ã€<code>groups</code> ç­‰</p></li><li><p>æ”¯æŒ ğŸ¬ <a href="https://www.bilibili.com/video/BV1up4y1s7VP?p=7" target="_blank" rel="noopener noreferrer">å¯¼å‡º</a>ä»»æ„ä¹¦ç­¾ä¸º <code>json</code> æ–‡æ¡£</p></li><li><p>ä»¥ ğŸ¬ <a href="https://www.bilibili.com/video/BV1up4y1s7VP?p=3" target="_blank" rel="noopener noreferrer">æ ‘å›¾</a>çš„å½¢å¼æµè§ˆå±‚çº§ç»“æ„çš„ä¹¦ç­¾æ•°æ®</p></li><li><p>ä¸€é”®æ‰“å¼€å¤šä¸ªä¹¦ç­¾ï¼Œæ”¯æŒåœ¨ ğŸ¬ <a href="https://www.bilibili.com/video/BV1up4y1s7VP" target="_blank" rel="noopener noreferrer">æ ‡ç­¾ç»„</a>å†…æ‰“å¼€ä¹¦ç­¾</p></li></ul><p>æœ¬æ–‡ä¸»è¦è®°å½•äº†æˆ‘åœ¨å¼€å‘ TagDown æ‰©å±•ç¨‹åºè¿‡ç¨‹ä¸­çš„ä¸€äº›å°æ”¶è·ã€‚</p><h2 id="è®¾è®¡" tabindex="-1"><a class="header-anchor" href="#è®¾è®¡" aria-hidden="true">#</a> è®¾è®¡</h2><p>è¯¥æ‰©å±•ç¨‹åºä¸ç”¨æˆ·çš„äº¤äº’ç•Œé¢ä¸»è¦æ˜¯é€šè¿‡ä¸€ä¸ª<strong>å¼¹å‡ºçª— popup</strong>ï¼Œå½“ç”¨æˆ·ç‚¹å‡»å·¥å…·æ ä¸Šæ‰©å±•ç¨‹åºçš„å›¾æ ‡æ—¶ï¼Œä¼šå¼¹å‡ºä¸€ä¸ª HTML é¡µé¢ï¼Œè¯¥é¡µé¢å®ç°äº†å¤§éƒ¨åˆ†æ‰©å±•ç¨‹åºçš„åŠŸèƒ½ã€‚</p><p>è¯¥é¡µé¢æœ‰ä¸¤ç§çŠ¶æ€ï¼š</p><ul><li>æµè§ˆçŠ¶æ€ browserï¼šç”¨æˆ·å¯ä»¥æµè§ˆ Chrome ä¸­å·²å­˜çš„æ‰€æœ‰ä¹¦ç­¾</li><li>ç¼–è¾‘çŠ¶æ€ editï¼šç”¨æˆ·åœ¨ç¼–è¾‘é¡µé¢å¯ä»¥æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ä¹¦ç­¾</li></ul><p><img src="/blog-web/assets/tagdown-ui.892e9f23.png" alt="UI"></p><p>æ‰©å±•ç¨‹åºåœ¨åå°ä¼šç›‘æ§æ ‡ç­¾åˆ‡æ¢æ¿€æ´»çŠ¶æ€ï¼Œä»¥åˆ†æå½“å‰è®¿é—®çš„ URL æ˜¯å¦å·²æ”¶è—ä¸ºä¹¦ç­¾ï¼ŒåŠ¨æ€åˆ‡æ¢å·¥å…·æ ä¸Šæ‰©å±•ç¨‹åºçš„å›¾æ ‡çŠ¶æ€ã€‚</p><p>æ‰©å±•ç¨‹åºè¿˜æä¾›ä¸€ä¸ªé…ç½®é¡µé¢ option pageï¼Œå¯ä»¥å¯¹ IndexedDB æ•°æ®åº“æ‰§è¡Œå¯¼å‡ºã€å¯¼å…¥ã€åˆ é™¤æ“ä½œï¼Œè¿˜å¯ä»¥æŒ‰éœ€å¯¼å‡ºä¹¦ç­¾ã€‚</p><p><img src="/blog-web/assets/tagdown-options-page.d41d00b4.png" alt="option page"></p><p>æ›´è¯¦ç»†çš„è®¾è®¡ç¨¿å¯ä»¥æŸ¥çœ‹<a href="https://www.figma.com/community/file/1014891055524312843" target="_blank" rel="noopener noreferrer">è¿™é‡Œ</a>ï¼Œè¿˜æœ‰ä¸€ä¸ª<a href="https://www.figma.com/proto/2Rtmm9uWs4LOAqLviyvveX/TagDown?node-id=1447%3A7484&amp;scaling=scale-down&amp;page-id=1403%3A1050&amp;starting-point-node-id=1447%3A7484&amp;show-proto-sidebar=1" target="_blank" rel="noopener noreferrer">åŸå‹</a>å¯ä»¥ä½“éªŒæ‰©å±•ç¨‹åºçš„åŸºæœ¬äº¤äº’ã€‚</p><h2 id="é¢„å¤‡æŠ€èƒ½" tabindex="-1"><a class="header-anchor" href="#é¢„å¤‡æŠ€èƒ½" aria-hidden="true">#</a> é¢„å¤‡æŠ€èƒ½</h2><p>æœ¬é¡¹ç›®ä½¿ç”¨ Vueï¼ˆVue 3.0 ç‰ˆæœ¬ï¼‰å’Œ Chrome æ‰€æä¾›çš„ API è¿›è¡Œå¼€å‘ï¼ˆå½“ç„¶è¿˜ä½¿ç”¨äº†å¿…ä¸å¯å°‘çš„å‰ç«¯ä¸‰å¤§åŸºæœ¬æŠ€èƒ½ HTMLã€CSSã€JavaScriptï¼‰ï¼Œæ­¤å¤– CSS ä¸»è¦ä½¿ç”¨ Tailwindcss æ¡†æ¶ã€‚</p><ul><li>HTML</li><li>CSSã€<a href="https://tailwindcss.com/" target="_blank" rel="noopener noreferrer">Tailwind CSS</a></li><li><a href="https://v3.cn.vuejs.org/" target="_blank" rel="noopener noreferrer">Vue</a>ã€JavaScript</li><li><a href="https://developer.chrome.com/docs/extensions/reference/" target="_blank" rel="noopener noreferrer">Chrome APIs</a></li></ul><h2 id="æ­å»ºå¼€å‘ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#æ­å»ºå¼€å‘ç¯å¢ƒ" aria-hidden="true">#</a> æ­å»ºå¼€å‘ç¯å¢ƒ</h2><p>æ­å»ºä¸€ä¸ªä½¿ç”¨ Vue+Vite+Tailwindcss çš„å¼€å‘ç¯å¢ƒï¼Œå…¶ä¸­å¼€å‘çš„æ‰©å±•ç¨‹åºå±äº Manifest V3 ç‰ˆæœ¬ã€‚</p><p>ğŸ’¡ ç³»ç»Ÿå·²ç»å®‰è£… node ç¯å¢ƒ</p><p>ğŸ’¡ å¦‚æœåœ¨å¼€å‘ä¸­ä½¿ç”¨ VS Code æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ¨èå®‰è£… Vue3 å¼€å‘çš„é…å¥— <a href="https://marketplace.visualstudio.com/items?itemName=johnsoncodehk.volar" target="_blank" rel="noopener noreferrer">Volar</a> æ’ä»¶ã€‚</p><p>åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤<a href="https://cn.vitejs.dev/guide/#scaffolding-your-first-vite-project" target="_blank" rel="noopener noreferrer">åˆ›å»ºä¸€ä¸ª Vue3+Vite çš„é¡¹ç›®æ¨¡æ¿</a></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> init vite@latest
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>ç„¶åæ ¹æ®æç¤ºå®‰è£…ä¾èµ–åŒ…</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># å°†ç»ˆç«¯çš„è·¯å¾„åˆ‡æ¢åˆ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸­</span>
<span class="token builtin class-name">cd</span> project-folder
<span class="token comment"># å®‰è£…ä¾èµ–åŒ…</span>
<span class="token function">npm</span> <span class="token function">install</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>ä¸ºäº†åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ ESLint è¿›è¡Œä»£ç è§„èŒƒç®¡ç†ï¼Œéœ€è¦å®‰è£… <a href="https://eslint.vuejs.org/" target="_blank" rel="noopener noreferrer">eslint-plugin-vue</a> æ¨¡å—</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --save-dev eslint eslint-plugin-vue
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>ç„¶ååœ¨ç»ˆç«¯è¾“å…¥ <code>eslint --init</code> å‘½ä»¤è¿›è¡Œåˆå§‹åŒ–é…ç½®ï¼Œæ ¹æ®è‡ªå·±çš„ç¼–ç¨‹ä¹ æƒ¯å’Œå›¢é˜Ÿè¦æ±‚ï¼ŒæŒ‰ç…§æç¤ºè®¾ç½®ä»£ç æ ·å¼è§„èŒƒï¼š</p><ul><li><p><code>To check syntax, find problems, and enforece code style</code></p></li><li><p><code>JavaScript modules (import/export)</code></p></li><li><p><code>Vue.js</code></p></li><li><p><code>Browser</code> &amp; <code>Node</code></p></li><li><p><code>Use a popular style guide</code> -&gt; <code>Airbnb</code></p></li><li><p><code>JavaScript</code></p></li></ul><p>ç„¶åç³»ç»Ÿä¼šå®‰è£…æ‰€ä¾èµ–çš„åŒ…å’Œç”Ÿæˆ ESLint é…ç½®æ–‡ä»¶ <code>.eslintrc.js</code></p><p>ç”±äºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯ Vue3 ç‰ˆæœ¬ï¼Œæ‰€ä»¥éœ€è¦æ‰“å¼€é…ç½®æ–‡ä»¶ <code>.eslintrc.js</code> è¿›è¡Œç›¸åº”çš„ä¿®æ”¹</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&#39;plugin:vue/vue3-recommended&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;airbnb-base&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><div class="highlight-line">Â </div><br><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å¦‚æœä½¿ç”¨ VS Code è¿›è¡Œä»£ç ç¼–å†™ï¼Œéœ€è¦åœ¨ ğŸ“ æ–‡ä»¶å¤¹ <code>.vscode</code> ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ <code>settings.json</code> è¿›è¡Œç¼–è¾‘å™¨çš„ eslint é…ç½®</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;editor.codeActionsOnSave&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;source.fixAll.eslint&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;eslint.validate&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;javascript&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;vue&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ğŸ’¡ æ›´å¤šå…³äºä½¿ç”¨ ESLint è¿›è¡Œä»£ç è§„èŒƒç®¡ç†çš„ç»†èŠ‚å¯ä»¥å‚è€ƒè¯¥ ğŸ¬ <a href="https://www.bilibili.com/video/BV1pq4y1T75p" target="_blank" rel="noopener noreferrer">å½±ç‰‡</a></p><p>ç”±äºå¼€å‘ Chrome æ’ä»¶éœ€è¦ç‰¹æ®Šçš„é¡¹ç›®ç»“æ„ï¼Œä¾‹å¦‚æ ¹ç›®å½•éœ€è¦æœ‰ä¸€ä¸ª <code>manifest.json</code> æ–‡æ¡£ä»¥æè¿°æ‰©å±•ç¨‹åºç›¸å…³ä¿¡æ¯å’Œæƒé™ï¼Œè¿˜éœ€è¦åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤å®‰è£…ä¸€ä¸ªç‰¹æ®Šçš„æ’ä»¶ <a href="https://github.com/yeqisong/vite-plugin-vue-crx3" target="_blank" rel="noopener noreferrer">vite-plugin-vue-crx3</a></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> i -D vite-plugin-vue-crx3
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>æ ¹æ®è¯¥æ’ä»¶çš„<a href="https://github.com/yeqisong/vite-plugin-vue-crx3#2%E4%B8%80%E8%88%AC%E5%BC%80%E5%8F%91%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84" target="_blank" rel="noopener noreferrer">è¯´æ˜æ–‡æ¡£</a>ï¼Œä¿®æ”¹é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼Œä»¥ç¬¦åˆæ‰©å±•ç¨‹åºå¼€å‘è¦æ±‚ã€‚</p><blockquote><p>æœ¬æ’ä»¶çš„æ ¸å¿ƒå°±æ˜¯ï¼šå°±ä»¥ manifest.json ä½œä¸ºå…¥å£æ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ†æ manifest ä¸­çš„å¼€å‘é…ç½®ï¼Œè·å– vue åº”ç”¨çš„å„ä¸ªå…¥å£æ–‡ä»¶ï¼Œæ‰“åŒ…æ—¶è‡ªåŠ¨å°† manifest.json ä¸­å¼€å‘è·¯å¾„æ›´æ–°ä¸ºç”Ÿäº§è·¯å¾„ã€‚</p></blockquote><p>é¡¹ç›®åŸæ¥çš„ç›®å½•ç»“æ„</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>â”‚  .eslintrc.js
â”‚  .gitignore
â”‚  index.html
â”‚  package-lock.json      
â”‚  package.json
â”‚  README.md
â”‚  vite.config.js
â”‚
â”œâ”€.vscode
â”‚      extensions.json
â”‚      settings.json
â”‚
â”œâ”€public
â”‚      favicon.ico
â”‚
â””â”€src
    â”‚  App.vue
    â”‚  main.js
    â”‚
    â”œâ”€assets
    â”‚      logo.png
    â”‚
    â””â”€components
            HelloWorld.vue
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>ç”±äºé¡¹ç›®æ‰“åŒ…çš„å…¥å£æ–‡ä»¶æ˜¯ <code>manifest.json</code>ï¼Œæ‰€ä»¥åˆ é™¤åŸæ¥çš„å…¥å£æ–‡ä»¶ <code>src/main.js</code> ä»¥åŠç›¸åº”ç›¸åº”çš„æ–‡ä»¶ <code>index.html</code>ã€‚ç„¶åæ–°å¢ <code>src/manifest.json</code> æ–‡æ¡£å’Œå…¶ä»–æ–‡ä»¶ã€‚ä¿®æ”¹åçš„ç›®å½•ç»“æ„</p><p>ğŸ’¡ å‚è€ƒ <a href="https://github.com/yeqisong/crx3-dev-template" target="_blank" rel="noopener noreferrer">crx3-dev-template</a> æ¨¡æ¿</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>â”‚  .eslintrc.js       
â”‚  .gitignore
â”‚  package-lock.json  
â”‚  package.json       
â”‚  postcss.config.js  
â”‚  README.md
â”‚  tailwind.config.js 
â”‚  vite.config.js     
â”‚  
â”œâ”€.vscode
â”‚      extensions.json
â”‚      settings.json  
â”‚      
â”œâ”€public
â”‚  â”‚  favicon.ico     
â”‚  â”‚  
â”‚  â””â”€_locales
â”‚      â””â”€en
â””â”€src
    â”‚  manifest.json  
    â”‚  options.html   
    â”‚  popup.html     
    â”‚  
    â”œâ”€assets
    â”‚  â”‚  logo.png    
    â”‚  â”‚  
    â”‚  â””â”€images       
    â”‚          icon128.png
    â”‚          icon16.png 
    â”‚          icon24.png 
    â”‚          icon32.png 
    â”‚          icon48.png 
    â”‚          icon64.png 
    â”‚          icon72.png 
    â”‚          logo.png   
    â”‚
    â”œâ”€background
    â”‚      main.js        
    â”‚      
    â”œâ”€options
    â”‚      App.vue        
    â”‚      main.js        
    â”‚      
    â””â”€popup
            App.vue       
            main.js  
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p>ä¸»è¦çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ä½œç”¨ï¼š</p><ul><li><code>src/manifest.json</code> æ‰©å±•ç¨‹åºçš„é…ç½®æ¸…å•</li><li><code>background</code> ä¸æ‰©å±•ç¨‹åºçš„åå° service worker ç›¸å…³çš„ä»£ç ï¼Œåœ¨ manifest V3 ç‰ˆæœ¬çš„æ‰©å±•ç¨‹åºä¸­ï¼Œåå°æ²¡æœ‰å¯è§†çš„å‰ç«¯é¡µé¢ï¼Œæ‰€ä»¥è¯¥ä¸ä¼šä¸éœ€è¦ä½¿ç”¨ Vue</li><li><code>src/popup.html</code> å¼¹å‡ºçª—çš„å…¥å£æ–‡ä»¶ï¼ŒğŸ“ æ–‡ä»¶å¤¹ <code>popup</code> æ”¾ç½®å¼¹çª—é¡µé¢çš„ç›¸å…³ä»£ç æ–‡æ¡£ï¼Œè¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Vue å•é¡µé¢åº”ç”¨</li><li><code>src/options.html</code> è®¾ç½®é¡µé¢çš„å…¥å£æ–‡ä»¶ï¼ŒğŸ“ æ–‡ä»¶å¤¹ <code>options</code> æ”¾ç½®è®¾ç½®é¡µé¢çš„ç›¸å…³ä»£ç æ–‡æ¡£ï¼Œè¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ Vue å•é¡µé¢åº”ç”¨</li><li>ğŸ“ æ–‡ä»¶å¤¹ <code>public/_locales</code> æ”¾ç½®ä¸å›½é™…åŒ–ï¼ˆç¿»è¯‘ï¼‰ç›¸å…³çš„æ–‡æ¡£</li></ul><p>å…¶ä¸­åœ¨ ğŸ“ æ–‡ä»¶å¤¹ <code>src</code> ä¸­çš„ <code>manifest.json</code> æ–‡æ¡£æ˜¯æ‰©å±•ç¨‹åºçš„é…ç½®æ¸…å•</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TagDown&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;manifest_version&quot;</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TagDown is a bookmark manager.&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;service_worker&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./background/main.js&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;action&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;default_title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;TagDown&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default_popup&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./popup.html&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;default_icon&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./assets/images/icon16.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;32&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./assets/images/icon32.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./assets/images/icon48.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;64&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./assets/images/icon64.png&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./assets/images/icon128.png&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;options_page&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./options.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;16&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./assets/images/icon16.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;32&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./assets/images/icon32.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;48&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./assets/images/icon48.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;64&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./assets/images/icon64.png&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;128&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./assets/images/icon128.png&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;default_locale&quot;</span><span class="token operator">:</span> <span class="token string">&quot;en&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>ğŸ’¡ ç”±äºæ”¾åœ¨ ğŸ“ æ–‡ä»¶å¤¹ <code>src</code> ä¸‹çš„ <code>manifest.json</code> åªæœåŠ¡äºå¼€å‘ç¯å¢ƒï¼Œå› æ­¤åœ¨è®¾ç½®èµ„æºï¼ˆå„ä¸ªå…¥å£æ–‡ä»¶ï¼‰çš„è·¯å¾„æ—¶ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„å³å¯ï¼Œæ’ä»¶æ‰“åŒ…æ—¶ä¼šè‡ªåŠ¨åˆ†æå¹¶æ›´æ–°è·¯å¾„ã€‚</p><p>è¿˜è¦åœ¨ vite é…ç½®æ–‡ä»¶ <code>vite.config.js</code> å¼•ç”¨æ’ä»¶ï¼Œå¹¶è®¾ç½®å…¥å£æ–‡ä»¶</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-vue&#39;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> crx3 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-vue-crx3&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// https://vitejs.dev/config/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&#39;@&#39;</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">crx3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// crx3å³ä¸ºæ’ä»¶å…¥å£å‡½æ•°</span>
  build<span class="token operator">:</span> <span class="token punctuation">{</span>
    target<span class="token operator">:</span> <span class="token string">&#39;es2015&#39;</span><span class="token punctuation">,</span>
    rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span>
      input<span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;src/manifest.json&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å°† src ä¸­çš„ manifest.json ä½œä¸ºå…¥å£æ–‡ä»¶</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>è¯¥æ’ä»¶æ”¯æŒ<strong>çƒ­é‡è½½</strong>ä¾¿äºå¼€å‘è°ƒè¯•ï¼Œéœ€è¦åœ¨ <code>package.json</code> æ–‡æ¡£ä¸­æ·»åŠ ç›¸åº”çš„æŒ‡ä»¤</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite preview&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;watch&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite build --watch&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><div class="highlight-line">Â </div><br><br><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ç„¶ååœ¨å¼€å‘æ—¶ä½¿ç”¨ <code>npm run watch</code> å‘½ä»¤å³å¯å¯ç”¨çƒ­é‡è½½åŠŸèƒ½ï¼Œå½“ä»£ç çš„ä¿®æ”¹ä¿å­˜åï¼Œæµè§ˆå™¨è‡ªåŠ¨æ›´æ–°å½“å‰å¼€å‘çš„æ’ä»¶ï¼Œæ­£åœ¨è°ƒç”¨çš„ç½‘é¡µä¹Ÿä¼šè‡ªåŠ¨åˆ·æ–°ã€‚</p><p>æœ€åä¸ºäº†ä¾¿äºç½‘é¡µçš„æ ·å¼è®¾ç½®ï¼Œä½¿ç”¨ <a href="https://tailwindcss.com/docs/guides/vue-3-vite" target="_blank" rel="noopener noreferrer">Tailwindcss æ¡†æ¶</a>ï¼ŒæŒ‰ç…§å®˜æ–¹æ–‡æ¡£çš„ä¾æ­¤æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><ul><li><p>åœ¨ç»ˆç«¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£… Tailwind CSS æ¨¡å—å’Œç›¸åº”çš„ä¾èµ–åŒ…</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> -D tailwindcss@latest postcss@latest autoprefixer@latest
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>åœ¨ç»ˆç«¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ– Tailwind CSS ç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ <code>tailwind.config.js</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>npx tailwindcss init -p
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>ä¸ºäº†ä¼˜åŒ–é¡¹ç›®<a href="https://tailwindcss.com/docs/just-in-time-mode#enabling-jit-mode" target="_blank" rel="noopener noreferrer">å¼€å‘</a>å’Œ<a href="https://tailwindcss.com/docs/optimizing-for-production" target="_blank" rel="noopener noreferrer">æ‰“åŒ…</a>æ—¶çš„æ–‡ä»¶å¤§å°ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ <code>tailwind.config.js</code> ä¸­è¿›è¡Œè®¾ç½®ï¼Œä»¥åˆ é™¤æœªä½¿ç”¨çš„æ ·å¼ä»£ç </p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  mode<span class="token operator">:</span> <span class="token string">&#39;jit&#39;</span><span class="token punctuation">,</span>
  purge<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;./src/**/*.{vue,js,ts,jsx,tsx}&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul><p>ğŸ’¡ vite ä¼šé€šè¿‡<a href="https://cn.vitejs.dev/guide/dep-pre-bundling.html" target="_blank" rel="noopener noreferrer">ä¾èµ–é¢„æ„å»º</a>å®ç° CommonJS å’Œ UMD å…¼å®¹æ€§ï¼Œä½†å¹¶ä¸èƒ½è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ <strong><a href="https://github.com/perry-mitchell/webdav-client" target="_blank" rel="noopener noreferrer">webdav-client</a></strong> æ¨¡å—å°±é‡åˆ°ç¼–è¯‘é—®é¢˜ï¼Œå› æ­¤å¼•å…¥ä¸€ä¸ª rollup æ’ä»¶ <a href="https://github.com/rollup/plugins/tree/master/packages/commonjs/" target="_blank" rel="noopener noreferrer">@rollup/plugin-commonjs</a>ï¼Œå®ƒå°† CommonJS æ¨¡å—è½¬æ¢ä¸º ES6 æ¨¡å—</p><ul><li><p>åœ¨ç»ˆç«¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…æ¨¡å—å’Œç›¸åº”çš„ä¾èµ–åŒ…</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> @rollup/plugin-commonjs --save-dev
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div></li><li><p>åœ¨ vite é…ç½®æ–‡ä»¶ <code>vite.config.js</code> å¼•ç”¨æ’ä»¶</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ...</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">crx3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ul><h2 id="å¼¹å‡ºé¡µé¢å¼€å‘" tabindex="-1"><a class="header-anchor" href="#å¼¹å‡ºé¡µé¢å¼€å‘" aria-hidden="true">#</a> å¼¹å‡ºé¡µé¢å¼€å‘</h2><p>åœ¨è¿›è¡Œå¼¹å‡ºé¡µé¢å¼€å‘ä¸­ï¼Œä¸»è¦éœ€è¦è§£å†³çš„æ˜¯ Vue <strong>ç»„ä»¶é—´æ•°æ®ä¼ é€’</strong>é—®é¢˜ã€‚</p><p>ä¸ºäº†ä¾¿äºä»£ç çš„å¤ç”¨å’Œç»´æŠ¤ï¼Œå°†é¡µé¢åˆ†ä¸ºå¤šä¸ª Vue ç»„ä»¶ï¼Œä¾‹å¦‚åœ¨å¼¹å‡ºé¡µé¢çš„æµè§ˆçŠ¶æ€ä¸­ï¼Œå°†ç½‘é¡µçš„çˆ¶çº§ç»„ä»¶ <code>BrowserPage</code> ä¸­ä¸»è¦æœ‰ 4 å¤§å­ç»„ä»¶ï¼š</p><ul><li><code>BrowserHeader.vue</code></li><li><code>BrowserMenu.vue</code> å’Œ <code>BrowserMenuPin.vue</code></li><li><code>BrowserGrid.vue</code> å’Œ <code>BrowserTree.vue</code>ï¼Œä»¥åŠ <code>BrowserPin.vue</code></li><li><code>BrowserFooter</code></li></ul><p><img src="/blog-web/assets/tagdown-popup-components.7809551f.png" alt="components"></p><h3 id="çˆ¶å­ç»„ä»¶é—´æ•°æ®ä¼ é€’" tabindex="-1"><a class="header-anchor" href="#çˆ¶å­ç»„ä»¶é—´æ•°æ®ä¼ é€’" aria-hidden="true">#</a> çˆ¶å­ç»„ä»¶é—´æ•°æ®ä¼ é€’</h3><p>åœ¨ Vue ä¸­æœ€å¸¸è§çš„ç»„ä»¶ä¹‹é—´çš„æ•°æ®ä¼ é€’æ–¹å¼æ˜¯ä½¿ç”¨ <code>prop</code> å’Œ <code>emit</code> å®ç°çˆ¶å­ç»„ä»¶é—´ä¼ å€¼ï¼š</p><ul><li>é€šè¿‡ prop å‘å­ç»„ä»¶ä¼ é€’æ•°æ®ã€‚prop æ˜¯åœ¨ç»„ä»¶ä¸Šæ³¨å†Œçš„ä¸€äº›<strong>è‡ªå®šä¹‰ attribute</strong>ã€‚å½“ä¸€ä¸ªå€¼ä¼ é€’ç»™ä¸€ä¸ª prop attribute çš„æ—¶å€™ï¼Œå®ƒå°±å˜æˆäº†é‚£ä¸ªç»„ä»¶å®ä¾‹çš„ä¸€ä¸ª propertyã€‚</li><li>é€šè¿‡ emit å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®ã€‚å½“ç»„ä»¶éœ€è¦ä¿®æ”¹çˆ¶å±‚æ§ç®¡çš„æ•°æ®ï¼ˆè¿™äº›æ•°æ®é€šè¿‡ props ä¼ é€’è¿›æ¥ï¼‰æ—¶ï¼ŒåŸºäº<strong>å•å‘æ•°æ®æµåŸåˆ™</strong>ä¸èƒ½åœ¨ç»„ä»¶å†…è¿›è¡Œä¿®æ”¹ï¼Œè€Œæ˜¯éœ€è¦é€šè¿‡ <code>$emit(&#39;eventName&#39;, value)</code> <strong>å‘å¤–æŠ›å‡ºè‡ªå®šä¹‰çš„äº‹ä»¶</strong>ï¼Œé€šçŸ¥çˆ¶å±‚è¿›è¡Œæ•°æ®ä¿®æ”¹ã€‚</li></ul><p>ğŸ’¡ å¯¹äºè¾“å…¥å‹çš„ç»„ä»¶ï¼Œä¾‹å¦‚åœ¨é¡¹ç›®ä¸­ç»„ä»¶ <code>BrowserFooter</code> åŒ…å«ä¸€ä¸ª <code>&lt;input&gt;</code> å…ƒç´ ï¼Œå¯ä»¥å…è®¸ç”¨æˆ·è¾“å…¥æ ‡ç­¾ç»„çš„åç§°ã€‚å¯ä»¥åœ¨ç»„ä»¶ä¸Šä½¿ç”¨ <code>v-model</code>ï¼Œä»¥åœ¨çˆ¶å­ç»„ä»¶ä¼ å€¼çš„åŒæ—¶å®ç°æ•°æ®çš„åŒå‘ç»‘å®šï¼Œå³æ•°æ®å¯ä»¥ä»çˆ¶å±‚ä¼ é€’ç»™å­ç»„ä»¶ï¼ˆä¸€èˆ¬ä½œä¸ºå˜é‡çš„åˆå§‹å€¼ï¼‰ï¼ŒåŒæ—¶å¯ä»¥æ¥æ”¶å­ç»„ä»¶è¿”å›çš„å€¼ï¼Œä»¥ä¿®æ”¹ç»‘å®šçš„å˜é‡ã€‚</p><p>åœ¨çˆ¶å±‚ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œé€šè¿‡ <code>v-model</code> å®ç°æ•°æ®çš„åŒå‘ç»‘å®šã€‚</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token comment">&lt;!-- ä½¿ç”¨ç»„ä»¶ï¼Œä¸ºäº†ç®€æ´çš„æ¼”ç¤ºï¼Œçœç•¥æ˜¾ç¤ºå…¶ä»–å±æ€§çš„ç»‘å®š --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BrowserFooter</span>
  <span class="token attr-name"><span class="token namespace">v-model:</span>multi-on-group</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multiOnGroup<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name"><span class="token namespace">v-model:</span>new-group-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>newGroupName<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>åœ¨å­ç»„ä»¶çš„è¡¨å•å…ƒç´ ä¸­ï¼Œç»‘å®šç›¸åº”çš„å±æ€§ï¼ŒåŒæ—¶ç›‘å¬ç›¸åº”çš„äº‹ä»¶ï¼š</p><ul><li><p>å¯¹äº <code>&lt;input type=&quot;checkbox&quot;&gt;</code> å¤é€‰æ¡†ï¼Œç»‘å®šçš„å±æ€§æ˜¯ <code>checked</code>ï¼Œéœ€è¦ç›‘å¬çš„äº‹ä»¶æ˜¯ <code>change</code></p></li><li><p>å¯¹äº <code>&lt;input type=&quot;text&quot;&gt;</code> æ–‡æœ¬è¾“å…¥æ¡†ï¼Œç»‘å®šçš„å±æ€§æ˜¯ <code>value</code>ï¼Œéœ€è¦ç›‘å¬çš„äº‹ä»¶æ˜¯ <code>input</code></p></li></ul><p>å½“å±æ€§å€¼å˜æ›´æ—¶ï¼Œéœ€è¦æŠ›å‡ºäº‹ä»¶çš„æ ¼å¼ä»¥ <code>update:</code> ä¸ºå‰ç¼€ï¼Œè€Œå±æ€§å€¼é€šè¿‡è¯»å–äº‹ä»¶å¯¹è±¡çš„ç›¸åº”å±æ€§ <code>$event.target</code> è·å¾—</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- çœç•¥å…¶ä»–æ¨¡æ¿å†…å®¹ --&gt;</span>
  <span class="token comment">&lt;!-- å•ä¸ªå¤é€‰æ¡† --&gt;</span>
  <span class="token comment">&lt;!-- ä¸ºäº†ç®€æ´çš„æ¼”ç¤ºï¼Œçœç•¥æ˜¾ç¤ºå…¶ä»–å±æ€§çš„ç»‘å®š --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
    <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>group<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:checked</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>multiOnGroup<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$emit(<span class="token punctuation">&#39;</span>update:multiOnGroup<span class="token punctuation">&#39;</span>, $event.target.checked)<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span>
    <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>group<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text-xs text-gray-500<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>åœ¨ç»„å†…æ‰“å¼€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- çœç•¥å…¶ä»–æ¨¡æ¿å†…å®¹ --&gt;</span>
  <span class="token comment">&lt;!-- æ–‡æœ¬è¾“å…¥æ¡† --&gt;</span>
  <span class="token comment">&lt;!-- ä¸ºäº†ç®€æ´çš„æ¼”ç¤ºï¼Œçœç•¥æ˜¾ç¤ºå…¶ä»–å±æ€§çš„ç»‘å®š --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
    <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>è¾“å…¥ group åç§°<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>newGroupName<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$emit(<span class="token punctuation">&#39;</span>update:newGroupName<span class="token punctuation">&#39;</span>, $event.target.value)<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- çœç•¥å…¶ä»–æ¨¡æ¿å†…å®¹ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    multiOnGroup<span class="token operator">:</span> Boolean<span class="token punctuation">,</span>
    newGroupName<span class="token operator">:</span> <span class="token punctuation">{</span>
      type<span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;new&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  emits<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// ...</span>
    <span class="token string">&#39;update:multiOnGroup&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;update:newGroupName&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="ç¥–å­™ç»„ä»¶é—´æ•°æ®ä¼ é€’" tabindex="-1"><a class="header-anchor" href="#ç¥–å­™ç»„ä»¶é—´æ•°æ®ä¼ é€’" aria-hidden="true">#</a> ç¥–å­™ç»„ä»¶é—´æ•°æ®ä¼ é€’</h3><p>ç”¨ <code>provide</code> å’Œ <code>inject</code> å®ç°ä»ç¥–å…ˆç»„ä»¶å‘å…¶å­å­™åä»£ç»„ä»¶ä¼ å€¼ï¼š</p><ul><li>çˆ¶ç»„ä»¶ç”¨ <code>provide</code> é€‰é¡¹æˆ–ï¼ˆåœ¨ç»„åˆå¼ API ä¸­ï¼‰æ–¹æ³•æ¥æä¾›æ•°æ®ï¼Œå¯ä»¥æä¾›å“åº”å¼æ•°æ®ï¼Œä¾‹å¦‚ ref å¯¹è±¡</li><li>å­ç»„ä»¶ç”¨ <code>inject</code> é€‰é¡¹æˆ–ï¼ˆåœ¨ç»„åˆå¼ API ä¸­ï¼‰æ–¹æ³•æ¥æ¥æ”¶è¿™ä¸ªæ•°æ®</li></ul><p>åœ¨é¡¹ç›®ä¸­å¤šä¸ªç»„ä»¶ä¸­éƒ½éœ€è¦ä½¿ç”¨ IndexedDB æ•°æ®åº“ï¼Œåœ¨å¼¹å‡ºé¡µçš„ Vue å…¥å£æ–‡ä»¶ <code>src/popup/main.js</code> ä¸­ä½¿ç”¨æ¡†æ¶ Dexie.js åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å®ä¾‹ï¼Œå†é€šè¿‡ <code>provide</code> çš„æ–¹å¼ä¾›å…¶ä»–å­ç»„ä»¶ä½¿ç”¨ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> Dexie <span class="token keyword">from</span> <span class="token string">&#39;dexie&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App.vue&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&#39;@/styles/tailwind.css&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">&#39;tagdown&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  bookmark<span class="token operator">:</span> <span class="token string">&#39;id, *tags, *groups&#39;</span><span class="token punctuation">,</span>
  share<span class="token operator">:</span> <span class="token string">&#39;id, share&#39;</span><span class="token punctuation">,</span>
  star<span class="token operator">:</span> <span class="token string">&#39;id, star&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">database</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;db&#39;</span><span class="token punctuation">,</span> database<span class="token punctuation">)</span><span class="token punctuation">;</span>
  app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&#39;#app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Error occurred</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>ç„¶ååœ¨ç»„ä»¶ï¼Œä¾‹å¦‚ <code>BrowserPage.vue</code> ä¸­é€šè¿‡ <code> const db = inject(&#39;db&#39;);</code> æ¥æ¥æ”¶è¯¥æ•°æ®åº“å®ä¾‹ã€‚</p><p>ğŸ’¡ ä¸ºäº†ä¾¿äºä»£ç ç»´æŠ¤ï¼Œå½“ä½¿ç”¨å“åº”å¼ provide / inject å€¼æ—¶ï¼Œå»ºè®®å°½å¯èƒ½å°†<strong>å¯¹å“åº”å¼ property çš„ä¿®æ”¹é™åˆ¶åœ¨å®šä¹‰ provide çš„ç»„ä»¶å†…</strong>ã€‚å¦‚æœçœŸçš„éœ€è¦åœ¨æ³¨å…¥æ•°æ®çš„ç»„ä»¶å†…éƒ¨æ›´æ–° inject çš„æ•°æ®ï¼Œå»ºè®®åŒæ—¶ provide ä¸€ä¸ª<strong>æ–¹æ³•</strong>æ¥è´Ÿè´£æ”¹å˜å€¼ï¼Œè¿™æ ·å¯ä»¥å°†æ•°æ®å€¼çš„è®¾å®šå’Œæ•°æ®ä¿®æ”¹çš„é€»è¾‘ä»£ç éƒ½ä¾ç„¶é›†ä¸­æ”¾åœ¨ç¥–çˆ¶ç»„ä»¶ä¸­ï¼Œä¾¿äºåç»­è·Ÿè¸ªå’Œç»´æŠ¤ã€‚</p><p>åœ¨ç¥–å…ˆç»„ä»¶ <code>src/popup/App.vue</code> ä¸­æ ¹æ®å“åº”å¼å˜é‡ <code>Page</code> æ§åˆ¶å¼¹å‡ºé¡µé¢çš„çŠ¶æ€æ˜¯ <code>&quot;browser&quot;</code> è¿˜æ˜¯ <code>&quot;edit&quot;</code>ï¼Œè€Œæ§åˆ¶è¯¥å˜é‡åˆ‡æ¢çš„æŒ‰é’®æ˜¯åœ¨åä»£ç»„ä»¶ <code>BrowserFooter.vue</code> ä¸­.</p><p>å› æ­¤åœ¨ç¥–å…ˆç»„ä»¶æä¾›ä¿®æ”¹è¯¥å˜é‡çš„æ–¹æ³•</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> provide <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>
    
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// provide page state and change the page state function</span>
  <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;page&#39;</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">changePage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    page<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;changePage&#39;</span><span class="token punctuation">,</span> changePage<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>åœ¨åä»£ç»„ä»¶æ¥æ”¶è¯¥æ–¹æ³•ï¼Œå¹¶ç»‘å®šåˆ°æŒ‰é’®ä¸Š</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- çœç•¥å…¶ä»–æ¨¡æ¿ä»£ç  --&gt;</span>
  <span class="token comment">&lt;!-- ä¸ºäº†ç®€æ´çš„æ¼”ç¤ºï¼Œçœç•¥æ˜¾ç¤ºå…¶ä»–å±æ€§çš„ç»‘å®š --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
    <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>add bookmark<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changePage(<span class="token punctuation">&#39;</span>edit<span class="token punctuation">&#39;</span>)<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- çœç•¥å…¶ä»–æ¨¡æ¿ä»£ç  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> changePage <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;changePage&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token comment">// ...</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    changePage
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="å…„å¼Ÿç»„ä»¶é—´ä¿¡æ¯ä¼ é€’" tabindex="-1"><a class="header-anchor" href="#å…„å¼Ÿç»„ä»¶é—´ä¿¡æ¯ä¼ é€’" aria-hidden="true">#</a> å…„å¼Ÿç»„ä»¶é—´ä¿¡æ¯ä¼ é€’</h3><p>å¯¹äºåœ¨å±‚çº§ç»“æ„ä¸­å¤„äºã€Œå¹³è¡Œã€å…³ç³»ï¼Œå¦‚æœéœ€è¦è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ Vue å®˜æ–¹æ¨èçš„æ•°æ®çŠ¶æ€ç®¡ç†æ’ä»¶ <a href="https://vuex.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">Vuex</a>ã€‚</p><p>åœ¨é¡¹ç›®ä¸­æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯é€šè¿‡ç‚¹å‡»ç»„ä»¶ <code>BrowserMenu</code> çš„æŒ‰é’®ï¼Œæ§åˆ¶å…„å¼Ÿç»„ä»¶ <code>BrowserGrid</code> çš„æ–‡ä»¶å¤¹å±•å¼€/æŠ˜å ã€‚</p><p><img src="/blog-web/assets/tagdown-toggle-folder.3112e95c.gif" alt="toggle folder"></p><p>æŠŠå…„å¼Ÿç»„ä»¶çš„çˆ¶ç»„ä»¶ä½œä¸ºä¿¡æ¯ä¼ é€’çš„ã€Œæ¡¥æ¢ã€ï¼Œåœ¨çˆ¶ç»„ä»¶ç›‘å¬å…¶ä¸­ä¸€ä¸ªå­ç»„ä»¶æŠ›å‡ºçš„äº‹ä»¶ï¼Œç„¶åæ¥æ”¶åˆ°è‡ªå®šä¹‰äº‹ä»¶æ—¶ï¼Œé€šè¿‡æ¨¡æ¿å¼•ç”¨æ¥è°ƒç”¨å¦ä¸€ä¸ªå­ç»„ä»¶çš„æ–¹æ³•ï¼Œä»è€Œå®ç°å…„å¼Ÿç»„ä»¶ä¿¡æ¯ä¼ é€’ã€‚</p><p>å°†çˆ¶ç»„ä»¶ <code>BrowserPage</code> ä½œä¸ºã€Œæ¡¥æ¢ã€ï¼Œè¿æ¥ä¸¤ä¸ªã€Œå¹³è¡Œã€å…³ç³»å­ç»„ä»¶ã€‚</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- çœç•¥å…¶ä»–æ¨¡æ¿ä»£ç  --&gt;</span>
  <span class="token comment">&lt;!-- menu --&gt;</span>
  <span class="token comment">&lt;!-- ä¸ºäº†ç®€æ´çš„æ¼”ç¤ºï¼Œçœç•¥æ˜¾ç¤ºå…¶ä»–å±æ€§çš„ç»‘å®š --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span>
      <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>browserMenuComponent<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@unfold-all</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unfoldAllHandler<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">@fold-all</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>foldAllHandler<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- çœç•¥å…¶ä»–æ¨¡æ¿ä»£ç  --&gt;</span>
  <span class="token comment">&lt;!-- ä¸ºäº†ç®€æ´çš„æ¼”ç¤ºï¼Œçœç•¥æ˜¾ç¤ºå…¶ä»–å±æ€§çš„ç»‘å®š --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BrowserGrid</span>
    <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>grid<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  ref<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> inject<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vue&#39;</span><span class="token punctuation">;</span>
    
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// unfold or fold all folder</span>
    <span class="token keyword">const</span> grid <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å¼•ç”¨ BrowserGrid ç»„ä»¶</span>
    <span class="token keyword">const</span> <span class="token function-variable function">unfoldAllHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      grid<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">unfoldAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è°ƒç”¨ç»„ä»¶ä¸­çš„æ–¹æ³• unfoldAll()</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> <span class="token function-variable function">foldAllHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      grid<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">foldAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è°ƒç”¨ç»„ä»¶ä¸­çš„æ–¹æ³• foldAll()</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>   

    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      grid<span class="token punctuation">,</span>
      unfoldAllHandler<span class="token punctuation">,</span>
      foldAllHandler<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><h3 id="é¡µé¢æ ·å¼" tabindex="-1"><a class="header-anchor" href="#é¡µé¢æ ·å¼" aria-hidden="true">#</a> é¡µé¢æ ·å¼</h3><p>ç”±äº Chrome <a href="https://developer.chrome.com/docs/extensions/reference/action/#popup" target="_blank" rel="noopener noreferrer">é™åˆ¶</a>å¼¹å‡ºé¡µé¢çš„å¤§å°ï¼Œé«˜å’Œå®½çš„æœ€å°å€¼éƒ½æ˜¯æ˜¯ 25pxï¼Œé«˜çš„æœ€å¤§å€¼æ˜¯ 600pxï¼Œå®½çš„æœ€å¤§å€¼æ˜¯ 800pxã€‚å› æ­¤ä¸ºäº†å°½å¯èƒ½åˆ©ç”¨ç©ºé—´æ˜¾ç¤ºå†…å®¹ï¼ŒTagDown å°†å¼¹å‡ºé¡µçš„æµè§ˆçŠ¶æ€è®¾ç½®ä¸ºæœ€å¤§é™åˆ¶</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scss<span class="token punctuation">&quot;</span></span> <span class="token attr-name">scoped</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">// src/popup/App.vue
.browser-mode</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
    
// ...
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>ä½†æ˜¯æ­¤æ—¶å¼¹å‡ºé¡µå°±ä¼šå‡ºç°<strong>æ»šåŠ¨æ¡</strong>ï¼Œå¯ä»¥åœ¨å¼¹å‡ºé¡µçš„å…¥å£æ–‡ä»¶ ğŸ“„ <code>src/popup.html</code> ä¸­ä¸º <code>&lt;body&gt;</code> å…ƒç´ æ·»åŠ æ ·å¼ï¼Œå–æ¶ˆå®ƒçš„æ»šåŠ¨æ¡</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- çœç•¥éƒ¨åˆ†ä»£ç  --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">body::-webkit-scrollbar</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
      <span class="token property">height</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>  
    
<span class="token comment">&lt;!-- çœç•¥éƒ¨åˆ†ä»£ç  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="æ•°æ®æŒä¹…åŒ–" tabindex="-1"><a class="header-anchor" href="#æ•°æ®æŒä¹…åŒ–" aria-hidden="true">#</a> æ•°æ®æŒä¹…åŒ–</h2><p>å‚è€ƒï¼š</p><ul><li>ã€Šç°ä»£ JavaScript æ•™ç¨‹ã€‹<a href="https://zh.javascript.info/indexeddb" target="_blank" rel="noopener noreferrer">IndexedDB</a> ä¸€ç« </li><li><a href="https://golb.hplar.ch/2017/09/A-closer-look-at-IndexedDB.html" target="_blank" rel="noopener noreferrer">A closer look at IndexedDB</a></li></ul><h3 id="indexeddb-åŸºç¡€" tabindex="-1"><a class="header-anchor" href="#indexeddb-åŸºç¡€" aria-hidden="true">#</a> IndexedDB åŸºç¡€</h3><p>å‰ç«¯æ•°æ®æŒä¹…åŒ–æœ‰å¤šç§æ–¹å¼å®ç°ï¼Œå…¶ä¸­è¾ƒå¸¸ç”¨çš„æ˜¯é€šè¿‡æµè§ˆå™¨è‡ªå¸¦çš„ IndexedDB æ•°æ®åº“å®ç°ã€‚</p><p>ğŸ’¡ ç”±äºæ‰©å±•ç¨‹åºçš„åå° service worker ç”±äº Service workers æ— æ³•è®¿é—® DOM å’Œç›¸å…³çš„ APIï¼Œä¸”ç¯å¢ƒä¸­æ²¡æœ‰ <code>window</code> è¿™ä¸ªå˜é‡å¯¹è±¡ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨æµè§ˆå™¨æä¾›çš„ <code>localStorage</code> å’Œ <code>sessionStorage</code> è¿›è¡Œæ•°æ®å­˜å‚¨ã€‚Chrome ä¸ºæ‰©å±•ç¨‹åºæä¾›ä¸€ä¸ª<a href="https://developer.chrome.com/docs/extensions/reference/storage/" target="_blank" rel="noopener noreferrer">æ•°æ®å­˜å‚¨ API <code>chrome.storeage</code></a> ï¼Œè¯¥ API å¯ä»¥å®ç° ç±»ä¼¼ localStorage çš„åŠŸèƒ½ï¼Œç”¨äºå­˜å‚¨<strong>å°‘é‡</strong>çš„æ•°æ®ï¼ˆä¸€èˆ¬æ˜¯å­˜å‚¨æ‰©å±•ç¨‹åºçš„è®¾ç½®å‚æ•°ï¼‰ã€‚å¯¹äº <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fextensions%2Freference%2Fstorage%2F%23property-sync" target="_blank" rel="noopener noreferrer">sync åŒæ­¥å­˜å‚¨</a>çš„æ•°æ®ï¼Œå…è®¸æ€»å¤§å°ä¸º 100KBï¼›å¯¹äº <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Fextensions%2Freference%2Fstorage%2F%23property-local" target="_blank" rel="noopener noreferrer">local æœ¬åœ°å­˜å‚¨</a>çš„æ•°æ®ï¼Œå…è®¸æ€»å¤§å°ä¸º 5MBï¼ˆç±»ä¼¼äº localstorage çš„å­˜å‚¨é™åˆ¶ï¼‰ã€‚</p><p>IndexedDB å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li>é€šè¿‡æ”¯æŒå¤šç§ç±»å‹çš„é”®ï¼Œæ¥å­˜å‚¨å‡ ä¹å¯ä»¥æ˜¯<strong>ä»»ä½•ç±»å‹</strong>çš„å€¼</li><li>æ”¯æ’‘äº‹åŠ¡ï¼Œæœ‰è‰¯å¥½çš„å¯é æ€§ï¼ˆ<strong>äº‹åŠ¡</strong>æ˜¯æ•°æ®åº“é€šç”¨æœ¯è¯­ï¼Œæ˜¯æŒ‡ä¸€ç»„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸å­˜åœ¨ä¸­é—´ç»“æœä»è€Œå¯¼è‡´æ•°æ®å†²çªæˆ–ä¸å®Œæ•´ï¼‰</li><li>æ”¯æŒé”®çš„èŒƒå›´æŸ¥è¯¢ï¼Œä¹Ÿæ”¯æŒä¸ºæ•°æ®æ·»åŠ ç´¢å¼•</li></ul><p>âš ï¸ IndexedDB éµå¾ª<strong>åŒæºç­–ç•¥</strong>é™åˆ¶ï¼Œå³æ¯ä¸ªæ•°æ®åº“éƒ½æ˜¯ç»‘å®šåˆ°æºï¼ˆåŸŸ/åè®®/ç«¯å£ï¼‰çš„ï¼Œä¸åŒçš„ç½‘ç«™ä¸èƒ½ç›¸äº’è®¿é—®å¯¹æ–¹çš„æ•°æ®åº“ã€‚</p><p>IndexedDB æ•°æ®æœ‰å‡ ä¸ªåŸºæœ¬çš„æ¦‚å¿µï¼Œå’Œ SQLã€NoSQL ç­‰å¸¸ç”¨æ•°æ®åº“æ¦‚å¿µç±»ä¼¼ï¼š</p><ul><li>ï¼ˆåŒæºï¼‰ç½‘é¡µå¯ä»¥åˆ›å»ºä¸€ä¸ªä¸“å±çš„æ•°æ®åº“ Databaseï¼ˆéµå¾ªåŒæºç­–ç•¥çš„é™åˆ¶ï¼‰</li><li>æ¯ä¸€ä¸ªæ•°æ®åº“å¯ä»¥åˆ›å»ºå¤šä¸ª<strong>å¯¹è±¡åº“ ObjectStore</strong>ï¼Œå’Œ SQL çš„è¡¨æ ¼æ¦‚å¿µç±»ä¼¼</li><li>åœ¨å¯¹è±¡åº“ä¸­å°±æ˜¯ä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨ç€çš„ä¸€æ¡æ¡æ•°æ®</li></ul><p><img src="/blog-web/assets/IndexedDB.5b1590ef.png" alt="IndexedDB"></p><p>ä½¿ç”¨ IndexedDB çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>åˆ›å»º/æ‰“å¼€ä¸€ä¸ªæ•°æ®åº“</li><li>å®šä¹‰æ•°æ®ç»“æ„ï¼Œåˆ›å»º<strong>å¯¹è±¡åº“</strong>ï¼ŒæŒ‡å®šæ•°æ®é¡¹çš„é”® keyï¼ˆè¿˜å¯ä»¥åˆ›å»ºç´¢å¼• indexï¼‰</li><li>å¯åŠ¨<strong>äº‹åŠ¡</strong>å¯¹å¯¹æ•°æ®è¿›è¡Œæ“ä½œ</li><li>ç›‘å¬ç›¸åº”çš„äº‹ä»¶</li><li>è·å–æ“ä½œç»“æœ</li></ul><p>ä½¿ç”¨æ–¹æ³• <code>open()</code>ï¼ˆè¿æ¥ï¼‰ä¸€ä¸ªæ•°æ®åº“ï¼Œç¬¬ä¸€ä¸ªå‚æ•° <code>name</code> æ˜¯æ•°æ®åº“åç§°ï¼Œæ•°æ®åº“å¯ä»¥æœ‰è®¸å¤šä¸åŒçš„åç§°ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºæ•°æ®åº“ç‰ˆæœ¬ï¼Œé»˜è®¤ä¸º <code>1</code>ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> openRequest <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>è¯¥æ–¹æ³•è¿”å› <code>openRequest</code> å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦ç›‘å¬è¯¥å¯¹è±¡ä¸Šçš„äº‹ä»¶ï¼ˆå› ä¸ºå¯¹ IndexedDB APIs ä¸€èˆ¬éƒ½æ˜¯<strong>å¼‚æ­¥æ“ä½œ</strong>ï¼Œå¾…äº‹ä»¶è§¦å‘åæ‰å¯ä»¥åœ¨å›è°ƒå‡½æ•°ä¸­æ‰§è¡Œåç»­æ“ä½œï¼‰ï¼š</p><ul><li><code>success</code>ï¼šæ•°æ®åº“å‡†å¤‡å°±ç»ªæ—¶è§¦å‘çš„äº‹ä»¶ã€‚ç„¶ååœ¨ <code>openRequest.result</code> ä¸­æœ‰äº†ä¸€ä¸ªæ•°æ®åº“å¯¹è±¡ Database Objectï¼Œä½¿ç”¨å®ƒå¯¹æ•°æ®åº“è¿›è¡Œè¿›ä¸€æ­¥çš„è°ƒç”¨</li><li><code>error</code>ï¼šæ‰“å¼€å¤±è´¥æ—¶è§¦å‘çš„äº‹ä»¶</li><li><code>upgradeneeded</code>ï¼šæ•°æ®åº“å·²å‡†å¤‡å°±ç»ªï¼Œä½†å…¶ç‰ˆæœ¬å·²è¿‡æ—¶è§¦å‘çš„äº‹ä»¶ã€‚å¯ä»¥æ ¹æ®éœ€è¦æ¯”è¾ƒç‰ˆæœ¬ï¼Œå¹¶å‡çº§æ•°æ®ç»“æ„ã€‚å‡çº§æ“ä½œé¡ºåˆ©å®Œæˆåï¼Œ<strong><code>onsuccess</code> äº‹ä»¶è¢«è§¦å‘ï¼Œæ•°æ®åº“æ‰ç®—æ˜¯æˆåŠŸæ‰“å¼€äº†</strong>ã€‚</li></ul><p>ğŸ’¡ å¦‚æœæ•°æ®åº“è¿˜ä¸å­˜åœ¨æ—¶ï¼ˆä»æ­¤æ—¶æ•°æ®åº“çš„ç‰ˆæœ¬æ˜¯ <code>0</code>ï¼‰ï¼Œæ‰“å¼€æ•°æ®åº“æ“ä½œå°±ä¼šè§¦å‘ <code>upgradeneeded</code> äº‹ä»¶ï¼Œæ­¤æ—¶å¯ä»¥æ‰§è¡Œåˆå§‹åŒ–ï¼ˆå¦‚åˆ›å»ºå¯¹è±¡åº“ï¼ŒæŒ‡å®šæ•°æ®é¡¹çš„é”® keyï¼Œå®šä¹‰æ•°æ®é¡¹çš„ç´¢å¼• index ç­‰ï¼‰</p><p>âš ï¸ åªæœ‰åœ¨ <code>upgradeneeded</code> äº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸­ï¼Œæ‰å¯ä»¥æ›´æ–°å‡çº§æ•°æ®åº“çš„ç»“æ„ï¼ˆä¾‹å¦‚å¯¹è±¡åº“çš„åˆ›å»ºï¼Œä»¥åŠä¿®æ”¹å¯¹è±¡åº“çš„ç´¢å¼•å±æ€§ï¼‰</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> openRequest <span class="token operator">=</span> indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;tagdown&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å¦‚æœæµè§ˆå™¨ä¸­æ²¡æœ‰è¯¥æ•°æ®åº“ï¼ˆæˆ–å·²å­˜åœ¨çš„æ•°æ®åº“ç‰ˆæœ¬ï¼Œä¸æ‰“å¼€çš„ç‰ˆæœ¬ä¸ç¬¦ï¼‰ï¼Œåˆ™ä¼šè§¦å‘ upgradeneeded äº‹ä»¶</span>
openRequest<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ‰§è¡Œåˆå§‹åŒ–</span>
  <span class="token keyword">let</span> bookmark <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span><span class="token string">&#39;bookmark&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> keyPath<span class="token operator">:</span> <span class="token string">&quot;id&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> index <span class="token operator">=</span> bookmark<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token string">&#39;tags&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;tags&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> multiEntry<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// å‚æ•°ä¾æ­¤è¡¨ç¤ºï¼šç´¢å¼•åç§°ä¸º tagsï¼Œå¯¹åº”ä»¥æ•°æ®çš„å“ªä¸€ä¸ªå±æ€§ä½œä¸ºç´¢å¼•å€¼ï¼Œç”±äºè¯¥å±æ€§å€¼ä¸ºæ•°ç»„ï¼Œä¸”å°†æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä½œä¸ºç´¢å¼•æ—¶éœ€è¦é…ç½® multiEntry ä¸º true</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// å¦‚æœæµè§ˆå™¨ä¸­æœ‰è¯¥æ•°æ®åº“ï¼Œåˆ™ä¼šè§¦å‘ onsuccess äº‹ä»¶</span>
openRequest<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> db <span class="token operator">=</span> openRequest<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
  <span class="token comment">// ç»§ç»­ä½¿ç”¨å·²æœ‰çš„ db å¯¹è±¡å¤„ç†æ•°æ®åº“</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

openRequest<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> openRequest<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>ğŸ’¡ å¦‚æœæƒ³åˆ é™¤æ•´ä¸ªæ•°æ®åº“ï¼ˆè€Œä¸æ˜¯å•ä¸€æ¡æ•°æ®ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ³• <code>deleteDatabase(databaseName)</code></p><p>æ¥ç€ï¼Œ<strong><mark>åœ¨ <code>success</code> äº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸­</mark></strong>ï¼Œä½¿ç”¨æ–¹æ³• <code>transaction</code> å¯åŠ¨äº‹åŠ¡ï¼Œå¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚</p><p>ä½¿ç”¨äº‹åŠ¡æ“ä½œæ•°æ®çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li><p>ä½¿ç”¨ <code>db.transaction(store)</code> åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œè¡¨æ˜è¦è®¿é—®çš„å¯¹è±¡åº“</p></li><li><p>ä½¿ç”¨ <code>transaction.objectStore(name)</code> è·å–å­˜å‚¨å¯¹è±¡</p></li><li><p>å‘èµ·è¯·æ±‚ï¼Œæ“ä½œæ•°æ®</p></li><li><p>ç›‘å¬è¯·æ±‚çš„æˆåŠŸ/é”™è¯¯äº‹ä»¶ï¼Œå¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œ</p></li></ul><p>æ–¹æ³• <code>transaction</code> åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒæ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹åŠ¡è¦è®¿é—®çš„å¯¹è±¡åº“åç§°ï¼ˆå¦‚æœæˆ‘ä»¬è¦è®¿é—®å¤šä¸ªå¯¹è±¡åº“ï¼Œåˆ™è¯¥å‚æ•°å€¼æ˜¯æŠ‘æ¶æ•°ç»„ï¼‰ï¼›ï¼ˆå¯é€‰ï¼‰ç¬¬äºŒä¸ªå‚æ•°æ˜¯äº‹åŠ¡ç±»å‹ï¼š</p><ul><li><code>readonly</code> åªè¯»ï¼Œé»˜è®¤å€¼</li><li><code>readwrite</code> å¯è¯»å–å’Œå†™å…¥æ•°æ®ï¼ˆä½†ä¸èƒ½åˆ›å»º/åˆ é™¤/æ›´æ”¹çš„å¯¹è±¡åº“ï¼Œè¿™ç±»æ“ä½œåªèƒ½åœ¨ <code>upgradeneeded</code> äº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸­è¿›è¡Œï¼‰</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>store<span class="token punctuation">[</span><span class="token punctuation">,</span> type<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>ğŸ’¡ éœ€è¦ä¸¤ç§äº‹åŠ¡ç±»å‹ï¼Œæ˜¯å› ä¸ºä¸¤ç§ç±»å‹çš„äº‹ç‰©æ“ä½œã€Œæ€§èƒ½ã€æ˜¯ä¸åŒçš„ã€‚è®¸å¤š <code>readonly</code> äº‹åŠ¡èƒ½å¤ŸåŒæ—¶è®¿é—®åŒä¸€å­˜å‚¨åŒºï¼›ä½† <code>readwrite</code> äº‹åŠ¡ä¸èƒ½ã€‚å› ä¸º <code>readwrite</code> äº‹åŠ¡ä¼šã€Œ<strong>é”å®š</strong>ã€å­˜å‚¨åŒºè¿›è¡Œå†™æ“ä½œï¼Œä¸‹ä¸€ä¸ªäº‹åŠ¡å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªäº‹åŠ¡å®Œæˆï¼Œæ‰èƒ½è®¿é—®ç›¸åŒçš„å­˜å‚¨åŒºã€‚</p><p>åˆ›å»ºäº‹åŠ¡åï¼Œä½¿ç”¨äº‹åŠ¡å®ä¾‹çš„æ–¹æ³• <code>objectStore(name)</code> è·å–ç›¸åº”çš„å¯¹è±¡åº“ï¼Œç„¶åå°±å¯ä»¥å¯¹é‡Œé¢çš„æ•°æ®é¡¹è¿›è¡Œæ“ä½œã€‚å¯¹è±¡åº“æ”¯æŒä¸¤ç§å­˜å‚¨å€¼çš„æ–¹æ³•ï¼š</p><ul><li>æ–¹æ³• <code>put(value, [key])</code> å°† <code>value</code> æ·»åŠ åˆ°å­˜å‚¨åŒºã€‚<strong>å¦‚æœå·²ç»å­˜åœ¨ç›¸åŒé”®çš„æ•°æ®ï¼Œåˆ™å°†æ›¿æ¢è¯¥å€¼ã€‚</strong></li><li>æ–¹æ³• <code>add(value, [key])</code> ä¸æ–¹æ³• <code>put</code> ç±»ä¼¼ï¼Œ<strong>ä½†æ˜¯å¦‚æœå·²ç»å­˜åœ¨ç›¸åŒé”®çš„æ•°æ®ï¼Œåˆ™è¯·æ±‚å¤±è´¥</strong>ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåä¸º <code>&quot;ConstraInterror&quot;</code> çš„é”™è¯¯ã€‚</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token string">&quot;bookmark&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;readwrite&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œè¡¨æ˜è¦è®¿é—®çš„å¯¹è±¡åº“æ˜¯ bookmarkï¼Œäº‹åŠ¡ç±»å‹æ˜¯è¯»å†™</span>

<span class="token comment">// è·å–å¯¹è±¡åº“è¿›è¡Œæ“ä½œ</span>
<span class="token keyword">let</span> bookmark <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span><span class="token string">&quot;bookmark&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ•°æ®é¡¹</span>
<span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">&#39;123&#39;</span><span class="token punctuation">,</span>
  title<span class="token operator">:</span> <span class="token string">&#39;Google&#39;</span>
  url<span class="token operator">:</span> <span class="token string">&#39;www.google.com&#39;</span>
  tags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;search&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;tool&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> request <span class="token operator">=</span> bookmark<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å‘å¯¹è±¡åº“ä¸­æ·»åŠ æ•°æ®é¡¹</span>

<span class="token comment">// ç›‘å¬è¯·æ±‚æˆåŠŸäº‹ä»¶</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Bookmark added to the store&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¯·æ±‚å¤±è´¥äº‹ä»¶</span>
request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>åˆ é™¤ç‰¹å®šçš„æ•°æ®éœ€è¦æŒ‡å®šæŸ¥è¯¢æ¡ä»¶ï¼Œä½¿ç”¨æ–¹æ³• <code>delete(query)</code></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åˆ é™¤é”®å€¼æ»¡è¶³ id=&#39;123&#39; çš„æ•°æ®</span>
bookmark<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&#39;123&#39;</span><span class="token punctuation">)</span>ï¼›
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>æ•°æ®åº“å¦ä¸€ä¸ªé‡è¦åŠŸèƒ½æ˜¯æœç´¢æ•°æ®ï¼ŒIndexedDB æ”¯æŒä¸¤ç§ä¸»è¦çš„æœç´¢ç±»å‹ï¼š</p><ul><li>åŸºäºä¸€ä¸ªé”®æˆ–èŒƒå›´è¿›è¡Œæœç´¢</li><li>åŸºäºä¸€ä¸ªç´¢å¼•æˆ–èŒƒå›´è¿›è¡Œæœç´¢</li></ul><p>ä¸¤è€…çš„åŒºåˆ«æ˜¯ï¼šç”±äºæ¯ä¸ªæ•°æ®çš„é”® key æ˜¯ç‰¹æ®Šå”¯ä¸€çš„ï¼Œå¦‚æœåŸºäºå•ä¸€å€¼æœç´¢ï¼Œæœ€å¤šè·å¾—ä¸€ä¸ªæ•°æ®é¡¹ï¼›è€Œç´¢å¼•å€¼å¯ä»¥å¤ç”¨ï¼Œå¦‚æœåŸºäºå•ä¸€ç´¢å¼•å€¼æœç´¢ï¼Œå¯ä»¥è·å¾—å¤šä¸ªæ•°æ®é¡¹ã€‚</p><p>ä½¿ç”¨æ–¹æ³• <code>get(query)</code> æŒ‰é”® key æœç´¢æ•°æ®ï¼Œè¿”å›æ»¡è¶³æ¡ä»¶çš„æ•°æ®é¡¹ï¼›ä½¿ç”¨æ–¹æ³• <code>getKey(query)</code> æŒ‰é”® key æœç´¢æ•°æ®ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯æ»¡è¶³æ¡ä»¶çš„æ•°æ®é¡¹çš„é”®å€¼</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>bookmark<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;123&#39;</span><span class="token punctuation">)</span> <span class="token comment">// è¿”å›æ•°æ®é¡¹</span>
bookmark<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token string">&#39;123&#39;</span><span class="token punctuation">)</span> <span class="token comment">// è¿”å› 123</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ğŸ’¡ ä½¿ç”¨æ–¹æ³• <code>getAll([query], [count])</code> æˆ– <code>getAllKeys([query], [count])</code> è·å–ä¸€ä¸ªèŒƒå›´çš„æ•°æ®æˆ–é”®å€¼ï¼Œè¿”å›æ•°ç»„ï¼Œå…¶ä¸­å‚æ•° <code>query</code> è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ï¼Œéœ€è¦é€šè¿‡è°ƒç”¨<a href="https://zh.javascript.info/indexeddb#:~:text=%E4%B8%80%E4%B8%AA%E2%80%9C%E9%94%AE%E8%8C%83%E5%9B%B4%E2%80%9D%E3%80%82-,%E4%BD%BF%E7%94%A8%E4%BB%A5%E4%B8%8B%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%E5%88%9B%E5%BB%BA%E8%8C%83%E5%9B%B4,-%EF%BC%9A" target="_blank" rel="noopener noreferrer">ç›¸åº”çš„å‡½æ•°</a>åˆ›å»ºã€‚</p><p>ğŸ’¡ <strong>åªè¿”å›é”®å€¼</strong>çš„æ–¹æ³•æ•ˆç‡æ›´é«˜ï¼Œè¯¥æ“ä½œä¸éœ€è¦è§£æè¯»å–å®Œæ•´çš„æ•°æ®</p><p><a href="https://zh.javascript.info/indexeddb#tong-guo-dai-suo-yin-de-zi-duan-sou-suo" target="_blank" rel="noopener noreferrer">é€šè¿‡ç´¢å¼• index è¿›è¡ŒæŸ¥è¯¢</a>ï¼Œä¹Ÿæ˜¯ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œä½†æ˜¯é€šè¿‡ç´¢å¼•å¯¹è±¡è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> tagsIndex <span class="token operator">=</span> bookmark<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span><span class="token string">&quot;tags&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç´¢å¼•å¯¹è±¡</span>
tagsIndex<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token string">&#39;tool&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è·å–æ‰€æœ‰æ ‡è®°æœ‰ tool çš„æ•°æ®é¡¹</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="dexie-js" tabindex="-1"><a class="header-anchor" href="#dexie-js" aria-hidden="true">#</a> Dexie.js</h3><p>è™½ç„¶ IndexedDB å¤§éƒ¨åˆ†æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯æ–¹æ³•è¿”å›çš„ä¸æ˜¯ Promiseï¼Œè€Œæ˜¯åŸºäºç›‘å¬äº‹ä»¶æ‰§è¡Œå›è°ƒçš„æ–¹å¼æ¥å¤„ç†æ“ä½œç»“æœï¼Œå¼€å‘ç¹çä¸”ä»£ç ä¸æ˜“äºç»´æŠ¤ã€‚</p><p>ä¸ºäº†ä¾¿äºå¼€å‘ä½¿ç”¨ä¸€ä¸ªåä¸º <strong><a href="https://dexie.org/" target="_blank" rel="noopener noreferrer">Dexie.js</a> åº“ï¼Œå®ƒå¯¹ IndexedDB APIs è¿›è¡ŒäºŒæ¬¡å°è£…</strong>ï¼Œè®©è°ƒç”¨ IndexedDB æ›´æ–¹ä¾¿ã€‚è¯¥åº“å¤§éƒ¨åˆ†æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥ä¸”è¿”å› Promiseã€‚</p><p>ä¸ IndexedDB ç±»ä¼¼ï¼Œå®ƒä¹Ÿæœ‰ç›¸åº”çš„ä¸åŒæ¦‚å¿µï¼Œä¸”ä¸åŒçš„ç±»å°è£…äº†ä¸åŒçš„æ–¹æ³•</p><ul><li><code>Dexie</code> è¯¥åº“çš„æ ¸å¿ƒç±»ï¼Œé€šè¿‡è¯¥ç±»å®ä¾‹åŒ–ï¼Œå¯ä»¥åˆ›å»º/è¿æ¥ä¸€ä¸ª IndexedDB æ•°æ®åº“</li><li>Table è¯¥ç±»è¡¨ç¤ºå¯¹è±¡åº“ ObjectStore</li><li>Collection è¯¥ç±»è¡¨ç¤ºå¯¹è±¡åº“ä¸­ä¸€éƒ¨åˆ†æ•°æ®é¡¹ï¼Œå¯ä»¥ç†è§£ä¸ºæ•°æ®çš„æŸ¥è¯¢ç»“æœ</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/</span>
<span class="token comment">// å®ä¾‹åŒ–ä¸€ä¸ªæ•°æ®åº“</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dexie</span><span class="token punctuation">(</span><span class="token string">&#39;tagdown&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å£°æ˜ç‰ˆæœ¬å’Œæ•°æ®ç»“æ„ï¼ˆå¯¹è±¡åº“ï¼‰</span>
db<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stores</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// åˆ›å»º 3 ä¸ªå¯¹è±¡åº“ï¼Œé”®ä¸ºå¯¹è±¡åº“çš„åç§°ï¼Œå€¼æ˜¯å¯¹è±¡åº“çš„ä¸­æ•°æ®é¡¹çš„é”®å’Œç´¢å¼•ï¼Œç”¨é€—å·åˆ†éš”</span>
  bookmark<span class="token operator">:</span> <span class="token string">&#39;id, *tags, *groups&#39;</span><span class="token punctuation">,</span> <span class="token comment">// ç¬¬ä¸€ä¸ªæ˜¯æŒ‡å®šç”¨ä½œä¸ºé”®çš„å±æ€§ï¼Œä¹‹åå°±æ˜¯ç´¢å¼•</span>
  <span class="token comment">// åŠ æ˜Ÿå· * è¡¨ç¤ºæ•°æ®ç›¸åº”å±æ€§å€¼ä¸ºæ•°ç»„ï¼Œä¸”å°†æ•°ç»„çš„æ¯ä¸ªå…ƒç´ ä½œä¸ºç´¢å¼•</span>
  share<span class="token operator">:</span> <span class="token string">&#39;id, share&#39;</span><span class="token punctuation">,</span>
  star<span class="token operator">:</span> <span class="token string">&#39;id, star&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// æ‰“å¼€/åˆ›å»ºæ•°æ®åº“ï¼Œå¼‚æ­¥æ“ä½œ</span>
db<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">database</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  app<span class="token punctuation">.</span><span class="token function">provide</span><span class="token punctuation">(</span><span class="token string">&#39;db&#39;</span><span class="token punctuation">,</span> database<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é€šè¿‡ provide-inject çš„æ–¹å¼å°†æ•°æ®åº“å¯¹è±¡æä¾›ç»™åº”ç”¨ä¸­å…¶ä»–ç»„ä»¶ä½¿ç”¨</span>
  app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&#39;#app&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Error occurred</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>ğŸ’¡ æ ¹æ®å®˜æ–¹çš„<a href="https://dexie.org/docs/Dexie/Dexie.open()" target="_blank" rel="noopener noreferrer">æ“ä½œæŒ‡å—</a>ï¼Œ<strong>ä¸å¿…</strong>åˆ¤æ–­æµè§ˆå™¨ä¸­æ˜¯å¦æœ‰å·²æœ‰åŒåçš„æ•°æ®ï¼Œå› ä¸ºæ¯æ¬¡å°è¯•è¿æ¥æ•°æ®åº“æ—¶ï¼ŒDexie ä¼šè‡ªåŠ¨åˆ¤æ–­ï¼ŒæŒ‰éœ€æ‰“å¼€å·²æœ‰æ•°æ®åº“æˆ–åˆ›å»ºä¸€ä¸ªæ–°æ•°æ®åº“ã€‚</p><p>ä»¥ä¸‹åˆ—å‡ºåœ¨é¡¹ç›®ä¸­ä¸æ•°æ®åº“ç›¸å…³çš„ä¸€äº›ä¸»è¦æ–¹æ³•</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/composables/useBookmark.js</span>
<span class="token comment">// ...</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;db&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åŸºäºé”® id æŸ¥è¯¢æ•°æ®</span>
<span class="token keyword">const</span> <span class="token function-variable function">getBookmarkDB</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> bookmark <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>bookmark<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> bookmark<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// å‘ bookmark å¯¹è±¡åº“æ·»åŠ æ•°æ®</span>
<span class="token keyword">const</span> <span class="token function-variable function">setBookmarkDB</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> bookmark</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// console.log(bookmark);</span>
  <span class="token keyword">await</span> db<span class="token punctuation">.</span>bookmark<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token punctuation">,</span>
    title<span class="token operator">:</span> bookmark<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
    url<span class="token operator">:</span> bookmark<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
    faviconUrl<span class="token operator">:</span> bookmark<span class="token punctuation">.</span>faviconUrl<span class="token punctuation">,</span>
    tags<span class="token operator">:</span> bookmark<span class="token punctuation">.</span>tags<span class="token punctuation">,</span>
    groups<span class="token operator">:</span> bookmark<span class="token punctuation">.</span>groups<span class="token punctuation">,</span>
    description<span class="token operator">:</span> bookmark<span class="token punctuation">.</span>description<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// åŸºäºé”® id åˆ é™¤æ•°æ®</span>
<span class="token keyword">const</span> <span class="token function-variable function">deleteBookmarkDB</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> db<span class="token punctuation">.</span>bookmark<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>è·å–ç´¢å¼•çš„æ‰€æœ‰å€¼</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/options/App.vue</span>
<span class="token comment">// ...</span>
<span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span><span class="token string">&#39;db&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// è·å–æ•°æ®åº“ä¸­ç´¢å¼• tags çš„æ‰€æœ‰å¯èƒ½çš„å€¼</span>
  allTags<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span>bookmark<span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span><span class="token string">&#39;tags&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">uniqueKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ä½¿ç”¨ <code>where</code> æŸ¥è¯¢è¯­å¥</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>// src/options/App.vue
// ...
const db = inject(&#39;db&#39;);
// ç­›é€‰æ¡ä»¶æ˜¯ç´¢å¼• share çš„å€¼ä¸º 1ï¼Œå¹¶è¿”å›ä¸€ä¸ªç”±è¿™äº›æ•°æ®çš„é”®å€¼æ„æˆçš„æ•°ç»„
const getShareableIds = async () =&gt; {
  const result = await db.share.where(&#39;share&#39;).equals(1).primaryKeys();
  return result;
};
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>å°†æŸ¥è¯¢ç»“æœè½¬æ¢ä¸ºæ•°ç»„</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>// src/popup/components/BrowserPage.vue
// ...
const db = inject(&#39;db&#39;);
const starNodes = await db.star.where({ star: 1 }).toArray();
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>å¯¼å…¥ã€å¯¼å‡º IndexedDB æ•°æ®åº“</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>// src/options/App.vue
// ...
import {
  importDB, exportDB, importInto, peakImportFile,
} from &#39;dexie-export-import&#39;;

// ...
// å¯¼å‡ºæ•°æ®åº“ä¸º blob
blob = await exportDB(db, {
  prettyJson: true,
});

// ...
// å¯¼å…¥æ•°æ®åº“
await importInto(db, file, {
  overwriteValues: true,
}).then(() =&gt; {
  console.log(&#39;import database successful!&#39;);
}).catch((err) =&gt; {
  console.log(err);
});
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="æ•°æ®åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åŒæ­¥" aria-hidden="true">#</a> æ•°æ®åŒæ­¥</h2><p>åœ¨æ‰©å±•ç¨‹åºä¸­ä½¿ç”¨ <a href="https://www.bilibili.com/video/BV1up4y1s7VP?p=12" target="_blank" rel="noopener noreferrer">WebDAV</a> <strong>åŒæ­¥å¤‡ä»½</strong> IndexedDB æ•°æ®åº“ã€‚å¯ä»¥å°†ä¹¦ç­¾æŒ‰ç»„åˆ«<strong>åŒæ­¥åˆ†äº«</strong>ä¸º <a href="https://www.bilibili.com/video/BV1up4y1s7VP?p=10" target="_blank" rel="noopener noreferrer">Gist</a>ã€‚</p><h3 id="webdav" tabindex="-1"><a class="header-anchor" href="#webdav" aria-hidden="true">#</a> WebDAV</h3><p>ä½¿ç”¨ <a href="https://github.com/perry-mitchell/webdav-client" target="_blank" rel="noopener noreferrer">webdav-client</a> åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ª WebDAV å®¢æˆ·ç«¯å¯ç”¨äº NodeJS æˆ–æµè§ˆå™¨ç¯å¢ƒã€‚</p><p>åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤å®‰è£…è¯¥æ¨¡å—åŠå…¶ç›¸åº”çš„ä¾èµ–</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> webdav --save
</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><p>ç„¶ååŸºäº WebDAV æœåŠ¡å™¨åœ°å€ã€ç”¨æˆ·åã€å¯†ç åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯å®ä¾‹</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/composables/useWebDAV.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;webdav/web&#39;</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
<span class="token comment">// create webDAV client</span>
<span class="token keyword">const</span> <span class="token function-variable function">createWebDAVClient</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> username<span class="token punctuation">,</span> password</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">createClient</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    username<span class="token punctuation">,</span>
    password<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> client<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ğŸ’¡ ç”±äºæ‰©å±•ç¨‹åºçš„åŸŸåå’Œéœ€è¦è®¿é—®çš„ WebDAV æœåŠ¡å™¨åŸŸåä¸åŒï¼Œæ‰©å±•ç¨‹åºæ”¯æŒè·¨åŸŸè®¿é—®å…¶ä»–æœåŠ¡å™¨ï¼Œä½†éœ€è¦å°†æœåŠ¡å™¨åœ°å€æ·»åŠ åˆ°æ‰©å±•ç¨‹åºçš„é…ç½®æ¸…å• <code>manifest.json</code> çš„<code>host_permissions</code> å±æ€§ä¸­ï¼Œä¾‹å¦‚ä½¿ç”¨<a href="https://help.jianguoyun.com/?p=2064" target="_blank" rel="noopener noreferrer">åšæœäº‘çš„ WebDAV æœåŠ¡</a></p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// çœç•¥æ˜¾ç¤ºå…¶ä»–éƒ¨åˆ†</span>
  <span class="token property">&quot;host_permissions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;https://dav.jianguoyun.com/dav/&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// çœç•¥æ˜¾ç¤ºå…¶ä»–éƒ¨åˆ†</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>ä»¥ä¸‹åˆ—å‡ºåœ¨é¡¹ç›®ä¸­ä¸ WebDAV ç›¸å…³çš„ä¸€äº›ä¸»è¦æ–¹æ³•</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/composables/useWebDAV.js</span>

<span class="token comment">// ...</span>
<span class="token comment">// æ£€æŸ¥ WebDAV æœåŠ¡å™¨è¿æ¥çŠ¶æ€</span>
<span class="token keyword">const</span> <span class="token function-variable function">checkWebDAVConnect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">client</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">stat</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      state<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      msg<span class="token operator">:</span> <span class="token string">&#39;è¿æ¥æˆåŠŸ&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        state<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        stateCode<span class="token operator">:</span> <span class="token number">401</span><span class="token punctuation">,</span>
        msg<span class="token operator">:</span> <span class="token string">&#39;æœªè·å¾—è®¿é—®æƒé™&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        state<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        stateCode<span class="token operator">:</span> <span class="token number">404</span><span class="token punctuation">,</span>
        msg<span class="token operator">:</span> <span class="token string">&#39;è¿æ¥å¤±è´¥&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ£€æŸ¥æ–‡ä»¶å¤¹å­˜åœ¨ä¸å¦ï¼Œå¦‚æœä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</span>
<span class="token keyword">const</span> <span class="token function-variable function">checkWebDAVFolder</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">client<span class="token punctuation">,</span> folderPath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span>folderPath<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">createDirectory</span><span class="token punctuation">(</span>folderPath<span class="token punctuation">,</span> <span class="token punctuation">{</span> recursive<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// è·å–æ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶</span>
<span class="token keyword">const</span> <span class="token function-variable function">getWebDAVFolder</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">client<span class="token punctuation">,</span> folderPath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">getDirectoryContents</span><span class="token punctuation">(</span>folderPath<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">contents</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>contents<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è·å–æ–‡ä»¶å¤¹ä¸­æœ€åæ›´æ–°çš„æ–‡ä»¶</span>
<span class="token comment">// è¿™é‡Œæ˜¯ä¸ºäº†è·å– WebDAV çš„æœ€åå¤‡ä»½åŒæ­¥æ—¶é—´</span>
<span class="token comment">// ç”±äºè®¿é—®æ“ä½œä¼šè§¦å‘æ–‡ä»¶å¤¹çš„æ›´æ–°ï¼Œæ‰€ä»¥è¿™é‡Œå®é™…ä¸Šæ˜¯è·å–æ–‡ä»¶å¤¹ä¸­æœ€åæ›´æ–°çš„æ–‡ä»¶çš„æ—¶é—´æˆ³</span>
<span class="token keyword">const</span> <span class="token function-variable function">getWebDAVLastFileState</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">client<span class="token punctuation">,</span> folderPath</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">checkWebDAVFolder</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> folderPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> filesArr <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getWebDAVFolder</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> folderPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>filesArr<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">// ç”±äºå­˜å‚¨çš„å¤‡ä»½æ–‡ä»¶å‘½åè§„åˆ™æ˜¯ tagdown_{timestamp}</span>
  <span class="token comment">// æ‰€ä»¥æ–‡ä»¶åˆ—è¡¨æœ€åä¸€ä¸ªå°±æ˜¯æœ€æ–°åˆ›å»ºçš„å¤‡ä»½æ–‡ä»¶</span>
  <span class="token keyword">const</span> lastFile <span class="token operator">=</span> filesArr<span class="token punctuation">[</span>filesArr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> lastFile<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// è·å–æ–‡ä»¶å†…å®¹</span>
<span class="token keyword">const</span> getWebDAVFile <span class="token operator">=</span> <span class="token punctuation">(</span>client<span class="token punctuation">,</span> filePath<span class="token punctuation">,</span> format <span class="token operator">=</span> <span class="token string">&#39;text&#39;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">getFileContents</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token punctuation">{</span> format <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// å†™å…¥æ–‡ä»¶å†…å®¹</span>
<span class="token keyword">const</span> <span class="token function-variable function">writeWebDAVFile</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">client<span class="token punctuation">,</span> folderPath<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> <span class="token function">checkWebDAVFolder</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> folderPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">putFileContents</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>folderPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fileName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    contentLength<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// console.log(res);</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      state<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      msg<span class="token operator">:</span> <span class="token string">&#39;WebDAV åŒæ­¥æˆåŠŸ&#39;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    state<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    msg<span class="token operator">:</span> <span class="token string">&#39;WebDAV åŒæ­¥å¤±è´¥&#39;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><h3 id="gist" tabindex="-1"><a class="header-anchor" href="#gist" aria-hidden="true">#</a> Gist</h3><p>Github æä¾›äº†ä¸€ç³»åˆ— <a href="https://docs.github.com/en/rest" target="_blank" rel="noopener noreferrer">RESTful API</a>ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€äº›<a href="https://docs.github.com/en/rest/reference/gists" target="_blank" rel="noopener noreferrer">ä¸ Gist äº¤äº’çš„ APIs</a>ã€‚ <a href="https://github.com/settings/tokens/new" target="_blank" rel="noopener noreferrer">ç”³è¯·</a>ä¸ªäºº<a href="https://docs.github.com/cn/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token" target="_blank" rel="noopener noreferrer">è®¿é—®ä»¤ç‰Œ</a>ï¼Œå°±å¯ä»¥åœ¨æ‰©å±•ç¨‹åºä¸­ç®¡ç† Gistï¼Œå°†ç‰¹å®šçš„ä¹¦ç­¾ä»¥ gist ä»£ç ç‰‡æ®µçš„å½¢å¼åˆ†äº«åˆ° Githubã€‚</p><p>ğŸ’¡ ç”±äºåœ¨å¼•å…¥ <a href="https://www.axios-http.cn/" target="_blank" rel="noopener noreferrer">axios</a> æ¨¡å—æ—¶å‡ºé”™ï¼Œæ‰€ä»¥åœ¨æ‰©å±•ç¨‹åºä¸­ä½¿ç”¨ <code>fetch</code> å‘ Github å‘é€ç½‘ç»œè¯·æ±‚ã€‚</p><p>ä»¥ä¸‹åˆ—å‡ºåœ¨é¡¹ç›®ä¸­ä¸ WebDAV ç›¸å…³çš„ä¸€äº›ä¸»è¦æ–¹æ³•</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/somposables/useGist.js</span>

<span class="token comment">//...</span>
<span class="token comment">// åˆ›å»º Gist</span>
<span class="token keyword">const</span> <span class="token function-variable function">createGist</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">token<span class="token punctuation">,</span> gist</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;https://api.github.com/gists&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä½¿ç”¨ POST æ–¹æ³•</span>
    method<span class="token operator">:</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span>
    <span class="token comment">// æ ¹æ®å®˜æ–¹æ–‡æ¡£ https://docs.github.com/en/rest/reference/gists#create-a-gist</span>
    <span class="token comment">// è¯·æ±‚ä½“å¯ä»¥è®¾ç½®å¤šç§å‚æ•°ï¼Œå³å…¥å‚ gist å¯ä»¥åŒ…å«ä»¥ä¸‹å±æ€§</span>
    <span class="token comment">// * descripton æè¿° </span>
    <span class="token comment">// * filesï¼ˆå±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› ä¸ºä¸€ä¸ª Gist å¯ä»¥åŒ…å«å¤šä¸ªä»£ç æ–‡ä»¶ç‰‡æ®µï¼Œè¯¥å¯¹è±¡ä¸­ï¼Œæ¯ä¸€ä¸ªå±æ€§å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå±æ€§åæ˜¯æ–‡ä»¶åï¼Œå±æ€§å€¼æ˜¯æ–‡ä»¶å†…å®¹ï¼‰</span>
    <span class="token comment">// * publicï¼Œæ˜¯å¦ä¸ºå…¬å¼€ Gist æˆ–ç§å¯† Gist </span>
    body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>gist<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// åœ¨è¯·æ±‚å¤´æ·»åŠ è®¤è¯ä¿¡æ¯</span>
    headers<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span>
      Authorization<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">201</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> resData <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        state<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        msg<span class="token operator">:</span> <span class="token string">&#39;åˆ›å»ºæˆåŠŸ&#39;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> resData<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;fail&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        state<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        msg<span class="token operator">:</span> <span class="token string">&#39;åˆ›å»ºå¤±è´¥&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Error:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        state<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        msg<span class="token operator">:</span> <span class="token string">&#39;åˆ›å»ºå¤±è´¥&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ›´æ–° Gist</span>
<span class="token keyword">const</span> <span class="token function-variable function">updateGist</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">token<span class="token punctuation">,</span> gistId<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://api.github.com/gists/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>gistId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// ä½¿ç”¨ PATCH æ–¹æ³•</span>
    method<span class="token operator">:</span> <span class="token string">&#39;PATCH&#39;</span><span class="token punctuation">,</span>
    <span class="token comment">// æ ¹æ®å®˜æ–¹æ–‡æ¡£ https://docs.github.com/en/rest/reference/gists#update-a-gist</span>
    <span class="token comment">// è¯·æ±‚ä½“å¯ä»¥è®¾ç½®å¤šç§å‚æ•°ï¼Œå³å…¥å‚ data å¯ä»¥åŒ…å«ä»¥ä¸‹å±æ€§</span>
    <span class="token comment">// * gist_id éœ€è¦æ›´æ–°çš„ Gist ID</span>
    <span class="token comment">// * desciption æè¿°</span>
    <span class="token comment">// * files æ–‡ä»¶ filesï¼ˆå±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› ä¸ºä¸€ä¸ª Gist å¯ä»¥åŒ…å«å¤šä¸ªä»£ç æ–‡ä»¶ç‰‡æ®µï¼Œè¯¥å¯¹è±¡ä¸­ï¼Œæ¯ä¸€ä¸ªå±æ€§å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œå±æ€§åæ˜¯æ–‡ä»¶åï¼Œå±æ€§å€¼æ˜¯æ–‡ä»¶å†…å®¹ï¼‰</span>
    body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token operator">...</span>data<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    headers<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Headers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">&#39;Content-Type&#39;</span><span class="token operator">:</span> <span class="token string">&#39;application/json&#39;</span><span class="token punctuation">,</span>
      Authorization<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> resData <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        state<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        msg<span class="token operator">:</span> <span class="token string">&#39;æ›´æ–°æˆåŠŸ&#39;</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> resData<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;fail&#39;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        state<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        msg<span class="token operator">:</span> <span class="token string">&#39;æ›´æ–°å¤±è´¥&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Error:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        state<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        msg<span class="token operator">:</span> <span class="token string">&#39;æ›´æ–°å¤±è´¥&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><h2 id="åå°ç›‘æ§" tabindex="-1"><a class="header-anchor" href="#åå°ç›‘æ§" aria-hidden="true">#</a> åå°ç›‘æ§</h2><p>âš ï¸ å¦‚æœå¸Œæœ›åœ¨åå°è„šæœ¬ä¸­ <code>import</code> å¼•å…¥å…¶ä»–åº“ï¼Œéœ€è¦åœ¨é…ç½®æ¸…å• <code>manifest.json</code> ä¸­å°†åå°è„šæœ¬ç±»å‹å£°æ˜ä¸ºæ¨¡å— <code>module</code></p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token property">&quot;background&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;service_worker&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./background/main.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>æ‰©å±•ç¨‹åºçš„åå°æ˜¯ä¸€ä¸ª service workerï¼ŒåŸºäºç›‘æ§äº‹ä»¶-ä½œå‡ºå“åº”çš„æ¨¡å¼æ‰§è¡Œå‘½ä»¤ã€‚</p><p>å¯ä»¥åœ¨åå°ç›‘æ§æ ‡ç­¾é¡µçš„åˆ‡æ¢äº‹ä»¶ï¼ŒæŸ¥è¯¢å½“å‰æ¿€æ´»æ ‡ç­¾é¡µ URL æ˜¯å¦ä¸ä»»ä½•å·²ä¿å­˜çš„ä¹¦ç­¾ç›¸åŒ¹é…ï¼ŒåŠ¨æ€æ›´æ”¹ Action å›¾æ ‡ã€‚å®ç°ç±»ä¼¼äº Chrome åœ°å€æ å³ä¾§çš„æ˜Ÿå‹å›¾æ ‡åˆ‡æ¢çŠ¶æ€ï¼Œä»¥æŒ‡ç¤ºå½“å‰æ ‡ç­¾æ˜¯å¦å·²æ”¶è—çš„åŠŸèƒ½ã€‚</p><p><img src="/blog-web/assets/change-action-icon.2273af65.gif" alt="change action"></p><p>ä¸»è¦ä½¿ç”¨ Chrome æä¾›çš„ä¸¤ä¸ª APIs å®ç°è¯¥åŠŸèƒ½ï¼š</p><ul><li><code>chrome.action.setIcon</code> åŠ¨æ€è®¾ç½® Action å›¾æ ‡</li><li><code>chrome.tabs.onActivated</code> ç›‘å¬æ ‡ç­¾æ¿€æ´»äº‹ä»¶</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// src/backrground/main.js</span>
<span class="token comment">// ...</span>

<span class="token doc-comment comment">/**
 * åŸºäºå½“å‰æ¿€æ´»æ ‡ç­¾æ˜¯å¦è¢«æ”¶è—ï¼ŒåŠ¨æ€æ›´æ”¹ Action å›¾æ ‡
 */</span>
<span class="token keyword">const</span> <span class="token function-variable function">changeActionIcon</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">tag <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setIcon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token number">16</span><span class="token operator">:</span> <span class="token string">&#39;/icons/icon16_tag.png&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">setIcon</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token number">16</span><span class="token operator">:</span> <span class="token string">&#39;/icons/icon16_untag.png&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬æ ‡ç­¾æ¿€æ´»äº‹ä»¶ï¼Œå›è°ƒå‡½æ•°æ¥æ”¶ä¸€ä¸ªå¯¹è±¡å…¥å‚ï¼Œå®ƒåŒ…å«æ¿€æ´»æ ‡ç­¾çš„ tabId</span>
chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span>onActivated<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">activeInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// åŸºäºæ¿€æ´»æ ‡ç­¾çš„ tabId è·å–æ ‡ç­¾å¯¹è±¡ï¼Œä»è€Œå¾—åˆ°ç›¸åº”çš„ url</span>
  <span class="token keyword">const</span> tab <span class="token operator">=</span> <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>tabs<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>activeInfo<span class="token punctuation">.</span>tabId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> tab<span class="token punctuation">.</span>url <span class="token operator">||</span> tab<span class="token punctuation">.</span>pendingUrl<span class="token punctuation">;</span>
  <span class="token comment">// åŸºäº url æŸ¥æ‰¾æ˜¯å¦æœ‰å·²æ”¶è—çš„ä¹¦ç­¾ä¸ä¹‹åŒ¹é…ï¼Œè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰åŒ¹é…ä¹¦ç­¾èŠ‚ç‚¹çš„æ•°ç»„</span>
  <span class="token keyword">const</span> nodes <span class="token operator">=</span> <span class="token keyword">await</span> chrome<span class="token punctuation">.</span>bookmarks<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> bookmarkState <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>nodes<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æœªæ‰¾åˆ°åŒ¹é…ä¹¦ç­¾</span>
    bookmarkState <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// æ‰¾åˆ°è‡³å°‘ä¸€ä¸ªåŒ¹é…ä¹¦ç­¾</span>
    bookmarkState <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>

  <span class="token comment">// åŸºäºä¹¦ç­¾åŒ¹é…æƒ…å†µæ›´æ”¹ Action å›¾æ ‡</span>
  <span class="token keyword">await</span> <span class="token function">changeActionIcon</span><span class="token punctuation">(</span>bookmarkState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>ğŸ’¡ è¿˜å¯ä»¥åŸºäºç›‘æ§å…¶ä»–äº‹ä»¶ï¼ŒåŠ¨æ€æ›´æ”¹ Action å›¾æ ‡ï¼š</p><ul><li><code>chrome.windows.onFocusChanged</code> æµè§ˆå™¨çª—å£æ›´æ”¹äº‹ä»¶</li><li><code>chrome.tabs.onUpdated</code> æ ‡ç­¾æ›´æ–°äº‹ä»¶ï¼Œä¾‹å¦‚æ ‡ç­¾é¡µçš„ URL æ›´æ”¹æ—¶</li><li><code>chrome.bookmarks.onCreated</code> æ–°å¢ä¹¦ç­¾äº‹ä»¶</li></ul><h2 id="è®¾ç½®é¡µé¢å¼€å‘" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®é¡µé¢å¼€å‘" aria-hidden="true">#</a> è®¾ç½®é¡µé¢å¼€å‘</h2><p>åœ¨è®¾ç½®é¡µé¢ä¸­ä¸»è¦æä¾›äº† IndexedDB æ•°æ®åº“çš„å¯¼å‡ºã€å¯¼å…¥ï¼Œä»¥åŠä¹¦ç­¾æŒ‰éœ€å¯¼å‡ºåŠŸèƒ½ã€‚</p><p>ç›®å‰æœ‰å¤šç§åº“æ”¯æŒåœ¨å‰ç«¯å°†æ•°æ®å¯¼å‡ºä¸ºæ–‡ä»¶ï¼Œä¾‹å¦‚ <a href="https://github.com/eligrey/FileSaver.js" target="_blank" rel="noopener noreferrer">FileSaver.js</a>ã€<a href="http://danml.com/download.html" target="_blank" rel="noopener noreferrer">download.js</a>ï¼Œåœ¨ TagDown çš„é…ç½®é¡µä¸­ï¼Œç”¨ Vanilla JS å®ç°äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼š</p><div class="language-vue ext-vue line-numbers-mode"><pre class="language-vue"><code>// src/options/App.vue

const exportJsonFile = (blob, fileName) =&gt; {
  if (!blob) return;
  const a = document.createElement(&#39;a&#39;);
  const url = window.URL.createObjectURL(blob);
  a.href = url;
  a.download = `${fileName}.json`;
  a.click();
};


// å°†å¯¹è±¡å‹æ•°æ®è½¬æ¢ä¸º JSON æ ¼å¼
const jsonData = JSON.stringify(data, null, 2);
// å†åŸºäº JSON æ ¼å¼çš„æ•°æ®åˆ›å»º Blob æ•°æ®
const blob = new Blob([jsonFile], { type: &#39;application/json&#39; });

// å†è§¦å‘ä¸‹è½½æ“ä½œ
exportJsonFile(blob, &#39;æ•°æ®å¯¼å‡º&#39;)
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">æ›´æ–°æ—¶é—´: </span><span class="meta-item-info">2021/10/25 ä¸Šåˆ7:31:04</span></div><!----></footer><!----><!--[--><!--]--></main><!--]--></div><div style="width:0px;" class="catalog-container absolute top-0 right-0 h-full hidden lg:block"><div class="headings-container sticky top-36" data-v-c28348e0><ul class="max-w-max m-2 pl-7 xl:pl-16 2xl:pl-20 py-4 opacity-50 hover:opacity-100 transition-all duration-300" data-v-c28348e0><!--[--><!--]--></ul></div></div><div style="display:none;" tabindex="0" class="sidebar-container fixed inset-y-0 left-0 z-20 lg:hidden opacity-10 hover:opacity-95"><div class="headings-container px-2 space-y-2 transition-all duration-300 py-20" data-v-6eed9461><!--[--><!--]--></div></div></div><footer class="bg-gray-200 p-8 grid grid-cols-1 md:grid-cols-3 gap-4 items-center"><div class="flex justify-center md:justify-start items-center"><a class="p-2 hover:bg-gray-300 rounded-md" href="https://benbinbin.github.io/" target="_blank"><img src="/blog-web/images/avatar.png" alt="avatar" class="w-10 h-10 rounded-full"></a></div><div class="text-center space-y-0.5"><p class="text-sm text-gray-600"> Â©2021 <span class="author">Benbinbin</span>. All Right Reserved. </p><p class="text-xs text-center text-gray-400"> é™¤ç‰¹æ®Šè¯´æ˜å¤–ï¼Œæœ¬ç«™çš„æ–‡ç« éµå¾ª <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" target="_blank" class="text-blue-400">CC-BY-SA-4.0</a> åè®® </p><p class="text-xs text-center text-gray-400"> ç½‘ç«™ä¸»é¢˜é‡‡ç”¨ <a href="https://github.com/Benbinbin/two-dishes-one-fish" target="_blank" class="text-blue-400">Two Dishes One Fish</a></p></div><div class="btn-container flex justify-center md:justify-end items-center space-x-0.5"><!--[--><a class="p-2 hover:bg-gray-300 rounded-md" href="mailto:benthomsonbin@gmail.com" target=""><img src="/blog-web/images/icons/email.svg" alt="email" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://github.com/Benbinbin" target="_blank"><img src="/blog-web/images/icons/github.svg" alt="github" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://juejin.cn/user/3175045314389278/posts" target="_blank"><img src="/blog-web/images/icons/juejin.svg" alt="juejin" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://dribbble.com/BinBinDesign" target="_blank"><img src="/blog-web/images/icons/dribbble.svg" alt="dribbble" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://twitter.com/Benbinbin_fun" target="_blank"><img src="/blog-web/images/icons/twitter.svg" alt="twitter" class="w-auto h-6"></a><a class="p-2 hover:bg-gray-300 rounded-md" href="https://weibo.com/binbindesign" target="_blank"><img src="/blog-web/images/icons/weibo.svg" alt="weibo" class="w-auto h-6"></a><!--]--></div></footer></div><!--]--></div>
    <script type="module" src="/blog-web/assets/app.43fe0c63.js" defer></script>
  </body>
</html>
